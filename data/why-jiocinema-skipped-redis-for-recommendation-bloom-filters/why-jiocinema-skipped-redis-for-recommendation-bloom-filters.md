
<!--
title: 为什么JioCinema在推荐布隆过滤器中跳过了Redis
cover: https://cdn.thenewstack.io/media/2025/02/6dd1e3d9-streaming.jpg
-->

为什么这家印度流媒体服务公司选择了这条非传统的道路，包括更明显的解决方案的权衡。

> 译自 [Why JioCinema Skipped Redis for Recommendation Bloom Filters](https://thenewstack.io/why-jiocinema-skipped-redis-for-recommendation-bloom-filters/)，作者 Cynthia Dunlop。

当您登录您最喜欢的流媒体服务时，第一印象至关重要。精选内容应该立即吸引您进入狂看模式。如果它充满了您已经看过的节目和电影，您的大脑会迅速切换到“嗯，现在是取消这项服务的时候了吗？”模式。

在技术层面，确保推荐内容的新鲜度是每个流媒体平台都面临的问题。但标准的解决方案并不适合JioCinema，这是一家著名的印度流媒体服务，以其经济实惠和广泛的内容库而闻名。它正在经历爆炸式增长，拥有打破世界纪录的6.2亿印度板球超级联赛（IPL）观众，峰值超过2000万并发观众。

该公司没有构建自己的布隆过滤器或使用像[Redis](https://redis.com/?utm_content=inline+mention)布隆过滤器这样的常见解决方案，而是采取了不同的路径：使用ScyllaDB的内置布隆过滤器支持来实时检查观看状态。

JioCinema的Charan Kamal，一位后端开发人员，和Harshit Jain，一位软件工程师，最近分享了他们为什么采取这种非常规路径，包括更明显的解决方案的权衡以及使用ScyllaDB实现这一点的后勤保障。

观看他们完整的[技术讲座](https://youtu.be/DWeRbmu0kJ0)，或继续阅读以浏览重点。

*喜欢这样的工程案例研究吗？在**Monster Scale Summit**（免费+虚拟）上选择您自己的50多个技术讲座。您可以向Martin Kleppmann、Kelsey Hightower和Gwen Shapira等专家，以及来自Discord、Disney+、Slack、Atlassian、Uber、Canva、Medium、Cloudflare等公司的工程师学习。*

## 挑战：用于新鲜推荐的“观看折扣”

JioCinema是一个领先的“OTT”（Over-The-Top）流媒体平台。该服务提供顶级的印度和国际娱乐节目，包括直播体育赛事（从IPL板球到西甲欧洲足球联赛到NBA篮球）、新电影、HBO原创剧集等。庞大的内容库涵盖10种印度语言。

JioCinema应用程序使用像“因为您看过”这样的自定义内容托盘来保持用户的参与度，并帮助他们发现新内容。例如，在用户完成“权力的游戏”后，该平台通常会推荐“龙之家族”——但如果用户已经看过它，它会推荐其他内容。

![](https://cdn.thenewstack.io/media/2025/02/f3859cf8-image3-1024x576.png)

正如Jain所说，“这些个性化的托盘不仅能让客户保持参与，还能提高内容的可发现性，从而培养长期的参与度并降低客户流失率。然而，个性化也带来了自身的挑战，特别是推荐客户已经观看过的内容的问题。为了解决这个问题，我们实施了一个解决方案，并将其称为‘观看折扣’。”

这项服务必须以具有成本效益的方式满足令人印象深刻的规模（每天有1000万活跃用户观看数十万个节目和电影）的低延迟要求。Kamal解释说：“考虑到我们庞大的客户群和目录，我们必须使用一种空间效率高且速度快的数据结构。虽然我们希望保持推荐内容的新鲜度，但我们也希望避免过度工程化并使系统过于复杂。我们可以容忍偶尔的误报。因此，这使我们想到了布隆过滤器——一种空间效率高的概率数据结构，专为快速查找集合中的成员身份而设计。”

## 自定义和Redis布隆过滤器的问题

好的，但是*哪种*布隆过滤器最适合这里？

该团队首先考虑构建一个自定义布隆过滤器来存储和提供内容。虽然这种“有趣的练习”可以完全控制实现，但它带来了重大的扩展挑战。他们不相信一个简单的布隆过滤器映射可以垂直扩展，以跟上JioCinema庞大且快速增长的用户群。水平扩展将需要实施粘性会话，其中特定的pod将为特定用户保存布隆过滤器，或者在系统中的每个pod中复制数据。虽然这将是一个有趣的工程挑战，但从商业角度来看，这没有任何意义。

他们探索的下一个选项是具有布隆过滤器功能的[Redis](https://thenewstack.io/redis-data-types-the-basics/)。他们使用[开源Redis集群](https://thenewstack.io/valkey-whats-new-and-whats-next/)进行的初步测试揭示了Redis集群拓扑的一个有趣问题。在高负载期间，节点偶尔会变热并触发故障转移，从而将副本提升为主节点。这产生了一种级联效应，其中集群中的整个节点变得不可用，而主副本提升在一个无休止的循环中继续进行。
为了避免这种风险，他们探索了 Redis Enterprise。这种方法显示出显著的[性能改进](https://thenewstack.io/the-architects-guide-to-open-table-formats-and-object-storage/)，并且确实满足了他们的服务级别协议要求。然而，有一个问题。JioCinema 的业务需要在多个区域实现毫秒级的延迟。

![](https://cdn.thenewstack.io/media/2025/02/a3aee499-image1-1024x576.png)

根据 Kamal 的说法，“即使使用 Redis Enterprise，我们仍然需要在保持低延迟的主动-主动部署和牺牲某些区域的客户体验之间做出选择。后者对于我们的用例是不可接受的。此外，Redis Enterprise 对每个操作和复制都收取高昂的费用，使得我们很难证明这项功能对我们业务的投资回报率。这促使我们探索 ScyllaDB。”

## 使用 ScyllaDB 实现观看折扣

Kamal 继续说道，“ScyllaDB 不仅开箱即用地支持 Bloom 过滤器，而且我们之前也有使用它来处理不同个性化用例的经验。考虑到它卓越的速度以及将数据复制到多个区域并为来自其原产地附近的客户提供服务的能力，ScyllaDB 似乎是一个全面的解决方案。这使我们能够专注于开发对我们的客户而言最重要的东西，并使我们能够快速进入市场。”

如下图所示，“观看折扣”功能由两个摄取管道提供支持。

![](https://cdn.thenewstack.io/media/2025/02/a4278f24-image2-1024x370.png)

批处理过程计算用户在指定时间窗口内的观看历史记录，确定内容是否满足完成标准以被视为“已观看”。如果是，系统将使用生存时间 (TTL) 属性更新 ScyllaDB 表，确保内容仅在指定时间后才能被重新发现。

短视频（30 到 60 秒的视频，可带来高参与度）需要不同的处理方式。在这里，内容必须立即标记为“已观看”，因此使用实时事件流来更新观看折扣存储库。

## 为什么选择 ScyllaDB

Kamal 总结道，“正如前面提到的，采用 ScyllaDB 使我们能够优先开发新功能，而不是创建数据结构。这种方法使我们能够保持节点的小型化，并在 Bloom 过滤器和过滤已观看内容之间保持清晰的关注点分离。ScyllaDB 无与伦比的性能变得显而易见，尤其是在处理高基数分区和小数据量时——这正是我们数据集的特征。TTL 使清理变得容易，并允许在指定时间后发现已观看的内容。此外，从 `LOCAL_QUORUM` 读取确保我们可以从离用户最近的区域访问数据，从而实现高吞吐量和更低的延迟。ScyllaDB 中这些功能的战略性组合极大地提高了我们系统的功效和效率。”
