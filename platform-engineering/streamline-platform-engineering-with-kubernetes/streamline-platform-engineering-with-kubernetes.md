# 使用 Kubernetes 精简平台架构工程

平台架构工程涉及创建一个环境，使开发人员可以专注于构建应用程序。Kubernetes 可以提供帮助。

翻译自 [Streamline Platform Engineering with Kubernetes](https://thenewstack.io/streamline-platform-engineering-with-kubernetes/) 。很赞同本文，有时我会想，如果没有 Kubernetes ，对大多数平庸的我们来说，根本没有能力构建出自己的平台。

![](https://cdn.thenewstack.io/media/2023/09/9b3cc903-harbour-city-3928590_1280-1024x682.jpg)
*图片来自 Pixabay 的 Rush4*

平台工程在现代应用程序开发和部署领域发挥着关键作用。随着软件应用程序变得越来越复杂和分布式，需要一个强大和可扩展的基础设施已经变得至关重要。这就是平台工程发挥作用的地方，它充当支撑整个软件开发生命周期的 backbone。让我们深入探讨平台工程在为应用程序创建和维护基础设施方面的关键作用。

## 理解平台工程

在其核心，平台工程涉及创建一个环境，使开发人员可以专注于构建应用程序，而不必承担管理基础设施复杂性的负担。平台工程师架构，构建和维护必要的基础设施和工具，以确保应用程序平稳高效地运行，不管它们可能包含的复杂性。

在应用程序开发的动态世界中，平台工程师面临着多方面的挑战。最突出的挑战之一是管理各种各样的应用程序和服务，这些应用程序和服务在需求、技术和运营需求方面各不相同。随着应用程序跨云环境、内部设置和混合配置展开，平台工程师的任务是创建一个统一、一致和可靠的基础设施。

高效地管理这个多样化的环境对于确保应用程序的可靠性和可用性至关重要。如果没有精简的管理，就会出现低效，导致资源浪费、运营瓶颈和敏捷性降低。这就是 Kubernetes 作为平台工程转型解决方案发挥作用的地方。

## 进入Kubernetes: 一个强大的解决方案

Kubernetes 是一个容器编排平台，已经成为平台工程领域的突破。凭借其自动化部署、扩展和管理容器化应用程序的能力，Kubernetes 解决了平台工程师所面临的挑战。通过提供一个统一的平台来管理基础设施的应用程序，Kubernetes 与平台工程的目标完美契合。

Kubernetes 减轻了平台工程师的负担，允许他们以声明的方式定义应用程序部署、扩展和管理流程。这消除了手动干预，简化了重复任务，使平台工程师能够专注于更高级别的策略和优化。

此外，Kubernetes 通过提供应用程序部署和基础设施管理的通用语言，促进了不同团队(包括开发人员和运营人员)之间的协作。这培育了 DevOps 文化，在这种文化中，开发和运营之间的界限模糊，团队协作工作以实现共同目标。

从这里，我们将深入研究 Kubernetes 编排的具体内容以及它如何革新平台工程实践。从管理多租户到自动化基础设施，从确保安全到优化可扩展性，Kubernetes 提供了一个全面的工具包，满足平台工程师的复杂需求。加入我们的行列，一起探索 Kubernetes 如何使平台工程简化部署和管理，最终导致更高效和可靠的软件生态系统。

## 管理多样化应用程序的挑战: 平台工程师的困境

平台工程师的角色类似于一个繁忙大都市的建筑师，负责设计和维护支持各种应用程序和服务的基础设施。然而，在今天的技术环境中，这项任务变得越来越复杂和具有挑战性。平台工程师在努力管理各种应用程序和服务以跨越复杂和动态的环境时面临一系列困难。

在不断扩大的数字领域，应用程序在技术、框架和依赖项方面展示出惊人的多样性。从微服务到单体，从无状态到有状态，每种应用程序类型都提出了自己的一系列需求。平台工程师的任务是创建一个无缝适应这种多样性的环境，确保每个应用程序都能够在不与其他应用程序干扰的情况下进行最佳操作。

现代应用不再局限于单个服务器或数据中心。它们跨越混合云设置，利用各种云提供商，并且通常结合内部资源。这种基础设施的异构性在资源分配、数据一致性和维护一致的运营策略方面带来了挑战。平台工程师必须找到方法将这些不同的元素统一成一个统一且高效的生态系统。

应用程序的资源需求很少是静态的。它们根据用户需求、季节性模式或推广活动的波动而涨落。平台工程师必须设计一个可以根据这些波动动态扩展资源的基础设施。这不仅需要技术精湛，还需要预测分析来准确预测资源需求。

在当今永不停止的数字环境中，停机不能成为选项。平台工程师的任务是确保应用程序的高可用性和容错能力，这通常涉及设置冗余系统、实施故障转移策略以及在出现故障时平稳过渡。当应用程序跨多个区域或云提供商展开时，这变得更加复杂。

应用程序和服务需要持续更新，以保持安全性，利用新功能，并与不断发展的技术保持兼容。但是，在不造成停机或兼容性问题的情况下更新应用程序是一个挑战。平台工程师需要仔细协调更新，通常需要广泛的测试和规划以确保平稳过渡。

在网络安全威胁高度和数据法规日益严格的时代，平台工程师必须优先考虑安全性和合规性。他们需要实施稳健的安全措施，控制对敏感数据的访问，并确保应用程序遵守行业特定法规。在安全性与可用性和性能之间取得平衡是一项持续的钢丝表演。

在一个具有多种应用程序和服务的环境中，实现标准化可能捉襟见肘。不同的开发团队可能有不同的部署实践、配置和工具集。平台工程师需要在满足这些独特要求和建立标准化流程以确保一致性和可管理性之间取得平衡。

## Kubernetes: 平台工程中的范式转变

随着平台工程师在管理各种应用程序和服务以跨越复杂环境时陷入困境，一个转型的曙光出现了: Kubernetes。这个开源容器编排平台迅速崛起，成为直接解决平台工程师面临挑战的强大解决方案。

每个应用程序都有其独特的要求和依赖项，可能会给平台工程师造成运营迷宫。Kubernetes 作为一种统一力量介入，为部署、管理和扩展应用程序提供了一个标准化的平台，不管其基本复杂性。通过将应用程序封装在容器中，Kubernetes 抽象出具体细节，使平台工程师能够一致地对待每个应用程序。

Kubernetes 不会回避现代基础设施的复杂性。无论应用程序跨越混合云设置、多个云提供商还是内部数据中心，Kubernetes 都为跨这些不同地形进行编排提供了一种通用语言。它提倡“一次编写，随处部署”的概念，允许平台工程师在各种环境中无缝利用相同的配置。

资源分配和根据波动的用户需求进行扩展的挑战在 Kubernetes 中找到了优雅的解决方案。通过它的自动缩放机制，例如水平 Pod 自动缩放，平台工程师能够设计可以根据实时指标动态扩展或缩减资源的系统。这种弹性确保了在不需要人工干预的情况下实现最佳性能。

Kubernetes 体现了高可用性和容错的原则，这些是平台工程的关键方面。通过自动负载均衡、健康检查和故障转移机制，Kubernetes 创建了一个环境，应用程序可以在故障和中断时正常运行。平台工程师可以设计在面对意外挑战时仍能保持持续服务的系统。

在尽量减少停机时间和兼容性问题的同时更新应用程序的艰巨任务在 Kubernetes 中找到了精简的方法。通过滚动更新和金丝雀部署等功能，平台工程师可以编排无缝、渐进和可逆的更新。这不仅增强了部署过程的可靠性，还提升了开发人员和运营团队的信心。

## 安全性和合规性位于核心

安全性在平台工程中至关重要，Kubernetes 在这方面也不遑多让。通过实施基于角色的访问控制(RBAC)、网络策略和机密管理，Kubernetes 使平台工程师能够建立稳健的安全实践。合规性要求也通过受控访问和敏感数据封装来满足。

Kubernetes 弥合了适应唯一应用程序要求和建立标准实践之间的差距。它为通过 Helm Chart 和 Operators 创建可重用组件奠定了基础，同时允许灵活性。这种标准化的旅程增强了可管理性，减少了人为错误，并增强了团队之间的协作。

在平台工程领域，多租户的概念立足于一个关键支柱。随着组织在共享基础设施中托管多个团队或项目，挑战在于确保资源隔离、安全性和高效管理。凭借其强大的功能集，Kubernetes 提供了一个有效的解决方案来应对多租户的复杂性。

## 理解多租户

多租户是指在单个基础设施中托管多个隔离的实例或“租户”的做法。这些租户可以是团队、部门或项目，每个都需要自己的隔离环境以防止干扰和保持安全。

Kubernetes 引入了 Namespace 的概念来解决多租户的需求。Namespace 是一个逻辑分区，允许在集群内进行资源隔离、命名唯一性和访问控制。平台工程师可以利用 Namespace 为不同的团队或项目创建隔离的环境，确保资源是隔离的并且可以独立管理。

以下是 Namespace 的一些优点:

* **资源隔离**: Namespace 提供了一个隔离的空间，其中包含诸如 pod、服务和配置等资源。这种隔离可防止不同团队或项目之间的冲突和资源争用。
* **安全性和访问控制**: Namespace 允许平台工程师为每个 Namespace 设置基于角色的访问控制(RBAC)规则。这可以确保团队成员只能访问和操纵其指定 Namespace 中的资源。
* **命名范围**: Namespace 确保跨不同团队或项目的命名唯一性。Namespace 内的资源由其名称标识，并且 Namespace 为这些名称提供明确的上下文，避免命名冲突。
* **逻辑分区**: 平台工程师可以在同一集群内逻辑上分割属于不同团队或项目的应用程序。这使得在共享基础设施中更容易管理多样化的应用程序景观。

**资源分配和隔离的挑战**

虽然 Kubernetes Namespace 为多租户提供了坚实的基础，但与资源分配和隔离相关的挑战仍然存在:

* **资源分配**: 在多租户环境中，资源分配变成了一项平衡行为。平台工程师需要确保每个 Namespace 都获得足够的资源，同时防止资源占用过多会影响其他 Namespace。
* **资源配额**: Kubernetes 允许在 Namespace 级别设置资源配额，这可能很难微调。在限制资源使用和允许灵活性之间取得正确平衡至关重要。
* **隔离保证**: 确保 Namespace 之间完全隔离需要仔细考虑。泄漏资源或 Namespace 之间的网络通信可能会损害预期的隔离。
* **管理复杂性**: 随着 Namespace 数量的增长，管理和维护配置、RBAC 规则和资源分配会变得具有挑战性。平台工程师需要高效的工具和策略来有效地管理这种复杂性。

在平台工程领域，效率和可靠性的追求依赖于自动化。凭借其强大的功能集，Kubernetes 成为平台工程师寻求自动化部署和扩展过程的灯塔。让我们探索 Kubernetes 如何简化这些过程，并使平台工程师能够提升其基础设施管理。

## Kubernetes Controller: 自动化引擎

Kubernetes 控制器在编排从扩展应用程序到确保自我修复的自动化任务中发挥着关键作用。

* **扩展**: 水平 Pod 自动扩展(HPA)是一个典型的例子。 HPA 根据观察到的 CPU 或自定义指标自动调整 pod 副本数。这确保应用程序可以无缝处理流量波动，而不需要人工干预。
* **自我修复**: 存活和就绪探测是促成应用程序自我修复的关键组件。存活探测检测到应用程序故障并触发 pod 重启，而就绪探测确保只有健康pod接收流量。
* **更新**: 诸如 Deployment 之类的 Kubernetes 控制器通过维护所需数量的副本并过渡到新版本来自动化应用程序更新。这在更新和回滚期间可以防止服务中断，确保平稳过渡。

### Kustomize: 自定义自动化

[Kustomize](https://kustomize.io/) 是一个允许平台工程师在不需要复杂模板化的情况下自定义 Kubernetes 清单的工具。它提供了一个声明式的配置管理方法，使工程师可以为不同的环境、团队或应用程序定义变体。

Kustomize 的一些好处包括:

* **重用性**: Kustomize 通过支持创建可以根据需要进行扩展或修改的基本配置来促进重用。
* **特定环境的定制**: 平台工程师可以为不同的环境(开发、暂存、生产)或团队定制配置，而无需复制整个配置。
* **效率**: Kustomize 通过减少重复和最小化手动编辑来减少风险不一致和错误。

### 政策执行和治理: 走向稳定之路

在平台工程动态的环境中，执行政策和治理变成确保稳定性、安全性和合规性的关键。 Kubernetes 及其强大的功能集政策执行确保平台遵循预定义的规则和标准。这包括访问控制、安全策略、资源配额和合规性要求。通过执行这些政策，平台工程师维护一个安全可靠的应用环境。

在动态的 Kubernetes 环境中，保持安全性和合规性可能具有挑战性。随着应用程序的发展，跟踪不断变化的政策并确保跨集群和 namespace 的一致执行变得复杂。Kubernetes 资源短暂的本质增加了在实现持久安全性和合规性方面的另一层复杂性。

## DevOps 文化和协作: 消除鸿沟

在追求高效和协作的平台工程的过程中，培育 DevOps 文化至关重要。

[DevOps 文化](https://thenewstack.io/the-devops-future-is-user-centric-platform-engineering/)弥合了开发、运维和平台工程团队之间的鸿沟。它鼓励无缝的沟通、共享目标和对整个应用生命周期的集体责任感。

Kubernetes 通过提供应用部署和基础设施管理的通用语言，充当协作的催化剂。它鼓励跨职能沟通，并允许团队在共享配置上协作工作。

Kubernetes 的声明性质和共享工具消除了传统工作流中常见的孤立。开发者、运维人员和平台工程师可以集体定义、管理和发展应用程序，而不受僵硬边界的限制。
