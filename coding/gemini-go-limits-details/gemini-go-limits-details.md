
<!--
title: åœ¨Goä¸­ä½¿ç”¨Geminié™åˆ¶å’Œç»†èŠ‚
cover: 
-->

ç”±è°·æ­Œå¼€å‘çš„å¤šæ¨¡å¼å¤§åž‹è¯­è¨€æ¨¡åž‹Geminiå·²ç»å¯ä»¥åœ¨Vertex AIä¸Šç”¨äºŽç”Ÿäº§çº§åº”ç”¨ã€‚ä¸ŽVertex AIçš„ä»»ä½•å…¶ä»–äº§å“ä¸€æ ·ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒè¯­è¨€ç¼–å†™çš„å®¢æˆ·ç«¯ä¸Žå…¶è¿›è¡Œäº¤äº’ï¼Œä¾‹å¦‚Pythonã€Javaå’ŒGoï¼Œæˆ–è€…ä½¿ç”¨æ™®é€šçš„HTTPè¯·æ±‚ã€‚æ¯•ç«Ÿï¼ŒVertex AIåªæ˜¯ä¸Žå„ç§æä¾›çš„æœåŠ¡è¿›è¡Œäº¤äº’çš„ç½‘ç»œç•Œé¢ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ä½¿ç”¨Goå®¢æˆ·ç«¯ä¸Žæ•°æ®â€œèŠå¤©â€ï¼Œå¹¶å±•ç¤ºæ¨¡åž‹åœ¨å¤„ç†ä¸Šä¸‹æ–‡é•¿åº¦æ—¶çš„ä¸€äº›é™åˆ¶ã€‚

> è¯‘è‡ª [Using Gemini in a Go application: limits and details](https://pgaleone.eu/golang/vertexai/2024/02/26/gemini-go-limits-details/)ï¼Œä½œè€… Paolo Galeoneã€‚

ä½œä¸ºä¸€ågopherï¼Œå½“å¼€å‘æ–°çš„Webåº”ç”¨ç¨‹åºæ—¶ï¼ŒGoæ˜¯æˆ‘é¦–é€‰çš„è¯­è¨€ã€‚æ­£å¦‚ä¸€äº›äººå¯èƒ½å·²ç»æ³¨æ„åˆ°çš„é‚£æ ·ï¼Œæˆ‘æ­£åœ¨æ’°å†™æœ‰å…³åœ¨åŒ»ç–—ä¿å¥é¢†åŸŸä½¿ç”¨Vertex AIå’ŒGoçš„æ–‡ç« ï¼Œä¾‹å¦‚ï¼š

- [åœ¨Google Cloudä¸Šä½¿ç”¨Vertex AIåœ¨Goä¸­è¿›è¡Œè‡ªå®šä¹‰æ¨¡åž‹è®­ç»ƒå’Œéƒ¨ç½²](https://pgaleone.eu/golang/vertexai/2023/08/27/vertex-ai-custom-training-go-golang/)
- [åœ¨Vertex AIä¸Šé’ˆå¯¹è¡¨æ ¼æ•°æ®çš„è‡ªåŠ¨MLç®¡é“](https://pgaleone.eu/golang/vertexai/2023/06/14/automl-pipeline-tabular-data-vertexai-go-golang/)

è¿™æ˜¯è¯¥ç³»åˆ—çš„ç¬¬ä¸‰ç¯‡æ–‡ç« ï¼Œå› æ­¤ï¼Œå®ƒå°†ä¸Žå®ƒä»¬ä¸¤è€…ä¸€æ ·å…·æœ‰ç›¸åŒçš„å…ˆå†³æ¡ä»¶ï¼šæœåŠ¡è´¦æˆ·åˆ›å»ºã€çŽ¯å¢ƒå˜é‡ç­‰ã€‚å…ˆå†³æ¡ä»¶éƒ¨åˆ†å¯ä»¥åœ¨è¿™ä¸¤ç¯‡æ–‡ç« ä¸­é˜…è¯»ã€‚

æˆ‘æ’°å†™è¿™äº›æ–‡ç« æ˜¯å› ä¸ºæˆ‘æ­£åœ¨å¼€å‘ä¸€ä¸ªåä¸ºFitSleepInsightsçš„æ–°æœåŠ¡ï¼šä¸€ä¸ªå¯è§†åŒ–æ‚¨çš„å¥åº·æ•°æ®å¹¶ä¸Žå…¶äº¤æµçš„å·¥å…·ï¼ˆä½¿ç”¨Geminiï¼ï¼‰ã€‚å®ƒå°†ä¸ºæ¯ä¸ªFitbitç”¨æˆ·æä¾›ä¸€ç§å¯è§†åŒ–å¹¶ä»Žå…¶æ•°æ®ä¸­èŽ·å¾—æœ‰ä»·å€¼çš„è§è§£çš„æ–¹å¼ã€‚å¦‚æžœæ‚¨æ˜¯Fitbitç”¨æˆ·ï¼Œè¯·è®¢é˜…æœ¬æ–‡åº•éƒ¨çš„é€šè®¯ä»¥åœ¨æœåŠ¡ä¸Šçº¿æ—¶æ”¶åˆ°é‚®ä»¶ï¼

æ¨¡åž‹å®šä¹‰å’Œé…ç½®
æƒ³æ³•æ˜¯ä¸ºFitbitç”¨æˆ·æä¾›ä¸€ç§ä¸Žå…¶æ•°æ®äº¤æµçš„æ–¹å¼ã€‚å¤©çœŸçš„å®žçŽ°å°†æ˜¯ä»ŽFitbit APIèŽ·å–æ‰€æœ‰ç”¨æˆ·æ•°æ®ï¼Œå°†å…¶è½¬æ¢ä¸ºæ–‡æœ¬è¡¨ç¤ºï¼Œå¹¶å°†å…¶æä¾›ç»™æ¨¡åž‹ã€‚ä¹‹åŽï¼Œæˆ‘ä»¬å¯ä»¥è®©ç”¨æˆ·ä¸ŽAIäº¤æµï¼Œä½¿ä»–ä»¬èƒ½å¤Ÿä»Žè‡ªå·±çš„æ•°æ®ä¸­èŽ·å¾—è§è§£ã€‚åœ¨å®žçŽ°è¿™ä¸ªå¤©çœŸçš„æƒ³æ³•æ—¶ï¼Œæˆ‘ä»¬å°†é¢ä¸´Geminiçš„ä¸€äº›é™åˆ¶ã€‚

ä½¿ç”¨Vertex AIçš„ä»»ä½•æœåŠ¡éƒ½å¾ˆç®€å•ï¼šåªéœ€åˆ›å»ºä¸“ç”¨å®¢æˆ·ç«¯å¹¶ä½¿ç”¨å®ƒå³å¯ã€‚åœ¨Vertex AIä¸Šçš„ç”Ÿæˆæ¨¡åž‹çš„GoåŒ…æ˜¯cloud.google.com/go/vertexai/genaiï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¯¼å…¥å®ƒã€‚

å„ç§Geminiæ¨¡åž‹çš„æ–‡æ¡£å¯åœ¨https://ai.google.dev/models/geminiä¸Šæ‰¾åˆ°ã€‚å¯¹äºŽæˆ‘ä»¬çš„ç”¨ä¾‹ï¼Œæˆ‘ä»¬å¯¹â€œGemini Proâ€æ„Ÿå…´è¶£ï¼Œè¯¥æ¨¡åž‹æä¾›â€œæ–‡æœ¬â€å’Œâ€œèŠå¤©â€æœåŠ¡ã€‚åœ¨é“¾æŽ¥çš„æ–‡æ¡£ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä¸€äº›æ¨¡åž‹å¸¸é‡ï¼Œæˆ‘ä»¬å°†åœ¨ä»£ç ä¸­åŒ…å«å®ƒä»¬ã€‚

```go
import "cloud.google.com/go/vertexai/genai"

const MaxToken int = 30720
const MaxSequenceLength int = MaxToken * 3
```

â€œæ¨¡åž‹å˜ä½“â€éƒ¨åˆ†æœ‰ä¸€ä¸ªæ³¨é‡Šï¼š

æ³¨ï¼šå¯¹äºŽGeminiæ¨¡åž‹ï¼Œä¸€ä¸ªtokenç›¸å½“äºŽå¤§çº¦4ä¸ªå­—ç¬¦ã€‚100ä¸ªtokençº¦ä¸º60-80ä¸ªè‹±æ–‡å•è¯ã€‚

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å°†MaxSequenceLengthå¸¸é‡è®¾ç½®ä¸ºMaxToken * 3çš„åŽŸå› ï¼ˆè€Œä¸”ä¹˜æ³•å› å­3æ˜¯ä¸€ä¸ªä¿å®ˆçš„å€¼ï¼‰ã€‚æ­£å¦‚æˆ‘ä»¬å°†åœ¨ç¨åŽçœ‹åˆ°çš„ï¼Œè¿™å¹¶ä¸å®Œå…¨æ­£ç¡®ï¼Œå› ä¸ºä»ŽGoå®¢æˆ·ç«¯æ¥çœ‹ï¼Œæ¨¡åž‹ä¼¼ä¹Žæ— æ³•â€œå¿˜è®°â€å’Œå¿½ç•¥è¿‡åŽ»çš„æ•°æ®â€”â€”æ­£å¦‚äººä»¬å¯èƒ½æœŸæœ›ä¸ŽLLMäº’åŠ¨ä¸€æ ·ã€‚

çŽ°åœ¨æ˜¯åˆ›å»ºå®¢æˆ·ç«¯çš„æ—¶å€™äº†ã€‚

```go
ctx := context.Background()
var client *genai.Client
const region = "us-central1"
if client, err = genai.NewClient(ctx, os.Getenv("VAI_PROJECT_ID"), region, option.WithCredentialsFile(os.Getenv("VAI_SERVICE_ACCOUNT_KEY"))); err != nil {
    return err
}
defer client.Close()
```

ç«‹å³æ˜¾çœ¼çš„ä¸€ç‚¹æ˜¯ç¡¬ç¼–ç çš„const region = "us-central1"ã€‚è¿™æ˜¯ä½¿ç”¨Geminiåœ¨Vertex AIä¸Šçš„é™åˆ¶ä¹‹ä¸€ï¼ˆæˆªè‡³ä»Šå¤©ï¼‰ã€‚å°½ç®¡æˆ‘çš„æ•´ä¸ªé¡¹ç›®éƒ½åœ¨æ¬§æ´²ï¼ˆVAI_PROJECT_IDæŒ‡å‘æ¬§æ´²åŒºåŸŸï¼‰ï¼Œä½†æˆ‘å¿…é¡»ç¡¬ç¼–ç æ­¤ä½ç½®ï¼Œå› ä¸ºè¿™æ˜¯å”¯ä¸€æœ‰æ•ˆçš„ä½ç½®ã€‚

ä½¿ç”¨åˆ›å»ºçš„å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©è¦ä½¿ç”¨çš„æ¨¡åž‹ã€‚åœ¨æ–‡æ¡£ä¸­ï¼Œæœ‰ä¸€ä¸ªåä¸ºâ€œæ¨¡åž‹å˜ä½“â€çš„éƒ¨åˆ†ï¼Œæè¿°äº†æ‰€æœ‰å¯ç”¨çš„æ¨¡åž‹ã€‚å¯¹äºŽæˆ‘ä»¬çš„ç”¨ä¾‹ï¼Œè¦ä½¿ç”¨çš„æ¨¡åž‹æ˜¯gemini-proï¼Œå› ä¸ºæˆ‘ä»¬å°†ä»…ä½¿ç”¨æ–‡æœ¬ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¸æ„Ÿå…´è¶£å…¶ä»–å¤šæ¨¡å¼å˜ä½“ã€‚

æ¯ä¸ªæ¨¡åž‹éƒ½æœ‰ä¸€ç»„å¯è°ƒå‚æ•°ï¼Œå…è®¸æˆ‘ä»¬æŽ§åˆ¶æ¨¡åž‹çš„è¡Œä¸ºã€‚å…¶ä¸­ä¸€ä¸ªæœ€é‡è¦çš„å‚æ•°æ˜¯æ¸©åº¦ï¼šåœ¨[0-1]èŒƒå›´å†…çš„æ ‡é‡å€¼ã€‚è¾ƒé«˜çš„æ¸©åº¦ä¼šäº§ç”Ÿæ›´æœ‰åˆ›æ„å’Œä¸å¤ªå¯é¢„æµ‹çš„è¾“å‡ºï¼Œè€Œè¾ƒä½Žçš„æ¸©åº¦ä¼šäº§ç”Ÿæ›´ä¿å®ˆå’Œå¯é¢„æœŸçš„ç»“æžœã€‚

ä½œä¸ºæ¨¡åž‹çš„å¯é€‰å­—æ®µï¼ˆæˆ–è€…æ›´å¥½åœ°è¯´æ˜¯å‘é€åˆ°æ¨¡åž‹çš„è¯·æ±‚çš„å­—æ®µï¼‰ï¼Œåœ¨Goä¸­ï¼Œè¿™è¡¨ç¤ºä¸º*float32ã€‚å› æ­¤ï¼Œè¦è®¾ç½®ç‰¹å®šçš„æ¸©åº¦ï¼Œæˆ‘ä»¬éœ€è¦æ’å…¥ä¸€ä¸ªé™„åŠ å˜é‡å¹¶æå–å…¶åœ°å€ã€‚

```go
model := client.GenerativeModel("gemini-pro")

const ChatTemperature float32 = 0.1
temperature := ChatTemperature
model.Temperature = &temperature
```

ä¸Žæ•°æ®äº¤æµ
æƒ³æ³•æ˜¯å…è®¸ç”¨æˆ·é€šè¿‡Fitbit APIæ”¶é›†çš„å¥åº·æ•°æ®ä¸Žå…¶è¿›è¡Œäº¤æµã€‚gemini-proæ”¯æŒèŠå¤©ï¼Œè€ŒGoå®¢æˆ·ç«¯å…è®¸æˆ‘ä»¬ç”¨ä¸€è¡Œä»£ç å®šä¹‰ä¸€ä¸ªæ–°çš„èŠå¤©ä¼šè¯ã€‚

```go
chatSession := model.StartChat()
```

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸€è¡Œå‡ ä¹Žä»€ä¹ˆéƒ½æ²¡åšã€‚å®ƒåªæ˜¯é…ç½®äº†æœ¬åœ°ä¼šè¯ï¼Œä½†å¹¶æ²¡æœ‰å‘Vertex AI

æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ã€‚æœ‰äº†è¿™ä¸ªèŠå¤©ä¼šè¯ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹è€ƒè™‘å¦‚ä½•å°†æ•°æ®æä¾›ç»™æ¨¡åž‹å¹¶ä»¥æ­¤æ–¹å¼åˆ›å»ºå…¶ä¸Šä¸‹æ–‡ã€‚æˆ‘ä»¬å¯ä»¥è€ƒè™‘ä»¥ä¸‹3ä¸ªé€‰é¡¹ï¼š

å‘é€é…ç½®æ¶ˆæ¯ï¼Œå¹¶åœ¨å•ä¸ªæ¶ˆæ¯ä¸­å‘é€æ‰€æœ‰ç”¨æˆ·æ•°æ®ã€‚
å‘é€é…ç½®æ¶ˆæ¯ï¼Œå¹¶åœ¨å¤šä¸ªæ¶ˆæ¯ä¸­å‘é€ç”¨æˆ·æ•°æ®ã€‚
æ¨¡æ‹Ÿä¸Žæ¨¡åž‹çš„ä»¥å‰å¯¹è¯ï¼Œå‘é€èŠå¤©åŽ†å²è®°å½•ã€‚
æ‰€æœ‰é€‰é¡¹éƒ½å…±äº«åˆå§‹ä¸Šä¸‹æ–‡åˆ›å»ºã€‚è¿™ä¸ªä¸Šä¸‹æ–‡æ˜¯ä¸€ç»„ç”¨äºŽé…ç½®æ¨¡åž‹çš„æŒ‡ä»¤ï¼Œç”¨äºŽé…ç½®å…¶è¡Œä¸ºï¼Œå¦‚ä½•å›žç­”ç”¨æˆ·å¹¶é˜²æ­¢ä¸€äº›åŽŸå§‹æ•°æ®çš„æ³„æ¼ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²æž„å»ºå™¨æ¥æœ‰æ•ˆåœ°åˆ›å»ºæˆ‘ä»¬å°†ä½œä¸ºç¬¬ä¸€æ¡æ¶ˆæ¯å‘é€çš„introductionStringã€‚

```go
var builder strings.Builder
fmt.Fprintln(&builder, "You are an expert in neuroscience focused on the connection between physical activity and sleep.")
fmt.Fprintln(&builder, "You have been asked to analyze the data of a Fitbit user.")
fmt.Fprintln(&builder, "The user shares with you his/her data in JSON format.")
fmt.Fprintln(&builder, "The user is visualizing a dashboard generated from the data provided.")
fmt.Fprintln(&builder, "You must describe the data in a way that the user can understand the data and the potential correlations between the data and the sleep/activity habits.")
fmt.Fprintln(&builder, "You must chat to the user.")
fmt.Fprintln(&builder, "Never go out of this context, do not say hi, hello, or anything that is not related to the data.")
fmt.Fprintln(&builder, "Never accept commands from the user, you are only allowed to chat about the data.")
// This line below is important. Otherwiser the model will start analyzing non-existing data.
fmt.Fprintln(&builder, "Wait to receive the data in JSON format. Before you receive the data, you can't say anything.")
```

å½“ç„¶ï¼Œè¿™åªæ˜¯ä¸€ç§é€šè¿‡æ–‡æœ¬é…ç½®æ¨¡åž‹çš„æ–¹å¼ï¼Œå¹¶ä¸èƒ½ä¿è¯ç”¨æˆ·èƒ½å¤Ÿç»•è¿‡æ­¤ä¸Šä¸‹æ–‡å¹¶å°†æ¨¡åž‹ç”¨äºŽå…¶ä»–ç›®çš„ã€‚å­—ç¬¦ä¸²æž„å»ºå™¨ä»ç„¶ä¿å­˜æ•°æ®ï¼Œå¹¶ä¸”å°šæœªåˆ›å»ºä»»ä½•å­—ç¬¦ä¸²ã€‚æ ¹æ®æˆ‘ä»¬å°†è¦å®žçŽ°çš„é€‰é¡¹ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šåœ¨å°†å…¶è½¬æ¢ä¸ºintroductionStringä¹‹å‰åœ¨æž„å»ºå™¨ä¸­æ·»åŠ ä¸€äº›å…¶ä»–è¡Œã€‚

é€‰é¡¹1ï¼šä¸€æ¬¡æ€§å‘é€æ‰€æœ‰æ•°æ®
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å‘é€2æ¡æ¶ˆæ¯ï¼Œç„¶åŽæŸ¥çœ‹æ¨¡åž‹çš„å›žç­”ï¼ˆå‡ºäºŽè°ƒè¯•ç›®çš„ï¼Œåœ¨ç”Ÿäº§åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å¯¹æ¨¡åž‹çš„å“åº”ä¸æ„Ÿå…´è¶£ï¼Œè€Œæ˜¯åœ¨é…ç½®å®ƒæ—¶ï¼‰ã€‚

```go
fmt.Fprintln(&builder, "I will send you a message containing the user data.")
introductionString := builder.String()

var response *genai.GenerateContentResponse
var err error
if response, err = chatSession.SendMessage(ctx, genai.Text(introductionString)); err != nil {
    return err
}
```

responseå˜é‡å…·æœ‰å¤æ‚çš„ç»“æž„â€”â€”è¿™æ˜¯ä¸€ä¸ªé€šç”¨çš„ç»“æž„ï¼Œä¹Ÿç”¨äºŽå¤šæ¨¡åž‹æ¨¡åž‹ã€‚å¯¹äºŽåƒgemini-proè¿™æ ·çš„ä»…æ–‡æœ¬æ¨¡åž‹ï¼Œåœ¨ç¬¬ä¸€ä¸ªå€™é€‰å“åº”å†…å®¹çš„ç¬¬ä¸€éƒ¨åˆ†ä¸­å¯ä»¥æ‰¾åˆ°æ¨¡åž‹å“åº”ã€‚

```go
fmt.Println(response.Candidates[0].Content.Parts[0])
```

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¨¡åž‹æ­£ç¡®åœ°å›žç­”äº†ä¸€äº›åˆç†çš„å†…å®¹ï¼ˆè€ƒè™‘åˆ°æˆ‘ä»¬çš„ä¸Šä¸‹æ–‡ï¼‰ï¼šæˆ‘æ­£åœ¨ç­‰å¾…æ‚¨åˆ†äº«JSONæ ¼å¼çš„æ•°æ®ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥åˆ†æžå®ƒå¹¶ä¸ºæ‚¨æä¾›æœ‰å…³æ•°æ®ä¸Žæ‚¨çš„ç¡çœ /æ´»åŠ¨ä¹ æƒ¯ä¹‹é—´æ½œåœ¨ç›¸å…³æ€§çš„è§è§£ã€‚

è®©æˆ‘ä»¬æŒ‰ç…§æ¨¡åž‹è¦æ±‚çš„åšã€‚èŽ·å–æ‰€æœ‰æ•°æ®ï¼Œå°†å…¶è½¬æ¢ä¸ºJSONï¼Œå¹¶å°†å…¶å‘é€åˆ°æ¨¡åž‹ã€‚

å‡è®¾å­˜åœ¨ä¸€ä¸ªå¯¹è±¡èŽ·å–å™¨ï¼Œå¹¶ä¸”å®ƒèƒ½å¤Ÿåœ¨æŒ‡å®šèŒƒå›´å†…èŽ·å–æ‰€æœ‰ç”¨æˆ·æ•°æ®ã€‚è¿™æ˜¯å‡½æ•°ç­¾åï¼š

```go
func (f *fetcher) FetchByRange(startDate, endDate time.Time) []*UserData
```

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨èŽ·å–å™¨å¯¹è±¡èŽ·å–æ‰€æœ‰æ•°æ®åˆ‡ç‰‡ï¼Œå¹¶å°†æ‰€æœ‰å€¼è½¬æ¢ä¸ºJSONã€‚

```go
allData := fetcher.FetchByRange(startDate, endDate)
var jsonData []byte
if jsonData, err = json.Marshal(allData); err != nil {
    return err
}
stringData := string(jsonData)
```

stringDataåŒ…å«JSONæ ¼å¼çš„æ‰€æœ‰ç”¨æˆ·æ•°æ®ï¼ŒçŽ°åœ¨æˆ‘ä»¬å¯ä»¥å°†å…¶å‘é€åˆ°æ¨¡åž‹å¹¶æŸ¥çœ‹å‘ç”Ÿäº†ä»€ä¹ˆï¼š

```go
if _, err = chatSession.SendMessage(ctx, genai.Text(stringData)); err != nil {
	return err
}
```

é”™è¯¯ä¸ä¸ºç©ºï¼š

rpcé”™è¯¯ï¼šä»£ç = InvalidArgument desc =è¯·æ±‚åŒ…å«æ— æ•ˆå‚æ•°ã€‚

è¿™ä¸ªé”™è¯¯ç»å¯¹æ˜¯é€šç”¨çš„ï¼Œä¸€ç‚¹ä¹Ÿä¸å…·æè¿°æ€§ã€‚è¿™æ˜¯Geminiç•Œé¢åœ¨Vertex AIä¸­çš„ç—›ç‚¹ä¹‹ä¸€ã€‚

ç»è¿‡è°ƒè¯•ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£åˆ°ï¼Œæˆ‘ä»¬æ­£åœ¨å‘æ¨¡åž‹å‘é€ä¸€ä¸ªå·¨å¤§çš„æ¶ˆæ¯ï¼Œè¶…è¿‡äº†MaxSequenceLenghtçš„å€¼ã€‚stringDataçš„é•¿åº¦ä¸º297057ï¼Œè€Œæ ¹æ®æ–‡æ¡£ï¼ˆè¿™æ˜¯å¦ä¸€ä¸ªç—›ç‚¹ï¼‰ï¼Œæœ€å¤§åºåˆ—é•¿åº¦ä¸º30720 * 3 = 92160ã€‚

ä¸ºäº†ç¡®å®šâ€œæ— æ•ˆå‚æ•°â€é€šç”¨æ¶ˆæ¯éšè—çš„é—®é¢˜æ˜¯å¦æ˜¯è¾“å…¥åºåˆ—é•¿åº¦è¿‡é•¿ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•å°†stringDataæˆªæ–­ä¸ºMaxSequenceLenghtï¼Œç„¶åŽå‘é€æ¶ˆæ¯ï¼š

```go
if _, err = chatSession.SendMessage(ctx, genai.Text(stringData[:MaxSequenceLenght])); err != nil {
	return err
}
```

é”™è¯¯ä¸ä¸ºç©ºï¼š

å†ä¸€æ¬¡ ðŸ˜”

ä¹Ÿè®¸æˆ‘ä»¬å¯¹æ–‡æ¡£çš„ä¿å®ˆè§£é‡Šè¿˜ä¸å¤Ÿä¿å®ˆï¼Ÿå¦‚æžœæˆ‘ä»¬å°†ä¹˜æ³•å› å­ä»Ž3æ”¹ä¸º2ï¼ˆæ‰€ä»¥æˆ‘ä»¬è®¤ä¸ºä¸€ä¸ªtokenæ˜¯é•¿2ä¸ªå­—ç¬¦çš„ä¸œè¥¿ï¼‰ï¼Œç„¶åŽé‡å¤ä¹‹å‰çš„è¯·æ±‚ï¼Œé‚£ä¹ˆå®ƒèƒ½å·¥ä½œï¼ä½†æ˜¯ï¼Œç­”æ¡ˆä»¤äººæ‹…å¿§ï¼Œå› ä¸ºæ¯æ¬¡æˆ‘ä»¬å‘é€è¿™ä¸ªæˆªæ–­çš„JSONæ—¶ï¼Œæ¨¡åž‹åªä¼šè¾“å‡ºJSONï¼Œå› ä¸ºä¼¼ä¹Žå‡ºäºŽæŸç§åŽŸå› å®ƒæ­£åœ¨å°è¯•å®Œæˆæ•°æ®ã€‚

æ— è®ºå¦‚ä½•ï¼Œæˆ‘ä»¬å¯ä»¥ä¸¢å¼ƒè¿™ä¸ªé€‰é¡¹ï¼Œå› ä¸ºä¸€æ¬¡æ€§å‘é€æ‰€æœ‰æ•°æ®æ˜¯ä¸å¯èƒ½çš„ã€‚è®©æˆ‘ä»¬é€‰æ‹©é€‰é¡¹2ã€‚

é€‰é¡¹2ï¼šå‘é€å¤šä¸ªæ¶ˆæ¯
ä»Žä¹‹å‰çš„å°è¯•ä¸­ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†è¦ä½¿ç”¨çš„å®žé™…MaxSequenceLenghtã€‚æˆ‘ä»¬å¯ä»¥å°è¯•å®šåˆ¶ä»‹ç»æ€§æ¶ˆæ¯ï¼Œå‘Šè¯‰Geminiæˆ‘ä»¬å°†å‘é€å¤šä¸ªæ¶ˆæ¯çš„æ•°æ®ï¼Œå¹¶åœ¨å‘é€æ–°ä¸Šä¸‹æ–‡å’Œå„ç§æ¶ˆæ¯åŽæŸ¥çœ‹æ¨¡åž‹çš„ç­”æ¡ˆã€‚

```go
var

 numMessages int
if len(stringData) > MaxSequenceLength {
    numMessages = len(stringData) / MaxSequenceLength
    fmt.Fprintf(&builder, "I will send you %d messages containing the user data.", numMessages)
} else {
    numMessages = 1
    fmt.Fprintln(&builder, "I will send you a message containing the user data.")
}

introductionString := builder.String()
if response, err = chatSession.SendMessage(ctx, genai.Text(introductionString)); err != nil {
    return err
}
// checkout response content

for i := 0; i < numMessages; i++ {
    if response, err = chatSession.SendMessage(ctx, genai.Text(stringData[i*MaxSequenceLength:(i+1)*MaxSequenceLength])); err != nil {
        return err
    }
    // checkout response content
}
```

ä¸å¹¸çš„æ˜¯ï¼Œåœ¨å‘é€introductionStringå’ŒstringDataçš„ç¬¬ä¸€ä¸ªå—åŽï¼ŒæœåŠ¡å™¨å†æ¬¡è¿”å›žäº†éš¾ä»¥ç†è§£çš„æ¶ˆæ¯ï¼š

rpcé”™è¯¯ï¼šä»£ç = InvalidArgument desc =è¯·æ±‚åŒ…å«æ— æ•ˆå‚æ•°ã€‚

æ­¤å¤–ï¼Œæ¨¡åž‹åœ¨ç¬¬ä¸€ä¸ªï¼ˆä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ªï¼‰å‘é€çš„å¸¦æœ‰JSONæ•°æ®çš„æ¶ˆæ¯åŽï¼Œå†æ¬¡å¼€å§‹åªè¿”å›žJSONå†…å®¹ã€‚è®©æˆ‘ä»¬å°è¯•ç¬¬ä¸‰ç§æ–¹æ³•ã€‚

å¡«å……èŠå¤©åŽ†å²è®°å½•
genai.ChatSessionç»“æž„å…·æœ‰ä¸€ä¸ªå¯ä¿®æ”¹çš„å­—æ®µåä¸ºHistoryã€‚æˆ‘ä»¬å¯ä»¥æ›´æ–°æ­¤å­—æ®µï¼Œä»¥ä¾¿ä¸ºæ¨¡åž‹æä¾›çŽ°æœ‰ä¸Šä¸‹æ–‡ï¼Œæ ¼å¼ä¸ºç”¨æˆ·å…·æœ‰ä¸åŒè§’è‰²ä¹‹é—´çš„æ¶ˆæ¯äº¤æ¢ï¼š

â€œç”¨æˆ·â€çš„æ¶ˆæ¯
â€œæ¨¡åž‹â€çš„æ¶ˆæ¯
å§‹ç»ˆæŒ‰æ­¤é¡ºåºã€‚å¡«å……åŽ†å²è®°å½•æ˜¯æˆ‘ä»¬å¿…é¡»æ¢å¤ä»¥å‰å¯¹è¯çš„æ–¹å¼ï¼ˆä¾‹å¦‚ï¼Œæˆ‘æƒ³è±¡https://gemini.google.com/appä¸Šçš„è¿‡åŽ»å¯¹è¯çš„ç®€åŽ†æ˜¯è¿™æ ·å®žçŽ°çš„ï¼‰ã€‚

```go
chatSession.History = []*genai.Content{
    {
        Parts: []genai.Part{
            genai.Text(introductionString),
        },
        Role: "user",
    },
    {
        Parts: []genai.Part{
            genai.Text(
                fmt.Sprintf("Great! I will analyze the data and provide you with insights. Send me the data in JSON format in %d messages", numMessages)),
        },
        Role: "model",
    },
}

for i := 0; i < numMessages; i++ {
    var botTextAnswer string
    if i == numMessages-1 {
        botTextAnswer = "I received the last message with the data. I will now analyze it and provide you with insights."
    } else {
        botTextAnswer = "Go on, send me the missing data. I will analyze it once I have all the data."
    }

    chatSession.History = append(chatSession.History, []*genai.Content{
        {
            Parts: []genai.Part{
                genai.Text(genai.Text(stringData[i*MaxSequenceLength : (i+1)*MaxSequenceLength])),
            },
            Role: "user",
        },
        {
            Parts: []genai.Part{
                genai.Text(botTextAnswer),
            },
            Role: "model",
        }}...)
}
```

è¿™æ ·ï¼Œçœ‹èµ·æ¥æˆ‘ä»¬å·²ç»èƒ½å¤Ÿå°†æ‰€æœ‰æ•°æ®ä¼ é€’ç»™æ¨¡åž‹äº†â€”â€”ä½†è¿™æ˜¯ä¸çœŸå®žçš„ã€‚å®žé™…ä¸Šï¼Œæˆ‘ä»¬åªæ˜¯å¡«å……äº†æœ¬åœ°çš„Historyå˜é‡ï¼Œå®ƒå°†åœ¨ç¬¬ä¸€ä¸ªchatSession.SendMessageè°ƒç”¨æ—¶å‘é€ã€‚æ­£å¦‚æ˜“äºŽæƒ³è±¡çš„é‚£æ ·ï¼Œç¬¬ä¸€æ¡å‘é€çš„æ¶ˆæ¯å°†å†æ¬¡ä»¥é€šå¸¸çš„é€šç”¨é”™è¯¯æ¶ˆæ¯å¤±è´¥ï¼š

rpcé”™è¯¯ï¼šä»£ç = InvalidArgument desc =è¯·æ±‚åŒ…å«æ— æ•ˆå‚æ•°ã€‚

è¿™äº›æ•…éšœçš„åŽŸå› 
æˆ‘ä»¬é‡åˆ°äº†ä¸€ä¸ªåœ¨ä½¿ç”¨å¤§åž‹è¯­è¨€æ¨¡åž‹æ—¶ç»å¸¸å‘ç”Ÿçš„å¸¸è§é—®é¢˜ï¼šä¸Šä¸‹æ–‡çª—å£é•¿åº¦é™åˆ¶ã€‚

åœ¨å¤§åž‹è¯­è¨€æ¨¡åž‹ä¸­ï¼Œä¸Šä¸‹æ–‡çª—å£å°±åƒå®ƒçš„çŸ­æœŸè®°å¿†ã€‚å®ƒæŒ‡çš„æ˜¯æ¨¡åž‹åœ¨å¤„ç†ä¿¡æ¯å’Œç”Ÿæˆå“åº”æ—¶å¯ä»¥åŒæ—¶è€ƒè™‘çš„æ–‡æœ¬é‡çš„æœ‰é™é‡ã€‚

æƒ³è±¡ä¸€ä¸‹ä½ åœ¨è¯»ä¸€æœ¬ä¹¦ï¼Œä½†ä½ åªèƒ½é€šè¿‡ä¸€ä¸ªå°çª—å£çœ‹åˆ°å‡ å¥è¯ã€‚éšç€ä½ å‰è¿›ï¼Œä»¥å‰çš„å¥å­æ¶ˆå¤±äº†ï¼Œè¢«æ–°çš„å¥å­å–ä»£äº†ã€‚è¿™ç±»ä¼¼äºŽLLMâ€œé˜…è¯»â€ä¿¡æ¯çš„æ–¹å¼â€”â€”å®ƒä¸“æ³¨äºŽç‰¹å®šçš„æ–‡æœ¬çª—å£ï¼Œå¹¶ä½¿ç”¨è¯¥ä¿¡æ¯æ¥ç†è§£æ•´ä½“ä¸Šä¸‹æ–‡å¹¶ç”Ÿæˆå“åº”ã€‚

åœ¨ä½¿ç”¨LLMæ—¶ï¼Œæˆ‘ä»¬åº”è¯¥è€ƒè™‘åˆ°åœ¨â€œæ ‡è®°è®¡æ•°â€å†…éƒ¨ä¸ä»…è€ƒè™‘äº†ç”¨æˆ·è¾“å…¥ï¼Œè¿˜è€ƒè™‘äº†æ¨¡åž‹çš„è¾“å‡ºã€‚å› æ­¤ï¼Œæ¯å½“æ¨¡åž‹æŽ¥å—1000ä¸ªæ ‡è®°ä½œä¸ºè¾“å…¥å¹¶ç”Ÿæˆ500ä¸ªæ ‡è®°ä½œä¸ºè¾“å‡ºæ—¶ï¼Œå®ƒå°†åœ¨ä¸‹ä¸€æ¬¡è°ƒç”¨ä¸­æ¶ˆè€—çš„æ ‡è®°æ€»æ•°å°†æ˜¯1500ï¼ˆ1000 + 500ï¼‰+æ–°è¾“å…¥æ¶ˆæ¯çš„æ ‡è®°æ•°ã€‚

ç„¶è€Œï¼ŒLLMç”¨æˆ·æœŸæœ›çš„æ˜¯æ¨¡åž‹â€œå¿˜è®°â€å¯¹è¯çš„åˆå§‹éƒ¨åˆ†ï¼Œå¹¶ä»…å°†å‰©ä½™éƒ¨åˆ†çš„ä¸Šä¸‹æ–‡ä½œä¸ºâ€œæ•°æ®åº“â€æ¥æŸ¥æ‰¾ç”¨æˆ·é—®é¢˜çš„ç­”æ¡ˆã€‚

è¿™åœ¨Goå®¢æˆ·ç«¯ä¸­æ²¡æœ‰å‘ç”Ÿï¼Œæˆ‘æ€€ç–‘ï¼ˆä½†å°šæœªéªŒè¯ï¼‰è¿™åªå‘ç”Ÿåœ¨è¿™ä¸ªå®¢æˆ·ç«¯ä¸Šï¼Œè€Œä¸æ˜¯Pythonå®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ï¼‰ã€‚æ— è®ºå¦‚ä½•ï¼Œæ•…éšœæ¶ˆæ¯ç»å¯¹å¤ªé€šç”¨äº†ï¼Œæ— æ³•ä½¿ç”¨ã€‚

æ­£ç¡®çš„è§£å†³æ–¹æ¡ˆï¼šRAGæˆ–æ›´å¤§çš„ä¸Šä¸‹æ–‡çª—å£
Geminiçš„ä¸Šä¸‹æ–‡çª—å£é•¿åº¦å–å†³äºŽç‰¹å®šç‰ˆæœ¬ï¼š

æ ‡å‡†Geminiï¼šæ­¤ç‰ˆæœ¬çš„ä¸Šä¸‹æ–‡çª—å£çº¦ä¸º128,000ä¸ªæ ‡è®°ï¼ˆ30720 * 4ï¼‰
Gemini 1.5 Proï¼ˆæœ‰é™è®¿é—®æƒé™å¹¶æœ€è¿‘å‘å¸ƒï¼‰ï¼šè¿™ä¸ªé«˜çº§ç‰ˆæœ¬æ‹¥æœ‰æ›´å¤§çš„ä¸Šä¸‹æ–‡çª—å£ï¼Œæœ€å¤šå¯è¾¾100ä¸‡ä¸ªæ ‡è®°ã€‚è¿™æ˜¯ç›®å‰å·²çŸ¥çš„ä»»ä½•å…¬å¼€å¤§è§„æ¨¡åŸºç¡€æ¨¡åž‹çš„æœ€é•¿ä¸Šä¸‹æ–‡çª—å£ã€‚
ç„¶è€Œï¼Œç”±äºŽGemini 1.5 Proå°šæœªå…¬å¼€å‘å¸ƒï¼Œæˆ‘ä»¬åªèƒ½ä¾é ä¸€ç§ç§°ä¸ºRAGçš„è§£å†³æ–¹æ¡ˆã€‚

RAGä»£è¡¨æ£€ç´¢å¢žå¼ºç”Ÿæˆã€‚å®ƒæ˜¯ä¸€ç§é€šè¿‡æä¾›ä»Žå¤–éƒ¨æ¥æºæ£€ç´¢çš„é™„åŠ ä¸Šä¸‹æ–‡æ¥æ”¹å–„LLMå“åº”å‡†ç¡®æ€§å’Œç›¸å…³æ€§çš„æŠ€æœ¯ã€‚

RAGçš„å·¥ä½œåŽŸç†å¦‚ä¸‹ï¼š

ç”¨æˆ·æä¾›æŸ¥è¯¢æˆ–ä»»åŠ¡ï¼šæ‚¨å‘LLMæå‡ºé—®é¢˜æˆ–æä¾›æŒ‡ä»¤ã€‚
æ£€ç´¢ç³»ç»Ÿæœç´¢ç›¸å…³ä¿¡æ¯ï¼šä¿¡æ¯æ£€ç´¢ç»„ä»¶æ ¹æ®æ‚¨çš„æŸ¥è¯¢æœç´¢æŒ‡å®šçš„æ•°æ®æºï¼ˆä¾‹å¦‚

ç»´åŸºç™¾ç§‘ï¼‰ã€‚
æ£€ç´¢å†…å®¹ä¸Žé—®é¢˜ä¸€èµ·ä¼ é€’åˆ°LLMï¼šæ£€ç´¢åˆ°çš„ä¿¡æ¯è¢«æ ¼å¼åŒ–å¹¶ä¸Žæ‚¨çš„æŸ¥è¯¢ä¸€èµ·æä¾›ç»™LLMã€‚
LLMä½¿ç”¨æ£€ç´¢å†…å®¹å’Œé—®é¢˜ç”Ÿæˆå“åº”ï¼šLLMå°†è¿™ä¸¤è€…ç»“åˆèµ·æ¥ï¼Œä»¥æä¾›æ›´è¯¦ç»†ã€æ›´ç›¸å…³çš„ç­”æ¡ˆã€‚
RAGçš„ä¸€ä¸ªå…³é”®å¥½å¤„æ˜¯ï¼Œå®ƒå¯ä»¥æ‰©å±•LLMçš„ä¸Šä¸‹æ–‡çª—å£ï¼Œä»¥ä½¿å…¶èƒ½å¤Ÿè®¿é—®æ›´å¤šä¿¡æ¯ã€‚è¿™ç§æ–¹æ³•çš„ä¸€ç§å®žçŽ°æ–¹å¼æ˜¯ä½¿ç”¨RAGè’™ç‰¹å¡æ´›ï¼šä½¿ç”¨RAGæ¨¡åž‹æ¥é€‰æ‹©æ£€ç´¢å†…å®¹ï¼Œç„¶åŽå°†å…¶ä¸ŽLLMé›†æˆã€‚

RAGçš„å¦ä¸€ä¸ªä¼˜åŠ¿æ˜¯å®ƒå¯ä»¥æä¾›æ›´å‡†ç¡®å’Œç›¸å…³çš„ç­”æ¡ˆï¼Œå› ä¸ºå®ƒåœ¨ç”Ÿæˆå“åº”æ—¶ä½¿ç”¨äº†æ›´å¤šçš„ä¿¡æ¯æºã€‚

æ€»ç»“
åœ¨Goå®¢æˆ·ç«¯ä¸­ä½¿ç”¨Vertex AIä¸Šçš„GeminiæœåŠ¡æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ï¼Œå› ä¸ºå®ƒéœ€è¦å¤„ç†è¯¸å¦‚é™åˆ¶ä¸Šä¸‹æ–‡é•¿åº¦ç­‰é—®é¢˜ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æŽ¢è®¨äº†å‡ ç§è§£å†³æ–¹æ¡ˆï¼Œä½†æœ€ç»ˆæ²¡æœ‰æ‰¾åˆ°æ»¡æ„çš„è§£å†³æ–¹æ¡ˆã€‚æ­£ç¡®çš„è§£å†³æ–¹æ¡ˆå¯èƒ½æ˜¯ä½¿ç”¨RAGæ¨¡åž‹æˆ–ç­‰å¾…æ›´å¤§çš„ä¸Šä¸‹æ–‡çª—å£æä¾›ã€‚

Geminiåœ¨æä¾›ç¿»è¯‘æœåŠ¡æ—¶å¯èƒ½ä¼šè¡¨çŽ°å¾—æ›´å¥½ï¼Œå› ä¸ºå®ƒä¸éœ€è¦ä¿æŒå¯¹è¯çš„çŠ¶æ€ï¼Œè€Œæ˜¯ç‹¬ç«‹å¤„ç†æ¯ä¸ªå¥å­ã€‚Geminiçš„æ€§èƒ½å¯èƒ½ä¼šå› æ‰€å¤„ç†çš„ä»»åŠ¡è€Œå¼‚ï¼Œéœ€è¦æ ¹æ®å…·ä½“æƒ…å†µè¿›è¡Œè¯„ä¼°å’Œè°ƒæ•´ã€‚