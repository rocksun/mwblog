<!--
title: 为什么FinOps属于你的CI/CD工作流
cover: https://cdn.thenewstack.io/media/2025/03/bb187a6b-shift-left-finops-ci-ci.jpg
summary: IaC催生FinOps左移！将成本治理融入CI/CD，编纂财务责任。GaC/PaC执行GitOps护栏，AI驱动治理扩展策略。InfraCost/Firefly等工具助力Terraform Plan成本预测，标签治理优化云成本。通过IDP集成FinOps数据，实现云浪费可执行补救，提升云效率！
-->

IaC催生FinOps左移！将成本治理融入CI/CD，编纂财务责任。GaC/PaC执行GitOps护栏，AI驱动治理扩展策略。InfraCost/Firefly等工具助力Terraform Plan成本预测，标签治理优化云成本。通过IDP集成FinOps数据，实现云浪费可执行补救，提升云效率！

> 译自：[Why FinOps Belongs in Your CI/CD Workflow](https://thenewstack.io/why-finops-belongs-in-your-ci-cd-workflow/)
> 
> 作者：Amit Liberman

[基础设施即代码 (IaC)](https://thenewstack.io/introduction-to-infrastructure-as-code/) 已经改变了云的配置方式，但是如果没有治理、成本意识和主动执行，组织将面临云支出螺旋式上升或安全和合规风险增加的风险。IaC 的发展催生了[策略即代码 (PaC) 和治理即代码 (GaC)](https://thenewstack.io/for-infrastructure-as-code-ci-cd-can-beat-terraform/)，使组织能够在安全之外的领域应用结构化的自动化策略。

这种实践现在正在扩展到 [FinOps](https://thenewstack.io/finops/)，以使成本治理能够被编纂，确保财务护栏作为基础设施自动化的一部分得到执行，就像合规性和安全策略一样。

“左移”方法起源于软件安全，强调在开发工作流程中尽早进行漏洞检测，以最大限度地降低风险和修复成本。传统上，安全测试发生在开发生命周期的后期，通常会导致昂贵的修复和合规性差距。通过将安全性左移——将自动安全检查、合规性策略和最佳实践集成到 [CI/CD 管道](https://thenewstack.io/ci-cd/) 中——组织可以在代码进入生产环境之前主动降低威胁。

现在，同样的原则也应用于 FinOps，将成本意识、预测和治理更早地嵌入到软件交付过程中。左移 FinOps 不是等待每月的云账单来评估费用，而是将成本估算、标签强制执行和预算约束直接集成到基础设施配置中，以尽早编纂财务责任。

让我们探讨一下[左移原则](https://thenewstack.io/its-time-to-start-shifting-left/)在 FinOps 中的应用，并研究如何将成本可见性集成到 CI/CD 工作流程中，通过治理策略强制执行标签，以及利用云浪费减少策略，在不限制开发人员自主权的情况下提供财务责任。

## FinOps 的 GaC 和 PaC

GaC 和 PaC 现在是执行 GitOps 护栏的基础，确保基础设施和应用程序部署的一致性、合规性和安全性。通过编纂治理策略，组织可以自动化访问控制，强制执行安全基线，并标准化跨环境的资源配置。这些实践有助于防止错误配置，强制执行成本约束，并通过将规则直接嵌入到 Git 工作流程中来保持可审计性。

随着 GitOps 成为现代 DevOps 的核心实践，GaC 和 PaC 充当了关键的执行层，支持自动漂移检测、持续合规性监控和主动修复，从而使基础设施和运营策略在没有人工干预的情况下保持完整。在 IaC 工作流程中，GaC 和 PaC 比以往任何时候都更加重要，可以用来执行财务最佳实践。

通过编纂 FinOps 治理策略，团队可以设置护栏，同时仍然授予开发人员创建资源的自主权。护栏不会扼杀创新，它们只是为了防止代价高昂的错误。每个工程师都会犯错误，但护栏确保这些错误不会导致每天 1 万美元的云账单，原因是在从 GitHub 上获取的 Terraform 模板中忽略了一个数据库实例。

此外，策略执行必须是动态和灵活的，允许组织随着其发展调整标签、成本约束和安全要求。人工智能驱动的治理可以通过识别可重复的模式并自动化跨环境的合规性检查来扩展策略执行。

## FinOps 和左移：部署前的成本预测

传统的成本管理工具侧重于回顾性分析——查看已经花费了什么。然而，左移 FinOps 意味着将成本预测直接集成到开发生命周期中。InfraCost 和 Firefly 等工具使团队能够直接从 Terraform 计划中估算基础设施费用，从而在部署前防止预算超支：

- 开发人员可以在部署之前看到其基础设施的预计成本。
- 成本护栏确保超过预算阈值的资源在部署时失败。
- 团队可以在提交配置之前比较架构选项——例如，使用多个可用区 (multi-AZ) 与单可用区 (single-AZ)。
- 架构师可以在基础设施甚至配置之前为新服务生成成本估算，从而避免意外。
- 产品团队可以在设计和优化功能时考虑到成本效益，从而利用可观测性。
[Terraform Plan](https://developer.hashicorp.com/terraform/tutorials/cli/plan) 洞察，以便就基础设施的权衡做出明智的决策。自动化工作流程可以阻止超出预设成本限制的部署，并提供替代的低成本建议。

![Terraform Plan UI shows "plan completed"](https://cdn.thenewstack.io/media/2025/03/4582e719-terraform-plan.png)

*来源：Firefly。*

通过利用 Terraform Plan，成本估算工具可以在部署之前分析基础设施配置，并根据计划中定义的资源提供财务预测。

当开发人员运行 Terraform Plan 时，FinOps 平台可以提取关键参数，例如实例类型、存储大小和网络成本，然后将它们映射到实时云定价数据。这使团队能够在配置之前评估其基础设施选择的财务影响，确保满足预算约束并防止意外支出。

## 标签：FinOps 治理的支柱

标签在现代 FinOps 中起着至关重要的作用，它提供了一种结构化的方式来跟踪、分配和优化云成本。大多数 FinOps 平台都依赖于定义明确的标签，将云支出与特定的团队、环境和服务相关联。

通过通过 GaC 和 PaC 实施标签策略，组织可以确保每个已部署的资源都包含元数据，以便进行准确的成本归属。这可以通过识别未充分利用的资源或未标记的部署来实现实时预算、预测和减少浪费。如果没有适当的标签实施，云成本管理将变得更具挑战性，从而难以分配费用、应用预算控制或生成有意义的财务洞察：

- CI/CD 中的标签覆盖率和实施可确保所有资源都得到正确标记。
- [Amazon Web Services (AWS)](https://aws.amazon.com/?utm_content=inline+mention) 成本分配标签和 Cost Explorer 需要结构化的标签才能进行有意义的成本跟踪。
- 关键标签，例如 `env_owner`、`environment`、`service` 和 `version` 使团队能够将资源与服务、租户和所有者相关联。
- 多租户软件即服务 (SaaS) 环境需要强大的标签策略，才能在客户之间正确分配成本，而单租户设置使成本跟踪更加简单。

如果没有强大的标签，理解云成本（尤其是在多租户 SaaS 环境中）将变得更加复杂。通过 CI/CD 实施标签可确保在没有必要的元数据的情况下不会配置任何资源，从而防止成本跟踪中出现代价高昂的漏洞。

**实施成本和合规性护栏**

成本实施和合规性是齐头并进的。防止安全错误配置（例如，可公开访问的 Relational Database Service (RDS) 实例）的相同策略框架也可以实施成本控制。

通过在基础设施级别集成成本护栏，您可以获得以下好处：

- 当开发人员的部署超出预算阈值时，会收到通知。
- 可以同时实施安全和成本策略（例如，EKS 集群需要专用节点，同时也要遵守预算限制）。
- 与 SOC 2、ISO 27001 和 HIPAA 对齐的内置模板有助于确保合规性，同时允许基于组织需求的灵活、动态策略。
- 开发人员会收到有关部署失败的明确反馈（无论是由于预算限制还是安全风险），因此他们可以在部署之前纠正问题。

生产环境与开发环境相比，具有不同的要求和成本考虑因素。与生产环境不同，开发环境并不总是需要相同级别的可用性、性能或合规性保证。这些差异具有重大的成本影响；虽然生产环境可能需要多可用区部署和更大的计算资源，但开发环境通常可以使用成本较低的配置。通过在配置之前了解成本，组织可以赋予开发人员更大的自主权，同时将云支出控制在分配的预算范围内。

**平台工程和 FinOps**

[内部开发者平台 (IDP)](https://thenewstack.io/internal-developer-platforms-are-for-devops-too/)（如 Backstage）通过将 FinOps 数据直接集成到开发者工作流程中，在提供实时成本透明度方面发挥着关键作用。通过 API 公开云浪费洞察，团队可以可视化成本分配、识别未充分利用的资源，并在其平台工程生态系统中自动执行修复。

这种集成使开发人员可以完全了解基础设施成本，而无需离开其现有工作流程，从而有助于提高责任感和做出更好的成本决策。通过将 FinOps 原则嵌入到 IDP 中，团队可以通过自动化的治理策略主动管理预算、优化资源分配和减少云浪费。

## 关于云浪费和可执行补救措施

传统的成本分析工具会告诉您您的支出，但很少提供可执行的清理建议。真正的 FinOps 治理需要可执行的云浪费减少策略，以及主动的 FinOps 措施。

FinOps 左移不仅仅是关于成本可见性，而是确保成本效率作为代码强制执行，并持续在您的生产系统上执行。传统的成本分析工具可以提供云支出的可见性，但很少提供可执行的清理建议。这包括减少云浪费的可执行见解，确保预定义的成本节约策略突出显示未充分利用或孤立的资源，而自动清理工作流程有助于回收未使用的基础设施。

![UI shows insights for cloud waste reduction](https://cdn.thenewstack.io/media/2025/03/b33302f9-manage-cloud-waste.png)

*来源：Firefly。*

通过深入了解基础设施的扩张、执行标记策略和自动化修复，可以主动管理云浪费。除了识别孤立或未充分利用的资源外，可执行的见解还可以帮助团队做出更明智的基础设施决策。分析部署模式或显示冗余工作负载使您能够做出数据驱动的决策，以最大限度地减少浪费并确定优化方案，无论是缩小过度配置的实例、整合冗余工作负载还是优化自动缩放配置。这些建议使工程团队能够在保持合规性的同时，平衡性能和成本效率。

## FinOps 左移：提高云效率的关键

FinOps 左移是云管理中的一个自然演进过程，它建立在 GaC 原则之上，该原则支持跨系统的自动化和统一执行。随着组织规模的扩大，FinOps 左移对于平衡开发人员自主性和财务责任至关重要，确保成本防护措施集成到 as-code 配置和 CI/CD 流程的早期阶段。

将财务防护措施嵌入到 PaC 和 GaC 中，可确保开发每个阶段的成本透明度，因此团队可以在保持敏捷性的同时防止预算超支。Firefly 通过提供管理云支出所需的可见性和可执行的见解，在此转型中发挥着关键作用。

通过使组织拥有高效扩展云环境所需的可见性、自动化能力和治理，工程团队可以通过左移 FinOps 方法保持成本意识。他们可以通过主动管理云浪费、执行合规性防护措施以及将成本治理无缝集成到 IDP 中来实现此目的，从而与平台工程实践、开发人员工具和工作流程进行原生集成。