<!--
title: 基础设施即代码的利与弊
cover: https://cdn.thenewstack.io/media/2023/11/0895a37e-pros-and-cons-2057447_1280-1024x484.jpg
-->

基础设施即代码虽然解决了自动化、一致性和可扩展性等传统挑战，却也引入了新的复杂性问题。

> 译自 [The Pros and Cons of IaC: What You Need to Know](https://thenewstack.io/the-pros-and-cons-of-iac-what-you-need-to-know/)，作者 Jason Turim 担任OpsCanvas的首席技术官和联合创始人。他的主要职责包括对公司整合产品组合的架构设计和进展的战略监督。他的职业道路标志着丰富的...

基础设施即代码(IaC)彻底改变了DevOps和软件开发的世界，开创了一个只需编写脚本就能生成基础设施的新时代。

然而，与大多数早期创新一样，它也不是没有灰色地带。虽然 IaC 已经解决了许多传统的挑战——提供了自动化、一致性和可扩展性——但它也带来了自己的一系列复杂问题。

本文深入探讨了 IaC 的世界，探索它带来的转型性利益，同时也揭示了专业人士在代码定义基础设施的时代所面临的新障碍。

## 什么是基础设施即代码?

从本质上讲，IaC 的核心思想是将基础设施的设置和配置视为代码。这意味着，专业人员不再需要手动配置服务器、数据库和其他基础设施组件，而可以使用包含所需状态代码的文件来定义。

基础设施配置[以代码文件的形式编写](https://thenewstack.io/why-infrastructure-as-code-is-vital-for-modern-devops/)，可以进行版本控制、测试和维护在源代码控制仓库中。这种方法的优点很多：它可以确保重复使用，允许团队在不同的环境(开发、暂存或生产)中一致地部署相同的基础设施。此外，由于这些配置存储为代码，因此可以像查看任何其他软件项目一样对其进行审查、审核和协作。

IaC 的另一个重要方面是其与[持续集成/持续交付(CI/CD)](https://thenewstack.io/questions-to-ask-about-the-iac-in-your-ci-cd-pipeline/)流水线的协同能力。这种集成有助于实现自动化的基础设施和应用程序部署，确保构建的资源始终与它们所支持的应用程序同步。

Terraform等工具在这方面发挥着关键作用，它允许开发人员和运维团队无缝定义、部署和管理基础设施。

从本质上讲，IaC 为更敏捷、高效和零错误的基础设施管理流程铺平了道路，与DevOps的自动化和协作理念密切相关。

### 数字基础设施的起源

基础设施即代码的[演变](https://thenewstack.io/navigating-the-evolution-infrastructure-as-catalog/)与云原生开发的兴起以及塑造这一景观的工具是密不可分的。在HashiCorp的Terraform等工具主导之前，IaC 主要是通过bash脚本和特定于云的工具来实现的。

Puppet、[Red Hat Ansible](https://www.openshift.com/try?utm_content=inline-mention)和Chef等早期参与者在[定义IaC的初期轨迹](https://thenewstack.io/how-chef-inspec-fits-in-with-todays-devops-practices/)方面发挥了关键作用。这些工具主要用于配置服务器，并且它们很好地适应了云计算的早期，当时的焦点主要是在配置虚拟机上。

### 从程序化到声明式IaC的云时代转型

向[云原生开发](https://thenewstack.io/cloud-native/)的转变见证了IaC风格的转变。已经提到的早期工具本质上更具程序化，详细说明了实现所需状态的步骤。这使得代码更难阅读和理解。

随着云计算的主流采用，IaC逐渐向更声明式的风格发展，以[Terraform和AWS CloudFormation](https://thenewstack.io/terraform-vs-cloudformation-which-is-better-for-you/)等工具为代表。在这种声明式方法中，重点是指定所需的最终状态，而不详细说明实现它的步骤。这使得代码更易读，因为它主要包含配置设置。

## 基础设施即代码的挑战

### 开发者的负担

传统上，开发者专注于编写和优化代码。随着IaC的出现，他们现在被期望理解和管理基础设施配置，为他们的责任增加了另一层次。

虽然有一些工具可以使这变得更容易，但责任仍然落在开发者身上，确保一切设置正确。这种转变模糊了传统角色之间的界限，曾经开发人员和运维团队之间有明确划分的地方，而随着DevOps和IaC的兴起，这些角色开始融合。

开发者现在发现自己要同时处理应用程序开发和基础设施管理，自然而然地导致认知负荷加重。

### 开发生命周期的挑战

IaC的开发生命周期明显比传统软件开发更慢且更繁琐。

在部署IaC代码时，涉及到一个显著的等待期，因为基础设施需要预分配。当出现错误时，这可能尤其令人沮丧。例如，如果开发者正在启动一个Kubernetes集群并遇到错误导致回滚，需要额外的时间等待已经配置的基础设施被销毁，然后花费更多时间识别问题并尝试另一次部署。

### 快速反馈的追求

IaC 中的部署速度与软件开发的一个关键方面即需要立即了解成功和失败反馈的需求发生了直接冲突。目前在 IaC 中缺乏这个反馈回路。

虽然有一些工具试图在本地模拟基础设施部署，例如 [LocalStack](https://localstack.cloud/)，但它们通常不能满足复杂场景或多个云提供商。这意味着开发人员花更多时间等待来看他们的配置和部署是否成功，而不是获得所需的反馈，从而导致开发过程的低效。

## 美好的前景：基础设施即代码的优点

IaC 当然有它的挑战，但重要的是不要忽略它带来的无数好处。IaC 的演变从根本上改变了对基础设施的看法、管理和部署，提供了大大超过其缺点的一系列优势。

### 一致性和可重现性

IaC 最重要的好处之一是能够保持一致的环境。通过以代码的形式定义基础设施，组织可以确保每个部署，从开发到生产，都是一致的，相对没有人为错误。这种可重现性意味着团队每次都可以重新创建完全相同的环境，消除了“它在我的机器上可以运行”的老问题。

### 版本控制和协作

与软件代码一样，IaC允许使用Git等工具对基础设施更改进行版本控制。这意味着团队可以跟踪随时间变化的更改，如有必要可以回滚到以前的配置，并可以更有效地协作。许多团队成员可以同时处理基础设施更改，相互检查更改并无缝合并，营造协作环境。

### 可扩展性和效率

使用IaC，扩展基础设施变得轻而易举。无论是启动新服务器还是部署整个Kubernetes集群，IaC工具都可以自动化这些流程，使它们更快更高效。这种自动化意味着随着应用程序用户群的增长，基础设施可以扩展来满足需求，无需手动干预。

### 节省成本

通过自动化基础设施部署和管理，组织可以实现可观的节省成本。手动流程既耗时又容易出错，导致浪费资源和不必要的开支。另一方面，IaC有助于优化资源使用，这意味着组织只需为所使用的资源付费。

此外，通过减少手动干预的需求，团队可以专注于更有价值的任务，进一步提高生产力和成本优化。

## IaC最佳实践：超越代码

IaC的最佳实践不仅仅是关于实现——它们应更关注用于部署基础设施的配置。归根结底，我们选择的工具将执行我们的命令，这表明一个熟悉当前策略的受过良好教育的工程师可能比使用的工具更有价值。让我们来探索一些这些最佳实践的情况

### 关注最终目标：安全的网络拓扑

在云中部署基础设施时的一项基础最佳实践是确保安全的网络拓扑。

例如，确保敏感资源不放在具有直接互联网访问权限的公共子网中对网络安全至关重要。这意味着像数据库这样的组件应始终放置在私有子网中，除非有充分的理由不这样做。

IaC的主要目标应始终是不仅要生成可重复的基础设施，还要优先考虑所建成的安全性。

### IaC中硬编码的陷阱

将具体的值直接硬编码到您编写的代码中可能是一项冒险的举措，既危及安全又缺乏灵活性。 当特定值(特别是敏感信息，如密码和密钥)被硬编码时，它们暴露给任何可以访问代码的人，增加潜在违规的风险。

此外，硬编码的值可能会抑制适应性；基础设施需求可能会发生变化，在代码中嵌入静态值会使创建新版本的过程变得极其复杂。这不仅会放慢流程，还会增加错误的可能性。

利用外部配置文件、环境变量或机密管理工具可以实现更动态、更安全和更可维护的IaC方法，确保基础设施可以轻松地适应不断变化的需求，而不会危及安全性。

### 拥抱版本控制

IaC中的版本控制与您的基础设施设置的时间机器类似。随着团队的发展和基础设施复杂性的增加，跟踪更改、回滚到以前的配置或简单地了解基础设施决策的历史变得非常宝贵。版本控制确保对基础设施所做的每一次更改都是有记录和时间戳的，这样团队就可以确定更改是在何时由谁完成的。

这不仅增强了责任制，还有助于故障排除，因为团队可以快速识别并恢复可能有问题的更改。此外，版本控制也促进了团队成员之间的协作。

在一个动态的环境中，多个工程师可能会对基础设施进行更改，版本控制可以确保这些更改不会相互覆盖或冲突。它为合并更新和解决差异提供了一条清晰的路径。

## 结论

基础设施即代码见证了DevOps和软件开发的演变，标志着我们对基础设施的方法和管理方式发生了转型性的转变。它在自动化、一致性和可扩展性方面的承诺是一场游戏规则变革，但重要的是要认识到它带来的细微差别和挑战。

虽然IaC已经简化了许多传统的基础设施任务，但它也要求开发人员具备一整套新的技能和考量。从早期的程序配置到声明式云原生时代的IaC历史之旅，强调了变化的快速步伐以及适应能力的必要性。

这些挑战虽然确实存在，但可以克服。实施适当的实践，例如关注拓扑安全性和利用版本控制工具，团队可以有效地应对这些复杂情况。

与任何技术一样，关键在于理解其优缺点并利用最佳实践来发挥其全部潜能。随着我们继续推进IaC的可能性界限，及时了解情况并保持适应能力，始终优先考虑安全高效的基础设施部署至关重要。
