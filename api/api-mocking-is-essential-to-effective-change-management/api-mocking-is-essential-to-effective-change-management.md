
<!--
title: API模拟对于有效的变更管理至关重要
cover: https://cdn.thenewstack.io/media/2024/11/365e6cb8-doubles.png
-->

在工作流程中包含模拟可以减少 API 漂移，简化变更管理，并建立更强大的 API 生态系统。

> 译自 [API Mocking Is Essential to Effective Change Management](https://thenewstack.io/api-mocking-is-essential-to-effective-change-management/)，作者 Israel Tetteh。

[在本系列的第一部分](https://yylives.cc/2024/11/25/the-tidal-wave-of-api-drift-use-mocking-to-stay-afloat/)，我讨论了模拟是如何解决API漂移问题的。然而，它也是一个更有效的[变更管理](https://thenewstack.io/the-chickens-have-flown-the-coop-change-management-is-back/)解决方案。API 模拟不仅仅是开发便利的工具，它还可以通过提供一致、可靠的基线来有效地支持变更管理，从而可以监控、测试和验证变更。

作为权威的真相来源，模拟使开发工作与计划中的API设计保持一致，降低了API[漂移](https://thenewstack.io/chaos-under-control-addressing-cloud-infrastructure-drift/)的风险，并提供了无缝的版本控制和变更跟踪。

## 模拟作为监控变更的权威基线

在[管理API更新](https://thenewstack.io/api-management/)时，一个不变的基线至关重要。如果没有它，团队可能会偏离API的预期设计，导致更多漂移和潜在的破坏性重大更改。API 模拟通过准确模拟API的预期行为和数据格式来作为基线。这使开发和质量保证团队能够将建议的更改与标准基准进行比较，确保新功能或升级在部署之前符合API指定的架构。

使用模拟作为权威基线为变更管理提供了各种好处：

1. **明确的期望和快乐的开发者**：模拟精确定义了API在结构和行为响应风格方面应该提供的内容。拥有一个一致的参考有助于开发人员发现更改何时偏离原始概念，并在问题蔓延到整个系统之前解决问题。这能让您的开发人员保持快乐、专注并清楚地了解他们需要交付的内容。
2. **准确的验证**：由于模拟复制了API的预期功能，因此它们提供了一个完美的环境来验证修改。通过将模拟响应与实际API行为进行匹配，开发人员可以验证一致性并在开发早期识别与漂移相关的问题。
3. **主动预防漂移**：定期更新和针对中央模拟进行验证，帮助团队确保文档和实际API实现保持同步，降低未来漂移的风险。在测试期间发现的每个差异都可以快速修复，以保持API与其声明的设计一致。

## 用于变更验证的标准化测试环境

变更管理的主要任务之一是确保在更改上线之前对其进行充分测试。在不必依赖实时API的情况下验证更改是否按预期工作，这在各个团队依赖同一API时尤其有用，因为模拟建立了一个一致的环境，该环境复制了API的生产行为。

基于模拟的标准化测试环境在以下几个方面帮助变更管理：

1. **受控的测试条件**：模拟使开发人员和测试人员能够建立受控条件，以在各种场景中复制API的响应。例如，他们可以模拟特定的数据结构、错误响应或负载情况，以彻底测试修改。这种可预测性降低了问题在测试中被忽略的可能性，因为团队可以在无风险的环境中评估更改如何影响依赖应用程序。
2. **减少对实时API可用性的依赖**：在许多情况下，由于维护、开发不完整或速率限制，访问实时API可能会受到限制。使用模拟API可以确保在一致、可预测的环境中验证更改，从而帮助团队保持CI/CD管道。

## 版本控制和变更跟踪的透明度

对于必须随着时间推移管理更改并监控API版本的团队来说，集中的模拟环境非常有用。团队从集中的环境中创建一个透明、可信的真相来源，所有利益相关者都可以在其中访问模拟API，这构成了版本控制和变更跟踪的基础。通过使每个团队都从相同的基线操作，并符合所需的API行为和结构，这种集中式方法有助于减少漂移。

以下是集中式模拟环境如何支持有效的版本控制并随着时间的推移减少漂移：

1. **透明版本控制:** 集中式模拟允许团队轻松实现和管理API版本控制，保留了随着时间推移的更新和弃用记录。开发人员可以在模拟的不同版本中工作，测试更改如何影响以前的版本，同时规划新版本。这种透明度有助于保持向后兼容性，确保更改不会影响当前用户和应用程序。
2. **一致的变更跟踪:** 在集中的模拟环境中，对API的每一次更改都对所有相关团队可见，从而增强了透明度和责任感。将变更跟踪工具与模拟API集成，允许开发人员记录更新，创建改进、问题修复和更改的完整审计跟踪。这种开放性使利益相关者能够准确了解何时以及为何进行修改，从而能够评估影响并更好地控制后续更新。
3. **增强的文档准确性:** 集中式模拟环境还可以通过自动同步模拟和实时API响应来促进准确的实时文档。通过将文档工具与模拟API集成，团队可以使规范保持最新并与API的实际行为相匹配，降低由过时文档引起的偏差风险。

## 集成API模拟的实用步骤

想要在变更管理中正确使用API模拟的团队必须在其日常开发流程中包含模拟技术。这些技术确保API的文档规范、实现和测试环境保持一致，降低偏差风险，并支持一致、开放的更新。

**步骤1：定义API的“真相来源”:** 将API模拟作为“[真相来源](https://www.getambassador.io/blog/openapi-specification-structure-best-practices)”是将模拟集成到变更管理中的第一步。团队可以通过创建与官方API契约匹配的模拟来构建API应如何运行的可信参考。这种集中的模拟统一了开发工作和文档，为所有API交互建立了清晰、可靠的标准。

**设定清晰的API契约:** 模拟应与声明的API规范相匹配，包括端点结构、数据格式和错误响应。此契约作为模拟的基础，指定API应该提供什么。对于需要向后兼容的API，使用版本控制来跟踪多个API版本尤其重要。通过监控版本，团队可以比较和测试以前的版本，以避免在发布升级时出现中断。

**实施版本控制:**

**步骤2：安排定期同步和审查:** 为防止API漂移，团队应建立定期检查点，在这些检查点中，将模拟API与实际实现进行比较，尽早发现异常并纠正它们，以免它们损害生产环境。

- **设置定期审查:** 定期将模拟API与实时实现进行比较，以确保它们同步。这些同步可以集成到sprint审查中，或者标记为“API检查”以跟踪更改并在发生时管理漂移。
- **分配同步所有权:** 将某些团队成员指定为“API管理员”，负责协调定期审查并确保模拟和实时API同步。为这些同步指定联系人可以保证责任和连续性，从而确保API的一致性。

**步骤3：自动化监控:** 自动化监控可以通过不断地将模拟API与实时实现进行验证来大大加快变更管理流程。通过自动化，团队可以在发生偏差时收到通知，从而允许他们实时处理问题并避免漂移累积。

- **实施漂移检测工具:** 监控工具用于识别模拟API和实时API之间的差异。可以配置这些工具来自动检查响应格式、端点可用性和数据结构的差异，如果发现漂移，则通知团队。
- **自动回滚关键漂移:** 当漂移影响关键API功能时，可以设置自动监控以启动回滚，将API恢复到以前的稳定版本。这种自动化减少了中断，同时也确保了意外修改不会影响下游应用程序。

**步骤4：将模拟更新集成到CI/CD管道中。** 通过在部署过程中包含模拟以保持跨环境的一致性，团队可以确保模拟API与每个新版本保持最新，确保已记录的实现和实际实现一致。

- **在构建和部署期间验证模拟**：在 CI/CD 流程中，将模拟 API 与实现进行验证，以保证在任何代码发布到生产环境之前的一致性。此阶段保证任何影响 API 的修改都针对模拟进行测试，从而在差异到达最终用户之前识别出来。



**步骤 5：促进跨团队协作**： API 模拟充当共享资源，鼓励前端、后端和 QA 团队之间的协作。组织可以通过提供集中、透明的模拟环境来建立反馈循环，从而统一开发工作并允许团队及时纠正异常。并且不要忘记，模拟的最佳实践是认识到[模拟是一项团队运动！](https://www.forbes.com/councils/forbestechcouncil/2024/10/30/api-mocking-is-a-team-sport/)

**使用模拟进行协作反馈循环**： 创建一个工作流程，其中前端、后端和 QA 团队使用模拟 API 作为沟通桥梁。例如，如果模拟响应不满足 UI 标准，前端开发人员可能会标记问题，而后端团队可以更新模拟响应以反映结构变化。这个[持续的反馈循环](https://www.getambassador.io/blog/boost-developer-velocity-optimizing-feedback-loops)促进了团队合作和一致性。

## 走向模拟

很明显，保持 API 文档、实现和预期功能之间的一致性至关重要。[API 模拟](https://www.getambassador.io/blog/mocking-ai-chatbot-api)对于强制执行这种一致性至关重要，因为它提供了一种严谨且系统的方法来定义 API 如何运行的明确“契约”。模拟模拟了 API 的预期答案，为开发、测试和部署提供了可靠且可预测的基础，降低了 API 漂移的风险，并保证了团队之间的一致性。

当集成到变更管理流程中时，API 模拟提供了改进 API 可靠性和稳定性的保护，即使项目规模扩大或进行快速修订也是如此。投资 API 模拟为开发团队提供了长期基础，使他们能够自信地应对变化，确保 API 对所有利益相关者保持强大和可靠。

通过在工作流程中包含模拟，您可以主动减少 API 漂移（我们开始整个对话的地方），简化变更管理并建立强大的 API 生态系统。这项投资最终将提高团队的生产力、协作和整体产品质量。如果您想了解如何在 Blackbird 中创建模拟实例，[请在此处查看](https://www.getambassador.io/docs/blackbird/latest/guides/mocks)或了解您如何在 Blackbird 中[模拟 AI 聊天机器人](https://www.getambassador.io/blog/mocking-ai-chatbot-api)。

[YOUTUBE.COM/THENEWSTACK 技术发展迅速，不要错过任何一集。订阅我们的 YouTube 频道以串流收听我们所有的播客、访谈、演示等等。](https://youtube.com/thenewstack?sub_confirmation=1)