# 诊断体系

任何问题的诊断，首先就是要搞清楚问题是什么，然后通过各种手段洞悉问题的本质。

这里先不提如何搞清“问题是什么？”，那是一个更普遍的话题，我们来谈谈做为一个IT技术人员，如何去洞悉问题的本质。

我们所面对的是一个复杂的IT系统，是建立在各种基础之上的。首先要有一个舒适的机房，计算机是符合各种工业标准的硬件组成，程序运行在已经越来越复杂的操作系统上或者是某个虚拟机之上，而越来越多地程序都有自己的运行时环境或者说是某个语言的虚拟机，大多数应用程序都是建立在著名框架或容器之上，最后是我们的程序员写的程序。所以我们面对的是这样一个盏：

 * 应用程序
 * 中间件和框架
 * 运行时环境
 * 操作系统
 * 硬件
 * 环境

为了保证整个IT系统的稳定，基础一定要打好，这也是现实情况。环境硬件往往是可靠的，大多数情况下是不需要怀疑的。操作系统也是愈加稳定，但是因为用户已经能轻易的操纵操作系统，所以就不一定那么一定可靠了。而运行时环境以及容器，通常也是可靠的，但是功能越强大，越容易出现问题。最容易出现问题的是我们自己的代码。

因为这个堆栈的下层都是对上层起到支撑作用，所以自然也会提供一些工具帮助上层诊断问题，所以一个解决问题的高手，一定是能够熟练运用各种工具的人，即使未必全通，也应当可以将问题的层级理清，以便协调其他人来协助处理。

后面是自底向上的各个层面的概述，未来会通过这个blog慢慢丰满。

## 环境

 * 通讯线路
 * 电力供应
 * 空调
 * 火灾、洪水和地震
 * 宇宙射线

也许我们做软件的从不关心这些，但这些确实有人在默默的支撑。尽管通常情况下不需要考虑这些问题，但是极端情况下也会真的带来问题。这里有一些相关的[小典故](/some-stories-about-env/)

## 硬件

硬件的更新成本远远大于软件，所以尽量设计成通用且可以扩展，还能够保持一定的时效性。硬件最初能够提供的工具很少，也比较原始，例如指示灯和蜂鸣声，感觉当年数着蜂鸣声判断故障原因有点萌。现在的硬件有了更强大的工具，例如IPMI，通过这个接口，我们可以获取诸如CPU温度的更多信息。

当然，我们之前更多的是通过操作系统获取硬件信息，例如存储损坏，网卡不工作，都是可以在操作系统层面查看。

这方面我的认识比较入门，期待专家补充。

## 操作系统

操作系统层面的工具，一方面是针对硬件，可以报告硬件的运行情况。另一方面，对于运行在该操作系统上的程序，也提供了诊断工具。因为在现代操作系统，所有的应用程序都是运行在操作系统上的进程，所以理解程序是如何在操作系统之上运行的就变得非常必要。

理论上讲，通过洞察进程的运行状况，我们就可以知道程序在干啥，但实际上现代高级编程语言，很多并不是直接运行在操作系统之上，而是一种模拟运行，此时操作系统工具并不特别有效。

## 运行时环境

以Java为例，Java并不是直接运行在操作系统上，而是运行在一个虚拟机之中，也就是JVM里，一般的操作系统工具并没有深入到虚拟机内部中，所以也无法获知Java代码的运行状况，所以对于Java应用的侦查，就需要依赖JVM本身的工具。


## 中间件和框架

直接用编程语言编写业务系统还是很难的，所以出现了中间件这个概念。中间件把应用系统的常用功能做成服务或库，然后应用开发人员在中间件基础之上开发业务系统。基于Java语言的JEE是最有名的中间件标准，基于这个标准出现了许多商业中间件，例如WebLogic和WebSphere；还有许多开源中间件，例如JBoss，jetty等。这类中间件本身功能强大，同时提供了各类对应的监控管理工具，尤其是商业中间件，可以帮助我们更快的解决问题。

随着开源事业的发展，有些框架几乎成为事实上的标准，例如Java领域的Spring、Dubbo，这些框架也提供了许多工具，辅助调试应用或框架的配置问题。

随着技术的发展，很多编程语言已经将很多应用服务做到了语言的基本包中，像JEE这种重型中间件已经变得不在流行。以golang为例，通过标准库，即可实现http服务，并不需要额外的框架。

## 应用程序

随着基础软件的发展，应用程序的开发越来越简单了。但是随着微服务、DevOps的发展，应用程序的要求也不一样了。有时我们需要在应用程序层面去做一些改造，去满足更高层面的需求。

## 结论

本站会发展成什么样子，现在还不好说，所以以后补充吧。


