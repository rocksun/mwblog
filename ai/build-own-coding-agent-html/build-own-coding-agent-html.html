<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head>
<meta content="uft-8" name="charset">

<title>Building your own CLI Coding Agent with Pydantic-AI</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8"><script defer="" src="https://cloud.umami.is/script.js" data-website-id="eb12527f-b713-4afa-905a-8a50f8a7f157"></script>
<meta content="summary" name="twitter:card">

<meta content="16665197" name="twitter:site:id">

<meta content="@martinfowler" name="twitter:site">

<meta content="Building your own CLI Coding Agent with Pydantic-AI" property="og:title">

<meta content="https://martinfowler.com/articles/build-own-coding-agent.html" property="og:url">

<meta content="How to build a CLI coding agent" property="og:description">

<meta content="https://martinfowler.com/logo-sq.png" property="og:image">

<meta content="martinfowler.com" property="og:site_name">

<meta content="article" property="og:type">

<meta content="2025-08-27" property="og:article:modified_time">

<meta content="width=device-width, initial-scale=1" name="viewport">

<link href="article.css" rel="stylesheet" type="text/css">
</head>

<body><header id="banner" style="background-image: url(&quot;/banner.png&quot;); background-repeat: no-repeat">

<div class="name-logo"><a href="https://martinfowler.com"><img src="/mf-name-white.png"></a></div>
  <div class="search">
    <!-- SiteSearch Google -->
    <form method="GET" action="https://www.google.com/search">
      <input type="hidden" name="ie" value="UTF-8">
      <input type="hidden" name="oe" value="UTF-8">
      <input class="field" type="text" name="q" size="15" maxlength="255" value="">
      <button class="button" type="submit" name="btnG" value=" " title="Search">
      <input type="hidden" name="domains" value="martinfowler.com">
      <input type="hidden" name="sitesearch" value=""> 
      <input type="hidden" name="sitesearch" value="martinfowler.com">
    
  </button></form></div>

<div class="menu-button navmenu-button"><a class="icon icon-bars" href="#navmenu-bottom"></a></div>

<nav class="top-menu">
<ul>
<li><a class="" href="https://refactoring.com">Refactoring</a></li>

<li><a class="" href="/agile.html">Agile</a></li>

<li><a class="" href="/architecture">Architecture</a></li>

<li><a class="" href="/aboutMe.html">About</a></li>

<li><a class="tw" href="https://www.thoughtworks.com/engineering">Thoughtworks</a></li>

<li><a class="icon icon-rss" href="/feed.atom" title="feed"></a></li>

<li><a class="icon icon-twitter" href="https://www.twitter.com/martinfowler" title="Twitter stream"></a></li>

<li class="icon"><a href="https://toot.thoughtworks.com/@mfowler" title="Mastodon stream"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M21.2595 13.9898C20.9852 15.4006 18.8033 16.9446 16.2974 17.2439C14.9907 17.3998 13.7041 17.5431 12.3321 17.4802C10.0885 17.3774 8.31809 16.9446 8.31809 16.9446C8.31809 17.163 8.33156 17.371 8.3585 17.5655C8.65019 19.7797 10.5541 19.9124 12.3576 19.9742C14.1779 20.0365 15.7987 19.5254 15.7987 19.5254L15.8735 21.1711C15.8735 21.1711 14.6003 21.8548 12.3321 21.9805C11.0814 22.0493 9.52849 21.9491 7.71973 21.4703C3.79684 20.432 3.12219 16.2504 3.01896 12.0074C2.98749 10.7477 3.00689 9.55981 3.00689 8.56632C3.00689 4.22771 5.84955 2.95599 5.84955 2.95599C7.2829 2.29772 9.74238 2.0209 12.2993 2H12.3621C14.919 2.0209 17.3801 2.29772 18.8133 2.95599C18.8133 2.95599 21.6559 4.22771 21.6559 8.56632C21.6559 8.56632 21.6916 11.7674 21.2595 13.9898ZM18.3029 8.9029C18.3029 7.82924 18.0295 6.97604 17.4805 6.34482C16.9142 5.71359 16.1726 5.39001 15.2522 5.39001C14.187 5.39001 13.3805 5.79937 12.8473 6.61819L12.3288 7.48723L11.8104 6.61819C11.2771 5.79937 10.4706 5.39001 9.40554 5.39001C8.485 5.39001 7.74344 5.71359 7.17719 6.34482C6.62807 6.97604 6.3547 7.82924 6.3547 8.9029V14.1562H8.43597V9.05731C8.43597 7.98246 8.88822 7.4369 9.79281 7.4369C10.793 7.4369 11.2944 8.08408 11.2944 9.36376V12.1547H13.3634V9.36376C13.3634 8.08408 13.8646 7.4369 14.8648 7.4369C15.7694 7.4369 16.2216 7.98246 16.2216 9.05731V14.1562H18.3029V8.9029Z"></path></svg>
</a></li>

<li class="icon"><a href="https://www.linkedin.com/in/martin-fowler-com/" title="LinkedIn"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M4.00098 3H20.001C20.5533 3 21.001 3.44772 21.001 4V20C21.001 20.5523 20.5533 21 20.001 21H4.00098C3.44869 21 3.00098 20.5523 3.00098 20V4C3.00098 3.44772 3.44869 3 4.00098 3ZM5.00098 5V19H19.001V5H5.00098ZM7.50098 9C6.67255 9 6.00098 8.32843 6.00098 7.5C6.00098 6.67157 6.67255 6 7.50098 6C8.3294 6 9.00098 6.67157 9.00098 7.5C9.00098 8.32843 8.3294 9 7.50098 9ZM6.50098 10H8.50098V17.5H6.50098V10ZM12.001 10.4295C12.5854 9.86534 13.2665 9.5 14.001 9.5C16.072 9.5 17.501 11.1789 17.501 13.25V17.5H15.501V13.25C15.501 12.2835 14.7175 11.5 13.751 11.5C12.7845 11.5 12.001 12.2835 12.001 13.25V17.5H10.001V10H12.001V10.4295Z"></path></svg>
</a></li>

<li class="icon"><a href="https://bsky.app/profile/martinfowler.com" title="BlueSky"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 11.3884C11.0942 9.62673 8.62833 6.34423 6.335 4.7259C4.13833 3.17506 3.30083 3.4434 2.75167 3.69256C2.11583 3.9784 2 4.95506 2 5.52839C2 6.10339 2.315 10.2367 2.52 10.9276C3.19917 13.2076 5.61417 13.9776 7.83917 13.7309C4.57917 14.2142 1.68333 15.4017 5.48083 19.6292C9.65833 23.9542 11.2058 18.7017 12 16.0392C12.7942 18.7017 13.7083 23.7651 18.4442 19.6292C22 16.0392 19.4208 14.2142 16.1608 13.7309C18.3858 13.9784 20.8008 13.2076 21.48 10.9276C21.685 10.2376 22 6.10256 22 5.52923C22 4.95423 21.8842 3.97839 21.2483 3.6909C20.6992 3.44256 19.8617 3.17423 17.665 4.72423C15.3717 6.34506 12.9058 9.62756 12 11.3884Z"></path></svg></a></li>
</ul>
</nav>
</header>
<nav id="top-navmenu">
<nav class="navmenu">
<div class="nav-head">  <div class="search">
    <!-- SiteSearch Google -->
    <form method="GET" action="https://www.google.com/search">
      <input type="hidden" name="ie" value="UTF-8">
      <input type="hidden" name="oe" value="UTF-8">
      <input class="field" type="text" name="q" size="15" maxlength="255" value="">
      <button class="button" type="submit" name="btnG" value=" " title="Search">
      <input type="hidden" name="domains" value="martinfowler.com">
      <input type="hidden" name="sitesearch" value=""> 
      <input type="hidden" name="sitesearch" value="martinfowler.com">
    
  </button></form></div>

<div class="closediv">
<span class="close" title="close"></span>
</div>
</div>

<div class="nav-body">
<div class="topics">
<h2>Topics</h2>

<p><a href="/architecture">Architecture</a></p>

<p><a href="https://refactoring.com">Refactoring</a></p>

<p><a href="/agile.html">Agile</a></p>

<p><a href="/delivery.html">Delivery</a></p>

<p><a href="/microservices">Microservices</a></p>

<p><a href="/data">Data</a></p>

<p><a href="/testing">Testing</a></p>

<p><a href="/dsl.html">DSL</a></p>
</div>

<div class="about">
<h2>about me</h2>

<p><a href="/aboutMe.html">About</a></p>

<p><a href="/books">Books</a></p>

<p><a href="/faq.html">FAQ</a></p>
</div>

<div class="content">
<h2>content</h2>

<p><a href="/videos.html">Videos</a></p>

<p><a href="/tags">Content Index</a></p>

<p><a href="/articles/eurogames">Board Games</a></p>

<p><a href="/photos">Photography</a></p>
</div>

<div class="tw">
<h2>Thoughtworks</h2>

<p><a href="https://thoughtworks.com">Home</a></p>

<p><a href="https://thoughtworks.com/insights">Insights</a></p>

<p><a href="https://thoughtworks.com/careers">Careers</a></p>

<p><a href="https://thoughtworks.com/radar">Radar</a></p>

<p><a href="https://www.thoughtworks.com/engineering">Engineering</a></p>
</div>

<div class="feeds">
<h2>follow</h2>

<p><a href="/feed.atom">RSS</a></p>

<p><a href="https://toot.thoughtworks.com/@mfowler">Mastodon</a></p>

<p><a href="https://www.linkedin.com/in/martin-fowler-com/">LinkedIn</a></p>

<p><a href="https://bsky.app/profile/martinfowler.com">Bluesky</a></p>

<p><a href="https://www.twitter.com/martinfowler">X</a></p>

<p><a href="https://boardgamegeek.com/blog/13064/martins-7th-decade">BGG</a></p>
</div>
</div>
</nav>
</nav>

<nav id="toc-dropdown">
<button class="dropdown-button">
<h2>Table of Contents</h2>
</button>

<div class="hidden" id="dropdownLinks">
<ul>
<li><a href="#top">Top</a></li>

<li><a href="#TheWaveOfCliCodingAgents">The wave of CLI Coding Agents</a></li>

<li><a href="#WhyBuildWhenYouCanBuy">Why Build When You Can Buy?</a></li>

<li><a href="#TheArchitectureOfOurDevelopmentAgent">The Architecture of Our Development Agent</a></li>

<li><a href="#StartingSimpleTheFoundation">Starting Simple: The Foundation</a></li>

<li><a href="#FirstCapabilityTesting">First Capability: Testing!</a></li>

<li><a href="#AddingIntelligenceInstructionsAndIntent">Adding Intelligence: Instructions and intent</a></li>

<li><a href="#TheMcpRevolutionPluggableCapabilities">The MCP Revolution: Pluggable Capabilities</a></li>

<li><a href="#SandboxedPythonExecution">Sandboxed Python Execution</a></li>

<li><a href="#Up-to-dateLibraryDocumentation">Up-to-Date library Documentation</a></li>

<li><a href="#AwsMcps">AWS MCPs</a></li>

<li><a href="#InternetSearchForCurrentInformation">Internet Search for Current Information</a></li>

<li><a href="#StructuredProblemSolving">Structured Problem Solving</a></li>

<li><a href="#OptimisingForReasoning">Optimising for Reasoning</a></li>

<li><a href="#DesktopCommanderWarningWithGreatPowerComesGreatResponsibility">Desktop Commander: Warning! With great power comes great responsibility!</a></li>

<li><a href="#TheCompleteSystem">The Complete System</a></li>

<li><a href="#WhatWeLearnedAboutCliAgents">What We Learned About CLI Agents</a></li>

<li><a href="#TheRoadAhead">The Road Ahead</a></li>

<li><a href="#WhyThisMatters">Why This Matters</a></li>
</ul>
</div>
</nav>

<main>
<h1>Building your own CLI Coding Agent with Pydantic-AI</h1>

<p class="subtitle">Learning by doing</p>

<section class="frontMatter">
<p class="abstract"><i>CLI coding agents are a fundamentally different tool to chatbots or
  autocomplete tools - they're agents that can read code, run tests, and update
  a codebase. While commercial tools are impressive, they don't understand the
  particular context of our environment and the eccentricities of our specific
  project. Instead we can build our own coding agent by assembling open source
  tools, using our specific development standards for: testing, documentation
  production, code reasoning, and file system operations. </i></p>

<p class="date">27 August 2025</p>
<hr>
<div class="front-grid">
<div class="author-list">
<div class="author">
<div class="photo"><a href="https://www.linkedin.com/in/benomahony/"><img alt="Photo of Ben O'Mahony" src="build-own-coding-agent/ben-o-mahony.jpg" width="80"></a></div>

<address class="name"><a href="https://www.linkedin.com/in/benomahony/" rel="author">Ben O'Mahony</a></address>

<div class="bio">
<p>Ben O’Mahony is Principal AI Engineer at Thoughtworks. He is a results-driven AI/Engineering leader with a track record of building high-performing teams and shipping business-critical AI, ML and data products and platforms at scale. He has deep expertise across the full Engineering and Data lifecycle from research to production deployment. Ben is adept at defining technical strategy, driving execution and partnering cross-functionally to deliver measurable impact. Recently Ben has been intensely focused on building Generative AI platforms, models and agents.</p>
</div>
</div>
</div>

<div class="tags"></div>

<div class="contents">
<h2>Contents</h2>

<ul>
<li><a href="#TheWaveOfCliCodingAgents">The wave of CLI Coding Agents</a></li>

<li><a href="#WhyBuildWhenYouCanBuy">Why Build When You Can Buy?</a></li>

<li><a href="#TheArchitectureOfOurDevelopmentAgent">The Architecture of Our Development Agent</a></li>

<li><a href="#StartingSimpleTheFoundation">Starting Simple: The Foundation</a></li>

<li><a href="#FirstCapabilityTesting">First Capability: Testing!</a></li>

<li><a href="#AddingIntelligenceInstructionsAndIntent">Adding Intelligence: Instructions and intent</a></li>

<li><a href="#TheMcpRevolutionPluggableCapabilities">The MCP Revolution: Pluggable Capabilities</a></li>

<li><a href="#SandboxedPythonExecution">Sandboxed Python Execution</a></li>

<li><a href="#Up-to-dateLibraryDocumentation">Up-to-Date library Documentation</a></li>

<li><a href="#AwsMcps">AWS MCPs</a></li>

<li><a href="#InternetSearchForCurrentInformation">Internet Search for Current Information</a></li>

<li><a href="#StructuredProblemSolving">Structured Problem Solving</a></li>

<li><a href="#OptimisingForReasoning">Optimising for Reasoning</a></li>

<li><a href="#DesktopCommanderWarningWithGreatPowerComesGreatResponsibility">Desktop Commander: Warning! With great power comes great responsibility!</a></li>

<li><a href="#TheCompleteSystem">The Complete System</a></li>

<li><a href="#WhatWeLearnedAboutCliAgents">What We Learned About CLI Agents</a></li>

<li><a href="#TheRoadAhead">The Road Ahead</a></li>

<li><a href="#WhyThisMatters">Why This Matters</a></li>
</ul>
</div>
</div>
<hr></section>

<div class="paperBody shallow">
<section id="TheWaveOfCliCodingAgents">
<h2>The wave of CLI Coding Agents</h2>

<p>If you have tried Claude Code, Gemini Code, Open Code or Simon
      Willison’s <a href="https://github.com/simonw/llm">LLM CLI</a>, you’ve experienced something fundamentally
      different from ChatGPT or Github Copilot. These aren’t just chatbots or
      autocomplete tools - they’re agents that can read your code, run your
      tests, search docs and make changes to your codebase async.</p>

<p>But how do they work? For me the best way to understand how any tool
      works is to try and build it myself. So that’s exactly what we did, and in
      this article I’ll take you through how we built our own CLI Coding Agent
      using the Pydantic-AI framework and the Model Context Protocol (MCP).
      You’ll see not just how to assemble the pieces but why each capability
      matters and how it changes the way you can work with code.</p>

<p>Our implementation leverages AWS Bedrock but with Pydantic-AI you could
      easily use any other mainstream provider or even a fully local LLM.</p>
</section>

<section id="WhyBuildWhenYouCanBuy">
<h2>Why Build When You Can Buy?</h2>

<p>Before diving into the technical implementation, let's examine why we
      chose to build our own solution.</p>

<p>The answer became clear very quickly using our custom agent, while
      commercial tools are impressive, they’re built for general use cases. Our
      agent was fully customised to our internal context and all the little
      eccentricities of our specific project. More importantly, building it gave
      us insights into how these systems work and the quality of our own GenAI
      Platform and Dev Tooling.</p>

<p>Think of it like learning to cook. You can eat at restaurants forever
      but understanding how flavours combine and techniques work makes you
      appreciate food differently - and lets you create exactly what you
      want.</p>
</section>

<section id="TheArchitectureOfOurDevelopmentAgent">
<h2>The Architecture of Our Development Agent</h2>

<p>At a high level, our coding assistant consists of several key
      components:</p>

<ul>
<li>Core AI Model: Claude from Anthropic accessed through AWS Bedrock </li>

<li>Pydantic-AI Framework: provides the agent framework and many helpful
        utilities to make our Agent more useful immediately </li>

<li>MCP Servers: independent processes that give the agent specialised
        tools, MCP is a common standard for defining the servers that contain these
        tools. </li>

<li>CLI Interface: how users interact with the assistant</li>
</ul>

<p>The magic happens through the Model Context Protocol (MCP), which
      allows the AI model to use various tools through a standardized interface.
      This architecture makes our assistant highly extensible - we can easily
      add new capabilities by implementing additional MCP servers, but we’re
      getting ahead of ourselves.</p>
</section>

<section id="StartingSimpleTheFoundation">
<h2>Starting Simple: The Foundation</h2>

<p>We started by creating a basic project structure and installing the
      necessary dependencies:</p>

<pre>uv init
uv add pydantic_ai
uv add boto3
</pre>

<p>Our primary dependencies include:</p>

<ul>
<li><code>pydantic-ai</code>: Framework for building AI agents</li>

<li><code>boto3</code>: For AWS API interactions</li>
</ul>

<p>We chose Claude Sonnet 4 from Anthropic (accessed via AWS Bedrock) as
      our foundation model due to its strong code understanding and generation
      capabilities. Here's how we configured it in our <code>main.py</code>:</p>

<pre>import boto3
from pydantic_ai import Agent
from pydantic_ai.mcp import MCPServerStdio
from pydantic_ai.models.bedrock import BedrockConverseModel
from pydantic_ai.providers.bedrock import BedrockProvider
</pre>

<pre>bedrock_config = BotocoreConfig(
    read_timeout=300,
    connect_timeout=60,
    retries={"max_attempts": 3},
)
bedrock_client = boto3.client(
    "bedrock-runtime", region_name="eu-central-1", config=bedrock_config
)
model = BedrockConverseModel(
    "eu.anthropic.claude-sonnet-4-20250514-v1:0",
    provider=BedrockProvider(bedrock_client=bedrock_client),
)
agent = Agent(
    model=model,
)
</pre>

<pre>if __name__ == "__main__":
  agent.to_cli_sync()
</pre>

<p>At this stage we already have a fully working CLI with a chat interface
      which we can use as you would a GUI chat interface, which is pretty cool
      for how little code this is! However we can definitely improve upon
      this.</p>
</section>

<section id="FirstCapabilityTesting">
<h2>First Capability: Testing!</h2>

<p>Instead of running the tests ourselves after each coding iteration why
      not get the agent to do it? Seems simple right?</p>

<pre>import subprocess
</pre>

<pre>@agent.tool_plain()
def run_unit_tests() -&gt; str:
    """Run unit tests using uv."""
    result = subprocess.run(
        ["uv", "run", "pytest", "-xvs", "tests/"], capture_output=True, text=True
    )
    return result.stdout
</pre>

<p>Here we use the same pytest command you would run in the terminal (I’ve
      shortened ours for the article). Now something magical happened. I could
      say “X isn’t working” and the agent would:</p>

<ul>
<li>1. Run the test suite</li>

<li>2. Identify which specific tests were failing</li>

<li>3. Analyze the error messages</li>

<li>4. Suggest targeted fixes.</li>
</ul>

<p><b>The workflow change:</b> Instead of staring at test failures or copy
      pasting terminal outputs into ChatGPT we now give our agent super relevant
      context about any issues in our codebase.</p>

<p>However we noticed our agent sometimes “fixed” failing tests by
      suggesting changes to the tests, not the actual implementation. This led
      to our next addition.</p>
</section>

<section id="AddingIntelligenceInstructionsAndIntent">
<h2>Adding Intelligence: Instructions and intent</h2>

<p>We realised we needed to teach our agent a little more about our
      development philosophy and steer it away from bad behaviours.</p>

<pre>instructions = """
You are a specialised agent for maintaining and developing the XXXXXX codebase.

## Development Guidelines:

1. **Test Failures:**
   - When tests fail, fix the implementation first, not the tests
   - Tests represent expected behavior; implementation should conform to tests
   - Only modify tests if they clearly don't match specifications

2. **Code Changes:**
   - Make the smallest possible changes to fix issues
   - Focus on fixing the specific problem rather than rewriting large portions
   - Add unit tests for all new functionality before implementing it

3. **Best Practices:**
   - Keep functions small with a single responsibility
   - Implement proper error handling with appropriate exceptions
   - Be mindful of configuration dependencies in tests

Remember to examine test failure messages carefully to understand the root cause before making any changes.
"""
</pre>

<pre>agent = Agent(
instructions=instructions,
model=model,
)
</pre>

<p><b>The workflow change:</b> The agent now understands our values around
      Test Driven Development and minimal changes. It stopped suggesting large
      refactors where a small fix would do (Mostly).</p>

<p>Now while we could continue building everything from absolute scratch
      and tweaking our prompts for days we want to go fast and use some tools
      other people have built - Enter Model Context Protocol (MCP).</p>
</section>

<section id="TheMcpRevolutionPluggableCapabilities">
<h2>The MCP Revolution: Pluggable Capabilities</h2>

<p>This is where our agent transformed from a helpful assistant to
      something approaching the commercial CLI agents. The Model Context
      Protocol (MCP) allows us to add sophisticated capabilities by running
      specialized servers.</p>

<blockquote>
<p>MCP is an open protocol that standardizes how applications provide
        context to LLMs. Think of MCP like a USB-C port for AI applications.
        Just as USB-C provides a standardized way to connect your devices to
        various peripherals and accessories, MCP provides a standardized way to
        connect AI models to different data sources and tools. </p>

<p class="quote-attribution">-- <a href="https://modelcontextprotocol.io/introduction">MCP Introduction</a></p>
</blockquote>

<p>We can run these servers as a local process, so no data sharing, where
      we interact with STDIN/STDOUT to keep things simple and local. <a href="/articles/function-call-LLM.html">(More details on tools and MCP)</a></p>
</section>

<section id="SandboxedPythonExecution">
<h2>Sandboxed Python Execution</h2>

<p>Using large language models to do calculations or executing arbitrary code they create is not effective and potentially very dangerous! To make our Agent more accurate and safe our first MCP addition was Pydantic Al’s default server for sandboxed Python code execution:</p>

<pre>run_python = MCPServerStdio(
    "deno",
    args=[
        "run",
        "-N",
        "-R=node_modules",
        "-W=node_modules",
        "--node-modules-dir=auto",
        "jsr:@pydantic/mcp-run-python",
        "stdio",
    ],
)
</pre>

<pre>agent = Agent(
    ...
    mcp_servers=[
        run_python
    ],
)
</pre>

<p>This gave our agent a sandbox where it could test ideas, prototype
      solutions, and verify its own suggestions.</p>

<p>NOTE: This is very different from running the tests where we need the
      local environment and is intended to be used to make calculations much
      more robust. This is because writing the code to output a number and then
      executing that code is much more reliable and understandable, scalable and
      repeatable than just generating the next token in a calculation. We have
      seen from frontier labs (including their leaked instructions) that this is
      a much better approach.</p>

<p><b>The workflow change:</b> Doing calculations, even more complex ones,
      became significantly more reliable. This is useful for many things like
      dates, sums, counts etc. It also allows for a rapid iteration cycle of
      simple python code.</p>
</section>

<section id="Up-to-dateLibraryDocumentation">
<h2>Up-to-Date library Documentation</h2>

<p>LLMs are mostly trained in batch on historical data this gives a fixed
      cutoff while languages and dependencies continue to change and improve so
      we added <a href="https://context7.com/">Context7</a> for access to up to date python
      library documentation in LLM consumable format:</p>

<pre>context7 = MCPServerStdio(
    command="npx", args=["-y", "@upstash/context7-mcp"], tool_prefix="context"
)
</pre>

<p><b>The workflow change:</b> When working with newer libraries or trying to
      use advanced features, the agent could look up current documentation
      rather than relying on potentially outdated training data. This made it
      much more reliable for real-world development work.</p>
</section>

<section id="AwsMcps">
<h2>AWS MCPs</h2>

<p>Since this particular agent was built with an AWS platform in mind, we
      added the AWS Labs MCP servers for comprehensive cloud docs and
      integration:</p>

<pre>awslabs = MCPServerStdio(
    command="uvx",
    args=["awslabs.core-mcp-server@latest"],
    env={"FASTMCP_LOG_LEVEL": "ERROR"},
    tool_prefix="awslabs",
)
aws_docs = MCPServerStdio(
    command="uvx",
    args=["awslabs.aws-documentation-mcp-server@latest"],
    env={"FASTMCP_LOG_LEVEL": "ERROR", "AWS_DOCUMENTATION_PARTITION": "aws"},
    tool_prefix="aws_docs",
)
</pre>

<p><b>The workflow change:</b> Now when I mentioned “Bedrock is timing out”
      or “the model responses are getting truncated,” the agent could directly
      access AWS documentation to help troubleshoot configuration issues. While
      we've only scratched the surface with these two servers, this is the tip
      of the iceberg—the <a href="https://awslabs.github.io/mcp/">AWS Labs MCP
      collection</a> includes servers for
      CloudWatch metrics, Lambda debugging, IAM policy analysis, and much more.
      Even with just documentation access, cloud debugging became more
      conversational and contextual.</p>
</section>

<section id="InternetSearchForCurrentInformation">
<h2>Internet Search for Current Information</h2>

<p>Sometimes you need information that's not in any documentation—recent
      Stack Overflow discussions, GitHub issues, or the latest best practices.
      We added general internet search:</p>

<pre>internet_search = MCPServerStdio(command="uvx", args=["duckduckgo-mcp-server"])
</pre>

<p><b>The workflow change:</b> When encountering obscure errors or needing to
      understand recent changes in the ecosystem, the agent could search for
      current discussions and solutions. This was particularly valuable for
      debugging deployment issues or understanding breaking changes in
      dependencies.</p>
</section>

<section id="StructuredProblemSolving">
<h2>Structured Problem Solving</h2>

<p>One of the most valuable additions was the code reasoning MCP, which
      helps the agent think through complex problems systematically:</p>

<pre>code_reasoning = MCPServerStdio(
    command="npx",
    args=["-y", "@mettamatt/code-reasoning"],
    tool_prefix="code_reasoning",
)
</pre>

<p><b>The workflow change:</b> Instead of jumping to solutions, the agent
      would break down complex problems into logical steps, explore alternative
      approaches, and explain its reasoning. This was invaluable for
      architectural decisions and debugging complex issues. I could ask “Why is
      this API call failing intermittently?” and get a structured analysis of
      potential causes rather than just guesses.</p>
</section>

<section id="OptimisingForReasoning">
<h2>Optimising for Reasoning</h2>

<p>As we added more sophisticated capabilities, we noticed that reasoning
      and analysis tasks often took much longer than regular text
      generation—especially when the output wasn't correctly formatted on the
      first try. We adjusted our Bedrock configuration to be more patient:</p>

<pre>bedrock_config = BotocoreConfig(
    read_timeout=300,
    connect_timeout=60,
    retries={"max_attempts": 3},
)
bedrock_client = boto3.client(
    "bedrock-runtime", region_name="eu-central-1", config=bedrock_config
)
</pre>

<p><b>The workflow change:</b> The longer timeouts meant our agent could work
      through complex problems without timing out. When analyzing large
      codebases or reasoning through intricate architectural decisions, the
      agent could take the time needed to provide thorough, well-reasoned
      responses rather than rushing to incomplete solutions.</p>
</section>

<section id="DesktopCommanderWarningWithGreatPowerComesGreatResponsibility">
<h2>Desktop Commander: Warning! With great power comes great responsibility!</h2>

<p>At this point, our agent was already quite capable—it could reason
      through problems, execute code, search for information, and access AWS
      documentation. This MCP server transforms your agent from a helpful
      assistant into something that can actually <i>do</i> things in your development
      environment:</p>

<pre>desktop_commander = MCPServerStdio(
    command="npx",
    args=["-y", "@wonderwhy-er/desktop-commander"],
    tool_prefix="desktop_commander",
)
</pre>

<p>Desktop Commander provides an incredibly comprehensive toolkit: file
      system operations (read, write, search), terminal command execution with
      process management, surgical code editing with <code>edit_block</code>, and even
      interactive REPL sessions. It's built on top of the MCP Filesystem Server
      but adds crucial capabilities like search-and-replace editing and
      intelligent process control.</p>

<p><b>The workflow change:</b> This is where everything came together. I
      could now say “The authentication tests are failing, please fix the issue”
      and the agent would:</p>

<ul>
<li>1. Run the test suite to see the specific failures</li>

<li>2. Read the failing test files to understand what was expected</li>

<li>3. Examine the authentication module code</li>

<li>4. Search the codebase for related patterns</li>

<li>5. Look up the documentation for the relevant library</li>

<li>6. Make edits to fix the implementation</li>

<li>7. Re-run the tests to verify the fix</li>

<li>8. Search for similar patterns elsewhere that might need updating</li>
</ul>

<p>All of this happened in a single conversation thread, with the agent
      maintaining context throughout. It wasn't just generating code
      suggestions—it was actively debugging, editing, and verifying fixes like a
      pair programming partner.</p>

<p>The security model is thoughtful too, with configurable allowed
      directories, blocked commands, and proper permission boundaries. You can
      learn more about its extensive capabilities at the <a href="https://github.com/wonderwhy-er/DesktopCommanderMCP">Desktop Commander
      documentation</a>.</p>
</section>

<section id="TheCompleteSystem">
<h2>The Complete System</h2>

<p>Here's our final agent configuration:</p>

<pre>import asyncio


import subprocess
import boto3
from pydantic_ai import Agent
from pydantic_ai.mcp import MCPServerStdio
from pydantic_ai.models.bedrock import BedrockConverseModel
from pydantic_ai.providers.bedrock import BedrockProvider
from botocore.config import Config as BotocoreConfig

bedrock_config = BotocoreConfig(
    read_timeout=300,
    connect_timeout=60,
    retries={"max_attempts": 3},
)
bedrock_client = boto3.client(
    "bedrock-runtime", region_name="eu-central-1", config=bedrock_config
)
model = BedrockConverseModel(
    "eu.anthropic.claude-sonnet-4-20250514-v1:0",
    provider=BedrockProvider(bedrock_client=bedrock_client),
)
agent = Agent(
    model=model,
)


instructions = """
You are a specialised agent for maintaining and developing the XXXXXX codebase.

## Development Guidelines:

1. **Test Failures:**
   - When tests fail, fix the implementation first, not the tests
   - Tests represent expected behavior; implementation should conform to tests
   - Only modify tests if they clearly don't match specifications

2. **Code Changes:**
   - Make the smallest possible changes to fix issues
   - Focus on fixing the specific problem rather than rewriting large portions
   - Add unit tests for all new functionality before implementing it

3. **Best Practices:**
   - Keep functions small with a single responsibility
   - Implement proper error handling with appropriate exceptions
   - Be mindful of configuration dependencies in tests

Remember to examine test failure messages carefully to understand the root cause before making any changes.
"""


run_python = MCPServerStdio(
    "deno",
    args=[
        "run",
        "-N",
        "-R=node_modules",
        "-W=node_modules",
        "--node-modules-dir=auto",
        "jsr:@pydantic/mcp-run-python",
        "stdio",
    ],
)

internet_search = MCPServerStdio(command="uvx", args=["duckduckgo-mcp-server"])
code_reasoning = MCPServerStdio(
    command="npx",
    args=["-y", "@mettamatt/code-reasoning"],
    tool_prefix="code_reasoning",
)
desktop_commander = MCPServerStdio(
    command="npx",
    args=["-y", "@wonderwhy-er/desktop-commander"],
    tool_prefix="desktop_commander",
)
awslabs = MCPServerStdio(
    command="uvx",
    args=["awslabs.core-mcp-server@latest"],
    env={"FASTMCP_LOG_LEVEL": "ERROR"},
    tool_prefix="awslabs",
)
aws_docs = MCPServerStdio(
    command="uvx",
    args=["awslabs.aws-documentation-mcp-server@latest"],
    env={"FASTMCP_LOG_LEVEL": "ERROR", "AWS_DOCUMENTATION_PARTITION": "aws"},
    tool_prefix="aws_docs",
)
context7 = MCPServerStdio(
    command="npx", args=["-y", "@upstash/context7-mcp"], tool_prefix="context"
)

agent = Agent(
    instructions=instructions,
    model=model,
    mcp_servers=[
        run_python,
        internet_search,
        code_reasoning,
        context7,
        awslabs,
        aws_docs,
        desktop_commander,
    ],
)


@agent.tool_plain()
def run_unit_tests() -&gt; str:
    """Run unit tests using uv."""
    result = subprocess.run(
        ["uv", "run", "pytest", "-xvs", "tests/"], capture_output=True, text=True
    )
    return result.stdout


async def main():
    async with agent.run_mcp_servers():
        await agent.to_cli()


if __name__ == "__main__":
    asyncio.run(main())
</pre>

<p>How it changes our workflow:</p>

<ul>
<li>Debugging becomes collaborative: you have an intelligent partner
        that can analyze error messages, suggest hypotheses, and help test
        solutions.</li>

<li>Learning accelerates: when working with unfamiliar libraries or
        patterns, the agent can explain existing code, suggest improvements, and
        teach you why certain approaches work better.</li>

<li>Context switching reduces: rather than jumping between
        documentation, Stack Overflow, AWS Console, and your IDE, you have a
        single interface that can access all these resources while maintaining
        context about your specific problem.</li>

<li>Problem-solving becomes structured: rather than jumping to
        solutions, the agent can break down complex issues into logical steps,
        explore alternatives, and explain its reasoning. Like having a real life talking rubber duck!</li>

<li>Code review improves: the agent can review your changes, spot
        potential issues, and suggest improvements before you commit—like having a
        senior developer looking over your shoulder.</li>
</ul>
</section>

<section id="WhatWeLearnedAboutCliAgents">
<h2>What We Learned About CLI Agents</h2>

<p>Building our own agent revealed several insights about this emerging
      paradigm:</p>

<ul>
<li>MCP is (almost) all you need: the magic isn't in any single
        capability, but in how they work together. The agent that can run tests,
        read files, search documentation, execute code, access AWS services, and
        reason through problems systematically becomes qualitatively different
        from one that can only do any single task.</li>

<li>Current information is crucial: having access to real-time search
        and up-to-date documentation makes the agent much more reliable for
        real-world development work where training data might be outdated.</li>

<li>Structured thinking matters: the code reasoning capability
        transforms the agent from a clever autocomplete into a thinking partner
        that can break down complex problems and explore alternative
        solutions.</li>

<li>Context is king: commercial agents like Claude Code are impressive
        partly because they maintain context across all these different tools.
        Your agent needs to remember what it learned from the test run when it's
        making file changes.</li>

<li>Specialisation matters: our agent works better for our specific
        codebase than general-purpose tools because it understands our patterns,
        conventions, and tool preferences. If it falls short in any area then we
        can go and make the required changes.</li>
</ul>
</section>

<section id="TheRoadAhead">
<h2>The Road Ahead</h2>

<p>The CLI agent paradigm is still evolving rapidly. Some areas we're
      exploring:</p>

<ul>
<li>AWS-specific tooling: the AWS Labs MCP servers
        (https://awslabs.github.io/mcp/) provide incredible depth for cloud-native
        development—from CloudWatch metrics to Lambda debugging to IAM policy
        analysis.</li>

<li>Workflow Enhancements: teaching the agent our common development
        workflows so it can handle routine tasks end-to-end. Connecting the agent
        to our project management tools so it can understand priorities and
        coordinate with team processes.</li>

<li>Benchmarking: <a href="https://www.tbench.ai">Terminal Bench</a>
        looks like a great dataset and leaderboard to test this toy agent against
        the big boys!</li>
</ul>
</section>

<section id="WhyThisMatters">
<h2>Why This Matters</h2>

<p>CLI coding agents represent a fundamental
      shift from AI as a writing assistant to AI as a development partner.
      Unlike Copilot's autocomplete or ChatGPT's Q&amp;A, these agents can:</p>

<ul>
<li>Understand your entire project context</li>

<li>Execute tasks across multiple tools</li>

<li>Maintain state across complex workflows</li>

<li>Learn from your specific codebase and patterns</li>
</ul>

<p>Building one yourself—even a simple version—gives you insights into
      where this technology is heading and how to make the most of commercial
      tools when they arrive.</p>

<p>The future of software development isn't just about writing code
      faster. It's about having an intelligent partner that understands your
      goals, your constraints, and your codebase well enough to help you think
      through problems and implement solutions collaboratively.</p>

<p>And the best way to understand that future? Build it yourself.</p>
</section>

<hr class="bodySep">
</div>

<div class="appendix">
<details id="SignificantRevisions">
<summary>Significant Revisions</summary>

<p><i>27 August 2025: </i>published</p>
</details>
</div>
</main>

<nav id="bottom-navmenu" style="display: none;">
<nav class="navmenu">
<div class="nav-head">  <div class="search">
    <!-- SiteSearch Google -->
    <form method="GET" action="https://www.google.com/search">
      <input type="hidden" name="ie" value="UTF-8">
      <input type="hidden" name="oe" value="UTF-8">
      <input class="field" type="text" name="q" size="15" maxlength="255" value="">
      <button class="button" type="submit" name="btnG" value=" " title="Search">
      <input type="hidden" name="domains" value="martinfowler.com">
      <input type="hidden" name="sitesearch" value=""> 
      <input type="hidden" name="sitesearch" value="martinfowler.com">
    
  </button></form></div>

<div class="closediv">
<span class="close" title="close"></span>
</div>
</div>

<div class="nav-body">
<div class="topics">
<h2>Topics</h2>

<p><a href="/architecture">Architecture</a></p>

<p><a href="https://refactoring.com">Refactoring</a></p>

<p><a href="/agile.html">Agile</a></p>

<p><a href="/delivery.html">Delivery</a></p>

<p><a href="/microservices">Microservices</a></p>

<p><a href="/data">Data</a></p>

<p><a href="/testing">Testing</a></p>

<p><a href="/dsl.html">DSL</a></p>
</div>

<div class="about">
<h2>about me</h2>

<p><a href="/aboutMe.html">About</a></p>

<p><a href="/books">Books</a></p>

<p><a href="/faq.html">FAQ</a></p>
</div>

<div class="content">
<h2>content</h2>

<p><a href="/videos.html">Videos</a></p>

<p><a href="/tags">Content Index</a></p>

<p><a href="/articles/eurogames">Board Games</a></p>

<p><a href="/photos">Photography</a></p>
</div>

<div class="tw">
<h2>Thoughtworks</h2>

<p><a href="https://thoughtworks.com">Home</a></p>

<p><a href="https://thoughtworks.com/insights">Insights</a></p>

<p><a href="https://thoughtworks.com/careers">Careers</a></p>

<p><a href="https://thoughtworks.com/radar">Radar</a></p>

<p><a href="https://www.thoughtworks.com/engineering">Engineering</a></p>
</div>

<div class="feeds">
<h2>follow</h2>

<p><a href="/feed.atom">RSS</a></p>

<p><a href="https://toot.thoughtworks.com/@mfowler">Mastodon</a></p>

<p><a href="https://www.linkedin.com/in/martin-fowler-com/">LinkedIn</a></p>

<p><a href="https://bsky.app/profile/martinfowler.com">Bluesky</a></p>

<p><a href="https://www.twitter.com/martinfowler">X</a></p>

<p><a href="https://boardgamegeek.com/blog/13064/martins-7th-decade">BGG</a></p>
</div>
</div>
</nav>
</nav>
<footer id="page-footer">
<div class="tw-logo">
<a href="https://www.thoughtworks.com/engineering">
<img src="/thoughtworks_white.png">
</a>
</div>
<div class="menu-button">
<div class="icon-bars navmenu-button"></div>
</div>
<div class="copyright">
<p>© Martin Fowler | <a href="/aboutMe.html#disclosures">Disclosures</a></p>
</div>
</footer>

<script src="/jquery-1.11.3.min.js" type="text/javascript"></script>

<script src="/mfcom.js" type="text/javascript"></script>


</body></html>