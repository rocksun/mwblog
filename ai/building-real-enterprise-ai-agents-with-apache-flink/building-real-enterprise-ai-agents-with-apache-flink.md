<!--
title: 使用 Apache Flink 构建真正的企业 AI 代理
cover: https://cdn.thenewstack.io/media/2025/08/771b5b5b-data.png
summary: 文章强调企业应构建自主代理，而非仅关注 AI 聊天机器人。有状态流处理是关键，Apache Flink 提供了构建此类代理的基础设施，例如保险索赔处理、供应链管理和智能目录维护等用例。未来，每个工程师都将成为 AI 工程师。
-->

文章强调企业应构建自主代理，而非仅关注 AI 聊天机器人。有状态流处理是关键，Apache Flink 提供了构建此类代理的基础设施，例如保险索赔处理、供应链管理和智能目录维护等用例。未来，每个工程师都将成为 AI 工程师。

> 译自：[Building Real Enterprise AI Agents With Apache Flink](https://thenewstack.io/building-real-enterprise-ai-agents-with-apache-flink/)
> 
> 作者：Sean Falconer

当前对 AI 聊天机器人的关注，忽略了企业真正的机遇：构建自主代理。我们希望 AI 系统不仅能告知客户他们的货物已延误，而且还能从一开始就防止延误。这需要一个始终开启、深嵌在您的基础设施中，并且能够监控定义您业务状态的持续事件流的系统。

这才是企业 AI 的真正承诺：不是等待提问的聊天机器人，而是一个不断观察、理解和反应的代理集群。一个检测到欺诈模式并在资金消失之前冻结帐户的代理。一个看到用户活动激增并主动扩展服务的代理。

然而，这种愿景暴露了一个根本的架构差距。

您无法使用为聊天机器人设计的无状态、请求-响应模型来构建这些始终开启、具有状态感知能力的系统。它们需要一个从头开始构建的架构，以处理连续的事件流并管理不断变化的状态。

让我们来探讨一下这个架构。我们将论证有状态流处理是这一新型 AI 的必要基础，并展示 [Apache Flink](https://thenewstack.io/a-developers-guide-to-getting-started-with-apache-flink/) 如何提供强大、低延迟的引擎，从而将这些自主代理变为现实。

## AI 代理炒作碰壁：基础设施瓶颈

自主 AI 代理的愿景引人注目。

我们想象它们智能地自动化从供应链物流到实时客户个性化的一切。虽然大型语言模型 (LLM) 已经变得非常强大，但一个主要的障碍阻止了这一愿景成为广泛的现实。问题不在于代理的大脑；而在于管道。

为了做出决策，代理需要访问来自整个业务的最新、上下文数据。今天常见的做法是将一个由断开连接的系统拼凑在一起：一个用于数据流处理（如 [Apache Kafka](https://thenewstack.io/what-devs-should-know-when-starting-an-apache-kafka-journey/)），另一个用于工作流编排，一个用于聚合代理可能需要的所有可能的上下文数据，以及一个单独的应用程序运行时用于代理的逻辑。

这种“拼接”方法创建了一个在操作上复杂且在技术上脆弱的系统。工程师们不得不管理一个脆弱的架构，其中数据在系统之间传递，在每个步骤中都会引入显著的延迟。此过程通常依赖于轮询或微批处理，这意味着代理始终在处理略微过时的数据。此外，当出现问题时，调试是一场噩梦，因为整个工作流程中没有统一的视图或**可观测性**。

这揭示了当今技术堆栈中的一个明显差距：缺乏一个统一的原生框架，用于直接在他们所需的实时数据流上构建、运行和扩展代理，以使其有效。

## 全新视角：代理作为事件驱动的微服务

为了克服基础设施瓶颈，我们需要从根本上改变我们对代理架构的思考方式。我们不应该将代理视为附加到我们系统上的请求-响应应用程序，而应该将它们构建为事件驱动的[微服务](https://thenewstack.io/microservices/)。

这种范式可以分解为一个简单的公式：代理是事件驱动逻辑（触发其操作）、最新上下文数据（为其决策提供信息）和 LLM 推理引擎（为其智能提供动力）的组合。通过这个视角看待代理，可以揭示为什么流处理架构不仅仅是一个选择，而是一种必然。

此模型提供三个关键优势：

1. **代理需要最新、上下文数据：** 代理的好坏取决于其可以访问的数据。为了使代理检测到欺诈或预测库存中断，它需要实时、准确地了解正在发生的业务事件。流处理架构提供了一个自然的管道来捕获、处理和丰富动态数据。这确保了当代理需要做出决策时，它所需的精确上下文可以立即获得，而没有传统数据轮询的延迟和过时。
2. **业务流程是异步和连续的：** 大多数关键业务工作流程都不能完全适应同步的请求-响应模型。处理保险索赔、管理库存水平或跟踪货物是连续的、有状态的过程，可能会持续数小时或数天。流处理模型正是为这种现实而设计的，允许代理异步运行并长时间保持上下文，就像它们正在自动化的业务流程一样。
3. **可重放性是一种发展超能力：** 这是事件驱动方法最强大但最微妙的优势。当代理的输入仅仅是来自持久、有序日志（如 Apache Kafka）的事件时，它会解锁一个革命性的开发生命周期：
   * **安全地开发和测试：** 您可以重放真实的历史事件流，以安全地测试和迭代代理的逻辑。这允许进行严格、真实的测试，而不会对实时生产系统产生任何风险或副作用。
   * **启用“暗启动”：** 在部署新版本的代理之前，您可以在实时事件流的后台运行它。这允许您将其决策和输出与当前的生产版本进行比较，确保它在您进行切换之前按预期运行。
   * **统一批处理和流处理：** 历史数据和实时数据之间的界限消失了。您可以将过去事件的日志视为“批处理”来开发和训练您的代理，然后部署完全相同的代码来对实时“流”进行操作。这消除了对单独代码库的需求，并保证了测试和生产之间的一致性。

## 事件驱动代理的引擎：Apache Flink

这种事件驱动的视角需要一种新型的基础设施，一种为对无界数据流进行连续计算而构建的引擎。这就是 Apache Flink 的用武之地。Flink 是一个开源流处理框架，从头开始为有状态计算而设计，使其成为构建自主代理的理想基础。

开箱即用，Flink 提供了可靠的代理系统必不可少的核心功能：

* **有状态计算：** Flink 可以记住过去事件的信息和上下文。这为代理提供了一个持久的“记忆”，以理解序列、模式和用户历史记录，而无需每次查找都依赖外部数据库。
* **低延迟、高吞吐量处理：** 它旨在处理大量的事件，每秒数百万个，延迟为毫秒级，使代理能够在业务事件发生时立即做出反应。
* **具有精确一次语义的容错性：** 这对于构建您可以信任的自主系统至关重要。Flink 保证即使集群中的一台机器发生故障，每个事件也将被正确处理一次。这确保了代理的状态保持一致，并且没有重复或丢失的信息。

虽然 Flink 提供了完美的引擎，但社区认识到需要更好地原生支持特定于代理的工作流程。这导致了 [Streaming Agents](https://www.confluent.io/product/streaming-agents/) 的出现，旨在使 Flink 成为构建代理的权威平台。至关重要的是，这不仅仅是另一个要拼接到您的堆栈中的工具。它是一个原生框架，直接扩展了 Flink 自己的 DataStream 和 Table API，使代理开发成为 Flink 生态系统中的头等公民。

这种原生方法解锁了最强大的优势：数据处理和 AI 的无缝集成。以前，工程师可能有一个 Flink 作业来丰富数据，然后将其写入消息队列，以便单独的 Python 服务应用 AI 逻辑。借助 [Streaming Agents](https://thenewstack.io/confluents-real-time-agents-build-on-kafka-streaming-data/)，复杂的数据转换（如连接事件流、将数据聚合为特征以及使用上下文丰富数据）可以在与代理的推理和决策逻辑相同的统一管道中进行。

这消除了“数据世界”和“AI 世界”之间低效且容易出错的边界，创建了一个单一的、可观察的和端到端一致的系统。

## 现实世界中的 Streaming Agents：自动化流程

当 Streaming Agents 从简单的数据转换转变为“封闭世界”自动化时，它们的真正力量就会被释放出来。这包括自动化特定的、高容量的业务流程，其中代理在定义的一组数据流、工具和目标上运行。

### 用例 1：保险索赔处理

在保险业中，索赔处理是自动化核心功能的绝佳选择。可以将 Streaming Agent 设计为持续监控传入索赔的流。当摄取新的索赔事件时，代理通过从各种内部数据库和对象存储中查询保单持有人的详细信息、其索赔历史记录和相关的损害报告来自主收集必要的上下文。

使用 LLM，它对欺诈指标、保单合规性和数据完整性执行关键检查。根据其分析，代理会将索赔智能地路由到下一步：自动批准低风险索赔，标记复杂案例以供人工审核，或向客户请求更多信息，从而显着加快解决时间。

### 用例 2：主动供应链管理

现代供应链会生成大量的实时数据。可以部署 Streaming Agent 来持续监控多个物流数据流，包括来自承运人的货物位置、当前的仓库库存水平和外部天气警报。

代理的目标是主动检测潜在的中断。当其对组合数据的分析显示可能出现延误时，例如，停滞的货物运往该商品库存低的仓库时，它会自主计划并触发纠正措施。这可能包括重新安排不同的货物、拆分订单或创建库存转移订单，同时通知利益相关者中断和解决方案。

### 用例 3：智能目录维护

对于像 Instacart 这样的在线市场和电子商务平台，维护一个干净、一致的产品目录是一项巨大的运营挑战。Streaming Agent 可以通过从数百或数千个合作伙伴那里摄取产品数据流来自动化此过程。

当各种数据到达时，代理使用 LLM 来理解和标准化它，规范化描述（例如，“12 盎司”与“一打盎司”），丰富产品属性并将它们分配到正确的类别。它还可以识别不一致之处，例如不匹配的定价或丢失的图像，自动标记它们以供审核，或者在明确的情况下直接更新中央产品目录，从而确保高质量的客户体验。

## 未来：每个工程师都是 AI 工程师

Streaming Agents 的目标是普及开发，使全球数百万开发人员能够构建智能应用程序。通过提供熟悉的 API 和抽象，我们将 AI 开发带入主流软件工程生命周期，使每位工程师都能够利用这些强大的新功能。

但是，只有当代理像健壮的、生产级的软件一样构建，而不是脆弱的演示时，它们才会成功。这就是 Flink 提供关键基础的地方。

它将真实应用程序的基本组件、状态管理、**可观测性**和容错可靠性视为头等公民。这确保了您构建的代理不仅智能，而且可扩展、有弹性，并且可以满足生产的需求。

Flink 提供了必不可少的基础设施，可以将代理 AI 从一个有希望的概念转变为可扩展的、生产系统，从而推动真正的商业价值。未来正在数据流上构建，借助 Streaming Agents，每位开发人员都可以参与构建它。