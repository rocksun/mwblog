<!DOCTYPE html><html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="true" data-theme="dark" data-theme-choice="dark" data-rh="lang,dir,class,data-has-hydrated"><head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title>We're open sourcing our MCP OIDC Provider | Tigris Object Storage</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.tigrisdata.com/blog/mcp-oidc-provider/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><link data-rh="true" rel="icon" href="/blog/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.tigrisdata.com/blog/mcp-oidc-provider/"><link data-rh="true" rel="alternate" href="https://www.tigrisdata.com/blog/mcp-oidc-provider/" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.tigrisdata.com/blog/mcp-oidc-provider/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Tigris Object Storage RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Tigris Object Storage Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="Tigris Object Storage JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script type="text/javascript" async="" src="https://ph.tigrisdata.com/static/array.js"></script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-GW2DNH9EW4"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-GW2DNH9EW4",{anonymize_ip:!0})</script>



<link rel="preconnect" href="https://ph.tigrisdata.com">
<script>!function(t,e){var o,p,i,n;e.__SV||(window.posthog=e,e._i=[],e.init=function(r,s,a){function c(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(i=t.createElement("script")).type="text/javascript",i.async=!0,i.src=s.api_host+"/static/array.js",(n=t.getElementsByTagName("script")[0]).parentNode.insertBefore(i,n);var _=e;for(void 0!==a?_=e[a]=[]:a="posthog",_.people=_.people||[],_.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},_.people.toString=function(){return _.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset".split(" "),p=0;p<o.length;p++)c(_,o[p]);e._i.push([r,s,a])},e.__SV=1)}(document,window.posthog||[]),posthog.init("phc_6a2zd9w9hGzIqYl527bL4dXk3Wz8J9pEHyXTwP1hHq4",{api_host:"https://ph.tigrisdata.com",opt_in_site_apps:!0,id:"default"})</script><link rel="stylesheet" href="/blog/assets/css/styles.447ee95b.css">
<script src="/blog/assets/js/runtime~main.1e2e8559.js" defer="defer"></script>
<script src="/blog/assets/js/main.27fff8ea.js" defer="defer"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0" data-rh="true"><meta property="og:title" content="We're open sourcing our MCP OIDC Provider | Tigris Object Storage" data-rh="true"><meta name="description" content="When building a remote MCP server, you will most likely need an OIDC layer between clients (Claude, Cursor etc) and your upstream IdP (Auth0, Clerk etc). We have created a ready to use solution for you that's vendor neutral: use any IdP you want.
" data-rh="true"><meta property="og:description" content="When building a remote MCP server, you will most likely need an OIDC layer between clients (Claude, Cursor etc) and your upstream IdP (Auth0, Clerk etc). We have created a ready to use solution for you that's vendor neutral: use any IdP you want.
" data-rh="true"><meta name="keywords" content="MCP,OAuth,OIDC,Authentication,Authorization,Model Context Protocol" data-rh="true"><meta property="og:image" content="https://www.tigrisdata.com/blog/assets/images/mcp-oid-8c0a6ed2ecb4c261895605373b7e58b6.webp" data-rh="true"><meta name="twitter:image" content="https://www.tigrisdata.com/blog/assets/images/mcp-oid-8c0a6ed2ecb4c261895605373b7e58b6.webp" data-rh="true"><meta property="og:type" content="article" data-rh="true"><meta property="article:published_time" content="2025-12-16T00:00:00.000Z" data-rh="true"><meta property="article:author" content="https://www.linkedin.com/in/abdullahibrahim/,https://www.linkedin.com/in/katieschilling" data-rh="true"><meta property="article:tag" content="Engineering,Open Source" data-rh="true"><link rel="prefetch" href="/blog/assets/js/a6aa9e1f.2ffbb761.js"><link rel="prefetch" href="/blog/assets/js/36994c47.48c081a9.js"><link rel="prefetch" href="/blog/assets/js/814f3328.d88abfd1.js"><link rel="prefetch" href="/blog/assets/js/c9970b36.f76ff854.js"><link rel="prefetch" href="/blog/assets/js/f07e9261.448cd4ed.js"><link rel="prefetch" href="/blog/assets/js/5b942556.95c08a77.js"><link rel="prefetch" href="/blog/assets/js/f1f82f1c.670aacaf.js"><link rel="prefetch" href="/blog/assets/js/604b599c.5add9d52.js"><link rel="prefetch" href="/blog/assets/js/7e4f88af.8ca9f108.js"><link rel="prefetch" href="/blog/assets/js/1aa2c588.f514f137.js"><link rel="prefetch" href="/blog/assets/js/2b2753ff.80ccb0a6.js"><link rel="prefetch" href="/blog/assets/js/3b3df0b6.e51aeef6.js"><link rel="prefetch" href="/blog/assets/js/08af526d.04fb04cb.js"><link rel="prefetch" href="/blog/assets/js/6875c492.2e36ec6e.js"><link rel="prefetch" href="/blog/assets/js/36994c47.48c081a9.js"><link rel="prefetch" href="/blog/assets/js/814f3328.d88abfd1.js"><link rel="prefetch" href="/blog/assets/js/c9970b36.f76ff854.js"><link rel="prefetch" href="/blog/assets/js/f1f82f1c.670aacaf.js"><link rel="prefetch" href="/blog/assets/js/1aa2c588.f514f137.js"><link rel="prefetch" href="/blog/assets/js/3b3df0b6.e51aeef6.js"><link rel="prefetch" href="/blog/assets/js/414bc89f.a9dbf9d2.js"><link rel="prefetch" href="/blog/assets/js/eb0c2c2e.4f922104.js"><link rel="prefetch" href="/blog/assets/js/fdacc08b.93a42152.js"><link rel="prefetch" href="/blog/assets/js/78d814b4.733880dd.js"><link rel="prefetch" href="/blog/assets/js/54d70555.ce295894.js"><link rel="prefetch" href="/blog/assets/js/c8e8f844.87fe2905.js"></head>
<body class="navigation-with-keyboard" data-rh="class" style="overflow: visible;">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></symbol>
</defs></svg>
<script type="text/javascript" crossorigin="anonymous" src="https://ph.tigrisdata.com/static/web-vitals.js?v=1.307.0"></script><script type="text/javascript" crossorigin="anonymous" src="https://ph.tigrisdata.com/static/surveys.js?v=1.307.0"></script><script type="text/javascript" crossorigin="anonymous" src="https://ph.tigrisdata.com/static/dead-clicks-autocapture.js?v=1.307.0"></script><script type="text/javascript" crossorigin="anonymous" src="https://ph.tigrisdata.com/static/lazy-recorder.js?v=1.307.0"></script><script type="text/javascript" crossorigin="anonymous" src="https://ph.tigrisdata.com/array/phc_6a2zd9w9hGzIqYl527bL4dXk3Wz8J9pEHyXTwP1hHq4/config.js"></script><script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"dark"),document.documentElement.setAttribute("data-theme-choice",t||"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.tigrisdata.com" target="_self" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/blog/logo/dark.png" alt="Tigris Blog" class="themedComponent_mlkZ themedComponent--dark_xIcU" height="26px"></div></a><a href="https://www.tigrisdata.com/docs/" target="_self" rel="" class="navbar__item navbar__link disable-external-icon">Docs<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://www.tigrisdata.com/docs/overview/" target="_self" rel="" class="navbar__item navbar__link disable-external-icon">Overview<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://www.tigrisdata.com/docs/get-started/" target="_self" rel="" class="navbar__item navbar__link disable-external-icon">Get Started<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://www.tigrisdata.com/docs/sdks/s3/" target="_self" rel="" class="navbar__item navbar__link disable-external-icon">AWS S3 SDKs<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://www.tigrisdata.com/docs/migration/" target="_self" rel="" class="navbar__item navbar__link disable-external-icon">Migration<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog/">Blog</a><a href="https://www.tigrisdata.com/docs/pricing/" target="_self" rel="" class="navbar__item navbar__link disable-external-icon">Pricing<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://twitter.com/TigrisData" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link pseudo-icon twitter-icon"></a><a href="https://console.tigris.dev/signin?pid=019b2f98-723b-7c03-a5a6-3704a58c7844&amp;sid=019b2f98-7459-7b3a-9eaa-52b454d03c98" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link wc-portal-login wc-portal-link">Login<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://console.tigris.dev/signup?pid=019b2f98-723b-7c03-a5a6-3704a58c7844&amp;sid=019b2f98-7459-7b3a-9eaa-52b454d03c98" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link wc-portal-signup wc-portal-link">Get Started<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP" type="button" title="dark mode" aria-label="Switch between dark and light mode (currently dark mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><main class="row col col--10"><article class="col--12"><header><a class="" href="/blog/">Blog</a> <!-- -->/<!-- --> <a class="tagLink_IbIG" href="/blog/tags/engineering/">Engineering</a><h1 class="titleBlogPostPage_Svq1">We're open sourcing our MCP OIDC Provider</h1><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_q4o9"><div class="avatar margin-bottom--sm"><a href="https://www.linkedin.com/in/abdullahibrahim/" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://avatars.githubusercontent.com/u/530615?v=4" alt="Abdullah Ibrahim"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://www.linkedin.com/in/abdullahibrahim/" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp" translate="no">Abdullah Ibrahim</span></a></div><small class="authorTitle_nd0D" title="Senior Software Engineer">Senior Software Engineer</small><div class="authorSocials_rSDt"></div></div></div></div><div class="col col--6 authorCol_q4o9"><div class="avatar margin-bottom--sm"><a href="https://www.linkedin.com/in/katieschilling" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://avatars.githubusercontent.com/u/8411213?s=400&amp;u=762567c65decb82e1433a7d1c42a2ffdcc59a125&amp;v=4" alt="Katie Schilling"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://www.linkedin.com/in/katieschilling" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp" translate="no">Katie Schilling</span></a></div><small class="authorTitle_nd0D" title="DevEx Enthusiast">DevEx Enthusiast</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown markdownImage_jjdn"><img src="/blog/assets/images/mcp-oid-8c0a6ed2ecb4c261895605373b7e58b6.webp" class="hero-image" alt="We're open sourcing our MCP OAuth Provider">
<p><strong>TLDR: When building a remote MCP server, you will most likely need an OIDC
layer between clients (Claude, Cursor etc) and your upstream IdP (Auth0, Clerk
etc). We have created a ready to use solution for you that's vendor neutral: use
any IdP you want.</strong></p>
<p>MCP servers need real authentication and authorization. Tokens must be issued,
refreshed, validated, and tied to upstream identity. Clients need to log in,
obtain credentials, and call your MCP server securely. It's complicated,
especially if you aren't a security engineer. You shouldn't roll your own auth,
but if the existing tools don't work out of the box, what do you do?</p>
<p>Implementing a
<a href="https://support.claude.com/en/articles/11503834-building-custom-connectors-via-remote-mcp-servers" target="_blank" rel="noopener noreferrer" class="">remote hosted MCP server</a>
requires implementing
<a href="https://modelcontextprotocol.io/specification/draft/basic/authorization" target="_blank" rel="noopener noreferrer" class="">MCP Authorization Protocol</a>
which is based on OAuth 2.1 (DRAFT). In theory, this is straightforward because
modern applications either implement OAuth specs themselves or use an
OAuth-compliant IdP like Auth0 or Clerk. That's what I thought at least, but ran
into major issues the moment I started implementing.</p>
<p>That's why we built and open-sourced the
<a href="https://github.com/tigrisdata/mcp-oidc-provider" target="_blank" rel="noopener noreferrer" class="">mcp-oidc-provider</a>: a minimal,
production-ready OIDC provider designed specifically for MCP workflows.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="mcp-protocol-requires-discovery-oauth-or-oidc">MCP Protocol Requires Discovery (OAuth or OIDC)<a href="#mcp-protocol-requires-discovery-oauth-or-oidc" class="hash-link" aria-label="Direct link to MCP Protocol Requires Discovery (OAuth or OIDC)" title="Direct link to MCP Protocol Requires Discovery (OAuth or OIDC)" translate="no">​</a></h2>
<p>The MCP Specification
(<a href="https://modelcontextprotocol.io/specification/2025-11-25/basic/authorization#protected-resource-metadata-discovery-requirements" target="_blank" rel="noopener noreferrer" class="">2025-11-25</a>)
explicitly requires OAuth. Per the spec:</p>
<ul>
<li class="">A protected MCP server acts as an OAuth 2.1 resource server, capable of
accepting and responding to protected resource requests using access tokens.</li>
<li class="">An MCP client acts as an OAuth 2.1 client, making protected resource requests
on behalf of a resource owner.</li>
</ul>
<p>And for Discovery, MCP authorization servers (which is what this package is used
for) MUST provide at least one of the discovery mechanisms:</p>
<ul>
<li class="">OAuth 2.0 Authorization Server Metadata
(<a href="https://datatracker.ietf.org/doc/html/rfc8414" target="_blank" rel="noopener noreferrer" class="">RFC8414</a>)</li>
<li class="">OpenID Connect Discovery 1.0</li>
</ul>
<p>OpenID Connect Discovery (OIDC) is technically optional, but you'll need some
identity layer to fully secure your MCP server. OAuth provides a way for the
client to ask your MCP authorization server to go and get authorization from the
resource owner. It doesn't verify the identity of the client. OIDC handles the
identity part for you.</p>
<p>Without OIDC, you have to build custom integrations per provider to verify
identity. You'll need to implement your own token refresh logic including
<code>offline_access</code> support. Redirect URIs like <code>mcp://cursor/auth</code> or
<code>claude://oauth/callback</code> will get rejected by standard IdPs, since they are not
web URLs and require explicit OIDC support. And your MCP server wouldn't work
with desktop clients like Claude and Cursor.</p>
<p>Just use OIDC. It's way easier.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="you-need-both-oauth-and-oidc">You need both OAuth and OIDC<a href="#you-need-both-oauth-and-oidc" class="hash-link" aria-label="Direct link to You need both OAuth and OIDC" title="Direct link to You need both OAuth and OIDC" translate="no">​</a></h3>
<p>In this package, I have implemented both the OAuth and OIDC discovery endpoints,
the reason? MCP clients MUST support trying both discovery mechanisms, but not
all the clients conform to the specification. So for example, if they only
implemented OpenID Connect Discovery 1.0 for discovery, <code>mcp-oidc-provider</code> will
still work.</p>
<p>Our well known
<a href="https://mcp.storage.dev/.well-known/openid-configuration" target="_blank" rel="noopener noreferrer" class="">OIDC endpoint</a> is
out-of-the-box from OpenID. For maximum compatibility, we implement the OAuth
endpoints:</p>
<ul>
<li class=""><a href="https://mcp.storage.dev/.well-known/oauth-authorization-server" target="_blank" rel="noopener noreferrer" class="">https://mcp.storage.dev/.well-known/oauth-authorization-server</a></li>
<li class=""><a href="https://mcp.storage.dev/.well-known/oauth-protected-resource/" target="_blank" rel="noopener noreferrer" class="">https://mcp.storage.dev/.well-known/oauth-protected-resource/</a></li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="dynamic-client-registration-upstream-idps-alone-dont-solve-this">Dynamic Client Registration: Upstream IdPs alone don't solve this<a href="#dynamic-client-registration-upstream-idps-alone-dont-solve-this" class="hash-link" aria-label="Direct link to Dynamic Client Registration: Upstream IdPs alone don't solve this" title="Direct link to Dynamic Client Registration: Upstream IdPs alone don't solve this" translate="no">​</a></h2>
<p>Per the MCP Specification: "Authorization servers and MCP clients <strong>SHOULD</strong>
support the OAuth 2.0 Dynamic Client Registration Protocol
(<a href="https://datatracker.ietf.org/doc/html/rfc7591" target="_blank" rel="noopener noreferrer" class="">RFC7591</a>)." On its face, it
seems like this should make IdPs that support dynamic client registration work
for most MCP clients.</p>
<p>When using Auth0 for the first iteration, we enabled dynamic client
registration. It technically worked for authorizing MCP clients without any
middleware, but each ephemeral client showed up in the list of long-lived third
party apps. So for each user, we had a third party app for each session. As you
can imagine, our fingers hurt from clicking through that list. And issuing
scoped access tokens per client was a pain.</p>
<p><img decoding="async" loading="lazy" alt="A bunch of dynamically created OAuth clients drowning out the statically defined ones" src="/blog/assets/images/oauth-clients-1f309154bab0cc028818e1d876ddb0e7.webp" width="1999" height="1132" class="img_ev3q"></p>
<p>We needed one third party app in the list, a small OIDC provider, that could
control access for all the MCP clients. Lest our eyes bleed from the dashboard
bloat.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="introducing-mcp-oidc-provider">Introducing mcp-oidc-provider<a href="#introducing-mcp-oidc-provider" class="hash-link" aria-label="Direct link to Introducing mcp-oidc-provider" title="Direct link to Introducing mcp-oidc-provider" translate="no">​</a></h2>
<p>A minimal, opinionated OIDC provider built specifically for MCP servers that you
can use with any OIDC compatible IdP.</p>
<p>Using this, you get exactly what the specification requires:</p>
<ul>
<li class="">A protected MCP server acts as an OAuth 2.1 resource server, capable of
accepting and responding to protected resource requests using access tokens.</li>
<li class="">A client that acts as an OAuth 2.1 client, making protected resource requests
on behalf of a resource owner.</li>
</ul>
<p>Additionally, we store sessions, tokens, grants, and OIDC adapter data in a key
value store. You can use Tigris as your KV store like we did, or any other store
that is supported by <a href="https://github.com/jaredwray/keyv/" target="_blank" rel="noopener noreferrer" class="">Keyv</a>, like Redis or
Postgres.</p>
<center><div class="docusaurus-mermaid-container container_lyt7"><svg id="mermaid-svg-6846564" width="100%" xmlns="http://www.w3.org/2000/svg" class="flowchart" style="max-width: 556.265625px;" viewBox="0 0 556.265625 868" role="graphics-document document" aria-roledescription="flowchart-v2"><style>#mermaid-svg-6846564{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-svg-6846564 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-svg-6846564 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-svg-6846564 .error-icon{fill:#a44141;}#mermaid-svg-6846564 .error-text{fill:#ddd;stroke:#ddd;}#mermaid-svg-6846564 .edge-thickness-normal{stroke-width:1px;}#mermaid-svg-6846564 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-6846564 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-6846564 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-svg-6846564 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-6846564 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-6846564 .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-svg-6846564 .marker.cross{stroke:lightgrey;}#mermaid-svg-6846564 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-6846564 p{margin:0;}#mermaid-svg-6846564 .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#ccc;}#mermaid-svg-6846564 .cluster-label text{fill:#F9FFFE;}#mermaid-svg-6846564 .cluster-label span{color:#F9FFFE;}#mermaid-svg-6846564 .cluster-label span p{background-color:transparent;}#mermaid-svg-6846564 .label text,#mermaid-svg-6846564 span{fill:#ccc;color:#ccc;}#mermaid-svg-6846564 .node rect,#mermaid-svg-6846564 .node circle,#mermaid-svg-6846564 .node ellipse,#mermaid-svg-6846564 .node polygon,#mermaid-svg-6846564 .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-svg-6846564 .rough-node .label text,#mermaid-svg-6846564 .node .label text,#mermaid-svg-6846564 .image-shape .label,#mermaid-svg-6846564 .icon-shape .label{text-anchor:middle;}#mermaid-svg-6846564 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-svg-6846564 .rough-node .label,#mermaid-svg-6846564 .node .label,#mermaid-svg-6846564 .image-shape .label,#mermaid-svg-6846564 .icon-shape .label{text-align:center;}#mermaid-svg-6846564 .node.clickable{cursor:pointer;}#mermaid-svg-6846564 .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-svg-6846564 .arrowheadPath{fill:lightgrey;}#mermaid-svg-6846564 .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-svg-6846564 .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-svg-6846564 .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-svg-6846564 .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-svg-6846564 .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-svg-6846564 .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-svg-6846564 .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-svg-6846564 .cluster text{fill:#F9FFFE;}#mermaid-svg-6846564 .cluster span{color:#F9FFFE;}#mermaid-svg-6846564 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-6846564 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-svg-6846564 rect.text{fill:none;stroke-width:0;}#mermaid-svg-6846564 .icon-shape,#mermaid-svg-6846564 .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-svg-6846564 .icon-shape p,#mermaid-svg-6846564 .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-svg-6846564 .icon-shape rect,#mermaid-svg-6846564 .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-svg-6846564 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-svg-6846564 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-svg-6846564 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><marker id="mermaid-svg-6846564_flowchart-v2-pointEnd" class="marker flowchart-v2" viewBox="0 0 10 10" refX="5" refY="5" markerUnits="userSpaceOnUse" markerWidth="8" markerHeight="8" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-svg-6846564_flowchart-v2-pointStart" class="marker flowchart-v2" viewBox="0 0 10 10" refX="4.5" refY="5" markerUnits="userSpaceOnUse" markerWidth="8" markerHeight="8" orient="auto"><path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-svg-6846564_flowchart-v2-circleEnd" class="marker flowchart-v2" viewBox="0 0 10 10" refX="11" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaid-svg-6846564_flowchart-v2-circleStart" class="marker flowchart-v2" viewBox="0 0 10 10" refX="-1" refY="5" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle></marker><marker id="mermaid-svg-6846564_flowchart-v2-crossEnd" class="marker cross flowchart-v2" viewBox="0 0 11 11" refX="12" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><marker id="mermaid-svg-6846564_flowchart-v2-crossStart" class="marker cross flowchart-v2" viewBox="0 0 11 11" refX="-1" refY="5.2" markerUnits="userSpaceOnUse" markerWidth="11" markerHeight="11" orient="auto"><path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path></marker><g class="root"><g class="clusters"><g class="cluster" id="RESOURCE_LAYER" data-look="classic"><rect style="" x="218.265625" y="258" width="330" height="152"></rect><g class="cluster-label" transform="translate(329.1484375, 258)"><foreignObject width="108.234375" height="24"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Resource Layer</p></span></div></foreignObject></g></g><g class="cluster" id="AUTH_LAYER" data-look="classic"><rect style="" x="8.64453125" y="532" width="466.4765625" height="328"></rect><g class="cluster-label" transform="translate(203.1640625, 532)"><foreignObject width="77.4375" height="24"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Auth Layer</p></span></div></foreignObject></g></g><g class="cluster" id="CLIENT_SIDE" data-look="classic"><rect style="" x="8" y="8" width="467.765625" height="152"></rect><g class="cluster-label" transform="translate(203.1875, 8)"><foreignObject width="77.390625" height="24"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Client Side</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path d="M155.363,135L147.886,139.167C140.409,143.333,125.454,151.667,117.977,164C110.5,176.333,110.5,192.667,110.5,209C110.5,225.333,110.5,241.667,110.5,262.5C110.5,283.333,110.5,308.667,110.5,334C110.5,359.333,110.5,384.667,110.5,407.5C110.5,430.333,110.5,450.667,110.5,471C110.5,491.333,110.5,511.667,118.776,525.717C127.051,539.767,143.602,547.534,151.878,551.417L160.153,555.301" id="L_MCP_CLIENT_OIDC_PROVIDER_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaid-svg-6846564_flowchart-v2-pointEnd)"></path><path d="M246.883,635L246.883,645.167C246.883,655.333,246.883,675.667,246.883,695.333C246.883,715,246.883,734,246.883,743.5L246.883,753" id="L_OIDC_PROVIDER_UPSTREAM_IDP_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaid-svg-6846564_flowchart-v2-pointEnd)"></path><path d="M338.403,135L345.88,139.167C353.357,143.333,368.311,151.667,375.788,164C383.266,176.333,383.266,192.667,383.266,209C383.266,225.333,383.266,241.667,383.266,253.333C383.266,265,383.266,272,383.266,275.5L383.266,279" id="L_MCP_CLIENT_MCP_SERVER_0" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaid-svg-6846564_flowchart-v2-pointEnd)"></path><path d="M383.266,385L383.266,389.167C383.266,393.333,383.266,401.667,383.266,416C383.266,430.333,383.266,450.667,383.266,471C383.266,491.333,383.266,511.667,374.99,525.717C366.714,539.767,350.163,547.534,341.888,551.417L333.612,555.301" id="L_MCP_SERVER_OIDC_PROVIDER_0" class="edge-thickness-normal edge-pattern-dotted edge-thickness-normal edge-pattern-solid flowchart-link" style="" marker-end="url(#mermaid-svg-6846564_flowchart-v2-pointEnd)"></path></g><g class="edgeLabels"><g class="edgeLabel" transform="translate(110.5, 334)"><g class="label" transform="translate(-87.765625, -36)"><foreignObject width="175.53125" height="72"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml" class="labelBkg"><span class="edgeLabel"><p>OIDC Discovery<br>Client Registration<br>/authorize /token /jwks</p></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(246.8828125, 696)"><g class="label" transform="translate(-100, -36)"><foreignObject width="200" height="72"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml" class="labelBkg"><span class="edgeLabel"><p>OIDC Federation<br>(User authentication, claims)</p></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(383.265625, 209)"><g class="label" transform="translate(-72.1015625, -24)"><foreignObject width="144.203125" height="48"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml" class="labelBkg"><span class="edgeLabel"><p>MCP Requests with<br>Bearer Access Token</p></span></div></foreignObject></g></g><g class="edgeLabel" transform="translate(383.265625, 471)"><g class="label" transform="translate(-100, -36)"><foreignObject width="200" height="72"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml" class="labelBkg"><span class="edgeLabel"><p>JWT Verification via<br>/jwks &amp; token introspection</p></span></div></foreignObject></g></g></g><g class="nodes"><g class="node default" id="flowchart-MCP_CLIENT-0" transform="translate(246.8828125, 84)"><rect class="basic label-container" style="" x="-130" y="-51" width="260" height="102"></rect><g class="label" style="" transform="translate(-100, -36)"><rect></rect><foreignObject width="200" height="72"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>MCP Client<br>(Claude, Cursor, ChatGPT, etc.)</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-OIDC_PROVIDER-1" transform="translate(246.8828125, 596)"><rect class="basic label-container" style="" x="-128.7109375" y="-39" width="257.421875" height="78"></rect><g class="label" style="" transform="translate(-98.7109375, -24)"><rect></rect><foreignObject width="197.421875" height="48"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>mcp-oidc-provider<br>(OIDC Authorization Server)</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-UPSTREAM_IDP-2" transform="translate(246.8828125, 796)"><rect class="basic label-container" style="" x="-122.6328125" y="-39" width="245.265625" height="78"></rect><g class="label" style="" transform="translate(-92.6328125, -24)"><rect></rect><foreignObject width="185.265625" height="48"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Upstream IdP<br>(Auth0, Clerk, Okta, etc.)</p></span></div></foreignObject></g></g><g class="node default" id="flowchart-MCP_SERVER-3" transform="translate(383.265625, 334)"><rect class="basic label-container" style="" x="-130" y="-51" width="260" height="102"></rect><g class="label" style="" transform="translate(-100, -36)"><rect></rect><foreignObject width="200" height="72"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>MCP Server<br>(OAuth 2.1 Resource Server)</p></span></div></foreignObject></g></g></g></g></g></svg></div></center>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="usage-referencing-the-standalone-implementation">Usage: Referencing the Standalone Implementation<a href="#usage-referencing-the-standalone-implementation" class="hash-link" aria-label="Direct link to Usage: Referencing the Standalone Implementation" title="Direct link to Usage: Referencing the Standalone Implementation" translate="no">​</a></h3>
<p>The best place to start is the
<a href="https://github.com/tigrisdata/mcp-oidc-provider/tree/main/example/standalone-oidc" target="_blank" rel="noopener noreferrer" class="">standalone OIDC provider</a>.
Use it if you already have your MCP implementation in a different stack than
Express, or if you want to run Auth as a standalone microservice you can scale
independently. You can have your MCP server use NextJS or another framework,
then you can run this server standalone and proxy the Auth requests to this
server.</p>
<p>The standalone provider has:</p>
<ul>
<li class="">bootstrap server code</li>
<li class="">provider configuration</li>
<li class="">upstream IdP wiring</li>
<li class="">routing setup</li>
<li class="">storage adapter example</li>
<li class="">complete OIDC endpoint registration</li>
</ul>
<p>And, optionally, you can use Tigris as your key-value store.</p>
<p>Once you have the repo cloned and your dependencies installed with
<code>npm install</code>, setup your environment:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color: #F8F8F2; --prism-background-color: #282A36;"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color: rgb(248, 248, 242); background-color: rgb(40, 42, 54);"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">cat .env</span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain"># configure your upstream IdP</span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">UPSTREAM_ISSUER=https://YOUR_DOMAIN.auth0.com</span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">UPSTREAM_CLIENT_ID=...</span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">UPSTREAM_CLIENT_SECRET=...</span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">UPSTREAM_REDIRECT_URI=http://localhost:3000/callback</span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain" style="display: inline-block;"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">#configure your own provider issuer</span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">OIDC_ISSUER=http://localhost:4000</span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">OIDC_PORT=4000</span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain" style="display: inline-block;"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain"># Tigris (for @tigrisdata/keyv-tigris)</span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">TIGRIS_STORAGE_ACCESS_KEY_ID=tid_xxxxx</span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">TIGRIS_STORAGE_SECRET_ACCESS_KEY=tsec_yyyyy</span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">TIGRIS_STORAGE_BUCKET=my-kv-bucket</span><br></span></code></pre><div class="buttonGroup_M5ko"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_IEyt" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_TrPX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_cVMy"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>MCP clients will fetch
<code>[http://localhost:4000/.well-known/openid-configuration](http://localhost:4000/.well-known/openid-configuration)</code>
to discover which endpoints they need for the OAuth flow.</p>
<p>You run the provider with <code>npm start</code>. You can run it alongside your MCP server,
and the Auth requests will proxy to it.</p>
<p>Point your clients to your OIDC issuer. For example, Claude Desktop expects:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color: #F8F8F2; --prism-background-color: #282A36;"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color: rgb(248, 248, 242); background-color: rgb(40, 42, 54);"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">{</span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  "auth": {</span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">    "issuer": "http://localhost:4000"</span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  }</span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_M5ko"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_IEyt" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_TrPX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_cVMy"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>And when you get a request to your MCP server, you verify the tokens using JWKS:</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color: #F8F8F2; --prism-background-color: #282A36;"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color: rgb(248, 248, 242); background-color: rgb(40, 42, 54);"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">import</span><span class="token plain"> </span><span class="token punctuation" style="color: rgb(248, 248, 242);">{</span><span class="token plain"> createRemoteJWKSet</span><span class="token punctuation" style="color: rgb(248, 248, 242);">,</span><span class="token plain"> jwtVerify </span><span class="token punctuation" style="color: rgb(248, 248, 242);">}</span><span class="token plain"> </span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">from</span><span class="token plain"> </span><span class="token string" style="color: rgb(255, 121, 198);">"jose"</span><span class="token punctuation" style="color: rgb(248, 248, 242);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain" style="display: inline-block;"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain"></span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">const</span><span class="token plain"> jwks </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color: rgb(80, 250, 123);">createRemoteJWKSet</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">new</span><span class="token plain"> </span><span class="token class-name constant" style="color: rgb(189, 147, 249);">URL</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token string" style="color: rgb(255, 121, 198);">"http://localhost:4000/jwks"</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token punctuation" style="color: rgb(248, 248, 242);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain" style="display: inline-block;"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain"></span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">const</span><span class="token plain"> </span><span class="token punctuation" style="color: rgb(248, 248, 242);">{</span><span class="token plain"> payload </span><span class="token punctuation" style="color: rgb(248, 248, 242);">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">await</span><span class="token plain"> </span><span class="token function" style="color: rgb(80, 250, 123);">jwtVerify</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token plain">accessToken</span><span class="token punctuation" style="color: rgb(248, 248, 242);">,</span><span class="token plain"> jwks</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token punctuation" style="color: rgb(248, 248, 242);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain" style="display: inline-block;"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain"></span><span class="token builtin" style="color: rgb(189, 147, 249);">console</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token function" style="color: rgb(80, 250, 123);">log</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token string" style="color: rgb(255, 121, 198);">"User:"</span><span class="token punctuation" style="color: rgb(248, 248, 242);">,</span><span class="token plain"> payload</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token plain">sub</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token punctuation" style="color: rgb(248, 248, 242);">;</span><br></span></code></pre><div class="buttonGroup_M5ko"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_IEyt" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_TrPX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_cVMy"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>That's it. You have a fully functioning OIDC-based MCP auth flow.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="usage-integrated-mode-express--mcp">Usage: Integrated Mode (Express + MCP)<a href="#usage-integrated-mode-express--mcp" class="hash-link" aria-label="Direct link to Usage: Integrated Mode (Express + MCP)" title="Direct link to Usage: Integrated Mode (Express + MCP)" translate="no">​</a></h3>
<p>This is the easiest way to get started if you're using Node / Express for your
MCP server. In integrated mode, you run one Express app that:</p>
<ul>
<li class="">Hosts the OIDC provider (/.well-known/openid-configuration, /authorize,
/token, /jwks, /register)</li>
<li class="">Hosts your MCP endpoint</li>
<li class="">Handles all OAuth + OIDC flows end-to-end</li>
<li class="">Exposes a single BASE_URL you point your MCP client at</li>
</ul>
<p>First, install your dependencies:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color: #F8F8F2; --prism-background-color: #282A36;"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color: rgb(248, 248, 242); background-color: rgb(40, 42, 54);"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">npm install mcp-oidc-provider keyv openid-client express</span><br></span></code></pre><div class="buttonGroup_M5ko"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_IEyt" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_TrPX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_cVMy"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You'll also want <code>typescript</code>, <code>ts-node</code>, etc. if you're using TS, but that's
standard.</p>
<p>Second, generate your JWKS signing keys once. You'll save them in your <code>.env.</code></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color: #F8F8F2; --prism-background-color: #282A36;"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color: rgb(248, 248, 242); background-color: rgb(40, 42, 54);"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">npx mcp-oidc-provider --pretty</span><br></span></code></pre><div class="buttonGroup_M5ko"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_IEyt" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_TrPX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_cVMy"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Copy the printed JSON and store it in a secure location (e.g. secret manager),
then inject it via the JWKS environment variable.</p>
<p>For dev, you can skip this (keys are auto-generated, but tokens break on
restart, after the token cache expires).</p>
<p>Third, configure your environment:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color: #F8F8F2; --prism-background-color: #282A36;"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color: rgb(248, 248, 242); background-color: rgb(40, 42, 54);"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">cat .env</span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">BASE_URL=http://localhost:3000          # Where this combined server runs</span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">OIDC_CLIENT_ID=your-idp-client-id</span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">OIDC_CLIENT_SECRET=your-idp-client-secret</span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">SESSION_SECRET=some-long-random-string</span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">JWKS=...                                # JSON from `npx mcp-oidc-provider --pretty` (prod only)</span><br></span></code></pre><div class="buttonGroup_M5ko"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_IEyt" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_TrPX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_cVMy"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>BASE_URL must be the public URL clients will use for:</p>
<ul>
<li class="">OIDC discovery (/.well-known/openid-configuration)</li>
<li class="">OAuth callback (/oauth/callback)</li>
<li class="">MCP endpoint (whatever route you choose under this server)</li>
</ul>
<p>Now you can add the OIDC provider to your sever by using the function
<code>setupMcpExpress()</code>. It will:</p>
<ul>
<li class="">Mount the OIDC provider routes onto the Express app</li>
<li class="">Wire up MCP auth (bearer auth + token verification)</li>
<li class="">Return:<!-- -->
<ul>
<li class="">app: the configured Express instance</li>
<li class=""><code>handleMcpRequest(handler)</code>: a helper to register your MCP request handler
with auth + user already resolved</li>
</ul>
</li>
</ul>
<p>Here's an example of how to use it:</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color: #F8F8F2; --prism-background-color: #282A36;"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color: rgb(248, 248, 242); background-color: rgb(40, 42, 54);"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">import</span><span class="token plain"> express </span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">from</span><span class="token plain"> </span><span class="token string" style="color: rgb(255, 121, 198);">"express"</span><span class="token punctuation" style="color: rgb(248, 248, 242);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain"></span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">import</span><span class="token plain"> </span><span class="token punctuation" style="color: rgb(248, 248, 242);">{</span><span class="token plain"> Keyv </span><span class="token punctuation" style="color: rgb(248, 248, 242);">}</span><span class="token plain"> </span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">from</span><span class="token plain"> </span><span class="token string" style="color: rgb(255, 121, 198);">"keyv"</span><span class="token punctuation" style="color: rgb(248, 248, 242);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain"></span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">import</span><span class="token plain"> </span><span class="token punctuation" style="color: rgb(248, 248, 242);">{</span><span class="token plain"> setupMcpExpress </span><span class="token punctuation" style="color: rgb(248, 248, 242);">}</span><span class="token plain"> </span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">from</span><span class="token plain"> </span><span class="token string" style="color: rgb(255, 121, 198);">"mcp-oidc-provider/mcp"</span><span class="token punctuation" style="color: rgb(248, 248, 242);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain"></span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">import</span><span class="token plain"> </span><span class="token punctuation" style="color: rgb(248, 248, 242);">{</span><span class="token plain"> OidcClient </span><span class="token punctuation" style="color: rgb(248, 248, 242);">}</span><span class="token plain"> </span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">from</span><span class="token plain"> </span><span class="token string" style="color: rgb(255, 121, 198);">"mcp-oidc-provider/oidc"</span><span class="token punctuation" style="color: rgb(248, 248, 242);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain"></span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">import</span><span class="token plain"> </span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">type</span><span class="token plain"> </span><span class="token punctuation" style="color: rgb(248, 248, 242);">{</span><span class="token plain"> </span><span class="token constant" style="color: rgb(189, 147, 249);">JWKS</span><span class="token plain"> </span><span class="token punctuation" style="color: rgb(248, 248, 242);">}</span><span class="token plain"> </span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">from</span><span class="token plain"> </span><span class="token string" style="color: rgb(255, 121, 198);">"mcp-oidc-provider"</span><span class="token punctuation" style="color: rgb(248, 248, 242);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain" style="display: inline-block;"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain"></span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">async</span><span class="token plain"> </span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">function</span><span class="token plain"> </span><span class="token function" style="color: rgb(80, 250, 123);">main</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token plain"> </span><span class="token punctuation" style="color: rgb(248, 248, 242);">{</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token comment" style="color: rgb(98, 114, 164);">// Parse JWKS from environment variable (required for production)</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">const</span><span class="token plain"> jwks</span><span class="token operator">:</span><span class="token plain"> </span><span class="token constant" style="color: rgb(189, 147, 249);">JWKS</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">undefined</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> process</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token plain">env</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token constant" style="color: rgb(189, 147, 249);">JWKS</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">    </span><span class="token operator">?</span><span class="token plain"> </span><span class="token constant" style="color: rgb(189, 147, 249);">JSON</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token function" style="color: rgb(80, 250, 123);">parse</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token plain">process</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token plain">env</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token constant" style="color: rgb(189, 147, 249);">JWKS</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">    </span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">undefined</span><span class="token punctuation" style="color: rgb(248, 248, 242);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain" style="display: inline-block;"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">if</span><span class="token plain"> </span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token operator">!</span><span class="token plain">process</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token plain">env</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token constant" style="color: rgb(189, 147, 249);">BASE_URL</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token plain"> </span><span class="token punctuation" style="color: rgb(248, 248, 242);">{</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">    </span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">throw</span><span class="token plain"> </span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">new</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token string" style="color: rgb(255, 121, 198);">"BASE_URL is required"</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token punctuation" style="color: rgb(248, 248, 242);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token punctuation" style="color: rgb(248, 248, 242);">}</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">if</span><span class="token plain"> </span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token operator">!</span><span class="token plain">process</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token plain">env</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token constant" style="color: rgb(189, 147, 249);">OIDC_CLIENT_ID</span><span class="token plain"> </span><span class="token operator">||</span><span class="token plain"> </span><span class="token operator">!</span><span class="token plain">process</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token plain">env</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token constant" style="color: rgb(189, 147, 249);">OIDC_CLIENT_SECRET</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token plain"> </span><span class="token punctuation" style="color: rgb(248, 248, 242);">{</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">    </span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">throw</span><span class="token plain"> </span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">new</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token string" style="color: rgb(255, 121, 198);">"OIDC_CLIENT_ID and OIDC_CLIENT_SECRET are required"</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token punctuation" style="color: rgb(248, 248, 242);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token punctuation" style="color: rgb(248, 248, 242);">}</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">if</span><span class="token plain"> </span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token operator">!</span><span class="token plain">process</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token plain">env</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token constant" style="color: rgb(189, 147, 249);">SESSION_SECRET</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token plain"> </span><span class="token punctuation" style="color: rgb(248, 248, 242);">{</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">    </span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">throw</span><span class="token plain"> </span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">new</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token string" style="color: rgb(255, 121, 198);">"SESSION_SECRET is required"</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token punctuation" style="color: rgb(248, 248, 242);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token punctuation" style="color: rgb(248, 248, 242);">}</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain" style="display: inline-block;"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token comment" style="color: rgb(98, 114, 164);">// Configure upstream IdP client (Auth0 / Clerk / Okta / Keycloak / etc.)</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">const</span><span class="token plain"> idpClient </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">new</span><span class="token plain"> </span><span class="token class-name">OidcClient</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token punctuation" style="color: rgb(248, 248, 242);">{</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">    issuer</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color: rgb(255, 121, 198);">"https://your-tenant.auth0.com"</span><span class="token punctuation" style="color: rgb(248, 248, 242);">,</span><span class="token plain"> </span><span class="token comment" style="color: rgb(98, 114, 164);">// or any OIDC issuer</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">    clientId</span><span class="token operator">:</span><span class="token plain"> process</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token plain">env</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token constant" style="color: rgb(189, 147, 249);">OIDC_CLIENT_ID</span><span class="token punctuation" style="color: rgb(248, 248, 242);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">    clientSecret</span><span class="token operator">:</span><span class="token plain"> process</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token plain">env</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token constant" style="color: rgb(189, 147, 249);">OIDC_CLIENT_SECRET</span><span class="token punctuation" style="color: rgb(248, 248, 242);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">    redirectUri</span><span class="token operator">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color: rgb(255, 121, 198);">`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color: rgb(248, 248, 242);">${</span><span class="token template-string interpolation">process</span><span class="token template-string interpolation punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token template-string interpolation">env</span><span class="token template-string interpolation punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token template-string interpolation constant" style="color: rgb(189, 147, 249);">BASE_URL</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color: rgb(248, 248, 242);">}</span><span class="token template-string string" style="color: rgb(255, 121, 198);">/oauth/callback</span><span class="token template-string template-punctuation string" style="color: rgb(255, 121, 198);">`</span><span class="token punctuation" style="color: rgb(248, 248, 242);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">    </span><span class="token comment" style="color: rgb(98, 114, 164);">// optional: scopes, additionalAuthParams, extractCustomData, ...</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token punctuation" style="color: rgb(248, 248, 242);">}</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token punctuation" style="color: rgb(248, 248, 242);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain" style="display: inline-block;"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token comment" style="color: rgb(98, 114, 164);">// Persistent store for sessions, grants, tokens, etc.</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">const</span><span class="token plain"> store </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">new</span><span class="token plain"> </span><span class="token class-name">Keyv</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token punctuation" style="color: rgb(248, 248, 242);">;</span><span class="token plain"> </span><span class="token comment" style="color: rgb(98, 114, 164);">// or new Keyv({ store: new KeyvTigris() }) in prod</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain" style="display: inline-block;"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token comment" style="color: rgb(98, 114, 164);">// This sets up:</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token comment" style="color: rgb(98, 114, 164);">// - OIDC endpoints (/authorize, /token, /jwks, /.well-known/openid-configuration, /register)</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token comment" style="color: rgb(98, 114, 164);">// - MCP auth wiring</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token comment" style="color: rgb(98, 114, 164);">// - A helper to register your MCP handler</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">const</span><span class="token plain"> </span><span class="token punctuation" style="color: rgb(248, 248, 242);">{</span><span class="token plain"> app</span><span class="token punctuation" style="color: rgb(248, 248, 242);">,</span><span class="token plain"> handleMcpRequest </span><span class="token punctuation" style="color: rgb(248, 248, 242);">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color: rgb(80, 250, 123);">setupMcpExpress</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token punctuation" style="color: rgb(248, 248, 242);">{</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">    idpClient</span><span class="token punctuation" style="color: rgb(248, 248, 242);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">    store</span><span class="token punctuation" style="color: rgb(248, 248, 242);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">    baseUrl</span><span class="token operator">:</span><span class="token plain"> process</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token plain">env</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token constant" style="color: rgb(189, 147, 249);">BASE_URL</span><span class="token punctuation" style="color: rgb(248, 248, 242);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">    secret</span><span class="token operator">:</span><span class="token plain"> process</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token plain">env</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token constant" style="color: rgb(189, 147, 249);">SESSION_SECRET</span><span class="token punctuation" style="color: rgb(248, 248, 242);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">    jwks</span><span class="token punctuation" style="color: rgb(248, 248, 242);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token punctuation" style="color: rgb(248, 248, 242);">}</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token punctuation" style="color: rgb(248, 248, 242);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain" style="display: inline-block;"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token comment" style="color: rgb(98, 114, 164);">// Your MCP handler: runs after a valid, authenticated request.</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token comment" style="color: rgb(98, 114, 164);">// req.user contains the authenticated user (from upstream IdP claims).</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token function" style="color: rgb(80, 250, 123);">handleMcpRequest</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">async</span><span class="token plain"> </span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token plain">req</span><span class="token punctuation" style="color: rgb(248, 248, 242);">,</span><span class="token plain"> res</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: rgb(248, 248, 242);">{</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">    </span><span class="token builtin" style="color: rgb(189, 147, 249);">console</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token function" style="color: rgb(80, 250, 123);">log</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token string" style="color: rgb(255, 121, 198);">"Authenticated user:"</span><span class="token punctuation" style="color: rgb(248, 248, 242);">,</span><span class="token plain"> req</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token plain">user</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token punctuation" style="color: rgb(248, 248, 242);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain" style="display: inline-block;"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">    </span><span class="token comment" style="color: rgb(98, 114, 164);">// Implement your MCP server here:</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">    </span><span class="token comment" style="color: rgb(98, 114, 164);">// - parse req.body for MCP messages</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">    </span><span class="token comment" style="color: rgb(98, 114, 164);">// - respond with MCP-compliant responses</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain" style="display: inline-block;"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">    </span><span class="token comment" style="color: rgb(98, 114, 164);">// For now, return a simple MCP-style stub:</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">    res</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token function" style="color: rgb(80, 250, 123);">json</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token punctuation" style="color: rgb(248, 248, 242);">{</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">      jsonrpc</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color: rgb(255, 121, 198);">"2.0"</span><span class="token punctuation" style="color: rgb(248, 248, 242);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">      id</span><span class="token operator">:</span><span class="token plain"> req</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token plain">body</span><span class="token operator">?.</span><span class="token plain">id </span><span class="token operator">??</span><span class="token plain"> </span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">null</span><span class="token punctuation" style="color: rgb(248, 248, 242);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">      result</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color: rgb(248, 248, 242);">{</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">        message</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color: rgb(255, 121, 198);">"Hello from integrated MCP + OIDC server!"</span><span class="token punctuation" style="color: rgb(248, 248, 242);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">        user</span><span class="token operator">:</span><span class="token plain"> req</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token plain">user</span><span class="token punctuation" style="color: rgb(248, 248, 242);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">      </span><span class="token punctuation" style="color: rgb(248, 248, 242);">}</span><span class="token punctuation" style="color: rgb(248, 248, 242);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">    </span><span class="token punctuation" style="color: rgb(248, 248, 242);">}</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token punctuation" style="color: rgb(248, 248, 242);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token punctuation" style="color: rgb(248, 248, 242);">}</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token punctuation" style="color: rgb(248, 248, 242);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain" style="display: inline-block;"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">const</span><span class="token plain"> port </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color: rgb(80, 250, 123);">Number</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token plain">process</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token plain">env</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token constant" style="color: rgb(189, 147, 249);">PORT</span><span class="token plain"> </span><span class="token operator">??</span><span class="token plain"> </span><span class="token number">3000</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token punctuation" style="color: rgb(248, 248, 242);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  app</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token function" style="color: rgb(80, 250, 123);">listen</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token plain">port</span><span class="token punctuation" style="color: rgb(248, 248, 242);">,</span><span class="token plain"> </span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: rgb(248, 248, 242);">{</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">    </span><span class="token builtin" style="color: rgb(189, 147, 249);">console</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token function" style="color: rgb(80, 250, 123);">log</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token template-string template-punctuation string" style="color: rgb(255, 121, 198);">`</span><span class="token template-string string" style="color: rgb(255, 121, 198);">MCP + OIDC server listening on </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color: rgb(248, 248, 242);">${</span><span class="token template-string interpolation">port</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color: rgb(248, 248, 242);">}</span><span class="token template-string template-punctuation string" style="color: rgb(255, 121, 198);">`</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token punctuation" style="color: rgb(248, 248, 242);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">    </span><span class="token builtin" style="color: rgb(189, 147, 249);">console</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token function" style="color: rgb(80, 250, 123);">log</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token template-string template-punctuation string" style="color: rgb(255, 121, 198);">`</span><span class="token template-string string" style="color: rgb(255, 121, 198);">Base URL: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color: rgb(248, 248, 242);">${</span><span class="token template-string interpolation">process</span><span class="token template-string interpolation punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token template-string interpolation">env</span><span class="token template-string interpolation punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token template-string interpolation constant" style="color: rgb(189, 147, 249);">BASE_URL</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color: rgb(248, 248, 242);">}</span><span class="token template-string template-punctuation string" style="color: rgb(255, 121, 198);">`</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token punctuation" style="color: rgb(248, 248, 242);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token punctuation" style="color: rgb(248, 248, 242);">}</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token punctuation" style="color: rgb(248, 248, 242);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain"></span><span class="token punctuation" style="color: rgb(248, 248, 242);">}</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain" style="display: inline-block;"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain"></span><span class="token function" style="color: rgb(80, 250, 123);">main</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token function" style="color: rgb(80, 250, 123);">catch</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token plain">err</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color: rgb(248, 248, 242);">{</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token builtin" style="color: rgb(189, 147, 249);">console</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token function" style="color: rgb(80, 250, 123);">error</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token plain">err</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token punctuation" style="color: rgb(248, 248, 242);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  process</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token function" style="color: rgb(80, 250, 123);">exit</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token number">1</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token punctuation" style="color: rgb(248, 248, 242);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain"></span><span class="token punctuation" style="color: rgb(248, 248, 242);">}</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token punctuation" style="color: rgb(248, 248, 242);">;</span><br></span></code></pre><div class="buttonGroup_M5ko"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_IEyt" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_TrPX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_cVMy"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Finally, you can point your clients to your MCP server. For example, Claude
Desktop expects:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color: #F8F8F2; --prism-background-color: #282A36;"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color: rgb(248, 248, 242); background-color: rgb(40, 42, 54);"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">{</span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  "auth": {</span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">    "issuer": "http://localhost:4000"</span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  }</span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_M5ko"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_IEyt" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_TrPX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_cVMy"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The actual config shape depends on the client, but the pattern is:</p>
<ul>
<li class="">Issuer = BASE_URL of this server</li>
<li class="">MCP endpoint = whatever MCP route your integrated server exposes (the one
wired by handleMcpRequest)</li>
</ul>
<p>Once configured:</p>
<ul>
<li class="">The client hits <code>/.well-known/openid-configuration</code> on your server.</li>
<li class="">It performs <code>/.authorize</code> → <code>/token</code> flows against your server.</li>
<li class="">Your server federates login to upstream IdP via OidcClient.</li>
<li class="">Your server issues MCP-specific tokens and validates them for /mcp requests.</li>
<li class="">Your handler gets authenticated requests with req.user populated.</li>
</ul>
<p>That's it. Your server is now an integrated OIDC issuer, token endpoint, and MCP
endpoint.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="using-the-mcp-oidc-provider-in-production">Using the mcp-oidc-provider in production<a href="#using-the-mcp-oidc-provider-in-production" class="hash-link" aria-label="Direct link to Using the mcp-oidc-provider in production" title="Direct link to Using the mcp-oidc-provider in production" translate="no">​</a></h2>
<p>We use it for our hosted MCP server, and we trust it enough to offer it to you.
It uses standard libraries for authentication and authorization. And, it doesn't
lock you into any vendor.</p>
<p>We've made mcp-oidc-provider as generic as possible, including adding additional
configurations to enhance what your IdP offers. For example, we allow you to
configure your JWKS caching settings just in case your IdP doesn't provide
<code>Cache-Control: max-age</code> headers. This can be helpful if your company has
security requirements around key rotation events that require expiring keys
after a certain period of time.</p>
<p>If you're using <code>jose.createRemoteJWKSet</code>, the way you typically control
expiration is by passing options when creating the JWKS fetcher:</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color: #F8F8F2; --prism-background-color: #282A36;"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style="color: rgb(248, 248, 242); background-color: rgb(40, 42, 54);"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">import</span><span class="token plain"> </span><span class="token punctuation" style="color: rgb(248, 248, 242);">{</span><span class="token plain"> createRemoteJWKSet </span><span class="token punctuation" style="color: rgb(248, 248, 242);">}</span><span class="token plain"> </span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">from</span><span class="token plain"> </span><span class="token string" style="color: rgb(255, 121, 198);">"jose"</span><span class="token punctuation" style="color: rgb(248, 248, 242);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain" style="display: inline-block;"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain"></span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">const</span><span class="token plain"> jwksUri </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">new</span><span class="token plain"> </span><span class="token class-name constant" style="color: rgb(189, 147, 249);">URL</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token string" style="color: rgb(255, 121, 198);">"https://your-issuer/.well-known/jwks.json"</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token punctuation" style="color: rgb(248, 248, 242);">;</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain" style="display: inline-block;"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain"></span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">const</span><span class="token plain"> jwks </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color: rgb(80, 250, 123);">createRemoteJWKSet</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token plain">jwksUri</span><span class="token punctuation" style="color: rgb(248, 248, 242);">,</span><span class="token plain"> </span><span class="token punctuation" style="color: rgb(248, 248, 242);">{</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token doc-comment comment" style="color: rgb(98, 114, 164);">/** Minimum time between JWKS fetches (milliseconds). Default: 30 seconds */</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  cooldownDuration</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">30_000</span><span class="token punctuation" style="color: rgb(248, 248, 242);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token doc-comment comment" style="color: rgb(98, 114, 164);">/** Maximum age of cached JWKS (milliseconds). Default: 10 minutes */</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  cacheMaxAge</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">600_000</span><span class="token punctuation" style="color: rgb(248, 248, 242);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain"></span><span class="token punctuation" style="color: rgb(248, 248, 242);">}</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token punctuation" style="color: rgb(248, 248, 242);">;</span><br></span></code></pre><div class="buttonGroup_M5ko"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_IEyt" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_TrPX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_cVMy"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you need any other customization, reach out! We'd love to make
mcp-oidc-provider fit into your MCP server.</p>
<div style="max-width:36.5rem;margin-left:auto;margin-right:auto"><div><div class="is--color_gradient_back ContainerWidth_UM6U"><div class="InlineCta_fTFF sl_card_m-2 card_static cta-flex"><div class="cta-margin-left"><h1 class="sl_title_m fix-1px">Try mcp-oidc-provider</h1><p>Ready to build a secure MCP server? Get started with mcp-oidc-provider and use any OIDC-compatible IdP you want.</p></div><div class="cta-flex-item cta-margin-right"><div style="white-space:nowrap"><a href="https://github.com/tigrisdata/mcp-oidc-provider" class="cta-link"><div>Check out the repo<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="icon-margin iconExternalLink_node_modules-@docusaurus-theme-classNameic-lib-theme-Icon-ExternalLink-styles-module"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></div></a></div></div></div></div></div></div></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/engineering/">Engineering</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/open-source/">Open Source</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg col col--12" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/blog/northflank-registry/"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">1-Click Docker Registry with Northflank + Tigris</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#mcp-protocol-requires-discovery-oauth-or-oidc" class="table-of-contents__link toc-highlight">MCP Protocol Requires Discovery (OAuth or OIDC)</a><ul><li><a href="#you-need-both-oauth-and-oidc" class="table-of-contents__link toc-highlight">You need both OAuth and OIDC</a></li></ul></li><li><a href="#dynamic-client-registration-upstream-idps-alone-dont-solve-this" class="table-of-contents__link toc-highlight">Dynamic Client Registration: Upstream IdPs alone don't solve this</a></li><li><a href="#introducing-mcp-oidc-provider" class="table-of-contents__link toc-highlight">Introducing mcp-oidc-provider</a><ul><li><a href="#usage-referencing-the-standalone-implementation" class="table-of-contents__link toc-highlight">Usage: Referencing the Standalone Implementation</a></li><li><a href="#usage-integrated-mode-express--mcp" class="table-of-contents__link toc-highlight">Usage: Integrated Mode (Express + MCP)</a></li></ul></li><li><a href="#using-the-mcp-oidc-provider-in-production" class="table-of-contents__link toc-highlight">Using the mcp-oidc-provider in production</a></li></ul></div></div></div></div></div><footer class="footer"><div class="container container-fluid"><div class="margin-bottom--sm"><a class="footerLogoLink_BH7S" href="/blog/"><img src="/blog/logo/dark.png" alt="Tigris Blog" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU" height="26px"></a></div><p class="footer__description">Tigris is a globally distributed S3-compatible object storage service that provides low latency anywhere in the world. Tigris enables developers to quickly and easily store and access any amount of data for a wide range of use cases.</p><div class="footer__row"><div class="footer__data"><div class="footer__cta"><a href="https://console.tigris.dev/signin?pid=019b2f98-723b-7c03-a5a6-3704a58c7844&amp;sid=019b2f98-7459-7b3a-9eaa-52b454d03c98" target="_blank" rel="noopener noreferrer">Dashboard</a></div></div><div class="links"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Company</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.tigrisdata.com/about/" target="_self" rel="" class="footer__link-item footer__link-item disable-external-icon">About<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/blog/">Blog</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.tigrisdata.com/docs/pricing/" target="_self" rel="" class="footer__link-item footer__link-item disable-external-icon">Pricing<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.tigrisdata.com/docs/legal/service-terms/" target="_self" rel="" class="footer__link-item footer__link-item disable-external-icon">Terms of Service<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.tigrisdata.com/docs/legal/privacy-policy/" target="_self" rel="" class="footer__link-item footer__link-item disable-external-icon">Privacy Policy<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="mailto:abuse@tigrisdata.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Report Abuse<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Developers</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.tigrisdata.com/docs/" target="_self" rel="" class="footer__link-item footer__link-item disable-external-icon">Docs<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://status.tigris.dev/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Status<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="mailto:help@tigrisdata.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Support<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Tigris Data, Inc. All rights reserved.</div></div></div></footer></div>

<div class="mermaidTooltip" style="opacity: 0;"></div></body></html>