<!--
title: 2024年Kubernetes高级面试问题
cover: https://miro.medium.com/v2/resize:fit:828/format:webp/1*1Ji48AoKnNdLnT4TRweypA.png
-->

对于资深工程师来说，精通 Kubernetes 意味着理解其复杂性、架构细微差别以及运维挑战。以下面试问题旨在深入探讨候选人在 Kubernetes 方面的专业知识，聚焦高级概念、最佳实践和实际问题解决能力。

> 译自 [13 Advanced Kubernetes Interview Questions for 2024](https://overcast.blog/13-advanced-kubernetes-interview-questions-for-2024-953683603df1)，作者 DavidW (skyDragon)。

准备好了吗？

开始吧。

## 1. 解释 Kubernetes 控制平面组件的角色和功能。

**期望回答**：候选人应该解释 Kubernetes 控制平面的组件，包括 kube-apiserver、etcd、kube-scheduler、kube-controller-manager 和 cloud-controller-manager。他们应该详细说明这些组件如何相互作用来管理 Kubernetes 集群的状态，重点关注 API 提供、集群状态存储、Pod 调度以及各种 Kubernetes 对象的生命周期管理等方面。

**需要提及的重要点**：

- kube-apiserver 充当控制平面的前端，暴露 Kubernetes API。
- etcd 是一个高可用的键值存储，用于所有集群数据。
- kube-scheduler 分发工作负载。
- kube-controller-manager 运行控制器进程。
- cloud-controller-manager 允许你将你的集群连接到你的云服务提供商的 API。

**你可以举的例子**：中“当部署一个新应用时，kube-apiserver 处理创建请求。etcd 存储此配置，使其成为集群所需状态的真实来源。kube-scheduler 然后决定在哪个节点上运行应用的 Pods，而 kube-controller-manager 则监督此过程以确保运行所需数量的 Pods。对于在云环境中运行的集群，cloud-controller-manager 与云提供商交互以管理诸如负载均衡器之类的资源。”

**回答时请谨慎**：“虽然此答案概述了每个控制平面组件的核心职责，但真实功能可能超出这些基础，尤其是随着自定义控制器和云提供商特定集成的出现。此外，这些组件的管理和交互方式可能会根据 Kubernetes 发行版和底层基础设施的不同而有所不同。”

2. 描述设计高可用性 Kubernetes 集群的过程和考虑因素。

期望回答：寻找部署 Kubernetes 主节点在不同可用区的多节点配置、利用 etcd 集群实现数据冗余以及使用负载均衡器将流量分发到 API 服务器的见解。候选人还应讨论节点健康检查和自动修复机制的重要性，以确保高可用性。

需要提及的重要点：

- 为了冗余设置多主节点。

在不同区域进行 etcd 集群化，以实现数据的弹性。

使用负载均衡器进行 API 服务器流量分发。

对工作节点进行自动健康检查和修复。

你可以举的例子：“在为电子商务平台设计高可用性集群时，我们在三个可用区部署了多主节点设置，并将 etcd 成员分布类似地以确保数据冗余。配置了 TCP 负载均衡器来将 API 请求分发到 API 服务器，确保没有单点故障。我们还利用 Kubernetes Engine 实现了节点自动修复，自动替换不健康的节点。”

回答时请谨慎：“虽然这些策略显著提高了集群的可用性，但也在集群管理和潜在成本方面引入了复杂性。对于一些应用程序，特别是那些对短暂停机有耐受性的应用程序，这种高度的冗余可能并不划算。最佳配置通常取决于具体的应用程序要求以及成本、复杂性和可用性之间的权衡。”

3. 如何在 Kubernetes 中实现零停机部署？

期望回答：候选人应该描述滚动更新、蓝绿部署和金丝雀发布等策略。他们应该提到 Kubernetes 的功能，如 Deployments、Services 和健康检查，并解释如何使用它们来实现零停机更新。高级答案可能还包括使用服务网格进行更可控的流量路由和故障注入测试。

需要提及的重要点：

滚动更新逐步用新的 Pod 替换旧的 Pod。

蓝绿部署在两个相同环境之间切换流量。

金丝雀发布逐步向一部分用户引入新版本。

健康检查确保只有健康的 Pod 提供流量。

你可以举的例子：“对于关键支付服务，我们采用金丝雀部署策略以在更新期间降低风险。我们首先将新版本部署给 10% 的用户，监控错误率和性能指标。确认稳定后，我们使用 Kubernetes Deployments 逐步增加流量到新版本，确保零停机。”

回答时请谨慎：“虽然这些策略旨在最小化停机时间，但其有效性可能因应用程序架构、部署复杂性和外部依赖而异。例如，有状态应用程序或需要数据库迁移的应用程序可能需要额外的步骤，而这些步骤 Kubernetes 原语无法涵盖。此外，网络问题或配置错误仍可能导致服务中断，强调了全面测试和监控的重要性。”

4. 讨论在 Kubernetes 中管理有状态应用程序的策略。

期望回答：期待讨论使用 StatefulSets 管理有状态应用程序、使用持久卷（PV）和持久卷声明（PVC）进行存储，以及使用无头服务确保稳定的网络身份。候选人还可能谈到有状态数据的备份/恢复策略以及使用运算符自动化有状态应用程序管理。

需要提及的重要点：

StatefulSets 确保有序部署、扩展和删除，同时为每个 Pod 提供独特的网络标识符。

Persistent Volumes 和 Persistent Volume Claims 提供持久存储，可在 Pod 重新启动时保留数据。

Headless Services 允许直接访问 Pod，无需负载均衡层。

你可以举的例子：“在部署高可用性 PostgreSQL 集群的项目中，我们使用 StatefulSets 来维护每个数据库 Pod 的标识符，确保在重新启动和重新部署后仍保持不变。每个 Pod 都附加到一个 Persistent Volume Claim，以确保数据库文件在 Pod 生命周期之外持久存在。配置了一个无头服务来为每个 Pod 提供稳定的网络标识符，便于在 PostgreSQL 集群中进行对等发现。”

回答时请谨慎：“虽然 Kubernetes 提供了强大的机制来管理有状态的应用程序，但可能会出现挑战，特别是对于需要精确管理状态和标识的复杂有状态工作负载。例如，当管理数据库版本升级或确保副本之间数据一致性时，操作复杂性可能会增加。此外，数据备份和灾难恢复策略的责任落在运维人员身上，因为 Kubernetes 并未本地处理这些方面。”

5. 解释您将如何优化 Kubernetes 集群中的资源使用。

期望回答：候选人应该谈论实现资源请求和限制，利用水平 Pod 自动缩放器，并使用 Prometheus 等工具进行监控。他们还可以提到使用垂直 Pod 自动缩放器和 PodDisruptionBudgets 进行更细致的资源管理，并保持应用程序性能。

需要提及的重要点：

- 资源请求和限制有助于确保 Pod 在具有足够资源的节点上调度，并防止资源争用。

- 水平 Pod 自动缩放器根据观察到的 CPU 利用率或自定义指标自动调整 Pod 副本的数量。

- 垂直 Pod 自动缩放器建议或自动调整请求和限制，以优化资源使用。

- 像 Prometheus 这样的监控工具对于识别资源瓶颈和效率低下至关重要。

你可以举的例子：“对于经历交通波动的应用程序，我们根据 Prometheus 的自定义指标实现了水平 Pod 自动缩放器，针对每个 Pod 每秒的特定请求数目。这使我们能够在高峰时自动扩展，在较安静的时期缩减规模，优化资源使用并保持性能。此外，我们为每个 Pod 设置了资源请求和限制，以确保可预测的调度并避免资源争用。”

回答时请谨慎：“在 Kubernetes 中进行资源优化高度依赖于工作负载的特性和底层基础设施。例如，过于激进的自动缩放可能导致快速扩展事件，可能会影响服务稳定性。同样，资源请求和限制的配置不当可能导致资源利用效率低下或 Pod 被驱逐。持续监控和调整对于找到合适的平衡至关重要。”

6. 描述如何保护 Kubernetes 集群的安全。

期望回答：寻找包括网络策略、RBAC、Pod 安全策略（或其替代方案，如 OPA/Gatekeeper 或 Kyverno，考虑到 Pod 安全策略的弃用）、密钥管理和 TLS 加密通信在内的综合安全策略。高级回答可能涉及 CI/CD 流水线的静态和动态分析工具、保护容器供应链以及集群审计日志记录。

需要提及的重要点：

- 网络策略限制 Pod 之间的流量，增强网络安全性。

- RBAC 控制对 Kubernetes 资源的访问，确保只有授权用户可以执行操作。

- Pod 安全策略（或现代替代方案）强制执行与安全相关的策略。

- 密钥管理对于安全处理密码和令牌等敏感数据至关重要。

- 实施 TLS 加密确保传输中的数据安全。

你可以举的例子："为了保护处理敏感数据的集群，我们实施了 RBAC 来为不同团队成员定义明确的访问控制，确保他们只能与其角色所需的资源进行交互。我们使用了网络策略来隔离应用程序的不同部分，防止在发生违规事件时可能出现的横向移动。对于机密管理，我们集成了外部机密管理器，以安全地自动将机密注入到我们的应用程序中。”

回答时请谨慎："保护 Kubernetes 集群涉及多方面的方法和持续的警惕。虽然提到的策略为安全提供了坚实的基础，但容器化环境的动态性质和不断演变的威胁形势要求持续评估和调整。此外，这些措施的有效性可能会因集群环境、应用程序架构和合规要求而异，强调了需要定制的安全策略。"

7. 如何确保 Kubernetes 使用的 etcd 集群具有高可用性？

期望回答：期望候选人讨论将 etcd 部署为跨不同可用区的多节点集群，为 etcd 节点使用专用硬件或实例以确保性能，实施定期快照备份，并设置活跃监控和警报以监控 etcd 的健康状态。

需要提及的重要点：

- 跨可用区的多节点 etcd 集群以实现容错。

- 为 etcd 使用专用资源以确保性能隔离。

定期快照备份用于灾难恢复。

监控和警报，以便积极解决问题。

你可以举的例子：“在生产环境中，我们部署了一个跨三个不同可用区的三节点 etcd 集群，以确保高可用性和容错性。每个 etcd 成员都托管在专用实例上，提供必要的计算资源和隔离。我们每隔 6 小时自动进行快照备份，并针对指示性能问题或节点不可用的指标配置了 Prometheus 警报。”

回答时请谨慎：“尽管这些做法显著增强了 etcd 集群的弹性和可用性，但管理 etcd 也具有其复杂性。性能调优和灾难恢复规划需要深入的理解和经验。此外，etcd 对网络延迟和磁盘 I/O 性能的敏感性意味着即使采取了这些措施，实现最佳性能可能也需要持续的调整和基础架构投入。”

8. 讨论服务网格在 Kubernetes 中的作用。

期望回答：候选人应该解释服务网格如何为微服务通信提供可观察性、可靠性和安全性。他们可能会讨论特定的服务网格，如 Istio 或 Linkerd，并描述流量管理、服务发现、负载均衡、mTLS 和断路器等功能。

需要提及的重要点：

- 对微服务交互的增强可观察性。

- 用于金丝雀部署和 A/B 测试的流量管理功能。

- 用于安全的服务间通信的 mTLS。

弹性模式，如断路器和重试。

你可以提供的例子：“对于一个微服务架构，面临着复杂的服务间通信和可靠性挑战，我们实施了 Istio 作为我们的服务网格。它使我们能够引入金丝雀部署，逐渐将流量转移到新版本并监控问题。Istio 的 mTLS 功能还帮助我们在不修改服务代码的情况下保护通信。此外，我们利用 Istio 的可观察性工具来深入了解服务依赖关系和性能。”

回答时请谨慎：“虽然服务网格在安全性、可观察性和可靠性方面增加了显著的价值，但它们也给 Kubernetes 环境引入了额外的复杂性和开销。使用服务网格的决定应与当前和未来应用架构的复杂性以及团队管理此复杂性的能力等因素相平衡。此外，对于简单的应用程序或环境来说，服务网格的好处可能过于庞大，而 Kubernetes 内置的功能已经足够。”

9. 你会如何为 Kubernetes 集群进行容量规划？

期望回答：答案应包括使用指标和日志监控当前使用情况，根据趋势或即将到来的项目预测未来需求，并考虑 Kubernetes 组件的开销。他们还应讨论用于扩展集群和应用程序的工具和实践。

需要提及的重要点：

- 利用监控工具如 Prometheus 收集使用指标。

分析历史数据以预测未来资源需求。

在容量规划中考虑集群组件的开销。

实施自动缩放策略，包括节点和 Pod 的自动缩放。

你可以举的例子：“为了应对在线零售应用预期中的用户流量激增，我们分析了历史 Prometheus 指标，以识别峰值使用模式并预测未来需求。然后，我们提前增加了集群容量，同时为前端服务配置了水平 Pod 自动缩放器，以根据需求动态扩展。此外，我们启用了集群自动缩放器，根据整个集群资源利用率增加或删除节点，确保我们能够有效地满足用户需求。”

回答时请谨慎：“在 Kubernetes 中进行容量规划需要在确保峰值负载的充足资源和避免过度配置导致不必要成本之间取得平衡。预测性分析可以指导容量调整，但是意外事件或需求突然激增可能会挑战即使是规划最完善的环境。持续的监控和调整，结合敏捷的缩放策略，对于有效应对这些挑战至关重要。”

10. 解释 GitOps 在 Kubernetes 中的概念和好处。

期望的回答：寻找关于 GitOps 如何将 Git 仓库作为声明式基础架构和应用的真实来源的解释。其好处包括提高部署的可预测性、更容易的回滚、增强的安全性和更好的合规性。他们可能会提到特定的工具，如 Argo CD 或 Flux。

需要提及的重要点：

GitOps 利用 Git 作为系统和应用配置的唯一真实来源，实现版本控制、协作和审计跟踪。

自动化的同步和部署流程确保 Kubernetes 集群的状态与存储在 Git 中的配置相匹配。

通过拉取请求审查和自动化检查，简化回滚到先前的配置并增强安全性。

你可以举的例子：“在最近的一个项目中，为了简化部署流程，我们采用了使用 Argo CD 的 GitOps 工作流。我们将所有 Kubernetes 部署清单存储在一个 Git 仓库中。Argo CD 不断地将集群状态与仓库同步。当我们需要更新一个应用程序时，我们只需在 Git 中更新其清单，并合并更改。Argo CD 会自动将更新应用到集群中。这不仅简化了我们的部署流程，还提供了清晰的变更审计跟踪，并简化了回滚操作。”

“虽然 GitOps 在自动化、安全性和可审计性方面带来了许多好处，但其有效性高度依赖于组织在 CI/CD 实践上的成熟度以及开发人员对 Git 工作流的熟悉程度。此外，对于复杂的部署来说，可能需要一定的学习曲线来声明性地管理配置。这还需要为 Git 仓库制定可靠的备份策略，因为它成为了一个关键的故障点。”

11. 在大规模 Kubernetes 环境中如何处理日志记录和监控？

期望的回答：候选人应该谈论关于集中式日志记录解决方案（例如 ELK stack、Loki）用于聚合来自多个来源的日志，以及监控工具（例如 Prometheus、Grafana）用于跟踪集群和应用程序的健康状态和性能。高级答案可能包括实施自定义指标和警报。

需要提及的重要点：

集中式日志记录使得能够聚合、搜索和分析 Kubernetes 集群中所有组件和应用程序的日志。

使用 Prometheus 进行监控并使用 Grafana 进行可视化，可以深入了解应用程序的性能和集群的健康状态。

设置基于特定指标的警报的重要性，以便主动解决问题。

你可以举例说：“对于一个大型电子商务平台，我们实施了 ELK 堆栈进行集中式日志记录，聚合所有服务的日志，以便轻松访问和分析。我们使用 Prometheus 监控我们的 Kubernetes 集群和服务，并通过 Grafana 仪表板实时可视化关键性能指标。我们设置了针对关键阈值的警报，例如高 CPU 或内存使用率，使我们能够快速识别并缓解潜在问题，以免影响客户。”

在大规模 Kubernetes 环境中实施全面的日志记录和监控至关重要，但可能会引入复杂性和开销，特别是在资源消耗和管理方面。微调要收集的指标和保留的日志是保持可见性和运营效率平衡的关键。此外，监控和日志记录系统的有效性取决于适当的配置和定期维护，以适应不断变化的应用程序和基础设施环境。

12. 描述如何在 Kubernetes 中实施网络策略以及它们的影响。

期望的回答：候选人应解释如何使用网络策略来定义 Kubernetes 集群内 Pod 之间的通信规则，从而增强安全性。他们可能会解释 Kubernetes 中的默认宽松网络设置，以及网络策略如何限制流量流动，并举例说明使用 YAML 定义。

需要提及的重要点：

网络策略允许管理员控制 IP 地址或端口级别的流量流动，增强集群安全性。

它们由 Kubernetes 网络插件实现，并需要支持网络策略的网络提供程序。

有效使用网络策略可以显著降低集群内未经授权的访问或违规行为的风险。

你可以举的例子：“为了将后端服务与公共互联网访问隔离并保护起来，我们定义了只允许来自特定前端 Pod 的流量的网络策略。下面是一个示例策略，它将入口流量限制为只能来自带有标签 role: frontend 的 Pod：

```yaml
apiVersion: networking.k8s.io/v1 
kind: NetworkPolicy 
metadata: 
  name: backend-access-policy 
spec: 
  podSelector: 
    matchLabels: 
      app: backend 
  ingress: 
  - from: 
    - podSelector: 
        matchLabels: 
          role: frontend
```

该策略确保只有前端 Pod 能与后端通信，显著增强了我们服务的安全性。”

有所保留的答案：“虽然网络策略是在 Kubernetes 集群内保护流量的强大工具，但其有效性取决于策略的正确和全面定义。配置错误的策略可能会意外地阻止关键通信或留下漏洞。此外，网络策略的实现和行为可能因不同的网络提供程序而异，因此需要进行彻底的测试和验证，以确保策略在您的特定环境中的行为符合预期。”

13. 讨论 Kubernetes 的演进以及您如何跟上其变化。

预期答案：一位资深工程师应该展示对 Kubernetes 不断发展的了解，提到官方 Kubernetes 博客、SIG 会议、KEPs（Kubernetes Enhancement Proposals）以及社区论坛等资源。他们还可能讨论最近发布的重大变化或即将推出的功能，这些变化可能影响到集群的管理方式。

这些问题旨在揭示候选人对 Kubernetes 的深度知识和经验，不仅涉及基本概念，还探讨他们构建、优化和解决复杂 Kubernetes 环境的能力。

了解更多

Kubernetes

DevOps

云计算

编程

软件开发
