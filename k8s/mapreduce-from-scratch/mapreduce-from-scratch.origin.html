<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="norton-safeweb-site-verification" content="24usqpep0ejc5w6hod3dulxwciwp0djs6c6ufp96av3t4whuxovj72wfkdjxu82yacb7430qjm8adbd5ezlt4592dq4zrvadcn9j9n-0btgdzpiojfzno16-fnsnu7xd" />
        
        <link rel="preconnect" href="https://substackcdn.com" />
        

        

        
        <link rel="preload" as="style" href="https://substackcdn.com/bundle/theme/main.744438bb3c1e083ebc7a.css" />
        
        
        
        <link rel="preload" as="font" href="https://fonts.gstatic.com/s/spectral/v13/rnCr-xNNww_2s0amA9M5knjsS_ul.woff2" crossorigin />
        

        
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/entry-3c13f6d5.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/index-bee825e1.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/user-51b02764.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/FlexBox-c1df079b.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/free_email_form-25f68dbb.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/Modal-faa641cb.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/app_install_modal-1b80d39d.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/IntroPopup-96bfa55d.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/Banner-cc32eba2.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/NavbarUserWidget-a83cba36.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/homepage_hooks-c28ee672.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/_defineProperty-213a01f6.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/Tooltip-d0af0cf2.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/_baseEach-514c6e37.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/HoverCard-41ea4b50.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/Divider-f25512a6.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/Progress-f0f26f86.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/Menu-9123dbf7.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/Select-cd38999e.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/ProfileHoverCard-0f3ebd95.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/UserBadge-fb9c174e.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/user_indicator-c1a5a8fb.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/ShareableImageModal-6a735338.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/ShareAssetButtons-9cd347fc.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/PubAccentTheme-4d7e77dd.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/overflow_menu-db9a534e.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/newsletter_item_list-03468b3d.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/ProfileSetupToast-60e0a843.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/CommunityPostView-2bcc1970.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/podcast_apps-184969d7.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/CommentBody-f90dd6a2.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/mention-e43b25a5.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/Attachments-94e0a9c8.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/AlertDialog-e3a605af.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/TextLink-f399b628.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/ChatAppUpsell-41a3562f.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/post-cfd9b3d5.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/FollowPrompt-a56b28dc.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/PodcastTranscriptTab-22166d76.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/facepile-2e21e967.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/ImageViewerModal-5f70a364.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/VideoVerticalMenu-89d6e55f.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/Recipe-53df0851.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/recommend_linked_publication_modal-722617bb.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/TabBar-a61ccfca.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/AuditionPlayer-5637d633.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/RewardBox-5297e7a9.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/Field-cea155ef.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/Radio-148681a8.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/Logo-f0548763.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/FilePicker-ceb0fe25.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/setup_all_podcasts-b481ea39.css" />
            
                <link type="text/css" rel="stylesheet" href="https://substackcdn.com/bundle/assets/CookieConsentFooter-0d9aca19.css" />
            
        

        
        
        
        
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover" />
        <meta name="author" content="Michal Pitr" />
        <meta property="og:url" content="https://michalpitr.substack.com/p/mapreduce-from-scratch" />
        <title data-preact-helmet>MapReduce from Scratch - by Michal Pitr - Michal’s Substack</title>
        <meta data-preact-helmet property="og:type" content="article"><meta data-preact-helmet property="og:title" content="MapReduce from Scratch"><meta data-preact-helmet name="twitter:title" content="MapReduce from Scratch"><meta data-preact-helmet name="description" content="Building a distributed computing framework, step by step."><meta data-preact-helmet property="og:description" content="Building a distributed computing framwork, step by step."><meta data-preact-helmet name="twitter:description" content="Building a distributed computing framwork, step by step."><meta data-preact-helmet property="og:image" content="https://substackcdn.com/image/fetch/w_1200,h_600,c_fill,f_jpg,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc1d3a7a5-e2cc-4778-bafe-03f87e6a6884_1600x671.png"><meta data-preact-helmet name="twitter:image" content="https://substackcdn.com/image/fetch/f_auto,q_auto:best,fl_progressive:steep/https%3A%2F%2Fmichalpitr.substack.com%2Fapi%2Fv1%2Fpost_preview%2F144104758%2Ftwitter.jpg%3Fversion%3D4"><meta data-preact-helmet name="twitter:card" content="summary_large_image">
        <link rel="canonical" href="https://michalpitr.substack.com/p/mapreduce-from-scratch" />

        

        

        
            
                <link rel="shortcut icon" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F75c97424-e12e-4ed1-ad50-792498945c4a%2Ffavicon.ico">
            
        
            
                <link rel="icon" type="image/png" sizes="16x16" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F75c97424-e12e-4ed1-ad50-792498945c4a%2Ffavicon-16x16.png">
            
        
            
                <link rel="icon" type="image/png" sizes="32x32" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F75c97424-e12e-4ed1-ad50-792498945c4a%2Ffavicon-32x32.png">
            
        
            
                <link rel="icon" type="image/png" sizes="48x48" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F75c97424-e12e-4ed1-ad50-792498945c4a%2Ffavicon-48x48.png">
            
        
            
                <link rel="apple-touch-icon" sizes="57x57" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F75c97424-e12e-4ed1-ad50-792498945c4a%2Fapple-touch-icon-57x57.png">
            
        
            
                <link rel="apple-touch-icon" sizes="60x60" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F75c97424-e12e-4ed1-ad50-792498945c4a%2Fapple-touch-icon-60x60.png">
            
        
            
                <link rel="apple-touch-icon" sizes="72x72" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F75c97424-e12e-4ed1-ad50-792498945c4a%2Fapple-touch-icon-72x72.png">
            
        
            
                <link rel="apple-touch-icon" sizes="76x76" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F75c97424-e12e-4ed1-ad50-792498945c4a%2Fapple-touch-icon-76x76.png">
            
        
            
                <link rel="apple-touch-icon" sizes="114x114" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F75c97424-e12e-4ed1-ad50-792498945c4a%2Fapple-touch-icon-114x114.png">
            
        
            
                <link rel="apple-touch-icon" sizes="120x120" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F75c97424-e12e-4ed1-ad50-792498945c4a%2Fapple-touch-icon-120x120.png">
            
        
            
                <link rel="apple-touch-icon" sizes="144x144" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F75c97424-e12e-4ed1-ad50-792498945c4a%2Fapple-touch-icon-144x144.png">
            
        
            
                <link rel="apple-touch-icon" sizes="152x152" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F75c97424-e12e-4ed1-ad50-792498945c4a%2Fapple-touch-icon-152x152.png">
            
        
            
                <link rel="apple-touch-icon" sizes="167x167" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F75c97424-e12e-4ed1-ad50-792498945c4a%2Fapple-touch-icon-167x167.png">
            
        
            
                <link rel="apple-touch-icon" sizes="180x180" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F75c97424-e12e-4ed1-ad50-792498945c4a%2Fapple-touch-icon-180x180.png">
            
        
            
                <link rel="apple-touch-icon" sizes="1024x1024" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F75c97424-e12e-4ed1-ad50-792498945c4a%2Fapple-touch-icon-1024x1024.png">
            
        
            
        
            
        
            
        

        

        
            <link rel="alternate" type="application/rss+xml" href="/feed" title="Michal’s Substack"/>
        

        
        
          <style>
            @font-face{font-family:'Spectral';font-style:italic;font-weight:400;font-display:fallback;src:url(https://fonts.gstatic.com/s/spectral/v13/rnCt-xNNww_2s0amA9M8on7mTNmnUHowCw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Spectral';font-style:italic;font-weight:400;font-display:fallback;src:url(https://fonts.gstatic.com/s/spectral/v13/rnCt-xNNww_2s0amA9M8onXmTNmnUHowCw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Spectral';font-style:italic;font-weight:400;font-display:fallback;src:url(https://fonts.gstatic.com/s/spectral/v13/rnCt-xNNww_2s0amA9M8onTmTNmnUHowCw.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Spectral';font-style:italic;font-weight:400;font-display:fallback;src:url(https://fonts.gstatic.com/s/spectral/v13/rnCt-xNNww_2s0amA9M8onrmTNmnUHo.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Spectral';font-style:normal;font-weight:400;font-display:fallback;src:url(https://fonts.gstatic.com/s/spectral/v13/rnCr-xNNww_2s0amA9M9knjsS_ulYHs.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Spectral';font-style:normal;font-weight:400;font-display:fallback;src:url(https://fonts.gstatic.com/s/spectral/v13/rnCr-xNNww_2s0amA9M2knjsS_ulYHs.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Spectral';font-style:normal;font-weight:400;font-display:fallback;src:url(https://fonts.gstatic.com/s/spectral/v13/rnCr-xNNww_2s0amA9M3knjsS_ulYHs.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Spectral';font-style:normal;font-weight:400;font-display:fallback;src:url(https://fonts.gstatic.com/s/spectral/v13/rnCr-xNNww_2s0amA9M5knjsS_ul.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Spectral';font-style:normal;font-weight:600;font-display:fallback;src:url(https://fonts.gstatic.com/s/spectral/v13/rnCs-xNNww_2s0amA9vmtm3FafaPWnIIMrY.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Spectral';font-style:normal;font-weight:600;font-display:fallback;src:url(https://fonts.gstatic.com/s/spectral/v13/rnCs-xNNww_2s0amA9vmtm3OafaPWnIIMrY.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Spectral';font-style:normal;font-weight:600;font-display:fallback;src:url(https://fonts.gstatic.com/s/spectral/v13/rnCs-xNNww_2s0amA9vmtm3PafaPWnIIMrY.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Spectral';font-style:normal;font-weight:600;font-display:fallback;src:url(https://fonts.gstatic.com/s/spectral/v13/rnCs-xNNww_2s0amA9vmtm3BafaPWnII.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}
            
          </style>
        

        <style>:root{--color_theme_bg_pop:#D10000;--background_pop:#D10000;--cover_bg_color:#FFFFFF;--background_pop_darken:#b80000;--print_on_pop:#ffffff;--color_theme_bg_pop_darken:#b80000;--color_theme_print_on_pop:#ffffff;--border_subtle:#f6dfdf;--background_subtle:rgba(248, 217, 217, 0.4);--print_pop:#d10000;--color_theme_accent:#d10000;--cover_print_primary:#363737;--cover_print_secondary:#757575;--cover_border_color:#d10000;--home_hero:newspaper;--home_posts:list;--background_contrast_1:#f0f0f0;--background_contrast_2:#dddddd;--background_contrast_3:#b7b7b7;--background_contrast_4:#929292;--background_contrast_5:#515151;--color_theme_detail:#e6e6e6;--background_contrast_pop:rgba(209, 0, 0, 0.4);--color_theme_bg_contrast_pop:rgba(209, 0, 0, 0.4);--input_background:#ffffff;--cover_input_background:#ffffff;--tooltip_background:#191919;--background_pop_rgb:209, 0, 0;--background_pop_rgb_pc:209 0 0;--color_theme_bg_pop_rgb:209, 0, 0;--color_theme_bg_pop_rgb_pc:209 0 0;--color_theme_accent_rgb:209, 0, 0;--color_theme_accent_rgb_pc:209 0 0;}</style>

        
            <link rel="stylesheet" href="https://substackcdn.com/bundle/theme/main.744438bb3c1e083ebc7a.css" />
        

        <style></style>

        

        

        
    </head>

    <body class="">
        

        

        <div id="entry">
            <div id="main" class="main typography use-theme-bg"><div data-testid="navbar" class="main-menu animated"><div class="main-menu-content"><div class="topbar"><div class="topbar-content"><div class="navbar-logo-container"><a href="/" native><img src="https://substackcdn.com/image/fetch/w_96,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbe5ab36b-c782-420e-ac35-c7599a1f77ad_976x976.png" class="navbar-logo" /></a></div><h1 class="navbar-title left-align loading"><a href="/" native class="navbar-title-link">Michal’s Substack</a></h1><div class="navbar-buttons"><div class="pencraft pc-display-contents pc-reset _pubTheme_6gfa3_1"><div style="width: 40px;" class="pencraft pc-display-flex pc-gap-4 pc-paddingLeft-0 pc-justifyContent-center pc-alignItems-center pc-reset _searchWrapper_933k8_1 _marginRight_933k8_19"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-fg-primary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search " area-hidden="true"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg></div><button tabIndex="0" type="button" aria-label="Share Publication" id="trigger40403" aria-expanded="false" aria-haspopup="dialog" aria-controls="dialog40404" ariaLabel="View more" class="pencraft pc-reset pencraft _iconButton2_1wz1m_628 _iconButtonBase_1wz1m_145 _buttonBase_1wz1m_1 _buttonNew_1wz1m_83 _size_md_1wz1m_127 _priority_tertiary_1wz1m_69"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-share "><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path><polyline points="16 6 12 2 8 6"></polyline><line x1="12" x2="12" y1="2" y2="15"></line></svg></button><button tabIndex="0" type="button" data-testid="noncontributor-cta-button" class="pencraft pc-reset pencraft _buttonBase_1wz1m_1 _button_1wz1m_1 _buttonNew_1wz1m_83 _button2_1wz1m_117 _priority_primary_1wz1m_57 _size_md_1wz1m_127">Subscribe</button><button tabIndex="0" type="button" native="true" data-href="https://substack.com/sign-in?redirect=%2Fp%2Fmapreduce-from-scratch&amp;for_pub=michalpitr" class="pencraft pc-reset pencraft _buttonBase_1wz1m_1 _button_1wz1m_1 _buttonNew_1wz1m_83 _button2_1wz1m_117 _priority_tertiary_1wz1m_69 _size_md_1wz1m_127">Sign in</button></div></div></div></div></div><div class="topbar-spacer"></div></div><div><script type="application/ld+json">{"@context":"https://schema.org","@type":"NewsArticle","url":"https://michalpitr.substack.com/p/mapreduce-from-scratch","mainEntityOfPage":"https://michalpitr.substack.com/p/mapreduce-from-scratch","headline":"MapReduce from Scratch","description":"Building a distributed computing framework, step by step.","image":[{"@type":"ImageObject","url":"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc1d3a7a5-e2cc-4778-bafe-03f87e6a6884_1600x671.png"}],"datePublished":"2024-04-28T21:33:39+00:00","dateModified":"2024-04-28T21:33:39+00:00","isAccessibleForFree":true,"author":[{"@type":"Person","name":"Michal Pitr","url":"https://substack.com/@michalpitr","description":"Computer Science & Mathematics graduate from the University of Edinburgh. I love figuring out how systems work at a fundamental level and sharing my findings.","identifier":"user:28235731","image":{"@type":"ImageObject","contentUrl":"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F73a6e774-038e-424d-afee-ce5041c3e7e0_1080x1080.jpeg","thumbnailUrl":"https://substackcdn.com/image/fetch/w_128,h_128,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F73a6e774-038e-424d-afee-ce5041c3e7e0_1080x1080.jpeg"}}],"publisher":{"@type":"Organization","name":"Michal\u2019s Substack","url":"https://michalpitr.substack.com","description":"My personal Substack","interactionStatistic":{"@type":"InteractionCounter","name":"Subscribers","interactionType":"https://schema.org/SubscribeAction","userInteractionCount":100},"identifier":"pub:1939983","logo":{"@type":"ImageObject","url":"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbe5ab36b-c782-420e-ac35-c7599a1f77ad_976x976.png","contentUrl":"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbe5ab36b-c782-420e-ac35-c7599a1f77ad_976x976.png","thumbnailUrl":"https://substackcdn.com/image/fetch/w_128,h_128,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbe5ab36b-c782-420e-ac35-c7599a1f77ad_976x976.png"},"image":{"@type":"ImageObject","url":"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbe5ab36b-c782-420e-ac35-c7599a1f77ad_976x976.png","contentUrl":"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbe5ab36b-c782-420e-ac35-c7599a1f77ad_976x976.png","thumbnailUrl":"https://substackcdn.com/image/fetch/w_128,h_128,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbe5ab36b-c782-420e-ac35-c7599a1f77ad_976x976.png"}}}</script><div class="single-post-container"><div class="container"><div class="single-post"><article class="typography newsletter-post post"><div inert role="dialog" class="modal typography out gone share-dialog popup"><div class="modal-table"><div class="modal-row"><div class="modal-cell modal-content no-fullscreen"><div class="container"><button tabIndex="0" type="button" data-testid="close-modal" class="pencraft pc-reset pencraft modal-btn modal-exit-btn no-margin _iconButton_1wz1m_145 _iconButtonBase_1wz1m_145 _buttonBase_1wz1m_1 _buttonOldColors_1wz1m_56 _size_40_1wz1m_175 _priority_secondary_1wz1m_63 _fill_empty_1wz1m_316 _rounded_1wz1m_155"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="secondary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x "><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg></button><div class="share-dialog-title">Share this post</div><div class="pencraft pc-display-flex pc-flexDirection-column pc-gap-32 pc-paddingLeft-24 pc-paddingRight-24 pc-paddingTop-32 pc-paddingBottom-48 pc-reset"><div class="pencraft pc-display-flex pc-padding-8 pc-reset _border-detail_100yf_25 pc-borderRadius-md social-preview-box post"><div class="social-image-box"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_120,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc1d3a7a5-e2cc-4778-bafe-03f87e6a6884_1600x671.png" /><img src="https://substackcdn.com/image/fetch/w_120,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc1d3a7a5-e2cc-4778-bafe-03f87e6a6884_1600x671.png" sizes="100vw" alt width="120" loading="lazy" class="_img_16u6n_1 social-image pencraft pc-reset" /></picture></div><div class="pencraft pc-display-flex pc-flexDirection-column pc-paddingTop-8 pc-paddingBottom-8 pc-paddingLeft-12 pc-reset"><h4 class="pencraft pc-reset _line-height-24_1k90y_98 _font-display_1k90y_118 _size-20_1k90y_70 _weight-bold_1k90y_168 _reset_1k90y_1">MapReduce from Scratch</h4><div class="pencraft pc-reset _color-secondary_1k90y_186 _line-height-20_1k90y_95 _font-text_1k90y_121 _size-13_1k90y_45 _weight-regular_1k90y_159 _reset_1k90y_1">michalpitr.substack.com</div></div></div><div class="pencraft pc-display-flex pc-gap-8 pc-justifyContent-space-between pc-reset share-dialog-buttons-wrapper"><button tabIndex="0" type="button" class="button share-action"><div class="action-icon"><svg role="img" width="20" height="16" viewBox="0 0 20 16" fill="none" stroke-width="1.8" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><path fill-rule="evenodd" clip-rule="evenodd" d="M12.1303 0.000379039C10.9833 -0.00959082 9.87819 0.431464 9.05309 1.22855L9.04556 1.23593L7.79145 2.48303C7.50587 2.767 7.50453 3.22877 7.78844 3.51441C8.07235 3.80004 8.53401 3.80139 8.81959 3.51741L10.0698 2.27423C10.6194 1.74503 11.3546 1.45229 12.1177 1.45892C12.8824 1.46556 13.6139 1.77236 14.1546 2.31323C14.6954 2.8541 15.0021 3.58577 15.0087 4.35065C15.0154 5.11353 14.7229 5.84857 14.1943 6.39829L12.0116 8.58145L12.0115 8.58155C11.7159 8.87739 11.36 9.10617 10.9682 9.25237C10.5764 9.39857 10.1577 9.45878 9.74051 9.42889C9.32337 9.39901 8.91752 9.27975 8.55051 9.07918C8.1835 8.87862 7.8639 8.60146 7.6134 8.26649C7.3722 7.94396 6.91526 7.87807 6.5928 8.11933C6.27034 8.36059 6.20447 8.81763 6.44567 9.14016C6.82142 9.64261 7.30082 10.0584 7.85134 10.3592C8.40186 10.66 9.01062 10.8389 9.63634 10.8838C10.2621 10.9286 10.8901 10.8383 11.4779 10.619C12.0656 10.3997 12.5994 10.0565 13.0429 9.61274L15.2302 7.42494L15.2391 7.4159C16.036 6.59062 16.4769 5.48529 16.467 4.33797C16.457 3.19066 15.9969 2.09316 15.1858 1.28185C14.3746 0.470545 13.2774 0.0103489 12.1303 0.000379039ZM7.29806 5.11625C6.67234 5.07142 6.0443 5.16173 5.45654 5.38103C4.86882 5.60031 4.33502 5.94355 3.89153 6.38727L1.70423 8.57506L1.69534 8.5841C0.898438 9.40939 0.457483 10.5147 0.467451 11.662C0.477418 12.8094 0.937512 13.9069 1.74864 14.7182C2.55976 15.5295 3.65701 15.9897 4.80407 15.9996C5.95113 16.0096 7.05622 15.5685 7.88132 14.7715L7.89035 14.7626L9.13717 13.5155C9.42192 13.2307 9.42192 12.7689 9.13717 12.4841C8.85243 12.1993 8.39077 12.1993 8.10602 12.4841L6.86392 13.7265C6.31432 14.2552 5.57945 14.5477 4.81675 14.5411C4.05204 14.5344 3.32054 14.2276 2.77979 13.6868C2.23904 13.1459 1.93231 12.4142 1.92566 11.6494C1.91904 10.8865 2.21146 10.1514 2.74011 9.60172L4.92287 7.41846C5.21854 7.12262 5.57437 6.89384 5.96621 6.74763C6.35805 6.60143 6.77674 6.54123 7.19389 6.57111C7.61104 6.601 8.01688 6.72026 8.38389 6.92082C8.75091 7.12138 9.0705 7.39855 9.32101 7.73352C9.56221 8.05605 10.0191 8.12194 10.3416 7.88068C10.6641 7.63942 10.7299 7.18238 10.4887 6.85985C10.113 6.3574 9.63359 5.94165 9.08307 5.64081C8.53255 5.33997 7.92378 5.16107 7.29806 5.11625Z"></path></g></svg></div><div translated class="pencraft pc-reset _color-secondary_1k90y_186 _line-height-20_1k90y_95 _font-text_1k90y_121 _size-13_1k90y_45 _weight-regular_1k90y_159 _reset_1k90y_1">Copy link</div></button><button tabIndex="0" type="button" class="button share-action"><div class="action-icon"><svg role="img" width="16" height="17" viewBox="0 0 16 17" fill="none" stroke-width="1.8" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><path d="M10.6543 1.38723C10.3533 0.960814 9.95383 0.61341 9.48976 0.374567C9.02902 0.137956 8.51908 0.0130716 8.00115 0.0100098C7.86087 0.0101844 7.72354 0.0502687 7.60519 0.125581C7.48684 0.200893 7.39237 0.308324 7.3328 0.435326L5.00368 5.67077H3.029C2.72335 5.66964 2.42059 5.73003 2.13876 5.84833C1.85692 5.96663 1.60177 6.14043 1.38849 6.35938C1.16707 6.57502 0.991841 6.83346 0.873459 7.11897C0.755078 7.40447 0.696022 7.71108 0.699885 8.02014V13.691C0.699885 14.3087 0.945273 14.9012 1.38207 15.338C1.81886 15.7747 2.41128 16.0201 3.029 16.0201H13.348C13.8951 16.021 14.425 15.8283 14.8438 15.4762C15.2626 15.1241 15.5434 14.6352 15.6366 14.0961L16.6493 8.4252C16.7252 8.09192 16.7252 7.74582 16.6493 7.41254C16.566 7.08205 16.4104 6.7742 16.1936 6.51128C15.9746 6.25 15.7017 6.03926 15.3936 5.89355C15.0762 5.7467 14.7306 5.67068 14.3809 5.67077H10.5328L11.0391 4.37457C11.2397 3.88784 11.3162 3.35894 11.2619 2.83533C11.1853 2.30894 10.9763 1.81065 10.6543 1.38723ZM4.75052 14.5518H3.029C2.91049 14.5525 2.79303 14.5296 2.68349 14.4844C2.57394 14.4392 2.47452 14.3726 2.39102 14.2885C2.23609 14.1199 2.14945 13.8997 2.14799 13.6708V8.02014C2.14913 7.901 2.17389 7.78328 2.22082 7.67377C2.26775 7.56427 2.33592 7.46515 2.4214 7.38216C2.50369 7.29576 2.60267 7.22698 2.71233 7.17998C2.822 7.13298 2.94007 7.10874 3.05938 7.10874H4.7809L4.75052 14.5518ZM10.6746 7.05811H14.3809C14.5145 7.05821 14.6462 7.08942 14.7657 7.14925C14.8875 7.20532 14.9948 7.28845 15.0796 7.39229C15.1675 7.49052 15.2301 7.60871 15.2619 7.73659C15.2922 7.8665 15.2922 8.00162 15.2619 8.13153L14.2493 13.8024C14.2087 14.017 14.094 14.2106 13.9252 14.3492C13.7619 14.4812 13.558 14.5528 13.348 14.5518H6.19862V6.45052L8.43659 1.38723H8.52773C8.9042 1.50037 9.23304 1.73413 9.4636 2.05252C9.69416 2.37092 9.81365 2.75627 9.80368 3.14925C9.8181 3.39741 9.78015 3.64583 9.69229 3.87836L9.23659 5.04292C9.15397 5.273 9.12623 5.51921 9.15558 5.76191C9.1877 6.00427 9.27425 6.23623 9.40875 6.44039C9.5535 6.6376 9.74028 6.80017 9.95558 6.91634C10.1774 7.03206 10.4244 7.0912 10.6746 7.08849V7.05811Z"></path></g></svg></div><div translated class="pencraft pc-reset _color-secondary_1k90y_186 _line-height-20_1k90y_95 _font-text_1k90y_121 _size-13_1k90y_45 _weight-regular_1k90y_159 _reset_1k90y_1">Facebook</div></button><button tabIndex="0" type="button" class="button share-action"><div class="action-icon"><svg role="img" width="21" height="16" viewBox="0 0 21 16" fill="none" stroke-width="1.8" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><path fill-rule="evenodd" clip-rule="evenodd" d="M2.22192 2.20503C2.36754 1.77115 2.78269 1.45455 3.26639 1.45455H17.9332C18.4169 1.45455 18.8321 1.77118 18.9777 2.2051L10.5999 8.02107L2.22192 2.20503ZM2.16639 3.94198V13.4545C2.16639 14.0529 2.66307 14.5455 3.26639 14.5455H17.9332C18.5365 14.5455 19.0332 14.0529 19.0332 13.4545V3.94206L11.0204 9.50462C10.7679 9.67991 10.4318 9.67991 10.1793 9.50462L2.16639 3.94198ZM20.4999 2.55809V13.4545C20.4999 14.8562 19.3465 16 17.9332 16H3.26639C1.85304 16 0.699707 14.8562 0.699707 13.4545V2.54545C0.699707 1.14379 1.85304 0 3.26639 0H17.9332C19.3407 0 20.4904 1.13441 20.4998 2.52818C20.5 2.53816 20.5001 2.54813 20.4999 2.55809Z"></path></g></svg></div><div translated class="pencraft pc-reset _color-secondary_1k90y_186 _line-height-20_1k90y_95 _font-text_1k90y_121 _size-13_1k90y_45 _weight-regular_1k90y_159 _reset_1k90y_1">Email</div></button><button tabIndex="0" type="button" class="button share-action"><div class="action-icon"><svg role="img" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><path d="M6.785 1.92766C5.45134 1.57031 4.08049 2.36176 3.72314 3.69543L0.444815 15.9303C0.0874636 17.264 0.878901 18.6348 2.21255 18.9922L5.37495 19.8396V7.66664C5.37495 6.40099 6.40096 5.37498 7.66661 5.37498H19.4723C19.3299 5.30548 19.1788 5.24858 19.0201 5.20604L6.785 1.92766Z" stroke="none"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M8.44161 7.4C7.86632 7.4 7.39995 7.86637 7.39995 8.44167V22.1081C7.39995 22.6834 7.86631 23.1498 8.4416 23.1498L22.1083 23.15C22.6836 23.15 23.1499 22.6836 23.1499 22.1083V8.44167C23.1499 7.86637 22.6836 7.4 22.1083 7.4H8.44161ZM10.3999 9.65C9.84766 9.65 9.39995 10.0977 9.39995 10.65C9.39995 11.2023 9.84766 11.65 10.3999 11.65H18.3999C18.9522 11.65 19.3999 11.2023 19.3999 10.65C19.3999 10.0977 18.9522 9.65 18.3999 9.65H10.3999ZM10.3999 14.15C9.84766 14.15 9.39995 14.5977 9.39995 15.15C9.39995 15.7023 9.84766 16.15 10.3999 16.15H15.3999C15.9522 16.15 16.3999 15.7023 16.3999 15.15C16.3999 14.5977 15.9522 14.15 15.3999 14.15H10.3999Z" stroke="none"></path></g></svg></div><div class="pencraft pc-reset _color-secondary_1k90y_186 _line-height-20_1k90y_95 _font-text_1k90y_121 _size-13_1k90y_45 _weight-regular_1k90y_159 _reset_1k90y_1">Note</div></button><button tabIndex="0" id="trigger40405" aria-expanded="false" aria-haspopup="dialog" aria-controls="dialog40406" ariaLabel="View more" type="button" class="button share-action"><div class="action-icon"><svg role="img" width="100" height="100" viewBox="0 0 100 100" fill="none" stroke-width="1.8" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><circle cx="23" cy="50" r="9"></circle><circle cx="50" cy="50" r="9"></circle><circle cx="77" cy="50" r="9"></circle></g></svg></div><div translated class="pencraft pc-reset _color-secondary_1k90y_186 _line-height-20_1k90y_95 _font-text_1k90y_121 _size-13_1k90y_45 _weight-regular_1k90y_159 _reset_1k90y_1">Other</div></button></div></div></div></div></div></div></div><div class="post-header"><h1 class="post-title unpublished">MapReduce from Scratch</h1><h3 class="subtitle">Building a distributed computing framework, step by step.</h3><div class="pencraft pc-display-flex pc-flexDirection-column pc-paddingBottom-16 pc-reset"><div class="pencraft pc-display-flex pc-flexDirection-column pc-paddingTop-16 pc-paddingBottom-16 pc-reset"><div class="pencraft pc-display-flex pc-gap-12 pc-alignItems-center pc-reset byline-wrapper"><div class="pencraft pc-display-flex pc-reset"><div class="pencraft pc-display-flex pc-gap-8 pc-alignItems-center _flexGrow_100yf_227 pc-reset facepile"><div class="pencraft pc-display-flex pc-alignItems-center pc-reset"><div class="pencraft pc-display-flex pc-alignItems-center pc-reset _faces_1civs_7 _size-40_1civs_15"><div class="profile-hover-card-target _profileHoverCardTarget_1ypz6_50"><a href="https://substack.com/profile/28235731-michal-pitr" target="_blank" rel="noopener" class="pencraft pc-display-flex _flexAuto_100yf_230 pc-reset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_80,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F73a6e774-038e-424d-afee-ce5041c3e7e0_1080x1080.jpeg" /><img src="https://substackcdn.com/image/fetch/w_80,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F73a6e774-038e-424d-afee-ce5041c3e7e0_1080x1080.jpeg" sizes="100vw" alt width="80" style="z-index: 1;" class="_img_16u6n_1 facepile-face _face_1civs_7 _size-40_1civs_15 _first_1civs_53 _last_1civs_57 pencraft pc-reset" /></picture></a></div></div></div></div></div><div class="pencraft pc-display-flex pc-flexDirection-column pc-reset"><div class="pencraft pc-reset _color-pub-primary-text_1k90y_204 _line-height-20_1k90y_95 _font-meta_1k90y_131 _size-11_1k90y_35 _weight-medium_1k90y_162 _transform-uppercase_1k90y_242 _reset_1k90y_1 _meta_1k90y_442"><div class="profile-hover-card-target _profileHoverCardTarget_1ypz6_50"><a href="https://substack.com/@michalpitr" class="pencraft pc-reset _decoration-hover-underline_1k90y_298 _reset_1k90y_1">Michal Pitr</a></div></div><div class="pencraft pc-display-flex pc-gap-4 pc-reset"><div class="pencraft pc-reset _color-pub-secondary-text_1k90y_207 _line-height-20_1k90y_95 _font-meta_1k90y_131 _size-11_1k90y_35 _weight-medium_1k90y_162 _transform-uppercase_1k90y_242 _reset_1k90y_1 _meta_1k90y_442">Apr 28, 2024</div></div></div></div></div><div class="pencraft pc-display-flex pc-gap-16 pc-paddingTop-16 pc-paddingBottom-16 pc-justifyContent-space-between pc-alignItems-center _flexGrow_100yf_227 pc-reset _border-top-detail-themed_100yf_47 _border-bottom-detail-themed_100yf_50 post-ufi"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="like-button-container"><a role="button" class="post-ufi-button style-button has-label with-border"><svg role="img" style="height: 20px; width: 20px;" width="20" height="20" viewBox="0 0 24 24" fill="#000000" stroke-width="2" stroke="#000" xmlns="http://www.w3.org/2000/svg" class="icon"><g><title></title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-heart "><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"></path></svg></g></svg><div class="label">8</div></a><div inert role="dialog" class="modal typography out gone share-dialog popup"><div class="modal-table"><div class="modal-row"><div class="modal-cell modal-content no-fullscreen"><div class="container"><button tabIndex="0" type="button" data-testid="close-modal" class="pencraft pc-reset pencraft modal-btn modal-exit-btn no-margin _iconButton_1wz1m_145 _iconButtonBase_1wz1m_145 _buttonBase_1wz1m_1 _buttonOldColors_1wz1m_56 _size_40_1wz1m_175 _priority_secondary_1wz1m_63 _fill_empty_1wz1m_316 _rounded_1wz1m_155"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="secondary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x "><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg></button><div class="share-dialog-title">Share this post</div><div class="pencraft pc-display-flex pc-flexDirection-column pc-gap-32 pc-paddingLeft-24 pc-paddingRight-24 pc-paddingTop-32 pc-paddingBottom-48 pc-reset"><div class="pencraft pc-display-flex pc-padding-8 pc-reset _border-detail_100yf_25 pc-borderRadius-md social-preview-box post"><div class="social-image-box"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_120,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc1d3a7a5-e2cc-4778-bafe-03f87e6a6884_1600x671.png" /><img src="https://substackcdn.com/image/fetch/w_120,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc1d3a7a5-e2cc-4778-bafe-03f87e6a6884_1600x671.png" sizes="100vw" alt width="120" loading="lazy" class="_img_16u6n_1 social-image pencraft pc-reset" /></picture></div><div class="pencraft pc-display-flex pc-flexDirection-column pc-paddingTop-8 pc-paddingBottom-8 pc-paddingLeft-12 pc-reset"><h4 class="pencraft pc-reset _line-height-24_1k90y_98 _font-display_1k90y_118 _size-20_1k90y_70 _weight-bold_1k90y_168 _reset_1k90y_1">MapReduce from Scratch</h4><div class="pencraft pc-reset _color-secondary_1k90y_186 _line-height-20_1k90y_95 _font-text_1k90y_121 _size-13_1k90y_45 _weight-regular_1k90y_159 _reset_1k90y_1">michalpitr.substack.com</div></div></div><div class="pencraft pc-display-flex pc-gap-8 pc-justifyContent-space-between pc-reset share-dialog-buttons-wrapper"><button tabIndex="0" type="button" class="button share-action"><div class="action-icon"><svg role="img" width="20" height="16" viewBox="0 0 20 16" fill="none" stroke-width="1.8" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><path fill-rule="evenodd" clip-rule="evenodd" d="M12.1303 0.000379039C10.9833 -0.00959082 9.87819 0.431464 9.05309 1.22855L9.04556 1.23593L7.79145 2.48303C7.50587 2.767 7.50453 3.22877 7.78844 3.51441C8.07235 3.80004 8.53401 3.80139 8.81959 3.51741L10.0698 2.27423C10.6194 1.74503 11.3546 1.45229 12.1177 1.45892C12.8824 1.46556 13.6139 1.77236 14.1546 2.31323C14.6954 2.8541 15.0021 3.58577 15.0087 4.35065C15.0154 5.11353 14.7229 5.84857 14.1943 6.39829L12.0116 8.58145L12.0115 8.58155C11.7159 8.87739 11.36 9.10617 10.9682 9.25237C10.5764 9.39857 10.1577 9.45878 9.74051 9.42889C9.32337 9.39901 8.91752 9.27975 8.55051 9.07918C8.1835 8.87862 7.8639 8.60146 7.6134 8.26649C7.3722 7.94396 6.91526 7.87807 6.5928 8.11933C6.27034 8.36059 6.20447 8.81763 6.44567 9.14016C6.82142 9.64261 7.30082 10.0584 7.85134 10.3592C8.40186 10.66 9.01062 10.8389 9.63634 10.8838C10.2621 10.9286 10.8901 10.8383 11.4779 10.619C12.0656 10.3997 12.5994 10.0565 13.0429 9.61274L15.2302 7.42494L15.2391 7.4159C16.036 6.59062 16.4769 5.48529 16.467 4.33797C16.457 3.19066 15.9969 2.09316 15.1858 1.28185C14.3746 0.470545 13.2774 0.0103489 12.1303 0.000379039ZM7.29806 5.11625C6.67234 5.07142 6.0443 5.16173 5.45654 5.38103C4.86882 5.60031 4.33502 5.94355 3.89153 6.38727L1.70423 8.57506L1.69534 8.5841C0.898438 9.40939 0.457483 10.5147 0.467451 11.662C0.477418 12.8094 0.937512 13.9069 1.74864 14.7182C2.55976 15.5295 3.65701 15.9897 4.80407 15.9996C5.95113 16.0096 7.05622 15.5685 7.88132 14.7715L7.89035 14.7626L9.13717 13.5155C9.42192 13.2307 9.42192 12.7689 9.13717 12.4841C8.85243 12.1993 8.39077 12.1993 8.10602 12.4841L6.86392 13.7265C6.31432 14.2552 5.57945 14.5477 4.81675 14.5411C4.05204 14.5344 3.32054 14.2276 2.77979 13.6868C2.23904 13.1459 1.93231 12.4142 1.92566 11.6494C1.91904 10.8865 2.21146 10.1514 2.74011 9.60172L4.92287 7.41846C5.21854 7.12262 5.57437 6.89384 5.96621 6.74763C6.35805 6.60143 6.77674 6.54123 7.19389 6.57111C7.61104 6.601 8.01688 6.72026 8.38389 6.92082C8.75091 7.12138 9.0705 7.39855 9.32101 7.73352C9.56221 8.05605 10.0191 8.12194 10.3416 7.88068C10.6641 7.63942 10.7299 7.18238 10.4887 6.85985C10.113 6.3574 9.63359 5.94165 9.08307 5.64081C8.53255 5.33997 7.92378 5.16107 7.29806 5.11625Z"></path></g></svg></div><div translated class="pencraft pc-reset _color-secondary_1k90y_186 _line-height-20_1k90y_95 _font-text_1k90y_121 _size-13_1k90y_45 _weight-regular_1k90y_159 _reset_1k90y_1">Copy link</div></button><button tabIndex="0" type="button" class="button share-action"><div class="action-icon"><svg role="img" width="16" height="17" viewBox="0 0 16 17" fill="none" stroke-width="1.8" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><path d="M10.6543 1.38723C10.3533 0.960814 9.95383 0.61341 9.48976 0.374567C9.02902 0.137956 8.51908 0.0130716 8.00115 0.0100098C7.86087 0.0101844 7.72354 0.0502687 7.60519 0.125581C7.48684 0.200893 7.39237 0.308324 7.3328 0.435326L5.00368 5.67077H3.029C2.72335 5.66964 2.42059 5.73003 2.13876 5.84833C1.85692 5.96663 1.60177 6.14043 1.38849 6.35938C1.16707 6.57502 0.991841 6.83346 0.873459 7.11897C0.755078 7.40447 0.696022 7.71108 0.699885 8.02014V13.691C0.699885 14.3087 0.945273 14.9012 1.38207 15.338C1.81886 15.7747 2.41128 16.0201 3.029 16.0201H13.348C13.8951 16.021 14.425 15.8283 14.8438 15.4762C15.2626 15.1241 15.5434 14.6352 15.6366 14.0961L16.6493 8.4252C16.7252 8.09192 16.7252 7.74582 16.6493 7.41254C16.566 7.08205 16.4104 6.7742 16.1936 6.51128C15.9746 6.25 15.7017 6.03926 15.3936 5.89355C15.0762 5.7467 14.7306 5.67068 14.3809 5.67077H10.5328L11.0391 4.37457C11.2397 3.88784 11.3162 3.35894 11.2619 2.83533C11.1853 2.30894 10.9763 1.81065 10.6543 1.38723ZM4.75052 14.5518H3.029C2.91049 14.5525 2.79303 14.5296 2.68349 14.4844C2.57394 14.4392 2.47452 14.3726 2.39102 14.2885C2.23609 14.1199 2.14945 13.8997 2.14799 13.6708V8.02014C2.14913 7.901 2.17389 7.78328 2.22082 7.67377C2.26775 7.56427 2.33592 7.46515 2.4214 7.38216C2.50369 7.29576 2.60267 7.22698 2.71233 7.17998C2.822 7.13298 2.94007 7.10874 3.05938 7.10874H4.7809L4.75052 14.5518ZM10.6746 7.05811H14.3809C14.5145 7.05821 14.6462 7.08942 14.7657 7.14925C14.8875 7.20532 14.9948 7.28845 15.0796 7.39229C15.1675 7.49052 15.2301 7.60871 15.2619 7.73659C15.2922 7.8665 15.2922 8.00162 15.2619 8.13153L14.2493 13.8024C14.2087 14.017 14.094 14.2106 13.9252 14.3492C13.7619 14.4812 13.558 14.5528 13.348 14.5518H6.19862V6.45052L8.43659 1.38723H8.52773C8.9042 1.50037 9.23304 1.73413 9.4636 2.05252C9.69416 2.37092 9.81365 2.75627 9.80368 3.14925C9.8181 3.39741 9.78015 3.64583 9.69229 3.87836L9.23659 5.04292C9.15397 5.273 9.12623 5.51921 9.15558 5.76191C9.1877 6.00427 9.27425 6.23623 9.40875 6.44039C9.5535 6.6376 9.74028 6.80017 9.95558 6.91634C10.1774 7.03206 10.4244 7.0912 10.6746 7.08849V7.05811Z"></path></g></svg></div><div translated class="pencraft pc-reset _color-secondary_1k90y_186 _line-height-20_1k90y_95 _font-text_1k90y_121 _size-13_1k90y_45 _weight-regular_1k90y_159 _reset_1k90y_1">Facebook</div></button><button tabIndex="0" type="button" class="button share-action"><div class="action-icon"><svg role="img" width="21" height="16" viewBox="0 0 21 16" fill="none" stroke-width="1.8" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><path fill-rule="evenodd" clip-rule="evenodd" d="M2.22192 2.20503C2.36754 1.77115 2.78269 1.45455 3.26639 1.45455H17.9332C18.4169 1.45455 18.8321 1.77118 18.9777 2.2051L10.5999 8.02107L2.22192 2.20503ZM2.16639 3.94198V13.4545C2.16639 14.0529 2.66307 14.5455 3.26639 14.5455H17.9332C18.5365 14.5455 19.0332 14.0529 19.0332 13.4545V3.94206L11.0204 9.50462C10.7679 9.67991 10.4318 9.67991 10.1793 9.50462L2.16639 3.94198ZM20.4999 2.55809V13.4545C20.4999 14.8562 19.3465 16 17.9332 16H3.26639C1.85304 16 0.699707 14.8562 0.699707 13.4545V2.54545C0.699707 1.14379 1.85304 0 3.26639 0H17.9332C19.3407 0 20.4904 1.13441 20.4998 2.52818C20.5 2.53816 20.5001 2.54813 20.4999 2.55809Z"></path></g></svg></div><div translated class="pencraft pc-reset _color-secondary_1k90y_186 _line-height-20_1k90y_95 _font-text_1k90y_121 _size-13_1k90y_45 _weight-regular_1k90y_159 _reset_1k90y_1">Email</div></button><button tabIndex="0" type="button" class="button share-action"><div class="action-icon"><svg role="img" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><path d="M6.785 1.92766C5.45134 1.57031 4.08049 2.36176 3.72314 3.69543L0.444815 15.9303C0.0874636 17.264 0.878901 18.6348 2.21255 18.9922L5.37495 19.8396V7.66664C5.37495 6.40099 6.40096 5.37498 7.66661 5.37498H19.4723C19.3299 5.30548 19.1788 5.24858 19.0201 5.20604L6.785 1.92766Z" stroke="none"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M8.44161 7.4C7.86632 7.4 7.39995 7.86637 7.39995 8.44167V22.1081C7.39995 22.6834 7.86631 23.1498 8.4416 23.1498L22.1083 23.15C22.6836 23.15 23.1499 22.6836 23.1499 22.1083V8.44167C23.1499 7.86637 22.6836 7.4 22.1083 7.4H8.44161ZM10.3999 9.65C9.84766 9.65 9.39995 10.0977 9.39995 10.65C9.39995 11.2023 9.84766 11.65 10.3999 11.65H18.3999C18.9522 11.65 19.3999 11.2023 19.3999 10.65C19.3999 10.0977 18.9522 9.65 18.3999 9.65H10.3999ZM10.3999 14.15C9.84766 14.15 9.39995 14.5977 9.39995 15.15C9.39995 15.7023 9.84766 16.15 10.3999 16.15H15.3999C15.9522 16.15 16.3999 15.7023 16.3999 15.15C16.3999 14.5977 15.9522 14.15 15.3999 14.15H10.3999Z" stroke="none"></path></g></svg></div><div class="pencraft pc-reset _color-secondary_1k90y_186 _line-height-20_1k90y_95 _font-text_1k90y_121 _size-13_1k90y_45 _weight-regular_1k90y_159 _reset_1k90y_1">Note</div></button><button tabIndex="0" id="trigger40407" aria-expanded="false" aria-haspopup="dialog" aria-controls="dialog40408" ariaLabel="View more" type="button" class="button share-action"><div class="action-icon"><svg role="img" width="100" height="100" viewBox="0 0 100 100" fill="none" stroke-width="1.8" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><circle cx="23" cy="50" r="9"></circle><circle cx="50" cy="50" r="9"></circle><circle cx="77" cy="50" r="9"></circle></g></svg></div><div translated class="pencraft pc-reset _color-secondary_1k90y_186 _line-height-20_1k90y_95 _font-text_1k90y_121 _size-13_1k90y_45 _weight-regular_1k90y_159 _reset_1k90y_1">Other</div></button></div></div></div></div></div></div></div></div><a role="button" href="https://michalpitr.substack.com/p/mapreduce-from-scratch/comments" class="post-ufi-button style-button post-ufi-comment-button no-label with-border"><svg role="img" style="height: 20px; width: 20px;" width="20" height="20" viewBox="0 0 24 24" fill="#000000" stroke-width="2" stroke="#000" xmlns="http://www.w3.org/2000/svg" class="icon"><g><title></title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-circle "><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"></path></svg></g></svg></a></div><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><a role="button" href="javascript:void(0)" class="post-ufi-button style-button no-icon has-label with-border"><div class="label">Share</div></a></div></div></div></div><div class="visibility-check"></div><div class class><div class="available-content"><div dir="auto" class="body markup"><p>Over the last couple of weeks, I’ve been building MapReduce from scratch. </p><p>This will be a long article: we’ll understand the need for distributed computing, rediscover why MapReduce is a natural way to model many problems, build our own version, understand how individual parts fit together, and solve a real problem with it!</p><h2 class="header-with-anchor-widget">Motivating the problem<div id="§motivating-the-problem" class="header-anchor-widget offset-top"><div class="header-anchor-widget-button-container"><div href="https://michalpitr.substack.com/i/144104758/motivating-the-problem" class="header-anchor-widget-button"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="header-anchor-widget-icon"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></div></div></div></h2><p><span>Suppose we want to count the word frequencies in a massive dataset. We tried to process it on a single machine but found it would take over a month. What can we do?</span><br /><br /><span>The first thought should be to get a faster machine, but it either might not exist or be too expensive. Instead, let’s see how we can distribute the problem across N commodity machines. We want an easy way to look up the frequency of any word with a simple query, i.e. grep over a file.</span><br /><br /><span>Let’s start by splitting the dataset into N partitions and computing word frequencies for each subset using a different machine. This already gives us Nx speedup minus some fixed overhead. To combine the results, we can add a final machine that takes these N partial result files and sums the frequencies of corresponding words.</span><br /><br /><span>This is not too far from the core idea behind MapReduce. The above process has two main steps: first, we</span><em> map</em><span> words to their frequency in a subset of input data and then </span><em>reduce</em><span> the intermediate results to obtain the final answer. </span></p><p><span>Note that this is pretty general, imagine we have a large dataset of photos that we want to classify: we could do the image classification task as a map operation and then group images with the same class in the reduce phase.</span><br /><br /><span>Another observation is that the map part is usually the more expensive phase of the two, so generally, we will have more mappers than reducers.</span></p><p>Having hopefully convinced you that MapReduce is a reasonable idea, let’s see how the MapReduce paper solves the word frequency problem.</p><div class="subscription-widget-wrap"><div class="subscription-widget show-subscribe"><div class="preamble"><p>Thanks for reading Michal’s Substack! Subscribe for free to receive new posts and support my work.</p></div><div data-component-name="SubscribeWidget" class="subscribe-widget"><div class="pencraft pc-display-flex pc-justifyContent-center pc-reset"><div class="_container_1mxvn_1"><form action="/api/v1/free?nojs=true" method="post" noValidate class="form _form_1mxvn_6"><input type="hidden" name="first_url" /><input type="hidden" name="first_referrer" /><input type="hidden" name="current_url" /><input type="hidden" name="current_referrer" /><input type="hidden" name="referral_code" /><input type="hidden" name="source" value="subscribe-widget-preamble" /><input type="hidden" name="referring_pub_id" /><input type="hidden" name="additional_referring_pub_ids" /><div class="_sideBySideWrap_1mxvn_10"><div class="_emailInputWrapper_1mxvn_57"><input type="email" name="email" placeholder="Type your email..." class="pencraft _emailInput_1mxvn_23" /></div><button tabIndex="0" type="submit" class="button rightButton primary subscribe-btn _button_1mxvn_76"><span class="button-text ">Subscribe</span></button></div><div id="error-container"></div></form></div></div></div></div></div><h2 class="header-with-anchor-widget">Using MapReduce<div id="§using-mapreduce" class="header-anchor-widget offset-top"><div class="header-anchor-widget-button-container"><div href="https://michalpitr.substack.com/i/144104758/using-mapreduce" class="header-anchor-widget-button"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="header-anchor-widget-icon"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></div></div></div></h2><p><span>Below, I copy-pasted the WordCounter MapReduce program from the </span><a href="https://static.googleusercontent.com/media/research.google.com/en//archive/mapreduce-osdi04.pdf" rel>paper</a><span>. Let’s see how it works. Later, when we implement our version, we’ll aim to keep the usage semantics the same.</span></p><pre><code>#include &quot;mapreduce/mapreduce.h&quot;

// User’s map function
class WordCounter : public Mapper
{
public:
    virtual void Map(const MapInput &amp;input)
    {
        const string &amp;text = input.value();
        const int n = text.size();
        for (int i = 0; i &lt; n;)
        {
            // Skip past leading whitespace
            while ((i &lt; n) &amp;&amp; isspace(text[i]))
                i++;
            // Find word end
            int start = i;
            while ((i &lt; n) &amp;&amp; !isspace(text[i]))
                i++;
            if (start &lt; i)
                Emit(text.substr(start, i - start), &quot;1&quot;);
        }
    }
};
REGISTER_MAPPER(WordCounter);

// User’s reduce function
class Adder : public Reducer
{
    virtual void Reduce(ReduceInput *input)
    {
        // Iterate over all entries with the
        // same key and add the values
        int64 value = 0;
        while (!input-&gt;done())
        {
            value += StringToInt(input-&gt;value());
            input-&gt;NextValue();
        }
        // Emit sum for input-&gt;key()
        Emit(IntToString(value));
    }
};
REGISTER_REDUCER(Adder);

int main(int argc, char **argv)
{
    ParseCommandLineFlags(argc, argv);
    MapReduceSpecification spec;
    
    // Store list of input files into &quot;spec&quot;
    for (int i = 1; i &lt; argc; i++)
    {
        MapReduceInput *input = spec.add_input();
        input-&gt;set_format(&quot;text&quot;);
        input-&gt;set_filepattern(argv[i]);
        input-&gt;set_mapper_class(&quot;WordCounter&quot;);
    }
    
    MapReduceOutput *out = spec.output();
    out-&gt;set_filebase(&quot;/gfs/test/freq&quot;);
    out-&gt;set_num_tasks(100);
    out-&gt;set_format(&quot;text&quot;);
    out-&gt;set_reducer_class(&quot;Adder&quot;);
    
    // Tuning parameters: use at most 2000
    // machines and 100 MB of memory per task
    spec.set_machines(2000);
    spec.set_map_megabytes(100);
    spec.set_reduce_megabytes(100);
    
    // Now run it
    MapReduceResult result;
    if (!MapReduce(spec, &amp;result))
        abort();
    // Done: ’result’ structure contains info
    // about counters, time taken, number of
    // machines used, etc.
    return 0;
}</code></pre><p><span>The user program has 3 parts: map function, reduce function, and configuration. Most of the heavy lifting is handled by the imported </span><code>mapreduce</code><span> library.</span></p><p><span>The map function splits the input text into words and emits key-value pairs. For instance, </span><em>“the quick brown fox jumps over the lazy dog”</em><span> is mapped to these key-value pairs: [“the”:1, “quick”:1, “brown”:1, “fox”:1, “jumps”: 1, “over”:1, “the”:1, “lazy”:1, “dog”:1]. Notice that the pair (“the”: 1) is emitted twice.</span></p><p>The reduce function operates per key. For instance, given the input [“the”:1, “the”:1”, “the”:1] it would emit (“the”:3).</p><p>The config handles input-output, formats, and the number of resources available for the MapReduce job.</p><p>In less than 100 lines of code, we can solve the word counting problem by utilizing 1000s of machines! That’s pretty neat and shows how powerful of an abstraction MapReduce is.</p><h2 class="header-with-anchor-widget">Gathering requirements<div id="§gathering-requirements" class="header-anchor-widget offset-top"><div class="header-anchor-widget-button-container"><div href="https://michalpitr.substack.com/i/144104758/gathering-requirements" class="header-anchor-widget-button"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="header-anchor-widget-icon"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></div></div></div></h2><p>With the paper as our inspiration, let’s start outlining the requirements for our implementation:</p><ul><li><p>The user imports our MapReduce library, implements Map and Reduce functions, and provides configuration.</p></li><li><p>When a user executes the binary, it is copied to multiple machines where it executes in either Mapper or Reducer mode.</p></li><li><p>Those machines must have access to input data.</p></li><li><p>Outputs of mappers must be available to reducers.</p></li><li><p>The user can access the final results.</p></li></ul><h2 class="header-with-anchor-widget">Infrastructure<div id="§infrastructure" class="header-anchor-widget offset-top"><div class="header-anchor-widget-button-container"><div href="https://michalpitr.substack.com/i/144104758/infrastructure" class="header-anchor-widget-button"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="header-anchor-widget-icon"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></div></div></div></h2><p><span>When I started working on this, these requirements presented two main unknowns: </span><em>how to distribute the binary to other machines and how to make input data available to them.</em></p><p>After some research, I settled on hosting my input data on a networked storage server - I chose NFS. We can mount the networked directory on every machine and allow the machines to read and write to it. It won’t be as performant or scalable as Google File System or HDFS, but it will do for our purposes.</p><p>To distribute the binary to multiple machines, execute it, and monitor its status, we could probably get quite far by copying the binary via SCP, SSHing into machines, executing the binary, and then waiting for it to finish. We could even implement health-pinging and progress-reporting.</p><p><span>However, after twiddling my thumbs for a while, I realized that this sounds awfully like cluster orchestration and decided to leverage Kubernetes to make my life easier. We can build the binary as a docker image and execute it as Kubernetes </span><a href="https://kubernetes.io/docs/concepts/workloads/controllers/job/" rel>Jobs</a><span>. Integrating NFS with Kubernetes is easy enough via Persistent Volumes and Persistent Volume Claims. Don’t worry, you don’t need to understand these concepts, but I mention them for completeness.</span></p><p><span>Since I’m developing this for educational purposes, I use </span><a href="https://minikube.sigs.k8s.io/docs/start/" rel>minikube</a><span> to spin up a local virtual cluster on my laptop. I run my NFS server as a docker container outside the cluster and connect it to the cluster via docker networking. The advantage of this setup is that it can be easily migrated to several physical or virtual machines.</span></p><div class="captioned-image-container"><figure><a class="image-link is-viewable-img image2" target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa41a20ea-44f8-49c1-be92-e53ab9f17a2b_1304x747.png" data-component-name="Image2ToDOM" rel><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa41a20ea-44f8-49c1-be92-e53ab9f17a2b_1304x747.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa41a20ea-44f8-49c1-be92-e53ab9f17a2b_1304x747.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa41a20ea-44f8-49c1-be92-e53ab9f17a2b_1304x747.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa41a20ea-44f8-49c1-be92-e53ab9f17a2b_1304x747.png 1456w" sizes="100vw" /><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa41a20ea-44f8-49c1-be92-e53ab9f17a2b_1304x747.png" width="1304" height="747" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/a41a20ea-44f8-49c1-be92-e53ab9f17a2b_1304x747.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:747,&quot;width&quot;:1304,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:null,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:null,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" class="sizing-normal" alt srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa41a20ea-44f8-49c1-be92-e53ab9f17a2b_1304x747.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa41a20ea-44f8-49c1-be92-e53ab9f17a2b_1304x747.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa41a20ea-44f8-49c1-be92-e53ab9f17a2b_1304x747.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa41a20ea-44f8-49c1-be92-e53ab9f17a2b_1304x747.png 1456w" sizes="100vw" loading="lazy" /></picture><div class="image-link-expand"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 "><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></a><figcaption class="image-caption">Infrastructure setup</figcaption></figure></div><p>With infrastructure sorted out, let’s start writing our MapReduce framework!</p><h2 class="header-with-anchor-widget">Using my MapReduce<div id="§using-my-mapreduce" class="header-anchor-widget offset-top"><div class="header-anchor-widget-button-container"><div href="https://michalpitr.substack.com/i/144104758/using-my-mapreduce" class="header-anchor-widget-button"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="header-anchor-widget-icon"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></div></div></div></h2><p>First, we’ll explore how to solve the word-counting problem using my MapReduce implementation. Then, we’ll deep dive into the implementation to understand how individual components function.</p><p>As promised, I tried to keep the usage semantics similar to the original paper. Compare this MapReduce program using my Go implementation against the C++ example we saw before! </p><pre><code>// main.go

import (
  …

  &quot;github.com/MichalPitr/map_reduce/pkg/config&quot;
  &quot;github.com/MichalPitr/map_reduce/pkg/interfaces&quot;
  &quot;github.com/MichalPitr/map_reduce/pkg/mapreduce&quot;
)

type WordCounter struct {
  wordRegex *regexp.Regexp
}

func (wc *WordCounter) Map(input interfaces.MapInput, emit func(key, value string)) {
  text := input.Value()
  text = strings.ToLower(text)
  words := wc.wordRegex.FindAllString(text, -1)
  for _, word := range words {
    emit(word, &quot;1&quot;)
  }
}

type Adder struct{}

func (a *Adder) Reduce(input interfaces.ReducerInput, emit func(value string)) {
  val := 0
  for !input.Done() {
    num, err := strconv.Atoi(input.Value())
    if err != nil {
      log.Printf(&quot;Failed converting input to integer, skipping: %q&quot;, input.Value())
      input.NextValue()
      continue
    }
  val += num
  input.NextValue()
  }
  emit(strconv.Itoa(val))
}

func main() {
  cfg := config.SetupJobConfig()
  log.Printf(&quot;cfg: %+v&quot;, cfg)
  cfg.NumReducers = 2
  cfg.NumMappers = 4


  cfg.Mapper = &amp;WordCounter{wordRegex: regexp.MustCompile(`\b\w+\b`)}
  cfg.Reducer = &amp;Adder{}

  mapreduce.Execute(cfg)
}</code></pre><p>Let’s spend some time understanding how my solution works behind the scenes. We can reference a handy diagram from the paper illustrating this. </p><p><span>The user’s program is executed in three modes, Master, Mapper, and Reducer, on different machines. At a high level, the master handles the entire job orchestration, mappers do the expensive map operation over input files, and reducers combine intermediate results from mappers. In my solution, the mode is determined by a CLI flag, e.g. </span><code>--mode=master</code><span> for master mode. </span></p><div class="captioned-image-container"><figure><a class="image-link is-viewable-img image2" target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F96d2f911-95ac-4428-9afe-6d1b0e25340b_818x644.png" data-component-name="Image2ToDOM" rel><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F96d2f911-95ac-4428-9afe-6d1b0e25340b_818x644.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F96d2f911-95ac-4428-9afe-6d1b0e25340b_818x644.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F96d2f911-95ac-4428-9afe-6d1b0e25340b_818x644.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F96d2f911-95ac-4428-9afe-6d1b0e25340b_818x644.png 1456w" sizes="100vw" /><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F96d2f911-95ac-4428-9afe-6d1b0e25340b_818x644.png" width="728" height="573.1442542787286" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/96d2f911-95ac-4428-9afe-6d1b0e25340b_818x644.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:false,&quot;imageSize&quot;:&quot;normal&quot;,&quot;height&quot;:644,&quot;width&quot;:818,&quot;resizeWidth&quot;:728,&quot;bytes&quot;:null,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:null,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" class="sizing-normal" alt srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F96d2f911-95ac-4428-9afe-6d1b0e25340b_818x644.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F96d2f911-95ac-4428-9afe-6d1b0e25340b_818x644.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F96d2f911-95ac-4428-9afe-6d1b0e25340b_818x644.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F96d2f911-95ac-4428-9afe-6d1b0e25340b_818x644.png 1456w" sizes="100vw" loading="lazy" /></picture><div class="image-link-expand"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 "><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></a><figcaption class="image-caption"></figcaption></figure></div><h2 class="header-with-anchor-widget">Master<div id="§master" class="header-anchor-widget offset-top"><div class="header-anchor-widget-button-container"><div href="https://michalpitr.substack.com/i/144104758/master" class="header-anchor-widget-button"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="header-anchor-widget-icon"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></div></div></div></h2><p>Master mode splits input files into subsets, prepares NFS directories, launches mapper jobs with assigned files, and waits for them to finish. Then it repeats the process for reducers. The main master function is simple enough that I can list it here:</p><pre><code>// /pkg/master/master.go

func Run(cfg *config.Config) {
  clientset := createKubernetesClient()
  numNodes := getNumberOfNodes(clientset)
  mustValidateConfig(cfg, numNodes)

  jobId := fmt.Sprintf(&quot;job-%s&quot;, time.Now().Format(&quot;2006-01-02-15-04-05&quot;))
  log.Printf(&quot;Running master: %s&quot;, jobId)
	
  mustCreateJobDir(cfg.NfsPath, jobId)
  fileRanges := partitionInputFiles(cfg.InputDir, cfg.NumMappers)

  t0 := time.Now()
  launchMappers(cfg, clientset, jobId, fileRanges)
  waitForJobsToComplete(clientset, jobId, &quot;mapper&quot;)
  log.Printf(&quot;Mappers took %v to finish&quot;, time.Since(t0))

  t1 := time.Now()
  launchReducers(cfg, clientset, jobId)
  waitForJobsToComplete(clientset, jobId, &quot;reducer&quot;)
  log.Printf(&quot;Reducers took %v to finish&quot;, time.Since(t1))
  log.Printf(&quot;Total runtime: %v&quot;, time.Since(t0))
}</code></pre><p><span>Let’s understand the </span><code>launchMappers</code><span> function. It creates a Kubernetes job for each mapper. The job spec specifies:</span></p><ul><li><p>Docker image containing our binary.</p></li><li><p>CLI arguments necessary for the mapper: mapper mode, input/output dirs, and files to process.</p></li><li><p>How to mount the NFS storage.</p></li></ul><p>Wait…Docker image? We never created one! I’ll show this in more detail when we finally run our solution, but Kubernetes revolves around containers so we dockerize our binary so that Kubernetes pods can download the binary.</p><p>After launchMappers creates a mapper job, Kubernetes assigns jobs to nodes within the cluster, starts the containers, and monitors their status.</p><p>Now that we can run mappers, it’s time to learn how they work!</p><h2 class="header-with-anchor-widget">Mappers<div id="§mappers" class="header-anchor-widget offset-top"><div class="header-anchor-widget-button-container"><div href="https://michalpitr.substack.com/i/144104758/mappers" class="header-anchor-widget-button"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="header-anchor-widget-icon"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></div></div></div></h2><p>In mapper mode, the binary scans input files line-by-line and passes the line to the user’s map function. Map processes the text and emits key-value pairs using the injected emit function. </p><p>In my implementation, the emit function is super simple - it stores the key-value pairs in a map of dynamic lists. A more complete implementation would do some buffering and then flush the buffer to the disk.</p><p>When the mapper finishes processing all inputs, it saves sorted key-value pairs to intermediate files in the NFS storage from where reducers will later read them for the final processing. Let’s zoom out here and see how this mapping from intermediate files to reducers works.</p><div class="captioned-image-container"><figure><a class="image-link is-viewable-img image2" target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0e7b17a6-a26c-4f89-9611-020b2b68bbd1_1600x648.png" data-component-name="Image2ToDOM" rel><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0e7b17a6-a26c-4f89-9611-020b2b68bbd1_1600x648.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0e7b17a6-a26c-4f89-9611-020b2b68bbd1_1600x648.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0e7b17a6-a26c-4f89-9611-020b2b68bbd1_1600x648.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0e7b17a6-a26c-4f89-9611-020b2b68bbd1_1600x648.png 1456w" sizes="100vw" /><img src="https://substackcdn.com/image/fetch/w_2400,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0e7b17a6-a26c-4f89-9611-020b2b68bbd1_1600x648.png" width="1020" height="413.3241758241758" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/0e7b17a6-a26c-4f89-9611-020b2b68bbd1_1600x648.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:false,&quot;imageSize&quot;:&quot;large&quot;,&quot;height&quot;:590,&quot;width&quot;:1456,&quot;resizeWidth&quot;:1020,&quot;bytes&quot;:null,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:null,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" class="sizing-large" alt srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0e7b17a6-a26c-4f89-9611-020b2b68bbd1_1600x648.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0e7b17a6-a26c-4f89-9611-020b2b68bbd1_1600x648.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0e7b17a6-a26c-4f89-9611-020b2b68bbd1_1600x648.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0e7b17a6-a26c-4f89-9611-020b2b68bbd1_1600x648.png 1456w" sizes="100vw" loading="lazy" /></picture><div class="image-link-expand"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 "><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></a></figure></div><p><span>We want to partition the intermediate files by keys such that all the same keys are processed by one reducer. For instance, “</span><em>brown”</em><span> and </span><em>“the”</em><span> appear in Mapper 1 and Mapper 2 intermediate files. We want to ensure each ends up being processed by the same reducer. Let’s see an example.</span></p><div class="captioned-image-container"><figure><a class="image-link is-viewable-img image2" target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc1d3a7a5-e2cc-4778-bafe-03f87e6a6884_1600x671.png" data-component-name="Image2ToDOM" rel><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc1d3a7a5-e2cc-4778-bafe-03f87e6a6884_1600x671.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc1d3a7a5-e2cc-4778-bafe-03f87e6a6884_1600x671.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc1d3a7a5-e2cc-4778-bafe-03f87e6a6884_1600x671.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc1d3a7a5-e2cc-4778-bafe-03f87e6a6884_1600x671.png 1456w" sizes="100vw" /><img src="https://substackcdn.com/image/fetch/w_2400,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc1d3a7a5-e2cc-4778-bafe-03f87e6a6884_1600x671.png" width="1036" height="434.75" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/c1d3a7a5-e2cc-4778-bafe-03f87e6a6884_1600x671.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:false,&quot;imageSize&quot;:&quot;large&quot;,&quot;height&quot;:611,&quot;width&quot;:1456,&quot;resizeWidth&quot;:1036,&quot;bytes&quot;:null,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:null,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" class="sizing-large" alt srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc1d3a7a5-e2cc-4778-bafe-03f87e6a6884_1600x671.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc1d3a7a5-e2cc-4778-bafe-03f87e6a6884_1600x671.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc1d3a7a5-e2cc-4778-bafe-03f87e6a6884_1600x671.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc1d3a7a5-e2cc-4778-bafe-03f87e6a6884_1600x671.png 1456w" sizes="100vw" loading="lazy" /></picture><div class="image-link-expand"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 "><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></a></figure></div><p>To achieve this, when we save intermediate results from mappers, we partition the keys by the number of reducers R using the formula</p><div data-component-name="Latex" class="pencraft pc-display-flex pc-paddingTop-4px pc-paddingBottom-4px pc-justifyContent-center _flexGrow_100yf_227 pc-reset latex-rendered"><div class="pencraft pc-display-flex pc-flexDirection-column pc-justifyContent-center pc-reset"><span style="display: block;">\(\text{hash}(\text{key}) \text{ mod} \text{ R}.\)</span></div></div><p>For instance, using FNV hash and R = 2, we get</p><div data-component-name="Latex" class="pencraft pc-display-flex pc-paddingTop-4px pc-paddingBottom-4px pc-justifyContent-center _flexGrow_100yf_227 pc-reset latex-rendered"><div class="pencraft pc-display-flex pc-flexDirection-column pc-justifyContent-center pc-reset"><span style="display: block;">\(1 \equiv \text{FNV}(\textit{brown}) \text{ mod } 2 \)</span></div></div><p><span>(maths note: this reads as “1 is congruent to FNV(</span><em>brown</em><span>) mod 2”.)</span></p><p><span>Based on this, we assign </span><em>“brown”</em><span> to the 2nd intermediate file, which is to be processed by reducer 2. Notice how in the example above, all </span><em>“the”</em><span>s landed in the blue files, while all the </span><em>“brown”</em><span>s landed in the red files!</span></p><p>This concludes the discussion on mappers - next, let’s see how reducers work.</p><h2 class="header-with-anchor-widget">Reducers<div id="§reducers" class="header-anchor-widget offset-top"><div class="header-anchor-widget-button-container"><div href="https://michalpitr.substack.com/i/144104758/reducers" class="header-anchor-widget-button"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="header-anchor-widget-icon"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></div></div></div></h2><p>As highlighted previously, the reducer’s job is to read key-value pairs from the assigned intermediate files and process them using the user-defined reduce function. </p><p><span>We can be certain of two things: the keys in intermediate files are sorted by key and if a key </span><strong>A</strong><span> is present in one of these intermediate files, we are guaranteed that key </span><strong>A</strong><span> is not present in any file assigned to other reducers.</span></p><p>I tried to be smarter about my reducer implementation and avoid loading all intermediate files into memory. This comes with an interesting algorithmic problem:</p><p>Suppose we are trying to process 3 intermediate files, key-value pair at a time without loading everything into memory.</p><div class="captioned-image-container"><figure><a class="image-link is-viewable-img image2" target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4a4c593-bd86-4471-9263-3fff6eadd11e_1076x998.png" data-component-name="Image2ToDOM" rel><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4a4c593-bd86-4471-9263-3fff6eadd11e_1076x998.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4a4c593-bd86-4471-9263-3fff6eadd11e_1076x998.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4a4c593-bd86-4471-9263-3fff6eadd11e_1076x998.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4a4c593-bd86-4471-9263-3fff6eadd11e_1076x998.png 1456w" sizes="100vw" /><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4a4c593-bd86-4471-9263-3fff6eadd11e_1076x998.png" width="552" height="511.98513011152414" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/f4a4c593-bd86-4471-9263-3fff6eadd11e_1076x998.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:998,&quot;width&quot;:1076,&quot;resizeWidth&quot;:552,&quot;bytes&quot;:null,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:null,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}" class="sizing-normal" alt srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4a4c593-bd86-4471-9263-3fff6eadd11e_1076x998.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4a4c593-bd86-4471-9263-3fff6eadd11e_1076x998.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4a4c593-bd86-4471-9263-3fff6eadd11e_1076x998.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4a4c593-bd86-4471-9263-3fff6eadd11e_1076x998.png 1456w" sizes="100vw" loading="lazy" /></picture><div class="image-link-expand"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 "><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></a></figure></div><p><span>We can merge the key-value pairs on the fly using a min-heap! We load the first key-value pair from each file into the heap. Whenever we pop from the heap, we read the next line from the corresponding file and push it onto the heap. This gives us a memory-efficient way to read a stream of key-value pairs! You can find the implementation </span><a href="https://github.com/MichalPitr/map_reduce/blob/main/pkg/reducer/stream_merger.go" rel>here</a><span>. </span></p><p>After processing all intermediate files, the reducer saves results to the NFS storage.</p><p>For instance, the above example would yield: [“abby”: 1, “alice”: 3, “bob”: 2, “car”:2, “dog”:1, …].</p><p>The MapReduce paper introduces a couple of additional optimizations that I skipped in my implementation. Astute readers can probably come up with some already - for instance, couldn’t we optionally do some reduction already on the mapper?</p><p><span>Congratulations, you now have a pretty complete understanding of MapReduce! The hard part is over! Let’s put it together and count the word frequencies in the top </span><a href="https://www.gutenberg.org/browse/scores/top#authors-last30" rel>100 most popular books on Project Gutenberg</a><span> using our MapReduce!</span></p><h2 class="header-with-anchor-widget">MapReduce in action<div id="§mapreduce-in-action" class="header-anchor-widget offset-top"><div class="header-anchor-widget-button-container"><div href="https://michalpitr.substack.com/i/144104758/mapreduce-in-action" class="header-anchor-widget-button"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="header-anchor-widget-icon"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></div></div></div></h2><p><span>I downloaded the 100 most popular books on Project Gutenberg to </span><code>/mnt/nfs/input/</code><span> with this </span><a href="https://github.com/MichalPitr/map_reduce/blob/main/utils/create-dataset.py" rel>script</a><span>. The book files are labeled </span><em>book-0</em><span> to </span><em>book-99</em><span>. I also created a 4-node minikube cluster with access to my NFS storage.</span></p><pre><code>michal@michal-ThinkPad-T490s:/mnt/nfs$ kubectl get nodes
NAME            STATUS   ROLES           AGE    VERSION
multinode       Ready    control-plane   27d    v1.28.3
multinode-m02   Ready    &lt;none&gt;          7d2h   v1.28.3
multinode-m04   Ready    &lt;none&gt;          7d1h   v1.28.3
multinode-m05   Ready    &lt;none&gt;          7d1h   v1.28.3</code></pre><p><span>I will be reusing the word-frequencies Go main file I showed earlier. We must prepare the docker image using this </span><a href="https://github.com/MichalPitr/map_reduce/blob/main/Dockerfile" rel>Dockerfile</a><span> and push it to my registry. The mapper and reducer nodes will pull this image to run our workloads.</span></p><pre><code>docker build -t michalpitr/mapreduce:latest .
docker push michalpitr/mapreduce:latest</code></pre><p>Now all we need to do is run the master locally!</p><pre><code>go build .
./map_reduce --mode=master --image=michalpitr/mapreduce:latest --input-dir /mnt/input/ --nfs-path /mnt/nfs/</code></pre><p>Let’s inspect the execution logs.</p><pre><code>michal@michal-ThinkPad-T490s:~/code/map_reduce$ ./map_reduce --mode=ma
ster --image=michalpitr/mapreduce:latest --input-dir /mnt/nfs/input/ -
-nfs-path /mnt/nfs/
2024/04/28 17:13:53 Running master job-2024-04-28-17-13-53
2024/04/28 17:13:53 Creating mapper-0 for book-0-30
2024/04/28 17:13:53 Creating mapper-1 for book-31-53
2024/04/28 17:13:53 Creating mapper-2 for book-54-76
2024/04/28 17:13:53 Creating mapper-3 for book-77-99
2024/04/28 17:13:53 Waiting for jobs to finish.
2024/04/28 17:14:03 Waiting for jobs to finish.
2024/04/28 17:14:13 Waiting for jobs to finish.
2024/04/28 17:14:23 All jobs completed.
2024/04/28 17:14:23 Mappers took 30.1843218s to finish
2024/04/28 17:14:23 Creating reducer-0
2024/04/28 17:14:23 Creating reducer-1
2024/04/28 17:14:23 Waiting for jobs to finish.
2024/04/28 17:14:33 All jobs completed.
2024/04/28 17:14:33 Reducers took 10.106014703s to finish
2024/04/28 17:14:33 Total runtime: 40.290376921s</code></pre><p><span>The whole job took 40s. We aren’t expecting anything crazy here, after all, I’m running this on an underpowered laptop and not a </span><em>real</em><span> cluster.</span></p><p>Let’s walk through this a little. The master creates 4 mappers, each with an assigned book range.</p><p><span>Using </span><code>kubectl</code><span>, we can see that the cluster is creating 4 containers. This is when the cluster pulls the image we pushed earlier!</span></p><pre><code>michal@michal-ThinkPad-T490s:/mnt/nfs$ kubectl get pods
NAME             READY   STATUS              RESTARTS   AGE
mapper-0-zgz24   0/1     ContainerCreating   0          11s
mapper-1-m824k   0/1     ContainerCreating   0          11s
mapper-2-ctqqt   0/1     ContainerCreating   0          11s
mapper-3-l2ddh   0/1     ContainerCreating   0          11s</code></pre><p>These don’t take very long to start running and to finish.</p><pre><code>michal@michal-ThinkPad-T490s:/mnt/nfs$ kubectl get pods
NAME             READY   STATUS      RESTARTS   AGE
mapper-0-zgz24   1/1     Running     0          18s
mapper-1-m824k   0/1     Completed   0          18s
mapper-2-ctqqt   0/1     Completed   0          18s
mapper-3-l2ddh   0/1     Completed   0          18s</code></pre><p>The master periodically polls the Kubernetes API server for the status of these jobs. Once they are all finished, it launches the reducers.</p><p>Before we go to reducers, let’s see the intermediate files produced by one of the mappers:</p><pre><code>michal@michal-ThinkPad-T490s:/mnt/nfs/job-2024-04-28-17-13-53/mapper-3$ ls
partition-0  partition-1</code></pre><p>Inspecting the end of partition-1 shows key-value pairs of a character from Dostoevsky’s Notes from Underground. So far so good!</p><pre><code>michal@michal-ThinkPad-T490s:/mnt/nfs/job-2024-04-28-17-13-53/mapper-3$ tail partition-1
zverkov,1
zverkov,1
zverkov,1
zverkov,1
zverkov,1
…</code></pre><p>Next, the master launches reducers,</p><pre><code>michal@michal-ThinkPad-T490s:/mnt/nfs$ kubectl get pods
NAME              READY   STATUS              RESTARTS   AGE
…
reducer-0-4xt58   0/1     ContainerCreating   0          2s
reducer-1-xvhfk   0/1     ContainerCreating   0          2s</code></pre><p>which swiftly finish.</p><pre><code>michal@michal-ThinkPad-T490s:/mnt/nfs$ kubectl get pods
NAME              READY   STATUS      RESTARTS   AGE
…
reducer-0-4xt58   0/1     Completed   0          7s
reducer-1-xvhfk   0/1     Completed   0          7s</code></pre><p>That’s it - we just computed word frequencies using our very own MapReduce framework! Let’s see what we can learn from the results!</p><p>I can see the output files in the root of the job folder:</p><pre><code>michal@michal-ThinkPad-T490s:/mnt/nfs/job-2024-04-28-17-13-53$ ls
…  reducer-0  reducer-1</code></pre><p>Let’s use grep to find the frequencies of some words.</p><pre><code>michal@michal-ThinkPad-T490s:/mnt/nfs/job-2024-04-28-17-13-53$ grep -w zverkov reducer-0 reducer-1
reducer-1:zverkov,112

michal@michal-ThinkPad-T490s:/mnt/nfs/job-2024-04-28-17-13-53$ grep -w the reducer-0 reducer-1
reducer-1:the,822175

michal@michal-ThinkPad-T490s:/mnt/nfs/job-2024-04-28-17-13-53$ grep -w mapreduce reducer-0 reducer-1
michal@michal-ThinkPad-T490s:/mnt/nfs/job-2024-04-28-17-13-53$ 

michal@michal-ThinkPad-T490s:/mnt/nfs/job-2024-04-28-17-13-53$ grep -w map reducer-0 reducer-1
reducer-1:map,188

michal@michal-ThinkPad-T490s:/mnt/nfs/job-2024-04-28-17-13-53$ grep -w reduce reducer-0 reducer-1
reducer-0:reduce,123</code></pre><p>Unfortunately, there are no mentions of MapReduce in the top 100 most popular books on Project Gutenberg… maybe one day?</p><p>One final note, notice how these output files partition the result space by key. When we look for a word, it’s only present in one file! It’s almost as if we did something right!</p><p><span>If you made it this far, you might as well check out the </span><a href="https://github.com/MichalPitr/map_reduce" rel>GitHub repo</a><span>. You’ll already be familiar with most ideas!</span></p><div><hr /></div><div class="subscription-widget-wrap"><div class="subscription-widget show-subscribe"><div class="preamble"><p>Thanks for reading Michal’s Substack! Subscribe for free to receive new posts and support my work.</p></div><div data-component-name="SubscribeWidget" class="subscribe-widget"><div class="pencraft pc-display-flex pc-justifyContent-center pc-reset"><div class="_container_1mxvn_1"><form action="/api/v1/free?nojs=true" method="post" noValidate class="form _form_1mxvn_6"><input type="hidden" name="first_url" /><input type="hidden" name="first_referrer" /><input type="hidden" name="current_url" /><input type="hidden" name="current_referrer" /><input type="hidden" name="referral_code" /><input type="hidden" name="source" value="subscribe-widget-preamble" /><input type="hidden" name="referring_pub_id" /><input type="hidden" name="additional_referring_pub_ids" /><div class="_sideBySideWrap_1mxvn_10"><div class="_emailInputWrapper_1mxvn_57"><input type="email" name="email" placeholder="Type your email..." class="pencraft _emailInput_1mxvn_23" /></div><button tabIndex="0" type="submit" class="button rightButton primary subscribe-btn _button_1mxvn_76"><span class="button-text ">Subscribe</span></button></div><div id="error-container"></div></form></div></div></div></div></div><p><span>Congratulations, you made it! If you enjoyed this deep dive, you might enjoy my previous one into </span><a href="https://michalpitr.substack.com/p/how-does-sqlite-store-data" rel>SQLite storage format internals</a><span>. Researching and writing these articles takes a lot of time and effort. To ensure you don’t miss the next one, consider subscribing or following me on </span><a href="https://www.linkedin.com/in/michal-pitr-a7156b127/" rel>LinkedIn</a><span>.</span></p><p></p></div></div><div class="visibility-check"></div><div class="post-footer"><div class="pencraft pc-display-flex pc-gap-16 pc-paddingTop-16 pc-paddingBottom-16 pc-justifyContent-space-between pc-alignItems-center _flexGrow_100yf_227 pc-reset _border-top-detail-themed_100yf_47 _border-bottom-detail-themed_100yf_50 post-ufi"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="like-button-container"><a role="button" class="post-ufi-button style-button has-label with-border"><svg role="img" style="height: 20px; width: 20px;" width="20" height="20" viewBox="0 0 24 24" fill="#000000" stroke-width="2" stroke="#000" xmlns="http://www.w3.org/2000/svg" class="icon"><g><title></title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-heart "><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"></path></svg></g></svg><div class="label">8</div></a><div inert role="dialog" class="modal typography out gone share-dialog popup"><div class="modal-table"><div class="modal-row"><div class="modal-cell modal-content no-fullscreen"><div class="container"><button tabIndex="0" type="button" data-testid="close-modal" class="pencraft pc-reset pencraft modal-btn modal-exit-btn no-margin _iconButton_1wz1m_145 _iconButtonBase_1wz1m_145 _buttonBase_1wz1m_1 _buttonOldColors_1wz1m_56 _size_40_1wz1m_175 _priority_secondary_1wz1m_63 _fill_empty_1wz1m_316 _rounded_1wz1m_155"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="secondary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x "><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg></button><div class="share-dialog-title">Share this post</div><div class="pencraft pc-display-flex pc-flexDirection-column pc-gap-32 pc-paddingLeft-24 pc-paddingRight-24 pc-paddingTop-32 pc-paddingBottom-48 pc-reset"><div class="pencraft pc-display-flex pc-padding-8 pc-reset _border-detail_100yf_25 pc-borderRadius-md social-preview-box post"><div class="social-image-box"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_120,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc1d3a7a5-e2cc-4778-bafe-03f87e6a6884_1600x671.png" /><img src="https://substackcdn.com/image/fetch/w_120,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc1d3a7a5-e2cc-4778-bafe-03f87e6a6884_1600x671.png" sizes="100vw" alt width="120" loading="lazy" class="_img_16u6n_1 social-image pencraft pc-reset" /></picture></div><div class="pencraft pc-display-flex pc-flexDirection-column pc-paddingTop-8 pc-paddingBottom-8 pc-paddingLeft-12 pc-reset"><h4 class="pencraft pc-reset _line-height-24_1k90y_98 _font-display_1k90y_118 _size-20_1k90y_70 _weight-bold_1k90y_168 _reset_1k90y_1">MapReduce from Scratch</h4><div class="pencraft pc-reset _color-secondary_1k90y_186 _line-height-20_1k90y_95 _font-text_1k90y_121 _size-13_1k90y_45 _weight-regular_1k90y_159 _reset_1k90y_1">michalpitr.substack.com</div></div></div><div class="pencraft pc-display-flex pc-gap-8 pc-justifyContent-space-between pc-reset share-dialog-buttons-wrapper"><button tabIndex="0" type="button" class="button share-action"><div class="action-icon"><svg role="img" width="20" height="16" viewBox="0 0 20 16" fill="none" stroke-width="1.8" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><path fill-rule="evenodd" clip-rule="evenodd" d="M12.1303 0.000379039C10.9833 -0.00959082 9.87819 0.431464 9.05309 1.22855L9.04556 1.23593L7.79145 2.48303C7.50587 2.767 7.50453 3.22877 7.78844 3.51441C8.07235 3.80004 8.53401 3.80139 8.81959 3.51741L10.0698 2.27423C10.6194 1.74503 11.3546 1.45229 12.1177 1.45892C12.8824 1.46556 13.6139 1.77236 14.1546 2.31323C14.6954 2.8541 15.0021 3.58577 15.0087 4.35065C15.0154 5.11353 14.7229 5.84857 14.1943 6.39829L12.0116 8.58145L12.0115 8.58155C11.7159 8.87739 11.36 9.10617 10.9682 9.25237C10.5764 9.39857 10.1577 9.45878 9.74051 9.42889C9.32337 9.39901 8.91752 9.27975 8.55051 9.07918C8.1835 8.87862 7.8639 8.60146 7.6134 8.26649C7.3722 7.94396 6.91526 7.87807 6.5928 8.11933C6.27034 8.36059 6.20447 8.81763 6.44567 9.14016C6.82142 9.64261 7.30082 10.0584 7.85134 10.3592C8.40186 10.66 9.01062 10.8389 9.63634 10.8838C10.2621 10.9286 10.8901 10.8383 11.4779 10.619C12.0656 10.3997 12.5994 10.0565 13.0429 9.61274L15.2302 7.42494L15.2391 7.4159C16.036 6.59062 16.4769 5.48529 16.467 4.33797C16.457 3.19066 15.9969 2.09316 15.1858 1.28185C14.3746 0.470545 13.2774 0.0103489 12.1303 0.000379039ZM7.29806 5.11625C6.67234 5.07142 6.0443 5.16173 5.45654 5.38103C4.86882 5.60031 4.33502 5.94355 3.89153 6.38727L1.70423 8.57506L1.69534 8.5841C0.898438 9.40939 0.457483 10.5147 0.467451 11.662C0.477418 12.8094 0.937512 13.9069 1.74864 14.7182C2.55976 15.5295 3.65701 15.9897 4.80407 15.9996C5.95113 16.0096 7.05622 15.5685 7.88132 14.7715L7.89035 14.7626L9.13717 13.5155C9.42192 13.2307 9.42192 12.7689 9.13717 12.4841C8.85243 12.1993 8.39077 12.1993 8.10602 12.4841L6.86392 13.7265C6.31432 14.2552 5.57945 14.5477 4.81675 14.5411C4.05204 14.5344 3.32054 14.2276 2.77979 13.6868C2.23904 13.1459 1.93231 12.4142 1.92566 11.6494C1.91904 10.8865 2.21146 10.1514 2.74011 9.60172L4.92287 7.41846C5.21854 7.12262 5.57437 6.89384 5.96621 6.74763C6.35805 6.60143 6.77674 6.54123 7.19389 6.57111C7.61104 6.601 8.01688 6.72026 8.38389 6.92082C8.75091 7.12138 9.0705 7.39855 9.32101 7.73352C9.56221 8.05605 10.0191 8.12194 10.3416 7.88068C10.6641 7.63942 10.7299 7.18238 10.4887 6.85985C10.113 6.3574 9.63359 5.94165 9.08307 5.64081C8.53255 5.33997 7.92378 5.16107 7.29806 5.11625Z"></path></g></svg></div><div translated class="pencraft pc-reset _color-secondary_1k90y_186 _line-height-20_1k90y_95 _font-text_1k90y_121 _size-13_1k90y_45 _weight-regular_1k90y_159 _reset_1k90y_1">Copy link</div></button><button tabIndex="0" type="button" class="button share-action"><div class="action-icon"><svg role="img" width="16" height="17" viewBox="0 0 16 17" fill="none" stroke-width="1.8" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><path d="M10.6543 1.38723C10.3533 0.960814 9.95383 0.61341 9.48976 0.374567C9.02902 0.137956 8.51908 0.0130716 8.00115 0.0100098C7.86087 0.0101844 7.72354 0.0502687 7.60519 0.125581C7.48684 0.200893 7.39237 0.308324 7.3328 0.435326L5.00368 5.67077H3.029C2.72335 5.66964 2.42059 5.73003 2.13876 5.84833C1.85692 5.96663 1.60177 6.14043 1.38849 6.35938C1.16707 6.57502 0.991841 6.83346 0.873459 7.11897C0.755078 7.40447 0.696022 7.71108 0.699885 8.02014V13.691C0.699885 14.3087 0.945273 14.9012 1.38207 15.338C1.81886 15.7747 2.41128 16.0201 3.029 16.0201H13.348C13.8951 16.021 14.425 15.8283 14.8438 15.4762C15.2626 15.1241 15.5434 14.6352 15.6366 14.0961L16.6493 8.4252C16.7252 8.09192 16.7252 7.74582 16.6493 7.41254C16.566 7.08205 16.4104 6.7742 16.1936 6.51128C15.9746 6.25 15.7017 6.03926 15.3936 5.89355C15.0762 5.7467 14.7306 5.67068 14.3809 5.67077H10.5328L11.0391 4.37457C11.2397 3.88784 11.3162 3.35894 11.2619 2.83533C11.1853 2.30894 10.9763 1.81065 10.6543 1.38723ZM4.75052 14.5518H3.029C2.91049 14.5525 2.79303 14.5296 2.68349 14.4844C2.57394 14.4392 2.47452 14.3726 2.39102 14.2885C2.23609 14.1199 2.14945 13.8997 2.14799 13.6708V8.02014C2.14913 7.901 2.17389 7.78328 2.22082 7.67377C2.26775 7.56427 2.33592 7.46515 2.4214 7.38216C2.50369 7.29576 2.60267 7.22698 2.71233 7.17998C2.822 7.13298 2.94007 7.10874 3.05938 7.10874H4.7809L4.75052 14.5518ZM10.6746 7.05811H14.3809C14.5145 7.05821 14.6462 7.08942 14.7657 7.14925C14.8875 7.20532 14.9948 7.28845 15.0796 7.39229C15.1675 7.49052 15.2301 7.60871 15.2619 7.73659C15.2922 7.8665 15.2922 8.00162 15.2619 8.13153L14.2493 13.8024C14.2087 14.017 14.094 14.2106 13.9252 14.3492C13.7619 14.4812 13.558 14.5528 13.348 14.5518H6.19862V6.45052L8.43659 1.38723H8.52773C8.9042 1.50037 9.23304 1.73413 9.4636 2.05252C9.69416 2.37092 9.81365 2.75627 9.80368 3.14925C9.8181 3.39741 9.78015 3.64583 9.69229 3.87836L9.23659 5.04292C9.15397 5.273 9.12623 5.51921 9.15558 5.76191C9.1877 6.00427 9.27425 6.23623 9.40875 6.44039C9.5535 6.6376 9.74028 6.80017 9.95558 6.91634C10.1774 7.03206 10.4244 7.0912 10.6746 7.08849V7.05811Z"></path></g></svg></div><div translated class="pencraft pc-reset _color-secondary_1k90y_186 _line-height-20_1k90y_95 _font-text_1k90y_121 _size-13_1k90y_45 _weight-regular_1k90y_159 _reset_1k90y_1">Facebook</div></button><button tabIndex="0" type="button" class="button share-action"><div class="action-icon"><svg role="img" width="21" height="16" viewBox="0 0 21 16" fill="none" stroke-width="1.8" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><path fill-rule="evenodd" clip-rule="evenodd" d="M2.22192 2.20503C2.36754 1.77115 2.78269 1.45455 3.26639 1.45455H17.9332C18.4169 1.45455 18.8321 1.77118 18.9777 2.2051L10.5999 8.02107L2.22192 2.20503ZM2.16639 3.94198V13.4545C2.16639 14.0529 2.66307 14.5455 3.26639 14.5455H17.9332C18.5365 14.5455 19.0332 14.0529 19.0332 13.4545V3.94206L11.0204 9.50462C10.7679 9.67991 10.4318 9.67991 10.1793 9.50462L2.16639 3.94198ZM20.4999 2.55809V13.4545C20.4999 14.8562 19.3465 16 17.9332 16H3.26639C1.85304 16 0.699707 14.8562 0.699707 13.4545V2.54545C0.699707 1.14379 1.85304 0 3.26639 0H17.9332C19.3407 0 20.4904 1.13441 20.4998 2.52818C20.5 2.53816 20.5001 2.54813 20.4999 2.55809Z"></path></g></svg></div><div translated class="pencraft pc-reset _color-secondary_1k90y_186 _line-height-20_1k90y_95 _font-text_1k90y_121 _size-13_1k90y_45 _weight-regular_1k90y_159 _reset_1k90y_1">Email</div></button><button tabIndex="0" type="button" class="button share-action"><div class="action-icon"><svg role="img" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><path d="M6.785 1.92766C5.45134 1.57031 4.08049 2.36176 3.72314 3.69543L0.444815 15.9303C0.0874636 17.264 0.878901 18.6348 2.21255 18.9922L5.37495 19.8396V7.66664C5.37495 6.40099 6.40096 5.37498 7.66661 5.37498H19.4723C19.3299 5.30548 19.1788 5.24858 19.0201 5.20604L6.785 1.92766Z" stroke="none"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M8.44161 7.4C7.86632 7.4 7.39995 7.86637 7.39995 8.44167V22.1081C7.39995 22.6834 7.86631 23.1498 8.4416 23.1498L22.1083 23.15C22.6836 23.15 23.1499 22.6836 23.1499 22.1083V8.44167C23.1499 7.86637 22.6836 7.4 22.1083 7.4H8.44161ZM10.3999 9.65C9.84766 9.65 9.39995 10.0977 9.39995 10.65C9.39995 11.2023 9.84766 11.65 10.3999 11.65H18.3999C18.9522 11.65 19.3999 11.2023 19.3999 10.65C19.3999 10.0977 18.9522 9.65 18.3999 9.65H10.3999ZM10.3999 14.15C9.84766 14.15 9.39995 14.5977 9.39995 15.15C9.39995 15.7023 9.84766 16.15 10.3999 16.15H15.3999C15.9522 16.15 16.3999 15.7023 16.3999 15.15C16.3999 14.5977 15.9522 14.15 15.3999 14.15H10.3999Z" stroke="none"></path></g></svg></div><div class="pencraft pc-reset _color-secondary_1k90y_186 _line-height-20_1k90y_95 _font-text_1k90y_121 _size-13_1k90y_45 _weight-regular_1k90y_159 _reset_1k90y_1">Note</div></button><button tabIndex="0" id="trigger40411" aria-expanded="false" aria-haspopup="dialog" aria-controls="dialog40412" ariaLabel="View more" type="button" class="button share-action"><div class="action-icon"><svg role="img" width="100" height="100" viewBox="0 0 100 100" fill="none" stroke-width="1.8" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><circle cx="23" cy="50" r="9"></circle><circle cx="50" cy="50" r="9"></circle><circle cx="77" cy="50" r="9"></circle></g></svg></div><div translated class="pencraft pc-reset _color-secondary_1k90y_186 _line-height-20_1k90y_95 _font-text_1k90y_121 _size-13_1k90y_45 _weight-regular_1k90y_159 _reset_1k90y_1">Other</div></button></div></div></div></div></div></div></div></div><a role="button" href="https://michalpitr.substack.com/p/mapreduce-from-scratch/comments" class="post-ufi-button style-button post-ufi-comment-button no-label with-border"><svg role="img" style="height: 20px; width: 20px;" width="20" height="20" viewBox="0 0 24 24" fill="#000000" stroke-width="2" stroke="#000" xmlns="http://www.w3.org/2000/svg" class="icon"><g><title></title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-circle "><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"></path></svg></g></svg></a></div><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><a role="button" href="javascript:void(0)" class="post-ufi-button style-button no-icon has-label with-border"><div class="label">Share</div></a></div></div></div></div></article></div></div><div class="single-post-section comments-section"><div class="container"><div class="comments-section-title">Comments</div><div class="visibility-check"></div><div data-test-id="comment-input" class="pencraft pc-display-flex _flexGrow_100yf_227 pc-reset comment-input-wrap"><form method="post" noValidate class="form comment-input"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_64,h_64,c_fill,f_webp,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fsubstack.com%2Fimg%2Favatars%2Flogged-out.png" /><img src="https://substackcdn.com/image/fetch/w_64,h_64,c_fill,f_auto,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fsubstack.com%2Fimg%2Favatars%2Flogged-out.png" sizes="100vw" alt width="64" height="64" style="width: 32px; height: 32px;" class="_img_16u6n_1 _avatar_u4hgo_1 _object-fit-cover_16u6n_5 pencraft pc-reset" /></picture><div class="pencraft pc-display-flex pc-flexDirection-column _flexGrow_100yf_227 pc-reset comment-input-right"><textarea data-gramm="false" data-gramm_editor="false" data-enable-grammarly="false" name="body" placeholder="Write a comment..."></textarea><div id="error-container"></div><div class="pencraft pc-display-flex pc-paddingTop-8 pc-justifyContent-space-between pc-alignItems-center pc-reset"></div></div></form></div></div></div><div class="single-post-section"><div class="container"><div class="visibility-check"></div><div class="pencraft pc-display-contents pc-reset _pubTheme_6gfa3_1"><div class="pencraft pc-paddingTop-24 pc-paddingBottom-24 pc-reset"><div class="portable-archive empty-list"><div class="pencraft pc-display-flex pc-paddingLeft-8 pc-paddingRight-8 pc-paddingBottom-16 pc-justifyContent-space-between pc-alignItems-center pc-reset"><div class="pencraft pc-display-flex pc-gap-8 pc-padding-4 pc-position-relative pc-reset _bg-secondary_100yf_172 pc-borderRadius-full _segments_i9xog_56"><button tabIndex="0" type="button" class="pencraft pc-display-flex pc-height-32 pc-paddingLeft-12 pc-paddingRight-12 pc-justifyContent-center pc-alignItems-center pc-cursor-pointer pc-reset _bg-unset_100yf_166 _border-unset_100yf_21 _sizing-border-box_100yf_265 pencraft _segment_i9xog_56 _active_i9xog_26"><div class="pencraft pc-reset _line-height-20_1k90y_95 _font-text_1k90y_121 _size-14_1k90y_50 _weight-semibold_1k90y_165 _reset_1k90y_1 _segmentText_i9xog_66 _active_i9xog_26">Top</div></button><button tabIndex="0" type="button" class="pencraft pc-display-flex pc-height-32 pc-paddingLeft-12 pc-paddingRight-12 pc-justifyContent-center pc-alignItems-center pc-cursor-pointer pc-reset _bg-unset_100yf_166 _border-unset_100yf_21 _sizing-border-box_100yf_265 pencraft _segment_i9xog_56"><div class="pencraft pc-reset _line-height-20_1k90y_95 _font-text_1k90y_121 _size-14_1k90y_50 _weight-semibold_1k90y_165 _reset_1k90y_1 _segmentText_i9xog_66">Latest</div></button><div class="pencraft pc-display-flex pc-height-32 pc-boxShadow-sm pc-position-absolute pc-reset _bg-primary_100yf_169 pc-borderRadius-full _segmentPill_i9xog_81"></div></div><button tabIndex="0" type="button" class="pencraft pc-reset pencraft _iconButton2_1wz1m_628 _iconButtonBase_1wz1m_145 _buttonBase_1wz1m_1 _buttonNew_1wz1m_83 _size_md_1wz1m_127 _priority_tertiary_1wz1m_69"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search "><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg></button></div><div class="portable-archive-list"><p class="portable-archive-empty">No posts</p></div></div></div></div></div></div><div class="visibility-check"></div><div class="subscribe-footer"><div class="container"><p>Ready for more?</p><div class="pencraft pc-display-flex pc-justifyContent-center pc-reset"><div><div class="_container_1mxvn_1"><form action="/api/v1/free?nojs=true" method="post" noValidate class="form _form_1mxvn_6"><input type="hidden" name="first_url" /><input type="hidden" name="first_referrer" /><input type="hidden" name="current_url" /><input type="hidden" name="current_referrer" /><input type="hidden" name="referral_code" /><input type="hidden" name="source" value="subscribe_footer" /><input type="hidden" name="referring_pub_id" /><input type="hidden" name="additional_referring_pub_ids" /><div class="_sideBySideWrap_1mxvn_10"><div class="_emailInputWrapper_1mxvn_57"><input type="email" name="email" placeholder="Type your email..." class="pencraft _emailInput_1mxvn_23 _emailInputOnAccentBackground_1mxvn_49" /></div><button tabIndex="0" type="submit" class="button rightButton primary subscribe-btn _button_1mxvn_76 _buttonOnAccentBackground_1mxvn_89"><span class="button-text ">Subscribe</span></button></div><div id="error-container"></div></form></div></div></div></div></div></div></div><div class="footer-wrap publication-footer"><div class="visibility-check"></div><div class="footer themed-background"><div class="container"><div class="footer-blurbs"><div class="footer-copyright-blurb">© 2024 Michal Pitr</div><div class="footer-terms-blurb"><a href="https://substack.com/privacy" target="_blank" rel="noopener noreferrer">Privacy</a><span> ∙ </span><a href="https://substack.com/tos" target="_blank" rel="noopener noreferrer">Terms</a><span> ∙ </span><a href="https://substack.com/ccpa#personal-data-collected" target="_blank" rel="noopener noreferrer">Collection notice</a></div></div><div class="footer-buttons"><a native href="https://substack.com/signup?utm_source=substack&amp;utm_medium=web&amp;utm_content=footer" class="footer-substack-cta start-publishing"><svg role="img" width="1000" height="1000" viewBox="0 0 1000 1000" fill="#FF6719" stroke-width="1.8" stroke="none" xmlns="http://www.w3.org/2000/svg"><g><title></title><path d="M764.166 348.371H236.319V419.402H764.166V348.371Z"></path><path d="M236.319 483.752V813.999L500.231 666.512L764.19 813.999V483.752H236.319Z"></path><path d="M764.166 213H236.319V284.019H764.166V213Z"></path></g></svg> Start Writing</a><a native href="https://substack.com/app/app-store-redirect?utm_campaign=app-marketing&amp;utm_content=web-footer-button" class="footer-substack-cta get-the-app no-icon">Get the app</a></div><div translated class="pencraft pc-reset _reset_1k90y_1 footer-slogan-blurb"><a href="https://substack.com" native>Substack</a> is the home for great culture</div></div></div></div></div><div inert role="dialog" class="modal typography out gone share-dialog popup"><div class="modal-table"><div class="modal-row"><div class="modal-cell modal-content no-fullscreen"><div class="container"><button tabIndex="0" type="button" data-testid="close-modal" class="pencraft pc-reset pencraft modal-btn modal-exit-btn no-margin _iconButton_1wz1m_145 _iconButtonBase_1wz1m_145 _buttonBase_1wz1m_1 _buttonOldColors_1wz1m_56 _size_40_1wz1m_175 _priority_secondary_1wz1m_63 _fill_empty_1wz1m_316 _rounded_1wz1m_155"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="secondary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x "><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg></button><div class="share-dialog-title">Share</div><div class="pencraft pc-display-flex pc-flexDirection-column pc-gap-32 pc-paddingLeft-24 pc-paddingRight-24 pc-paddingTop-32 pc-paddingBottom-48 pc-reset"><div class="pencraft pc-display-flex pc-gap-8 pc-justifyContent-space-between pc-reset share-dialog-buttons-wrapper"><button tabIndex="0" type="button" class="button share-action"><div class="action-icon"><svg role="img" width="20" height="16" viewBox="0 0 20 16" fill="none" stroke-width="1.8" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><path fill-rule="evenodd" clip-rule="evenodd" d="M12.1303 0.000379039C10.9833 -0.00959082 9.87819 0.431464 9.05309 1.22855L9.04556 1.23593L7.79145 2.48303C7.50587 2.767 7.50453 3.22877 7.78844 3.51441C8.07235 3.80004 8.53401 3.80139 8.81959 3.51741L10.0698 2.27423C10.6194 1.74503 11.3546 1.45229 12.1177 1.45892C12.8824 1.46556 13.6139 1.77236 14.1546 2.31323C14.6954 2.8541 15.0021 3.58577 15.0087 4.35065C15.0154 5.11353 14.7229 5.84857 14.1943 6.39829L12.0116 8.58145L12.0115 8.58155C11.7159 8.87739 11.36 9.10617 10.9682 9.25237C10.5764 9.39857 10.1577 9.45878 9.74051 9.42889C9.32337 9.39901 8.91752 9.27975 8.55051 9.07918C8.1835 8.87862 7.8639 8.60146 7.6134 8.26649C7.3722 7.94396 6.91526 7.87807 6.5928 8.11933C6.27034 8.36059 6.20447 8.81763 6.44567 9.14016C6.82142 9.64261 7.30082 10.0584 7.85134 10.3592C8.40186 10.66 9.01062 10.8389 9.63634 10.8838C10.2621 10.9286 10.8901 10.8383 11.4779 10.619C12.0656 10.3997 12.5994 10.0565 13.0429 9.61274L15.2302 7.42494L15.2391 7.4159C16.036 6.59062 16.4769 5.48529 16.467 4.33797C16.457 3.19066 15.9969 2.09316 15.1858 1.28185C14.3746 0.470545 13.2774 0.0103489 12.1303 0.000379039ZM7.29806 5.11625C6.67234 5.07142 6.0443 5.16173 5.45654 5.38103C4.86882 5.60031 4.33502 5.94355 3.89153 6.38727L1.70423 8.57506L1.69534 8.5841C0.898438 9.40939 0.457483 10.5147 0.467451 11.662C0.477418 12.8094 0.937512 13.9069 1.74864 14.7182C2.55976 15.5295 3.65701 15.9897 4.80407 15.9996C5.95113 16.0096 7.05622 15.5685 7.88132 14.7715L7.89035 14.7626L9.13717 13.5155C9.42192 13.2307 9.42192 12.7689 9.13717 12.4841C8.85243 12.1993 8.39077 12.1993 8.10602 12.4841L6.86392 13.7265C6.31432 14.2552 5.57945 14.5477 4.81675 14.5411C4.05204 14.5344 3.32054 14.2276 2.77979 13.6868C2.23904 13.1459 1.93231 12.4142 1.92566 11.6494C1.91904 10.8865 2.21146 10.1514 2.74011 9.60172L4.92287 7.41846C5.21854 7.12262 5.57437 6.89384 5.96621 6.74763C6.35805 6.60143 6.77674 6.54123 7.19389 6.57111C7.61104 6.601 8.01688 6.72026 8.38389 6.92082C8.75091 7.12138 9.0705 7.39855 9.32101 7.73352C9.56221 8.05605 10.0191 8.12194 10.3416 7.88068C10.6641 7.63942 10.7299 7.18238 10.4887 6.85985C10.113 6.3574 9.63359 5.94165 9.08307 5.64081C8.53255 5.33997 7.92378 5.16107 7.29806 5.11625Z"></path></g></svg></div><div translated class="pencraft pc-reset _color-secondary_1k90y_186 _line-height-20_1k90y_95 _font-text_1k90y_121 _size-13_1k90y_45 _weight-regular_1k90y_159 _reset_1k90y_1">Copy link</div></button><button tabIndex="0" type="button" class="button share-action"><div class="action-icon"><svg role="img" width="16" height="17" viewBox="0 0 16 17" fill="none" stroke-width="1.8" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><path d="M10.6543 1.38723C10.3533 0.960814 9.95383 0.61341 9.48976 0.374567C9.02902 0.137956 8.51908 0.0130716 8.00115 0.0100098C7.86087 0.0101844 7.72354 0.0502687 7.60519 0.125581C7.48684 0.200893 7.39237 0.308324 7.3328 0.435326L5.00368 5.67077H3.029C2.72335 5.66964 2.42059 5.73003 2.13876 5.84833C1.85692 5.96663 1.60177 6.14043 1.38849 6.35938C1.16707 6.57502 0.991841 6.83346 0.873459 7.11897C0.755078 7.40447 0.696022 7.71108 0.699885 8.02014V13.691C0.699885 14.3087 0.945273 14.9012 1.38207 15.338C1.81886 15.7747 2.41128 16.0201 3.029 16.0201H13.348C13.8951 16.021 14.425 15.8283 14.8438 15.4762C15.2626 15.1241 15.5434 14.6352 15.6366 14.0961L16.6493 8.4252C16.7252 8.09192 16.7252 7.74582 16.6493 7.41254C16.566 7.08205 16.4104 6.7742 16.1936 6.51128C15.9746 6.25 15.7017 6.03926 15.3936 5.89355C15.0762 5.7467 14.7306 5.67068 14.3809 5.67077H10.5328L11.0391 4.37457C11.2397 3.88784 11.3162 3.35894 11.2619 2.83533C11.1853 2.30894 10.9763 1.81065 10.6543 1.38723ZM4.75052 14.5518H3.029C2.91049 14.5525 2.79303 14.5296 2.68349 14.4844C2.57394 14.4392 2.47452 14.3726 2.39102 14.2885C2.23609 14.1199 2.14945 13.8997 2.14799 13.6708V8.02014C2.14913 7.901 2.17389 7.78328 2.22082 7.67377C2.26775 7.56427 2.33592 7.46515 2.4214 7.38216C2.50369 7.29576 2.60267 7.22698 2.71233 7.17998C2.822 7.13298 2.94007 7.10874 3.05938 7.10874H4.7809L4.75052 14.5518ZM10.6746 7.05811H14.3809C14.5145 7.05821 14.6462 7.08942 14.7657 7.14925C14.8875 7.20532 14.9948 7.28845 15.0796 7.39229C15.1675 7.49052 15.2301 7.60871 15.2619 7.73659C15.2922 7.8665 15.2922 8.00162 15.2619 8.13153L14.2493 13.8024C14.2087 14.017 14.094 14.2106 13.9252 14.3492C13.7619 14.4812 13.558 14.5528 13.348 14.5518H6.19862V6.45052L8.43659 1.38723H8.52773C8.9042 1.50037 9.23304 1.73413 9.4636 2.05252C9.69416 2.37092 9.81365 2.75627 9.80368 3.14925C9.8181 3.39741 9.78015 3.64583 9.69229 3.87836L9.23659 5.04292C9.15397 5.273 9.12623 5.51921 9.15558 5.76191C9.1877 6.00427 9.27425 6.23623 9.40875 6.44039C9.5535 6.6376 9.74028 6.80017 9.95558 6.91634C10.1774 7.03206 10.4244 7.0912 10.6746 7.08849V7.05811Z"></path></g></svg></div><div translated class="pencraft pc-reset _color-secondary_1k90y_186 _line-height-20_1k90y_95 _font-text_1k90y_121 _size-13_1k90y_45 _weight-regular_1k90y_159 _reset_1k90y_1">Facebook</div></button><button tabIndex="0" type="button" class="button share-action"><div class="action-icon"><svg role="img" width="21" height="16" viewBox="0 0 21 16" fill="none" stroke-width="1.8" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><path fill-rule="evenodd" clip-rule="evenodd" d="M2.22192 2.20503C2.36754 1.77115 2.78269 1.45455 3.26639 1.45455H17.9332C18.4169 1.45455 18.8321 1.77118 18.9777 2.2051L10.5999 8.02107L2.22192 2.20503ZM2.16639 3.94198V13.4545C2.16639 14.0529 2.66307 14.5455 3.26639 14.5455H17.9332C18.5365 14.5455 19.0332 14.0529 19.0332 13.4545V3.94206L11.0204 9.50462C10.7679 9.67991 10.4318 9.67991 10.1793 9.50462L2.16639 3.94198ZM20.4999 2.55809V13.4545C20.4999 14.8562 19.3465 16 17.9332 16H3.26639C1.85304 16 0.699707 14.8562 0.699707 13.4545V2.54545C0.699707 1.14379 1.85304 0 3.26639 0H17.9332C19.3407 0 20.4904 1.13441 20.4998 2.52818C20.5 2.53816 20.5001 2.54813 20.4999 2.55809Z"></path></g></svg></div><div translated class="pencraft pc-reset _color-secondary_1k90y_186 _line-height-20_1k90y_95 _font-text_1k90y_121 _size-13_1k90y_45 _weight-regular_1k90y_159 _reset_1k90y_1">Email</div></button><button tabIndex="0" type="button" class="button share-action"><div class="action-icon"><svg role="img" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><path d="M6.785 1.92766C5.45134 1.57031 4.08049 2.36176 3.72314 3.69543L0.444815 15.9303C0.0874636 17.264 0.878901 18.6348 2.21255 18.9922L5.37495 19.8396V7.66664C5.37495 6.40099 6.40096 5.37498 7.66661 5.37498H19.4723C19.3299 5.30548 19.1788 5.24858 19.0201 5.20604L6.785 1.92766Z" stroke="none"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M8.44161 7.4C7.86632 7.4 7.39995 7.86637 7.39995 8.44167V22.1081C7.39995 22.6834 7.86631 23.1498 8.4416 23.1498L22.1083 23.15C22.6836 23.15 23.1499 22.6836 23.1499 22.1083V8.44167C23.1499 7.86637 22.6836 7.4 22.1083 7.4H8.44161ZM10.3999 9.65C9.84766 9.65 9.39995 10.0977 9.39995 10.65C9.39995 11.2023 9.84766 11.65 10.3999 11.65H18.3999C18.9522 11.65 19.3999 11.2023 19.3999 10.65C19.3999 10.0977 18.9522 9.65 18.3999 9.65H10.3999ZM10.3999 14.15C9.84766 14.15 9.39995 14.5977 9.39995 15.15C9.39995 15.7023 9.84766 16.15 10.3999 16.15H15.3999C15.9522 16.15 16.3999 15.7023 16.3999 15.15C16.3999 14.5977 15.9522 14.15 15.3999 14.15H10.3999Z" stroke="none"></path></g></svg></div><div class="pencraft pc-reset _color-secondary_1k90y_186 _line-height-20_1k90y_95 _font-text_1k90y_121 _size-13_1k90y_45 _weight-regular_1k90y_159 _reset_1k90y_1">Note</div></button><button tabIndex="0" id="trigger40415" aria-expanded="false" aria-haspopup="dialog" aria-controls="dialog40416" ariaLabel="View more" type="button" class="button share-action"><div class="action-icon"><svg role="img" width="100" height="100" viewBox="0 0 100 100" fill="none" stroke-width="1.8" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><circle cx="23" cy="50" r="9"></circle><circle cx="50" cy="50" r="9"></circle><circle cx="77" cy="50" r="9"></circle></g></svg></div><div translated class="pencraft pc-reset _color-secondary_1k90y_186 _line-height-20_1k90y_95 _font-text_1k90y_121 _size-13_1k90y_45 _weight-regular_1k90y_159 _reset_1k90y_1">Other</div></button></div></div></div></div></div></div></div><div style="transform: translateY(0px);" class="tw-fixed tw-bottom-2.5 tw-right-2.5 tw-left-2.5 md:tw-left-auto md:tw-bottom-5 md:tw-right-5 md:tw-pl-4 tw-z-40"></div><div></div>
        </div>

        
            <script src="https://js.sentry-cdn.com/6c2ff3e3828e4017b7faf7b63e24cdf8.min.js" crossorigin="anonymous"></script>
            <script>
                window.Sentry && window.Sentry.onLoad(function() {
                    window.Sentry.init({
                        environment: window._preloads.sentry_environment,
                        dsn: window._preloads.sentry_dsn,
                    })
                })
            </script>
        


        
        
        
        <script>window._preloads        = JSON.parse("{\"isEU\":false,\"language\":\"en\",\"country\":\"US\",\"base_url\":\"https://michalpitr.substack.com\",\"stripe_publishable_key\":\"pk_live_vNnuGHOFnt4mM7V9PuCAAPJz\",\"captcha_site_key\":\"6LdYbsYZAAAAAIFIRh8X_16GoFRLIReh-e-q6qSa\",\"pub\":{\"apple_pay_disabled\":false,\"apex_domain\":null,\"author_id\":28235731,\"byline_images_enabled\":true,\"bylines_enabled\":true,\"chartable_token\":null,\"community_enabled\":true,\"copyright\":\"Michal Pitr\",\"cover_photo_url\":null,\"created_at\":\"2023-09-10T14:39:47.894Z\",\"custom_domain_optional\":false,\"custom_domain\":null,\"custom_publication_theme_id\":null,\"default_comment_sort\":\"best_first\",\"default_coupon\":null,\"default_group_coupon\":null,\"default_show_guest_bios\":true,\"email_banner_url\":null,\"email_from_name\":null,\"email_from\":null,\"embed_tracking_disabled\":false,\"explicit\":false,\"expose_paywall_content_to_search_engines\":true,\"fb_pixel_id\":null,\"fb_site_verification_token\":null,\"flagged_as_spam\":false,\"founding_subscription_benefits\":null,\"free_subscription_benefits\":null,\"ga_pixel_id\":null,\"google_site_verification_token\":null,\"google_tag_manager_token\":null,\"hero_image\":null,\"hero_text\":\"My personal Substack\",\"hide_intro_subtitle\":null,\"hide_intro_title\":null,\"hide_podcast_feed_link\":false,\"homepage_type\":\"newspaper\",\"id\":1939983,\"image_thumbnails_always_enabled\":false,\"invite_only\":false,\"language\":\"en\",\"logo_url_wide\":null,\"logo_url\":\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbe5ab36b-c782-420e-ac35-c7599a1f77ad_976x976.png\",\"minimum_group_size\":2,\"moderation_enabled\":true,\"name\":\"Michal\u2019s Substack\",\"paid_subscription_benefits\":null,\"parsely_pixel_id\":null,\"payments_state\":\"disabled\",\"paywall_free_trial_enabled\":false,\"podcast_art_url\":null,\"paid_podcast_episode_art_url\":null,\"podcast_byline\":null,\"podcast_description\":null,\"podcast_enabled\":false,\"podcast_feed_url\":null,\"podcast_title\":null,\"post_preview_limit\":null,\"require_clickthrough\":false,\"rss_feed_url\":null,\"rss_website_url\":null,\"show_pub_podcast_tab\":false,\"show_recs_on_homepage\":true,\"subdomain\":\"michalpitr\",\"subscriber_invites\":0,\"support_email\":null,\"theme_var_background_pop\":\"#D10000\",\"theme_var_color_links\":false,\"theme_var_cover_bg_color\":null,\"trial_end_override\":null,\"twitter_pixel_id\":null,\"type\":\"newsletter\",\"post_reaction_faces_enabled\":true,\"plans\":null,\"stripe_user_id\":null,\"stripe_country\":null,\"stripe_publishable_key\":null,\"automatic_tax_enabled\":null,\"author_name\":\"Michal Pitr\",\"author_handle\":\"michalpitr\",\"author_photo_url\":\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F73a6e774-038e-424d-afee-ce5041c3e7e0_1080x1080.jpeg\",\"author_bio\":\"Computer Science & Mathematics graduate from the University of Edinburgh. I love figuring out how systems work at a fundamental level and sharing my findings.\",\"has_custom_tos\":false,\"has_custom_privacy\":false,\"theme\":{\"background_pop_color\":null,\"web_bg_color\":null,\"cover_bg_color\":null,\"home_hero\":\"newspaper\",\"home_posts\":\"list\"},\"threads_v2_settings\":{\"photo_replies_enabled\":false,\"first_thread_email_sent_at\":null,\"create_thread_minimum_role\":\"contributor\",\"activated_at\":null,\"reader_thread_notifications_enabled\":false},\"default_group_coupon_percent_off\":null,\"pause_return_date\":null,\"has_posts\":true,\"has_recommendations\":true,\"first_post_date\":\"2024-01-27T17:37:46.394Z\",\"has_podcast\":false,\"has_free_podcast\":false,\"has_subscriber_only_podcast\":false,\"has_community_content\":false,\"twitter_share_on_publish_opt_in\":null,\"twitter_permissions\":\"none\",\"rankingDetail\":\"Launched 3 months ago\",\"rankingDetailFreeIncluded\":\"Hundreds of subscribers\",\"rankingDetailOrderOfMagnitude\":0,\"rankingDetailFreeIncludedOrderOfMagnitude\":100,\"rankingDetailFreeSubscriberCount\":null,\"rankingDetailByLanguage\":{\"de\":{\"rankingDetail\":\"Vor vor 3 Monaten gelauncht\",\"rankingDetailFreeIncluded\":\"Hunderte von Abonnenten\",\"rankingDetailOrderOfMagnitude\":0,\"rankingDetailFreeIncludedOrderOfMagnitude\":100,\"rankingDetailFreeSubscriberCount\":null,\"freeSubscriberCount\":null},\"es\":{\"rankingDetail\":\"Lanzado hace 3 meses\",\"rankingDetailFreeIncluded\":\"Cientos de suscriptores\",\"rankingDetailOrderOfMagnitude\":0,\"rankingDetailFreeIncludedOrderOfMagnitude\":100,\"rankingDetailFreeSubscriberCount\":null,\"freeSubscriberCount\":null},\"fr\":{\"rankingDetail\":\"Lanc\u00E9 il y a 3 mois\",\"rankingDetailFreeIncluded\":\"Des centaines d'abonn\u00E9s\",\"rankingDetailOrderOfMagnitude\":0,\"rankingDetailFreeIncludedOrderOfMagnitude\":100,\"rankingDetailFreeSubscriberCount\":null,\"freeSubscriberCount\":null},\"pt\":{\"rankingDetail\":\"Lan\u00E7ado 3 meses\",\"rankingDetailFreeIncluded\":\"Centenas de subscritores\",\"rankingDetailOrderOfMagnitude\":0,\"rankingDetailFreeIncludedOrderOfMagnitude\":100,\"rankingDetailFreeSubscriberCount\":null,\"freeSubscriberCount\":null},\"pt-br\":{\"rankingDetail\":\"Lan\u00E7ado 3 meses\",\"rankingDetailFreeIncluded\":\"Centenas de assinantes\",\"rankingDetailOrderOfMagnitude\":0,\"rankingDetailFreeIncludedOrderOfMagnitude\":100,\"rankingDetailFreeSubscriberCount\":null,\"freeSubscriberCount\":null},\"it\":{\"rankingDetail\":\"Lanciato 3 mesi\",\"rankingDetailFreeIncluded\":\"Centinaia di abbonati\",\"rankingDetailOrderOfMagnitude\":0,\"rankingDetailFreeIncludedOrderOfMagnitude\":100,\"rankingDetailFreeSubscriberCount\":null,\"freeSubscriberCount\":null},\"en\":{\"rankingDetail\":\"Launched 3 months ago\",\"rankingDetailFreeIncluded\":\"Hundreds of subscribers\",\"rankingDetailOrderOfMagnitude\":0,\"rankingDetailFreeIncludedOrderOfMagnitude\":100,\"rankingDetailFreeSubscriberCount\":null,\"freeSubscriberCount\":null}},\"freeSubscriberCount\":null,\"author_bestseller_tier\":0,\"disable_monthly_subscriptions\":false,\"disable_annual_subscriptions\":false,\"hide_post_restacks\":false,\"notes_feed_enabled\":false,\"paywall_chat\":\"free\",\"sections\":[],\"multipub_migration\":null,\"navigationBarItems\":[],\"contributors\":[{\"name\":\"Michal Pitr\",\"handle\":\"michalpitr\",\"role\":\"admin\",\"owner\":true,\"user_id\":28235731,\"photo_url\":\"https://substack-post-media.s3.amazonaws.com/public/images/73a6e774-038e-424d-afee-ce5041c3e7e0_1080x1080.jpeg\",\"bio\":\"Computer Science & Mathematics graduate from the University of Edinburgh. I love figuring out how systems work at a fundamental level and sharing my findings.\"}],\"threads_v2_enabled\":false,\"viralGiftsConfig\":null,\"tier\":2,\"no_follow\":false,\"no_index\":false,\"can_set_google_site_verification\":true,\"can_have_sitemap\":true,\"founding_plan_name_english\":\"Founding Member\",\"draft_plans\":null,\"base_url\":\"https://michalpitr.substack.com\",\"hostname\":\"michalpitr.substack.com\",\"is_on_substack\":false,\"spotify_podcast_settings\":null,\"podcastPalette\":{\"Vibrant\":{\"rgb\":[244.1949152542373,162.0762711864407,10.805084745762711],\"population\":0},\"DarkVibrant\":{\"rgb\":[126.9813559322034,84.27966101694916,5.618644067796606],\"population\":0},\"LightVibrant\":{\"rgb\":[250,212,142],\"population\":31},\"Muted\":{\"rgb\":[92,158,148],\"population\":4},\"DarkMuted\":{\"rgb\":[146.51694915254237,97.24576271186443,6.483050847457638],\"population\":0},\"LightMuted\":{\"rgb\":[164,204,196],\"population\":3}},\"pageThemes\":{\"podcast\":null},\"live_subscriber_counts\":false,\"subscribeCardVersionHash\":\"94543779e333b029ed0732c46c4cc686\"},\"confirmedLogin\":false,\"hide_intro_popup\":false,\"block_auto_login\":null,\"domainInfo\":{\"isSubstack\":true,\"customDomain\":null},\"experimentFeatures\":{},\"experimentExposures\":{},\"siteConfigs\":{\"score_upsell_email\":\"control\",\"first_chat_email_enabled\":true,\"notes_video_max_duration_minutes\":5,\"reader-onboarding-promoted-pub\":737237,\"pub_creation_captcha_behavior\":\"risky_pubs\",\"new_commenter_approval\":false,\"pub_update_opennode_api_key\":false,\"zendesk_automation_cancellations\":false,\"hide_book_a_meeting_button\":false,\"first_month_upsell_enabled\":false,\"substack_credits_enabled\":false,\"publication_max_bylines\":35,\"no_contest_charge_disputes\":false,\"new_subscription_management\":false,\"recommendations_announcement_url\":\"https://on.substack.com/p/recommendations\",\"comp_expiry_email_new_copy\":\"NONE\",\"free_unlock_required\":false,\"traffic_rule_check_enabled\":false,\"amp_emails_enabled\":false,\"enable_post_summarization\":false,\"image_deep_link_enabled\":false,\"bitcoin_enabled\":false,\"public_podcast_rss_feed_only_free_visible\":false,\"show_entire_square_image\":false,\"hide_subscriber_count\":false,\"editor_v2\":false,\"publication_author_display_override\":\"\",\"enable_android_recs_v2\":true,\"generate_pdf_tax_report\":false,\"promote_new_notes\":\"experiment\",\"enable_pledges_modal\":true,\"include_pdf_invoice\":false,\"hide_pub_from_subscription_recommendation\":false,\"platform_searcher_enabled\":false,\"daily_promoted_notes_enabled\":true,\"use_featured_pub_recommendations\":false,\"meetings_v1\":false,\"custom_target_origin\":\"\",\"exempt_from_gtm_filter\":false,\"group_sections_and_podcasts_in_menu\":false,\"boost_optin_modal_enabled\":true,\"apex_redirects\":true,\"post_blogspot_importer\":false,\"paywall_chat\":true,\"pub_tts_override\":\"default\",\"disable_monthly_subscriptions\":false,\"skip_welcome_email\":false,\"chat_reader_thread_notification_default\":false,\"scheduled_pinned_posts\":false,\"disable_redirect_outbound_utm_params\":false,\"reader_gift_referrals_enabled\":true,\"enable_bestseller_survey_modal\":false,\"dont_show_guest_byline\":false,\"like_comments_enabled\":true,\"extended_podcast_episode_metadata\":false,\"use_richer_html_for_editing_podcast_description\":false,\"default_to_editor_v2\":false,\"enable_author_note_email_toggle\":false,\"meetings_embed_publication_name\":false,\"no_auto_renewal_notice\":false,\"people_you_may_know_algorithm\":\"experiment\",\"show_note_preview_og_image\":true,\"welcome_screen_blurb_override\":\"\",\"post_recipients_batch_limit\":1000,\"like_posts_enabled\":true,\"notes_publication_mentions_enabled\":false,\"twitter_player_card_enabled\":true,\"enable_substack_player\":true,\"feed_promoted_user\":false,\"allow_renew_email_footer\":true,\"enable_android_chat_paywall\":true,\"section_specific_csv_imports_enabled\":false,\"improved_tts_voiceover\":false,\"bypass_profile_substack_logo_detection\":false,\"use_preloaded_player_sources\":false,\"generate_twitter_card_with_lamda\":false,\"list_pruning_enabled\":false,\"facebook_connect\":false,\"opt_in_to_sections_during_subscribe\":false,\"more_teaser_post_context\":\"experiment\",\"underlined_colored_links\":false,\"max_image_upload_mb\":32,\"modal_rec_variant_user\":\"control\",\"extract_stripe_receipt_url\":false,\"enable_android_dms_writer_beta\":false,\"enable_chat_inbox_pins\":false,\"threads_suggested_ios_version\":null,\"pledges_disabled\":false,\"threads_minimum_ios_version\":812,\"hide_podcast_email_setup_link\":false,\"subscribe_captcha_behavior\":\"default\",\"publication_ban_sample_rate\":0,\"allow_moderation_sampling_mode\":false,\"enable_global_search\":true,\"photo_dna_enabled\":false,\"round_square_images\":false,\"reader_referrals_feature_enabled\":false,\"continue_support_cta_in_newsletter_emails\":false,\"bloomberg_syndication_enabled\":false,\"custom_publication_theme\":false,\"lists_enabled\":false,\"show_writer_referral_box\":false,\"generated_database_maintenance_mode\":false,\"allow_document_freeze\":false,\"podcast_main_feed_is_firehose\":false,\"video_post_sticky\":true,\"no_embed_redirect\":false,\"enable_android_chat_founding_tier\":true,\"spotify_open_access_sandbox_mode\":false,\"fullstory_enabled\":false,\"chat_reply_poll_interval\":3,\"modal_rec_variant_content\":\"experiment\",\"enable_reader_marketing_page\":false,\"force_pub_links_to_use_subdomain\":false,\"email_existing_users_on_import\":false,\"always_show_cookie_banner\":false,\"hide_media_download_option\":false,\"review_incoming_email\":\"default\",\"use_stripe_link\":\"control\",\"twitter_figures_enabled\":false,\"hide_post_restacks\":false,\"feed_item_source_debug_mode\":false,\"global_search_bestseller_tier\":\"NONE\",\"spotify_open_access\":true,\"post_preview_hide_subtitles_on_grid\":false,\"publication_homepage_title_display_override\":\"\",\"pub_banned_word_list\":\"\",\"post_preview_highlight_byline\":false,\"credit_token_publication_suggested\":false,\"bypass_unlock_token_limit\":false,\"enable_dm_images\":true,\"notifications_disabled\":\"\",\"cross_post_notification_threshold\":1000,\"facebook_connect_prod_app\":true,\"gift_referrals_allow_reups\":true,\"messages_inbox_page_size\":50,\"minimum_android_version\":756,\"feed_main_disabled\":false,\"use_mobile_app_post_unlock_flow\":true,\"feed_polling_disabled\":false,\"enable_ai_generated_clips\":false,\"cookie_preference_middleware_enabled\":false,\"profile_search_tweaks\":false,\"live_events\":false,\"seo_tier_override\":\"NONE\",\"cancellation_flow_experiment\":\"experiment\",\"publisher_api_enabled\":false,\"zendesk_support_priority\":\"default\",\"enable_subscriber_referrals_awards\":true,\"use_zync_for_pubchat_updates\":true,\"homepage_overlap_ufi\":false,\"non_mfa_password_login_guard\":\"block_suspicious\",\"embeds_enabled\":true,\"enable_web_typing_indicators\":false,\"section_specific_preambles\":false,\"enable_android_chat_navigation\":false,\"web_vitals_sample_rate\":0,\"skip_twitter_step_in_writer_onboarding\":true,\"android_suggestion_categories_onboarding_tabs\":false,\"enable_video_in_notes_web\":true,\"spam_post_titles\":\"Notice: Your Substack Account Information Has Been Modified,Join the PancakeSwap V4 Airdrop and grab your share of $CAKE tokens!\",\"clipper_v2\":true,\"section_specific_welcome_pages\":false,\"local_payment_methods\":\"control\",\"dm_poll_interval\":3,\"posts_in_rss_feed\":20,\"post_rec_endpoint\":\"\",\"publisher_dashboard_section_selector\":false,\"reader_surveys_platform_question_order\":\"36,1,4,2,3,5,6,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35\",\"show_email_cutoff_cta\":\"experiment\",\"large_feed_following_threshold\":150,\"ios_share_to_notes_from_share_sheet\":\"experiment\",\"monthly_sub_is_one_off\":false,\"unread_notes_activity_digest\":\"control\",\"display_cookie_settings\":false,\"enable_chat_search\":true,\"welcome_page_query_params\":false,\"enable_free_podcast_urls\":false,\"dm_rate_limit_hours\":24,\"dm_rate_limit_requests\":100,\"use_microlink_for_instagram_embeds\":false,\"use_whisper\":false,\"enable_dm_realtime\":false,\"allow_filtering_moderation_reasons\":false,\"show_menu_on_posts\":false,\"app_upsell_follow_prompt\":\"control\",\"free_signup_confirmation_behavior\":\"with_email_validation\",\"ios_chat_revamp_enabled\":false,\"sql_feed_fallback_percent\":0,\"show_phone_banner\":false,\"publisher_banner\":\"\",\"chat_founding_tier\":true,\"enable_decagon_chat\":true,\"first_month_upsell\":\"control\",\"twitter_connect_flows_enabled\":false,\"android_google_sign_in\":false,\"enable_user_contacts\":true,\"enable_android_dms_realtime\":true,\"enable_upload_seperate_audio\":true,\"welcome_page_update_desktop_visuals_limited\":\"experiment\",\"posts_open_in_app\":\"control\",\"rss_verification_code\":\"\",\"enable_upload_transcript\":true,\"insert_trading_view_charts\":true,\"audio_encoding_bitrate\":null,\"extra_seats_coupon_type\":false,\"post_subdomain_universal_links\":false,\"post_import_max_file_size\":26214400,\"your_weekly_stack_notification\":\"experiment\",\"credit_tokens_enabled\":true,\"dm_rate_limit_total_hours\":24,\"show_email_cutoff_cta_top\":\"control\",\"minimum_ios_version\":2200,\"dm_rate_limit_total_requests\":1000,\"disable_annual_subscriptions\":false,\"enable_bestseller_survey_modal_override\":false,\"enable_transcript_as_post_body\":false,\"enable_android_dms\":false,\"use_substrate_sdxl\":false,\"recipes_enabled\":false,\"disable_deletion\":false,\"enable_dm_realtime_percentage\":100},\"publicationSettings\":{\"block_ai_crawlers\":true,\"credit_token_enabled\":false,\"custom_tos_and_privacy\":false,\"did_identity\":null,\"disable_optimistic_bank_payments\":false,\"display_welcome_page_details\":true,\"enable_meetings\":false,\"payment_pledges_enabled\":true,\"enable_post_page_conversion\":true,\"enable_prev_next_nav\":false,\"enable_restacking\":true,\"google_analytics_4_token\":null,\"group_sections_and_podcasts_in_menu_enabled\":false,\"medium_length_description\":\"\",\"notes_feed_enabled\":false,\"paywall_unlock_tokens\":false,\"post_preview_crop_gravity\":\"center\",\"reader_referrals_enabled\":false,\"reader_referrals_leaderboard_enabled\":false,\"seen_coming_soon_explainer\":false,\"seen_google_analytics_migration_modal\":false,\"local_currency_modal_seen\":false,\"local_payment_methods_modal_seen\":false,\"twitter_pixel_signup_event_id\":null,\"twitter_pixel_subscribe_event_id\":null,\"use_local_currency\":false,\"use_local_payment_methods\":true,\"welcome_page_opt_out_text\":\"No thanks\",\"cookie_settings\":\"\"},\"publicationUserSettings\":null,\"userSettings\":{\"user_id\":null,\"activity_likes_enabled\":true,\"hasDismissedSectionToNewsletterRename\":false,\"is_guest_post_enabled\":true,\"feed_web_nux_seen_at\":null,\"has_seen_select_to_restack_tooltip_nux\":false,\"invite_friends_nux_dismissed_at\":null,\"suggestions_feed_item_last_shown_at\":null,\"has_seen_select_to_restack_modal\":false,\"last_home_tab\":null,\"last_notification_alert_shown_at\":null,\"disable_reply_hiding\":false,\"newest_seen_chat_item_published_at\":null,\"explicitContentEnabled\":false,\"contactMatchingEnabled\":false,\"messageRequestLevel\":\"everyone\",\"creditTokensTreatmentExposed\":false,\"appBadgeIncludesChat\":false},\"subscriberCountDetails\":\"hundreds of subscribers\",\"mux_env_key\":\"u42pci814i6011qg3segrcpp9\",\"sentry_environment\":\"production\",\"launchWelcomePage\":false,\"noIndex\":false,\"post\":{\"id\":144104758,\"editor_v2\":false,\"publication_id\":1939983,\"type\":\"newsletter\",\"title\":\"MapReduce from Scratch\",\"social_title\":\"MapReduce from Scratch\",\"section_id\":null,\"search_engine_title\":null,\"search_engine_description\":\"Building a distributed computing framework, step by step.\",\"subtitle\":\"Building a distributed computing framework, step by step.\",\"slug\":\"mapreduce-from-scratch\",\"post_date\":\"2024-04-28T21:33:39.100Z\",\"podcast_url\":\"\",\"podcast_art_url\":null,\"podcast_duration\":null,\"video_upload_id\":null,\"podcast_upload_id\":null,\"podcast_preview_upload_id\":null,\"audience\":\"everyone\",\"should_send_free_preview\":false,\"write_comment_permissions\":\"everyone\",\"show_guest_bios\":true,\"free_unlock_required\":false,\"default_comment_sort\":null,\"canonical_url\":\"https://michalpitr.substack.com/p/mapreduce-from-scratch\",\"audience_before_archived\":null,\"exempt_from_archive_paywall\":false,\"teaser_post_eligible\":true,\"restacks\":1,\"reactions\":{\"\u2764\":8},\"top_exclusions\":[],\"pins\":[1939983],\"section_pins\":[],\"previous_post_slug\":\"how-does-sqlite-store-data\",\"next_post_slug\":null,\"cover_image\":\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc1d3a7a5-e2cc-4778-bafe-03f87e6a6884_1600x671.png\",\"cover_image_is_square\":false,\"cover_image_is_explicit\":false,\"videoUpload\":null,\"podcastFields\":{\"post_id\":144104758,\"podcast_episode_number\":null,\"podcast_season_number\":null,\"podcast_episode_type\":null,\"should_syndicate_to_other_feed\":null,\"syndicate_to_section_id\":null,\"hide_from_feed\":false,\"free_podcast_url\":null,\"free_podcast_duration\":null},\"podcastUpload\":null,\"podcastPreviewUpload\":null,\"voiceover_upload_id\":null,\"voiceoverUpload\":null,\"has_voiceover\":false,\"description\":\"Building a distributed computing framwork, step by step.\",\"body_html\":\"<p>Over the last couple of weeks, I\u2019ve been building MapReduce from scratch. </p><p>This will be a long article: we\u2019ll understand the need for distributed computing, rediscover why MapReduce is a natural way to model many problems, build our own version, understand how individual parts fit together, and solve a real problem with it!</p><h2>Motivating the problem</h2><p>Suppose we want to count the word frequencies in a massive dataset. We tried to process it on a single machine but found it would take over a month. What can we do?<br><br>The first thought should be to get a faster machine, but it either might not exist or be too expensive. Instead, let\u2019s see how we can distribute the problem across N commodity machines. We want an easy way to look up the frequency of any word with a simple query, i.e. grep over a file.<br><br>Let\u2019s start by splitting the dataset into N partitions and computing word frequencies for each subset using a different machine. This already gives us Nx speedup minus some fixed overhead. To combine the results, we can add a final machine that takes these N partial result files and sums the frequencies of corresponding words.<br><br>This is not too far from the core idea behind MapReduce. The above process has two main steps: first, we<em> map</em> words to their frequency in a subset of input data and then <em>reduce</em> the intermediate results to obtain the final answer.&nbsp;</p><p>Note that this is pretty general, imagine we have a large dataset of photos that we want to classify: we could do the image classification task as a map operation and then group images with the same class in the reduce phase.<br><br>Another observation is that the map part is usually the more expensive phase of the two, so generally, we will have more mappers than reducers.</p><p>Having hopefully convinced you that MapReduce is a reasonable idea, let\u2019s see how the MapReduce paper solves the word frequency problem.</p><div class=\\\"subscription-widget-wrap-editor\\\" data-attrs=\\\"{&quot;url&quot;:&quot;https://michalpitr.substack.com/subscribe?&quot;,&quot;text&quot;:&quot;Subscribe&quot;,&quot;language&quot;:&quot;en&quot;}\\\" data-component-name=\\\"SubscribeWidgetToDOM\\\"><div class=\\\"subscription-widget show-subscribe\\\"><div class=\\\"preamble\\\"><p class=\\\"cta-caption\\\">Thanks for reading Michal\u2019s Substack! Subscribe for free to receive new posts and support my work.</p></div><form class=\\\"subscription-widget-subscribe\\\"><input type=\\\"email\\\" class=\\\"email-input\\\" name=\\\"email\\\" placeholder=\\\"Type your email\u2026\\\" tabindex=\\\"-1\\\"><input type=\\\"submit\\\" class=\\\"button primary\\\" value=\\\"Subscribe\\\"><div class=\\\"fake-input-wrapper\\\"><div class=\\\"fake-input\\\"></div><div class=\\\"fake-button\\\"></div></div></form></div></div><h2>Using MapReduce</h2><p>Below, I copy-pasted the WordCounter MapReduce program from the <a href=\\\"https://static.googleusercontent.com/media/research.google.com/en//archive/mapreduce-osdi04.pdf\\\">paper</a>. Let\u2019s see how it works. Later, when we implement our version, we\u2019ll aim to keep the usage semantics the same.</p><pre><code>#include \\\"mapreduce/mapreduce.h\\\"\\n\\n// User\u2019s map function\\nclass WordCounter : public Mapper\\n{\\npublic:\\n    virtual void Map(const MapInput &amp;input)\\n    {\\n        const string &amp;text = input.value();\\n        const int n = text.size();\\n        for (int i = 0; i &lt; n;)\\n        {\\n            // Skip past leading whitespace\\n            while ((i &lt; n) &amp;&amp; isspace(text[i]))\\n                i++;\\n            // Find word end\\n            int start = i;\\n            while ((i &lt; n) &amp;&amp; !isspace(text[i]))\\n                i++;\\n            if (start &lt; i)\\n                Emit(text.substr(start, i - start), \\\"1\\\");\\n        }\\n    }\\n};\\nREGISTER_MAPPER(WordCounter);\\n\\n// User\u2019s reduce function\\nclass Adder : public Reducer\\n{\\n    virtual void Reduce(ReduceInput *input)\\n    {\\n        // Iterate over all entries with the\\n        // same key and add the values\\n        int64 value = 0;\\n        while (!input-&gt;done())\\n        {\\n            value += StringToInt(input-&gt;value());\\n            input-&gt;NextValue();\\n        }\\n        // Emit sum for input-&gt;key()\\n        Emit(IntToString(value));\\n    }\\n};\\nREGISTER_REDUCER(Adder);\\n\\nint main(int argc, char **argv)\\n{\\n    ParseCommandLineFlags(argc, argv);\\n    MapReduceSpecification spec;\\n    \\n    // Store list of input files into \\\"spec\\\"\\n    for (int i = 1; i &lt; argc; i++)\\n    {\\n        MapReduceInput *input = spec.add_input();\\n        input-&gt;set_format(\\\"text\\\");\\n        input-&gt;set_filepattern(argv[i]);\\n        input-&gt;set_mapper_class(\\\"WordCounter\\\");\\n    }\\n    \\n    MapReduceOutput *out = spec.output();\\n    out-&gt;set_filebase(\\\"/gfs/test/freq\\\");\\n    out-&gt;set_num_tasks(100);\\n    out-&gt;set_format(\\\"text\\\");\\n    out-&gt;set_reducer_class(\\\"Adder\\\");\\n    \\n    // Tuning parameters: use at most 2000\\n    // machines and 100 MB of memory per task\\n    spec.set_machines(2000);\\n    spec.set_map_megabytes(100);\\n    spec.set_reduce_megabytes(100);\\n    \\n    // Now run it\\n    MapReduceResult result;\\n    if (!MapReduce(spec, &amp;result))\\n        abort();\\n    // Done: \u2019result\u2019 structure contains info\\n    // about counters, time taken, number of\\n    // machines used, etc.\\n    return 0;\\n}</code></pre><p>The user program has 3 parts: map function, reduce function, and configuration. Most of the heavy lifting is handled by the imported <code>mapreduce</code> library.</p><p>The map function splits the input text into words and emits key-value pairs. For instance, <em>\u201Cthe quick brown fox jumps over the lazy dog\u201D</em> is mapped to these key-value pairs: [\u201Cthe\u201D:1, \u201Cquick\u201D:1, \u201Cbrown\u201D:1, \u201Cfox\u201D:1, \u201Cjumps\u201D: 1, \u201Cover\u201D:1, \u201Cthe\u201D:1, \u201Clazy\u201D:1, \u201Cdog\u201D:1]. Notice that the pair (\u201Cthe\u201D: 1) is emitted twice.</p><p>The reduce function operates per key. For instance, given the input [\u201Cthe\u201D:1, \u201Cthe\u201D:1\u201D, \u201Cthe\u201D:1] it would emit (\u201Cthe\u201D:3).</p><p>The config handles input-output, formats, and the number of resources available for the MapReduce job.</p><p>In less than 100 lines of code, we can solve the word counting problem by utilizing 1000s of machines! That\u2019s pretty neat and shows how powerful of an abstraction MapReduce is.</p><h2>Gathering requirements</h2><p>With the paper as our inspiration, let\u2019s start outlining the requirements for our implementation:</p><ul><li><p>The user imports our MapReduce library, implements Map and Reduce functions, and provides configuration.</p></li><li><p>When a user executes the binary, it is copied to multiple machines where it executes in either Mapper or Reducer mode.</p></li><li><p>Those machines must have access to input data.</p></li><li><p>Outputs of mappers must be available to reducers.</p></li><li><p>The user can access the final results.</p></li></ul><h2>Infrastructure</h2><p>When I started working on this, these requirements presented two main unknowns: <em>how to distribute the binary to other machines and how to make input data available to them.</em></p><p>After some research, I settled on hosting my input data on a networked storage server - I chose NFS. We can mount the networked directory on every machine and allow the machines to read and write to it. It won\u2019t be as performant or scalable as Google File System or HDFS, but it will do for our purposes.</p><p>To distribute the binary to multiple machines, execute it, and monitor its status, we could probably get quite far by copying the binary via SCP, SSHing into machines, executing the binary, and then waiting for it to finish. We could even implement health-pinging and progress-reporting.</p><p>However, after twiddling my thumbs for a while, I realized that this sounds awfully like cluster orchestration and decided to leverage Kubernetes to make my life easier. We can build the binary as a docker image and execute it as Kubernetes <a href=\\\"https://kubernetes.io/docs/concepts/workloads/controllers/job/\\\">Jobs</a>. Integrating NFS with Kubernetes is easy enough via Persistent Volumes and Persistent Volume Claims. Don\u2019t worry, you don\u2019t need to understand these concepts, but I mention them for completeness.</p><p>Since I\u2019m developing this for educational purposes, I use <a href=\\\"https://minikube.sigs.k8s.io/docs/start/\\\">minikube</a> to spin up a local virtual cluster on my laptop. I run my NFS server as a docker container outside the cluster and connect it to the cluster via docker networking. The advantage of this setup is that it can be easily migrated to several physical or virtual machines.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link is-viewable-img image2\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa41a20ea-44f8-49c1-be92-e53ab9f17a2b_1304x747.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa41a20ea-44f8-49c1-be92-e53ab9f17a2b_1304x747.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa41a20ea-44f8-49c1-be92-e53ab9f17a2b_1304x747.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa41a20ea-44f8-49c1-be92-e53ab9f17a2b_1304x747.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa41a20ea-44f8-49c1-be92-e53ab9f17a2b_1304x747.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa41a20ea-44f8-49c1-be92-e53ab9f17a2b_1304x747.png\\\" width=\\\"1304\\\" height=\\\"747\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/a41a20ea-44f8-49c1-be92-e53ab9f17a2b_1304x747.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:747,&quot;width&quot;:1304,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:null,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:null,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa41a20ea-44f8-49c1-be92-e53ab9f17a2b_1304x747.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa41a20ea-44f8-49c1-be92-e53ab9f17a2b_1304x747.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa41a20ea-44f8-49c1-be92-e53ab9f17a2b_1304x747.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fa41a20ea-44f8-49c1-be92-e53ab9f17a2b_1304x747.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2 \\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></a><figcaption class=\\\"image-caption\\\">Infrastructure setup</figcaption></figure></div><p>With infrastructure sorted out, let\u2019s start writing our MapReduce framework!</p><h2>Using my MapReduce</h2><p>First, we\u2019ll explore how to solve the word-counting problem using my MapReduce implementation. Then, we\u2019ll deep dive into the implementation to understand how individual components function.</p><p>As promised, I tried to keep the usage semantics similar to the original paper. Compare this MapReduce program using my Go implementation against the C++ example we saw before! </p><pre><code>// main.go\\n\\nimport (\\n  \u2026\\n\\n  \\\"github.com/MichalPitr/map_reduce/pkg/config\\\"\\n  \\\"github.com/MichalPitr/map_reduce/pkg/interfaces\\\"\\n  \\\"github.com/MichalPitr/map_reduce/pkg/mapreduce\\\"\\n)\\n\\ntype WordCounter struct {\\n  wordRegex *regexp.Regexp\\n}\\n\\nfunc (wc *WordCounter) Map(input interfaces.MapInput, emit func(key, value string)) {\\n  text := input.Value()\\n  text = strings.ToLower(text)\\n  words := wc.wordRegex.FindAllString(text, -1)\\n  for _, word := range words {\\n    emit(word, \\\"1\\\")\\n  }\\n}\\n\\ntype Adder struct{}\\n\\nfunc (a *Adder) Reduce(input interfaces.ReducerInput, emit func(value string)) {\\n  val := 0\\n  for !input.Done() {\\n    num, err := strconv.Atoi(input.Value())\\n    if err != nil {\\n      log.Printf(\\\"Failed converting input to integer, skipping: %q\\\", input.Value())\\n      input.NextValue()\\n      continue\\n    }\\n  val += num\\n  input.NextValue()\\n  }\\n  emit(strconv.Itoa(val))\\n}\\n\\nfunc main() {\\n  cfg := config.SetupJobConfig()\\n  log.Printf(\\\"cfg: %+v\\\", cfg)\\n  cfg.NumReducers = 2\\n  cfg.NumMappers = 4\\n\\n\\n  cfg.Mapper = &amp;WordCounter{wordRegex: regexp.MustCompile(`\\\\b\\\\w+\\\\b`)}\\n  cfg.Reducer = &amp;Adder{}\\n\\n  mapreduce.Execute(cfg)\\n}</code></pre><p>Let\u2019s spend some time understanding how my solution works behind the scenes. We can reference a handy diagram from the paper illustrating this. </p><p>The user\u2019s program is executed in three modes, Master, Mapper, and Reducer, on different machines. At a high level, the master handles the entire job orchestration, mappers do the expensive map operation over input files, and reducers combine intermediate results from mappers. In my solution, the mode is determined by a CLI flag, e.g. <code>--mode=master</code> for master mode. </p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link is-viewable-img image2\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F96d2f911-95ac-4428-9afe-6d1b0e25340b_818x644.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F96d2f911-95ac-4428-9afe-6d1b0e25340b_818x644.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F96d2f911-95ac-4428-9afe-6d1b0e25340b_818x644.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F96d2f911-95ac-4428-9afe-6d1b0e25340b_818x644.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F96d2f911-95ac-4428-9afe-6d1b0e25340b_818x644.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F96d2f911-95ac-4428-9afe-6d1b0e25340b_818x644.png\\\" width=\\\"728\\\" height=\\\"573.1442542787286\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/96d2f911-95ac-4428-9afe-6d1b0e25340b_818x644.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:false,&quot;imageSize&quot;:&quot;normal&quot;,&quot;height&quot;:644,&quot;width&quot;:818,&quot;resizeWidth&quot;:728,&quot;bytes&quot;:null,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:null,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F96d2f911-95ac-4428-9afe-6d1b0e25340b_818x644.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F96d2f911-95ac-4428-9afe-6d1b0e25340b_818x644.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F96d2f911-95ac-4428-9afe-6d1b0e25340b_818x644.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F96d2f911-95ac-4428-9afe-6d1b0e25340b_818x644.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2 \\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></a><figcaption class=\\\"image-caption\\\"></figcaption></figure></div><h2>Master</h2><p>Master mode splits input files into subsets, prepares NFS directories, launches mapper jobs with assigned files, and waits for them to finish. Then it repeats the process for reducers. The main master function is simple enough that I can list it here:</p><pre><code>// /pkg/master/master.go\\n\\nfunc Run(cfg *config.Config) {\\n  clientset := createKubernetesClient()\\n  numNodes := getNumberOfNodes(clientset)\\n  mustValidateConfig(cfg, numNodes)\\n\\n  jobId := fmt.Sprintf(\\\"job-%s\\\", time.Now().Format(\\\"2006-01-02-15-04-05\\\"))\\n  log.Printf(\\\"Running master: %s\\\", jobId)\\n\\t\\n  mustCreateJobDir(cfg.NfsPath, jobId)\\n  fileRanges := partitionInputFiles(cfg.InputDir, cfg.NumMappers)\\n\\n  t0 := time.Now()\\n  launchMappers(cfg, clientset, jobId, fileRanges)\\n  waitForJobsToComplete(clientset, jobId, \\\"mapper\\\")\\n  log.Printf(\\\"Mappers took %v to finish\\\", time.Since(t0))\\n\\n  t1 := time.Now()\\n  launchReducers(cfg, clientset, jobId)\\n  waitForJobsToComplete(clientset, jobId, \\\"reducer\\\")\\n  log.Printf(\\\"Reducers took %v to finish\\\", time.Since(t1))\\n  log.Printf(\\\"Total runtime: %v\\\", time.Since(t0))\\n}</code></pre><p>Let\u2019s understand the <code>launchMappers</code> function. It creates a Kubernetes job for each mapper. The job spec specifies:</p><ul><li><p>Docker image containing our binary.</p></li><li><p>CLI arguments necessary for the mapper: mapper mode, input/output dirs, and files to process.</p></li><li><p>How to mount the NFS storage.</p></li></ul><p>Wait\u2026Docker image? We never created one! I\u2019ll show this in more detail when we finally run our solution, but Kubernetes revolves around containers so we dockerize our binary so that Kubernetes pods can download the binary.</p><p>After launchMappers creates a mapper job, Kubernetes assigns jobs to nodes within the cluster, starts the containers, and monitors their status.</p><p>Now that we can run mappers, it\u2019s time to learn how they work!</p><h2>Mappers</h2><p>In mapper mode, the binary scans input files line-by-line and passes the line to the user\u2019s map function. Map processes the text and emits key-value pairs using the injected emit function. </p><p>In my implementation, the emit function is super simple - it stores the key-value pairs in a map of dynamic lists. A more complete implementation would do some buffering and then flush the buffer to the disk.</p><p>When the mapper finishes processing all inputs, it saves sorted key-value pairs to intermediate files in the NFS storage from where reducers will later read them for the final processing. Let\u2019s zoom out here and see how this mapping from intermediate files to reducers works.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link is-viewable-img image2\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0e7b17a6-a26c-4f89-9611-020b2b68bbd1_1600x648.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0e7b17a6-a26c-4f89-9611-020b2b68bbd1_1600x648.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0e7b17a6-a26c-4f89-9611-020b2b68bbd1_1600x648.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0e7b17a6-a26c-4f89-9611-020b2b68bbd1_1600x648.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0e7b17a6-a26c-4f89-9611-020b2b68bbd1_1600x648.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/w_2400,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0e7b17a6-a26c-4f89-9611-020b2b68bbd1_1600x648.png\\\" width=\\\"1020\\\" height=\\\"413.3241758241758\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/0e7b17a6-a26c-4f89-9611-020b2b68bbd1_1600x648.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:false,&quot;imageSize&quot;:&quot;large&quot;,&quot;height&quot;:590,&quot;width&quot;:1456,&quot;resizeWidth&quot;:1020,&quot;bytes&quot;:null,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:null,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}\\\" class=\\\"sizing-large\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0e7b17a6-a26c-4f89-9611-020b2b68bbd1_1600x648.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0e7b17a6-a26c-4f89-9611-020b2b68bbd1_1600x648.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0e7b17a6-a26c-4f89-9611-020b2b68bbd1_1600x648.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0e7b17a6-a26c-4f89-9611-020b2b68bbd1_1600x648.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2 \\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></a></figure></div><p>We want to partition the intermediate files by keys such that all the same keys are processed by one reducer. For instance, \u201C<em>brown\u201D</em> and <em>\u201Cthe\u201D</em> appear in Mapper 1 and Mapper 2 intermediate files. We want to ensure each ends up being processed by the same reducer. Let\u2019s see an example.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link is-viewable-img image2\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc1d3a7a5-e2cc-4778-bafe-03f87e6a6884_1600x671.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc1d3a7a5-e2cc-4778-bafe-03f87e6a6884_1600x671.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc1d3a7a5-e2cc-4778-bafe-03f87e6a6884_1600x671.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc1d3a7a5-e2cc-4778-bafe-03f87e6a6884_1600x671.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc1d3a7a5-e2cc-4778-bafe-03f87e6a6884_1600x671.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/w_2400,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc1d3a7a5-e2cc-4778-bafe-03f87e6a6884_1600x671.png\\\" width=\\\"1036\\\" height=\\\"434.75\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/c1d3a7a5-e2cc-4778-bafe-03f87e6a6884_1600x671.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:false,&quot;imageSize&quot;:&quot;large&quot;,&quot;height&quot;:611,&quot;width&quot;:1456,&quot;resizeWidth&quot;:1036,&quot;bytes&quot;:null,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:null,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}\\\" class=\\\"sizing-large\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc1d3a7a5-e2cc-4778-bafe-03f87e6a6884_1600x671.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc1d3a7a5-e2cc-4778-bafe-03f87e6a6884_1600x671.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc1d3a7a5-e2cc-4778-bafe-03f87e6a6884_1600x671.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc1d3a7a5-e2cc-4778-bafe-03f87e6a6884_1600x671.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2 \\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></a></figure></div><p>To achieve this, when we save intermediate results from mappers, we partition the keys by the number of reducers R using the formula</p><div class=\\\"latex-rendered\\\" data-attrs=\\\"{&quot;persistentExpression&quot;:&quot;\\\\\\\\text{hash}(\\\\\\\\text{key}) \\\\\\\\text{ mod} \\\\\\\\text{ R}.&quot;,&quot;id&quot;:&quot;CHOFHMZVSJ&quot;}\\\" data-component-name=\\\"LatexBlockToDOM\\\"></div><p>For instance, using FNV hash and R = 2, we get</p><div class=\\\"latex-rendered\\\" data-attrs=\\\"{&quot;persistentExpression&quot;:&quot;1 \\\\\\\\equiv \\\\\\\\text{FNV}(\\\\\\\\textit{brown}) \\\\\\\\text{ mod } 2 &quot;,&quot;id&quot;:&quot;LIKWPRZPTT&quot;}\\\" data-component-name=\\\"LatexBlockToDOM\\\"></div><p>(maths note: this reads as \u201C1 is congruent to FNV(<em>brown</em>) mod 2\u201D.)</p><p>Based on this, we assign <em>\u201Cbrown\u201D</em> to the 2nd intermediate file, which is to be processed by reducer 2. Notice how in the example above, all <em>\u201Cthe\u201D</em>s landed in the blue files, while all the <em>\u201Cbrown\u201D</em>s landed in the red files!</p><p>This concludes the discussion on mappers - next, let\u2019s see how reducers work.</p><h2>Reducers</h2><p>As highlighted previously, the reducer\u2019s job is to read key-value pairs from the assigned intermediate files and process them using the user-defined reduce function. </p><p>We can be certain of two things: the keys in intermediate files are sorted by key and if a key <strong>A</strong> is present in one of these intermediate files, we are guaranteed that key <strong>A</strong> is not present in any file assigned to other reducers.</p><p>I tried to be smarter about my reducer implementation and avoid loading all intermediate files into memory. This comes with an interesting algorithmic problem:</p><p>Suppose we are trying to process 3 intermediate files, key-value pair at a time without loading everything into memory.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link is-viewable-img image2\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4a4c593-bd86-4471-9263-3fff6eadd11e_1076x998.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4a4c593-bd86-4471-9263-3fff6eadd11e_1076x998.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4a4c593-bd86-4471-9263-3fff6eadd11e_1076x998.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4a4c593-bd86-4471-9263-3fff6eadd11e_1076x998.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4a4c593-bd86-4471-9263-3fff6eadd11e_1076x998.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4a4c593-bd86-4471-9263-3fff6eadd11e_1076x998.png\\\" width=\\\"552\\\" height=\\\"511.98513011152414\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/f4a4c593-bd86-4471-9263-3fff6eadd11e_1076x998.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:998,&quot;width&quot;:1076,&quot;resizeWidth&quot;:552,&quot;bytes&quot;:null,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:null,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4a4c593-bd86-4471-9263-3fff6eadd11e_1076x998.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4a4c593-bd86-4471-9263-3fff6eadd11e_1076x998.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4a4c593-bd86-4471-9263-3fff6eadd11e_1076x998.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff4a4c593-bd86-4471-9263-3fff6eadd11e_1076x998.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2 \\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></a></figure></div><p>We can merge the key-value pairs on the fly using a min-heap! We load the first key-value pair from each file into the heap. Whenever we pop from the heap, we read the next line from the corresponding file and push it onto the heap. This gives us a memory-efficient way to read a stream of key-value pairs! You can find the implementation <a href=\\\"https://github.com/MichalPitr/map_reduce/blob/main/pkg/reducer/stream_merger.go\\\">here</a>. </p><p>After processing all intermediate files, the reducer saves results to the NFS storage.</p><p>For instance, the above example would yield: [\u201Cabby\u201D: 1, \u201Calice\u201D: 3, \u201Cbob\u201D: 2, \u201Ccar\u201D:2, \u201Cdog\u201D:1, \u2026].</p><p>The MapReduce paper introduces a couple of additional optimizations that I skipped in my implementation. Astute readers can probably come up with some already - for instance, couldn\u2019t we optionally do some reduction already on the mapper?</p><p>Congratulations, you now have a pretty complete understanding of MapReduce! The hard part is over! Let\u2019s put it together and count the word frequencies in the top <a href=\\\"https://www.gutenberg.org/browse/scores/top#authors-last30\\\">100 most popular books on Project Gutenberg</a> using our MapReduce!</p><h2>MapReduce in action</h2><p>I downloaded the 100 most popular books on Project Gutenberg to <code>/mnt/nfs/input/</code> with this <a href=\\\"https://github.com/MichalPitr/map_reduce/blob/main/utils/create-dataset.py\\\">script</a>. The book files are labeled <em>book-0</em> to <em>book-99</em>. I also created a 4-node minikube cluster with access to my NFS storage.</p><pre><code>michal@michal-ThinkPad-T490s:/mnt/nfs$ kubectl get nodes\\nNAME            STATUS   ROLES           AGE    VERSION\\nmultinode       Ready    control-plane   27d    v1.28.3\\nmultinode-m02   Ready    &lt;none&gt;          7d2h   v1.28.3\\nmultinode-m04   Ready    &lt;none&gt;          7d1h   v1.28.3\\nmultinode-m05   Ready    &lt;none&gt;          7d1h   v1.28.3</code></pre><p>I will be reusing the word-frequencies Go main file I showed earlier. We must prepare the docker image using this <a href=\\\"https://github.com/MichalPitr/map_reduce/blob/main/Dockerfile\\\">Dockerfile</a> and push it to my registry. The mapper and reducer nodes will pull this image to run our workloads.</p><pre><code>docker build -t michalpitr/mapreduce:latest .\\ndocker push michalpitr/mapreduce:latest</code></pre><p>Now all we need to do is run the master locally!</p><pre><code>go build .\\n./map_reduce --mode=master --image=michalpitr/mapreduce:latest --input-dir /mnt/input/ --nfs-path /mnt/nfs/</code></pre><p>Let\u2019s inspect the execution logs.</p><pre><code>michal@michal-ThinkPad-T490s:~/code/map_reduce$ ./map_reduce --mode=ma\\nster --image=michalpitr/mapreduce:latest --input-dir /mnt/nfs/input/ -\\n-nfs-path /mnt/nfs/\\n2024/04/28 17:13:53 Running master job-2024-04-28-17-13-53\\n2024/04/28 17:13:53 Creating mapper-0 for book-0-30\\n2024/04/28 17:13:53 Creating mapper-1 for book-31-53\\n2024/04/28 17:13:53 Creating mapper-2 for book-54-76\\n2024/04/28 17:13:53 Creating mapper-3 for book-77-99\\n2024/04/28 17:13:53 Waiting for jobs to finish.\\n2024/04/28 17:14:03 Waiting for jobs to finish.\\n2024/04/28 17:14:13 Waiting for jobs to finish.\\n2024/04/28 17:14:23 All jobs completed.\\n2024/04/28 17:14:23 Mappers took 30.1843218s to finish\\n2024/04/28 17:14:23 Creating reducer-0\\n2024/04/28 17:14:23 Creating reducer-1\\n2024/04/28 17:14:23 Waiting for jobs to finish.\\n2024/04/28 17:14:33 All jobs completed.\\n2024/04/28 17:14:33 Reducers took 10.106014703s to finish\\n2024/04/28 17:14:33 Total runtime: 40.290376921s</code></pre><p>The whole job took 40s. We aren\u2019t expecting anything crazy here, after all, I\u2019m running this on an underpowered laptop and not a <em>real</em> cluster.</p><p>Let\u2019s walk through this a little. The master creates 4 mappers, each with an assigned book range.</p><p>Using <code>kubectl</code>, we can see that the cluster is creating 4 containers. This is when the cluster pulls the image we pushed earlier!</p><pre><code>michal@michal-ThinkPad-T490s:/mnt/nfs$ kubectl get pods\\nNAME             READY   STATUS              RESTARTS   AGE\\nmapper-0-zgz24   0/1     ContainerCreating   0          11s\\nmapper-1-m824k   0/1     ContainerCreating   0          11s\\nmapper-2-ctqqt   0/1     ContainerCreating   0          11s\\nmapper-3-l2ddh   0/1     ContainerCreating   0          11s</code></pre><p>These don\u2019t take very long to start running and to finish.</p><pre><code>michal@michal-ThinkPad-T490s:/mnt/nfs$ kubectl get pods\\nNAME             READY   STATUS      RESTARTS   AGE\\nmapper-0-zgz24   1/1     Running     0          18s\\nmapper-1-m824k   0/1     Completed   0          18s\\nmapper-2-ctqqt   0/1     Completed   0          18s\\nmapper-3-l2ddh   0/1     Completed   0          18s</code></pre><p>The master periodically polls the Kubernetes API server for the status of these jobs. Once they are all finished, it launches the reducers.</p><p>Before we go to reducers, let\u2019s see the intermediate files produced by one of the mappers:</p><pre><code>michal@michal-ThinkPad-T490s:/mnt/nfs/job-2024-04-28-17-13-53/mapper-3$ ls\\npartition-0  partition-1</code></pre><p>Inspecting the end of partition-1 shows key-value pairs of a character from Dostoevsky\u2019s Notes from Underground. So far so good!</p><pre><code>michal@michal-ThinkPad-T490s:/mnt/nfs/job-2024-04-28-17-13-53/mapper-3$ tail partition-1\\nzverkov,1\\nzverkov,1\\nzverkov,1\\nzverkov,1\\nzverkov,1\\n\u2026</code></pre><p>Next, the master launches reducers,</p><pre><code>michal@michal-ThinkPad-T490s:/mnt/nfs$ kubectl get pods\\nNAME              READY   STATUS              RESTARTS   AGE\\n\u2026\\nreducer-0-4xt58   0/1     ContainerCreating   0          2s\\nreducer-1-xvhfk   0/1     ContainerCreating   0          2s</code></pre><p>which swiftly finish.</p><pre><code>michal@michal-ThinkPad-T490s:/mnt/nfs$ kubectl get pods\\nNAME              READY   STATUS      RESTARTS   AGE\\n\u2026\\nreducer-0-4xt58   0/1     Completed   0          7s\\nreducer-1-xvhfk   0/1     Completed   0          7s</code></pre><p>That\u2019s it - we just computed word frequencies using our very own MapReduce framework! Let\u2019s see what we can learn from the results!</p><p>I can see the output files in the root of the job folder:</p><pre><code>michal@michal-ThinkPad-T490s:/mnt/nfs/job-2024-04-28-17-13-53$ ls\\n\u2026  reducer-0  reducer-1</code></pre><p>Let\u2019s use grep to find the frequencies of some words.</p><pre><code>michal@michal-ThinkPad-T490s:/mnt/nfs/job-2024-04-28-17-13-53$ grep -w zverkov reducer-0 reducer-1\\nreducer-1:zverkov,112\\n\\nmichal@michal-ThinkPad-T490s:/mnt/nfs/job-2024-04-28-17-13-53$ grep -w the reducer-0 reducer-1\\nreducer-1:the,822175\\n\\nmichal@michal-ThinkPad-T490s:/mnt/nfs/job-2024-04-28-17-13-53$ grep -w mapreduce reducer-0 reducer-1\\nmichal@michal-ThinkPad-T490s:/mnt/nfs/job-2024-04-28-17-13-53$ \\n\\nmichal@michal-ThinkPad-T490s:/mnt/nfs/job-2024-04-28-17-13-53$ grep -w map reducer-0 reducer-1\\nreducer-1:map,188\\n\\nmichal@michal-ThinkPad-T490s:/mnt/nfs/job-2024-04-28-17-13-53$ grep -w reduce reducer-0 reducer-1\\nreducer-0:reduce,123</code></pre><p>Unfortunately, there are no mentions of MapReduce in the top 100 most popular books on Project Gutenberg\u2026 maybe one day?</p><p>One final note, notice how these output files partition the result space by key. When we look for a word, it\u2019s only present in one file! It\u2019s almost as if we did something right!</p><p>If you made it this far, you might as well check out the <a href=\\\"https://github.com/MichalPitr/map_reduce\\\">GitHub repo</a>. You\u2019ll already be familiar with most ideas!</p><div><hr></div><div class=\\\"subscription-widget-wrap-editor\\\" data-attrs=\\\"{&quot;url&quot;:&quot;https://michalpitr.substack.com/subscribe?&quot;,&quot;text&quot;:&quot;Subscribe&quot;,&quot;language&quot;:&quot;en&quot;}\\\" data-component-name=\\\"SubscribeWidgetToDOM\\\"><div class=\\\"subscription-widget show-subscribe\\\"><div class=\\\"preamble\\\"><p class=\\\"cta-caption\\\">Thanks for reading Michal\u2019s Substack! Subscribe for free to receive new posts and support my work.</p></div><form class=\\\"subscription-widget-subscribe\\\"><input type=\\\"email\\\" class=\\\"email-input\\\" name=\\\"email\\\" placeholder=\\\"Type your email\u2026\\\" tabindex=\\\"-1\\\"><input type=\\\"submit\\\" class=\\\"button primary\\\" value=\\\"Subscribe\\\"><div class=\\\"fake-input-wrapper\\\"><div class=\\\"fake-input\\\"></div><div class=\\\"fake-button\\\"></div></div></form></div></div><p>Congratulations, you made it! If you enjoyed this deep dive, you might enjoy my previous one into <a href=\\\"https://michalpitr.substack.com/p/how-does-sqlite-store-data\\\">SQLite storage format internals</a>. Researching and writing these articles takes a lot of time and effort. To ensure you don\u2019t miss the next one, consider subscribing or following me on <a href=\\\"https://www.linkedin.com/in/michal-pitr-a7156b127/\\\">LinkedIn</a>.</p><p></p>\",\"longer_truncated_body_json\":null,\"longer_truncated_body_html\":null,\"truncated_body_text\":\"Over the last couple of weeks, I\u2019ve been building MapReduce from scratch. This will be a long article: we\u2019ll understand the need for distributed computing, rediscover why MapReduce is a natural way to model many problems, build our own version, understand how individual parts fit together, and solve a real problem with it!\",\"wordcount\":2826,\"postTags\":[{\"id\":\"10fcf3f4-1c10-42eb-8fad-9754b46a5c72\",\"publication_id\":1939983,\"name\":\"kubernetes\",\"slug\":\"kubernetes\",\"hidden\":false},{\"id\":\"114e7021-7569-40d0-9118-88e5cd527b9a\",\"publication_id\":1939983,\"name\":\"distributed computing\",\"slug\":\"distributed-computing\",\"hidden\":false},{\"id\":\"27c0ccd7-163c-4948-9173-a971001b1569\",\"publication_id\":1939983,\"name\":\"programming\",\"slug\":\"programming\",\"hidden\":false},{\"id\":\"5f9e395d-be26-493b-a43d-5fb8d234a89a\",\"publication_id\":1939983,\"name\":\"mapreduce\",\"slug\":\"mapreduce\",\"hidden\":false},{\"id\":\"ab4b217e-099c-4107-886e-e70456356edb\",\"publication_id\":1939983,\"name\":\"system design\",\"slug\":\"system-design\",\"hidden\":false},{\"id\":\"d791876e-85ad-4173-ad5e-e6d897a28a6b\",\"publication_id\":1939983,\"name\":\"software engineering\",\"slug\":\"software-engineering\",\"hidden\":false},{\"id\":\"f3b64019-77d8-412e-9701-7e3624f977f6\",\"publication_id\":1939983,\"name\":\"go\",\"slug\":\"go\",\"hidden\":false}],\"publishedBylines\":[{\"id\":28235731,\"name\":\"Michal Pitr\",\"handle\":\"michalpitr\",\"previous_name\":null,\"photo_url\":\"https://substack-post-media.s3.amazonaws.com/public/images/73a6e774-038e-424d-afee-ce5041c3e7e0_1080x1080.jpeg\",\"bio\":\"Computer Science & Mathematics graduate from the University of Edinburgh. I love figuring out how systems work at a fundamental level and sharing my findings.\",\"profile_set_up_at\":\"2023-09-10T14:39:45.041Z\",\"publicationUsers\":[{\"id\":1930739,\"user_id\":28235731,\"publication_id\":1939983,\"role\":\"admin\",\"public\":true,\"is_primary\":false,\"publication\":{\"id\":1939983,\"name\":\"Michal\u2019s Substack\",\"subdomain\":\"michalpitr\",\"custom_domain\":null,\"custom_domain_optional\":false,\"hero_text\":\"My personal Substack\",\"logo_url\":\"https://substack-post-media.s3.amazonaws.com/public/images/be5ab36b-c782-420e-ac35-c7599a1f77ad_976x976.png\",\"author_id\":28235731,\"theme_var_background_pop\":\"#D10000\",\"created_at\":\"2023-09-10T14:39:47.894Z\",\"rss_website_url\":null,\"email_from_name\":null,\"copyright\":\"Michal Pitr\",\"founding_plan_name\":null,\"community_enabled\":true,\"invite_only\":false,\"payments_state\":\"disabled\",\"language\":null,\"explicit\":false}}],\"is_guest\":false,\"bestseller_tier\":null}],\"reaction\":null,\"reaction_count\":8,\"comment_count\":0,\"child_comment_count\":0,\"is_geoblocked\":false,\"hasCashtag\":false},\"comments\":[],\"canonicalUrl\":\"https://michalpitr.substack.com/p/mapreduce-from-scratch\",\"inlineComments\":false,\"readerIsSearchCrawler\":false,\"ogUrl\":\"https://michalpitr.substack.com/p/mapreduce-from-scratch\",\"bannedFromNotes\":false,\"themeVariables\":{\"color_theme_bg_pop\":\"#D10000\",\"background_pop\":\"#D10000\",\"color_theme_bg_web\":null,\"cover_bg_color\":\"#FFFFFF\",\"background_pop_darken\":\"#b80000\",\"print_on_pop\":\"#ffffff\",\"color_theme_bg_pop_darken\":\"#b80000\",\"color_theme_print_on_pop\":\"#ffffff\",\"border_subtle\":\"#f6dfdf\",\"background_subtle\":\"rgba(248, 217, 217, 0.4)\",\"print_pop\":\"#d10000\",\"color_theme_accent\":\"#d10000\",\"cover_print_primary\":\"#363737\",\"cover_print_secondary\":\"#757575\",\"cover_border_color\":\"#d10000\",\"home_hero\":\"newspaper\",\"home_posts\":\"list\",\"background_contrast_1\":\"#f0f0f0\",\"background_contrast_2\":\"#dddddd\",\"background_contrast_3\":\"#b7b7b7\",\"background_contrast_4\":\"#929292\",\"background_contrast_5\":\"#515151\",\"color_theme_detail\":\"#e6e6e6\",\"background_contrast_pop\":\"rgba(209, 0, 0, 0.4)\",\"color_theme_bg_contrast_pop\":\"rgba(209, 0, 0, 0.4)\",\"input_background\":\"#ffffff\",\"cover_input_background\":\"#ffffff\",\"tooltip_background\":\"#191919\",\"background_pop_rgb\":\"209, 0, 0\",\"background_pop_rgb_pc\":\"209 0 0\",\"color_theme_bg_pop_rgb\":\"209, 0, 0\",\"color_theme_bg_pop_rgb_pc\":\"209 0 0\",\"color_theme_accent_rgb\":\"209, 0, 0\",\"color_theme_accent_rgb_pc\":\"209 0 0\"},\"recentEpisodes\":null,\"trackFrontendVisit\":true,\"isChatActive\":false,\"isMeetingsActive\":false,\"features\":{},\"showCookieBanner\":false,\"disabledCookies\":[],\"dd_env\":\"zuma-prod\",\"dd_ti\":true}")</script>
        <script>window._analyticsConfig = JSON.parse("{\"properties\":{\"subdomain\":\"michalpitr\",\"publication_id\":1939983,\"has_plans\":false,\"pub_community_enabled\":true,\"is_subscribed\":false,\"is_free_subscribed\":false,\"is_author\":false,\"is_contributor\":false,\"is_admin\":false,\"is_founding\":false},\"adwordsAccountId\":\"AW-316245675\",\"adwordsEventSendTo\":\"Tf76CKqcyL4DEKuN5pYB\"}")</script>
        
            <script type="module" src="https://substackcdn.com/bundle/assets/main-514d96ed.js" charset="utf-8"  defer></script>
        
        <script nomodule>
            (function() {
                var message = 'Your browser does not support modern JavaScript modules. Please upgrade your browser for the best experience.';
                var warningDiv = document.createElement('div');
                warningDiv.style.color = 'red';
                warningDiv.style.padding = '10px';
                warningDiv.style.margin = '10px 0';
                warningDiv.style.border = '1px solid red';
                warningDiv.style.backgroundColor = 'lightyellow';
                warningDiv.innerText = message;
                document.body.prepend(warningDiv);
            })();
        </script>

        
            <!-- Datadog Analytics -->
            <script>
              (function(h,o,u,n,d) {
                h=h[d]=h[d]||{q:[],onReady:function(c){h.q.push(c)}}
                d=o.createElement(u);d.async=1;d.src=n
                n=o.getElementsByTagName(u)[0];n.parentNode.insertBefore(d,n)
              })(window,document,'script','https://www.datadoghq-browser-agent.com/us1/v5/datadog-rum.js','DD_RUM')
              window.DD_RUM.onReady(function() {
                window.DD_RUM.init({
                  clientToken: 'puba71073f072643721169b68f352438710',
                  applicationId: '2e321b35-c76b-4073-8d04-cc9a10461793',
                  site: 'datadoghq.com',
                  service: 'substack-web',
                  env: window._preloads.dd_env,
                  version: '577d2f6d67a1a6b9688f48fe7add73b60931292d',
                  sessionSampleRate: 1,
                  sessionReplaySampleRate: 100,
                  trackUserInteractions: window._preloads.dd_ti,
                  trackResources: true,
                  trackLongTasks: true,
                  defaultPrivacyLevel: 'mask-user-input',
                  allowedTracingUrls: [/https?:\/\/(.+\/.)?substack(cdn)?\.com/]
                });
              })
            </script>
            <!-- End Datadog Analytics -->

            <!-- Cloudflare Web Analytics -->
            <script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon='{"token": "216309cffb464db4b0e02daf0b8e8060"}'></script>
            <!-- End Cloudflare Web Analytics -->
        

        <!-- Fallback tracking pixels -->
        

        

        <noscript>
    <style>
        #nojs-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            padding: 16px 16px 16px 32px;
            width: 100%;
            box-sizing: border-box;
            background: red;
            color: white;
            font-family: -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            font-size: 13px;
            line-height: 13px;
        }
        #nojs-banner a {
            color: inherit;
            text-decoration: underline;
        }
    </style>

    <div id="nojs-banner">
        This site requires JavaScript to run correctly. Please <a href="https://enable-javascript.com/" target="_blank">turn on JavaScript</a> or unblock scripts
    </div>
</noscript>


        

        

        
        
    </body>
</html>
