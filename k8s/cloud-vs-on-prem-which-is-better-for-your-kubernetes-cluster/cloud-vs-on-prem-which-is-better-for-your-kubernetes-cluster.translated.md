# 云 vs. 自建：哪个更适合您的 Kubernetes 集群？

![Featued image for: 云 vs. 自建：哪个更适合您的 Kubernetes 集群？](https://cdn.thenewstack.io/media/2025/01/94707231-cloud-onprem-kubernetes-1024x576.jpg)

部署应用程序工作负载时需要考虑许多因素。许多组织使用 Kubernetes 来部署和容器化其工作负载，因为它提供了增强的可扩展性、自我修复和支持高可用性。但是，需要做出一个关键的决定，即他们希望如何托管其[Kubernetes 基础设施](https://thenewstack.io/kubernetes/)：部署在云上还是使用本地基础设施进行管理。

这两种方案都有其优点和缺点，可能使其中一种更适合特定的用例。在本文中，我们将探讨[云和本地部署](https://thenewstack.io/extending-cicd-and-gitops-for-better-k8s-app-deployments/)、它们的优缺点以及选择最适合不同用例的方法的技巧。

## 什么是云基础设施？

云指的是多个设备，每个设备都有自己的系统资源，例如 CPU、内存和存储，通过全球网络连接。云提供商（例如，[AWS](https://aws.amazon.com/?utm_content=inline+mention)、Azure 或 [GCP](https://cloud.google.com/?utm_content=inline+mention)）提供物理设备并管理物理基础设施，因此您可以专注于部署和管理应用程序，而不是管理硬件。[云服务](https://thenewstack.io/cloud-native/) 通常按需提供——即，您只需支付使用的内容和数量——并且设计为高度可扩展且能够承受停机。

使用云服务可以减少开发人员的操作开销：在 Kubernetes 上部署应用程序时，云提供商在为 Kubernetes 集群配置和管理基础设施方面发挥着巨大作用。他们还处理 Kubernetes 维护中的操作挑战，例如集群升级、备份和恢复、灾难管理和扩展。

即使您使用[kOps](https://kops.sigs.k8s.io/)或类似工具自行管理集群，您仍然可以通过使用虚拟机 (VM)（例如 AWS 的 EC2 实例）来利用云服务。托管的 Kubernetes 集群（例如 EKS、AKS 和 GKE）广泛用于部署生产应用程序，因为它们与云提供商的生态系统很好地集成，并且团队无需维护集群基础设施。

## 什么是本地基础设施？

本地是指您在组织内部获取物理基础设施、设置它并处理维护活动。组织拥有所有服务器和基础设施组件。自己设置基础设施比从云提供商处配置基础设施需要更多时间，并且必须定期维护，任务包括升级基础设施、执行定期安全检查和安装安全补丁。

在本地部署 Kubernetes 集群的过程比使用云提供商复杂得多。您必须首先使用一级虚拟机管理程序（例如[VMware](https://tanzu.vmware.com?utm_content=inline+mention) vSphere 或 Proxmox）虚拟化整个基础设施。然后，您需要手动创建所有必需的 VM 作为 Kubernetes 节点，生成[SSL 证书](https://roadmap.sh/guides/ssl-tls-https-ssh)，处理机器 DNS 并设置 Kubernetes 集群。如果您无法获得支持，则设置自动缩放机制会带来额外的挑战。在设置初始集群后，您仍然必须执行定期维护活动，例如证书轮换、集群升级和节点升级。

如果您想跨多个可用区分发 Kubernetes 集群，则需要找到一个数据中心，在每个数据中心获取和设置物理基础设施，并处理网络以实现无缝节点通信。相比之下，当尝试使用云提供商获得相同结果时，您必须指定希望在其中配置节点的区域。

## 云 vs. 本地：实际差异

使用云提供商托管应用程序工作负载和完全在本地部署基础设施存在显着差异。

### 部署
这两种方法的基础设施部署和管理方式存在重要差异。
## 云 vs 本地部署

### 成本

**云**:  在云上部署应用程序时，您只需为正在使用的资源付费。例如，如果您从云提供商处配置 10 台虚拟机，则只需支付这些虚拟机的运营成本。

**本地**: 在本地部署应用程序时，您需要预先采购基础设施并支付硬件成本，然后随着时间的推移支付基础设施管理、功耗和物理空间的费用。成本可能因工作负载的规模而异。对于本地部署，您需要一次性投入大量资金，以及基础设施维护的经常性成本；云提供商则有可优化的经常性成本。


### 控制

**云**: 在云中运行应用程序时，由于共享责任模型，控制权在用户和云提供商之间共享：云提供商控制整个基础设施，而用户控制其应用程序及其部署配置。云提供商还对许多底层基础设施进行了抽象，这限制了您的控制级别。此外，某些要求可能会导致云供应商锁定。

**本地**: 本地基础设施使您可以完全控制应用程序的各个方面，包括硬件资源以及数据存储和移动。这种完全控制使您可以确保数据不会离开您的场所，以任何您喜欢的方式自定义基础设施，并优化硬件和软件以满足您用例的安全或其他要求。本地环境和云环境之间的控制级别差异很大，并影响组织管理其基础设施、应用程序和数据的方式。对于某些用例，更高的控制可能至关重要。


### 安全

**云**: 安全性仍然是云上部署工作负载的主要关注点之一。云提供商负责维护基础设施安全。云提供商确实会发生数据泄露，导致凭据泄露、知识产权丢失等。使用诸如 Trivy 之类的容器镜像安全扫描工具可以帮助保护应用程序的安全性。

**本地**: 政府、银行和医疗保健等行业通常需要本地环境提供的较高安全级别、隐私和控制级别。严格的合规法规和数据驻留法使保留基础设施的完全所有权对于保护敏感信息至关重要。虽然云提供商提供强大的安全性，但共享责任模型会带来某些组织无法接受的风险。尽管成本更高且复杂性更高，但对于数据泄露或合规性失败可能造成严重后果的行业而言，本地设置仍然是首选。安全性可能是选择本地部署还是云部署的决定性因素。


### 维护

**云**: 在云环境中，提供商管理底层基础设施，包括硬件更新、补丁和网络配置。组织负责维护其应用程序、数据和配置，但消除了物理硬件和基础设施维护的操作负担。这使团队能够更加专注于创新，而不是例行维护。

**本地**: 本地环境要求组织处理维护的各个方面。这提供了完全控制，但增加了大量运营开销，需要熟练的人员和对工具和资源的持续投资。初始基础设施设置后，仍需执行定期维护任务，包括软件和硬件升级，以及更换故障设备。无论您使用的是云基础设施还是本地基础设施，有效的维护对于确保正常运行时间、安全性和性能都至关重要。


### 部署方式

虽然存在不同类型的云提供商，包括公有云、私有云和混合云，但应用程序和服务的部署方式基本相同。物理基础设施由云提供商拥有和管理。作为云用户，您需要配置合适的基础设施，例如 Kubernetes 集群，并部署您的应用程序。已部署的应用程序存在于云提供商的基础设施上。在本地基础设施中，您首先需要正确配置基础设施——安装合适的操作系统，引导 Kubernetes 集群并配置集群组件（例如，网络、存储）——然后部署应用程序。已部署的应用程序存在于您的基础设施上，您管理应用程序及其涉及的不同流程。

### 合规性
合规性确保组织遵守管理其运营的法律、法规和标准，尤其是在数据隐私、财务责任和行业特定要求等领域。这对于保护敏感信息、避免法律处罚以及维护与客户和利益相关者的信任至关重要。合规性通过促进透明度和问责制，帮助企业维护其声誉和信誉。在数据泄露和隐私问题日益增多的时代，强大的合规框架对于降低风险和展示道德实践至关重要。

**云**: 在云环境中，合规责任由提供商和客户共同承担。提供商通常会获得其基础设施的[认证](https://devtron.ai/blog/reasons-why-soc2-compliance-critical-for-cicd-vendors-and-customers/)（例如，SOC 2、ISO 27001），但组织必须确保其数据处理、配置和应用程序符合法规标准。这种共享责任需要仔细选择供应商并进行持续审计以保持合规性。**本地**: 在本地环境中，组织对满足合规性要求拥有完全的控制权和责任。这包括管理数据安全、基础设施和访问控制以遵守相关法规。虽然这种级别的控制提供了灵活性，但也需要大量的专业知识和资源来确保持续合规性。

## 混合云呢？
混合云架构结合了本地基础设施（或私有云）和公共云服务的优势。在此模型中，工作负载和数据可以在本地环境和云平台之间无缝移动，提供灵活性和可扩展性以及控制能力。组织可以使用混合云解决方案来平衡其运营需求，例如将敏感数据保留在本地，同时利用公共云的可扩展性来处理不太重要的工作负载或峰值需求。

混合云模型通常依赖于编排和统一管理工具来提供环境之间的无缝集成。容器化和Kubernetes等技术在实现这种互操作性方面发挥着重要作用，允许应用程序在本地和云基础设施上一致运行。

混合云环境已广泛应用于需要在灵活性和控制之间取得平衡的各个行业。例如：

* **金融和银行**: 敏感的客户数据保存在本地数据中心，公共云用于分析和面向客户的应用程序。
* **医疗保健**: 将病历存储在本地，并利用云平台进行远程医疗和研究，可以提高对数据隐私法规的遵守程度。
* **零售**: 使用混合云帮助零售商管理季节性需求高峰，在本地处理常规运营，并在销售高峰期向云端扩展。

混合云也有利于企业从传统系统过渡到现代云原生架构，因为它允许分阶段实施，而不会中断正在进行的运营。

## 管理工具和框架
在运行为生产设计的Kubernetes集群时，您需要使用强大的机制来管理整个集群。虽然kubectl有助于管理和与Kubernetes集群交互，但不建议将其用于管理生产集群：它不提供所有资源的整体可见性，需要复杂的命令来执行操作，并且在多个集群之间导航可能很繁琐。

有一些工具可以帮助管理云和本地环境中的集群：虽然有些工具可以同时用于这两种环境，但其他工具在其中一种环境中更强大。

### 云管理工具

以下是一些最有助于在云环境中操作、自动化和管理Kubernetes集群生命周期的工具。
**KEDA、HPA和Karpenter**: Kubernetes事件驱动自动缩放器(KEDA)、水平Pod自动缩放器(HPA)和Karpenter等自动缩放工具在托管Kubernetes集群上使用时最为强大。在云上运行时，这些自动缩放器可以轻松地根据需要扩展基础设施，而不会耗尽资源。**OpenCost**: 在云上运行Kubernetes集群时，很容易超支。OpenCost可以帮助您深入了解集群的整体支出，并且您可以设置自动缩放策略来帮助管理成本。**Karmada**: Karmada是一个开源工具，有助于更轻松地跨多个云管理Kubernetes集群。当您在不同的云提供商处托管多个Kubernetes集群时，它最有用。**AWS CloudFormation**: AWS CloudFormation允许您以声明性、编码的方式部署多个AWS特定资源——例如S3存储桶、EC2实例等等。这对于在特定条件下自动配置Kubernetes集群的资源非常有用。虽然CloudFormation特定于AWS，但Azure、GCP和其他云提供商也提供类似的服务。**Devtron和Rancher**: 诸如[Devtron](https://devtron.ai/)或Rancher之类的集群管理工具可以帮助您大规模部署和管理复杂的应用程序，同时抽象出Kubernetes的复杂性。

### 本地管理工具
有多种工具可以帮助您在本地设置和管理Kubernetes集群。它们提供了巨大的价值，因为本地设置缺乏云提供商提供的集群管理功能。

**K3S和RKE2**: K3S是一个轻量级的Kubernetes发行版，而RKE2则非常注重安全性。与使用Kubeadm或类似工具的传统Kubernetes引导过程相比，这两个工具都易于设置。**Vault**: Kubernetes密钥未加密，并以Base64格式编码。使用Vault之类的外部密钥管理器可以防止密钥和环境变量泄漏。**Devtron的Kubernetes Dashboard**: [Devtron的Kubernetes Dashboard](https://devtron.ai/product/k8s-dashboard)作为一个单一工具，帮助用户从单一窗格管理多个Kubernetes集群。虽然它并非特定于本地环境，但它可以帮助操作员管理集群，提供对所有集群资源的可见性，部署和管理Helm图表，并支持集群升级过程。它具有强大的基于角色的访问控制(RBAC)支持，以限制团队成员之间的访问权限。**Ceph**: Ceph是一个分布式存储系统，用于处理持久数据可靠性。它可以用来管理Kubernetes集群中的存储驱动程序。Ceph拥有专用的容器存储接口(CSI)驱动程序，这有助于使其与Kubernetes块存储设备兼容。

## 结论
在云、本地和混合环境之间进行选择取决于组织独特的可扩展性、成本、控制和合规性需求。云解决方案提供了无与伦比的灵活性和易于扩展性，而本地设置则为敏感工作负载提供了无与伦比的控制和安全性。另一方面，混合云通过结合两者的优势来取得平衡，使企业能够针对特定用例优化其基础设施。

[Devtron](https://devtron.ai/)可以通过简化[应用程序管理](https://devtron.ai/blog/kubernetes-dashboard-for-application-management/)和[集群管理](https://devtron.ai/blog/kubernetes-dashboard-for-cluster-management/)来帮助简化与Kubernetes相关的许多复杂性，无论它是在云中还是在本地托管。如果您正在寻找一个端到端的解决方案来管理您的Kubernetes集群，请查看[Devtron的GitHub仓库](https://github.com/devtron-labs/devtron)并试用它。

随着技术的不断发展，组织必须仔细评估其运营目标、合规性要求和预算限制，以确定正确的策略。无论是利用云的敏捷性、本地的控制性还是混合的通用性，关键在于将基础设施与业务优先级相结合，以推动效率和创新。

[YOUTUBE.COM/THENEWSTACK 技术发展迅速，不要错过任何一集。订阅我们的YouTube频道，收看我们所有的播客、访谈、演示等等。](https://youtube.com/thenewstack?sub_confirmation=1)