<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Building a Kubernetes Pod Doctor with Gradio and GPT-4</title>
    <link rel="stylesheet" href="https://www.codereliant.io/assets/built/screen.css?v=13585ad5c8">

    <meta name="description" content="Pod Doctor allows you to interact with your Kubernetes pods, retrieve information and troubleshoot pods, and receive expert insights from GPT-4">
    <link rel="icon" href="https://www.codereliant.io/content/images/size/w256h256/2023/07/favicon.png" type="image/png">
    <link rel="canonical" href="https://www.codereliant.io/pod-doctor/">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <meta property="og:site_name" content="CodeReliant">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Building a Kubernetes Pod Doctor with Gradio and GPT-4">
    <meta property="og:description" content="Pod Doctor allows you to interact with your Kubernetes pods, retrieve information and troubleshoot pods, and receive expert insights from GPT-4">
    <meta property="og:url" content="https://www.codereliant.io/pod-doctor/">
    <meta property="og:image" content="https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDN8fGRvY3RvcnxlbnwwfHx8fDE3MTEzNzk0NDR8MA&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;2000content/images/size/w1200">
    <meta property="article:published_time" content="2024-03-26T15:56:42.000Z">
    <meta property="article:modified_time" content="2024-03-26T15:56:42.000Z">
    <meta property="article:tag" content="AI">
    <meta property="article:tag" content="SRE">
    <meta property="article:tag" content="Python">
    
    <meta property="article:publisher" content="https://www.facebook.com/codereliant">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Building a Kubernetes Pod Doctor with Gradio and GPT-4">
    <meta name="twitter:description" content="Pod Doctor allows you to interact with your Kubernetes pods, retrieve information and troubleshoot pods, and receive expert insights from GPT-4">
    <meta name="twitter:url" content="https://www.codereliant.io/pod-doctor/">
    <meta name="twitter:image" content="https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDN8fGRvY3RvcnxlbnwwfHx8fDE3MTEzNzk0NDR8MA&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;2000content/images/size/w1200">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Team CodeReliant">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="AI, SRE, Python">
    <meta name="twitter:site" content="@codereliant">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="800">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "CodeReliant",
        "url": "https://www.codereliant.io/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://www.codereliant.io/content/images/2023/06/Black---White-Minimalist-Business-Logo--1--1.png"
        }
    },
    "author": {
        "@type": "Person",
        "name": "Team CodeReliant",
        "image": {
            "@type": "ImageObject",
            "url": "https://www.codereliant.io/content/images/2023/06/Logo--4--1.png",
            "width": 400,
            "height": 400
        },
        "url": "https://www.codereliant.io/author/team/",
        "sameAs": [
            "https://www.codereliant.io/"
        ]
    },
    "headline": "Building a Kubernetes Pod Doctor with Gradio and GPT-4",
    "url": "https://www.codereliant.io/pod-doctor/",
    "datePublished": "2024-03-26T15:56:42.000Z",
    "dateModified": "2024-03-26T15:56:42.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3wxMTc3M3wwfDF8c2VhcmNofDN8fGRvY3RvcnxlbnwwfHx8fDE3MTEzNzk0NDR8MA&ixlib=rb-4.0.3&q=80&w=2000content/images/size/w1200",
        "width": 1200,
        "height": 800
    },
    "keywords": "AI, SRE, Python",
    "description": "Hey devs,\nAs many of you, I’ve been exploring how AI can help me be more productive with my day to day tasks. So “Pod Doctor” was born. This is a little tool (just 180 lines!) which helps me with Kubernetes Pod troubleshooting faster than if I were to do it myself. You can find the full code on github and in this beginner tutorial we’ll go through the steps required to be able build similar tools for yourself.\n\nWe’ll learn how to create Gradio&#x27;s chatbot UI, integrate the Kubernetes Python client",
    "mainEntityOfPage": "https://www.codereliant.io/pod-doctor/"
}
    </script>

    <meta name="generator" content="Ghost 5.81">
    <link rel="alternate" type="application/rss+xml" title="CodeReliant" href="https://www.codereliant.io/rss/">
    <script defer src="https://cdn.jsdelivr.net/ghost/portal@~2.37/umd/portal.min.js" data-i18n="false" data-ghost="https://www.codereliant.io/" data-key="8131b2c2ef99a59bf945b573a1" data-api="https://codereliant.ghost.io/ghost/api/content/" crossorigin="anonymous"></script><style id="gh-members-styles">.gh-post-upgrade-cta-content,
.gh-post-upgrade-cta {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    text-align: center;
    width: 100%;
    color: #ffffff;
    font-size: 16px;
}

.gh-post-upgrade-cta-content {
    border-radius: 8px;
    padding: 40px 4vw;
}

.gh-post-upgrade-cta h2 {
    color: #ffffff;
    font-size: 28px;
    letter-spacing: -0.2px;
    margin: 0;
    padding: 0;
}

.gh-post-upgrade-cta p {
    margin: 20px 0 0;
    padding: 0;
}

.gh-post-upgrade-cta small {
    font-size: 16px;
    letter-spacing: -0.2px;
}

.gh-post-upgrade-cta a {
    color: #ffffff;
    cursor: pointer;
    font-weight: 500;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a:hover {
    color: #ffffff;
    opacity: 0.8;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a.gh-btn {
    display: block;
    background: #ffffff;
    text-decoration: none;
    margin: 28px 0 0;
    padding: 8px 18px;
    border-radius: 4px;
    font-size: 16px;
    font-weight: 600;
}

.gh-post-upgrade-cta a.gh-btn:hover {
    opacity: 0.92;
}</style>
    <script defer src="https://cdn.jsdelivr.net/ghost/sodo-search@~1.1/umd/sodo-search.min.js" data-key="8131b2c2ef99a59bf945b573a1" data-styles="https://cdn.jsdelivr.net/ghost/sodo-search@~1.1/umd/main.css" data-sodo-search="https://codereliant.ghost.io/" crossorigin="anonymous"></script>
    
    <link href="https://www.codereliant.io/webmentions/receive/" rel="webmention">
    <script defer src="/public/cards.min.js?v=13585ad5c8"></script>
    <link rel="stylesheet" type="text/css" href="/public/cards.min.css?v=13585ad5c8">
    <script defer src="/public/comment-counts.min.js?v=13585ad5c8" data-ghost-comments-counts-api="https://www.codereliant.io/members/api/comments/counts/"></script>
    <script defer src="/public/member-attribution.min.js?v=13585ad5c8"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/themes/prism-tomorrow.min.css" integrity="sha512-vswe+cgvic/XBoF1OcM/TeJ2FW0OofqAVdCZiEYkd6dwGXthvkSFWOoGGJgS2CW70VK5dQM5Oh+7ne47s74VTg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-730HG4Y2PY"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-730HG4Y2PY');
</script>
<style>
.cover-icon {
    display: none;
    }
</style><style>:root {--ghost-accent-color: #ff572f;}</style>
</head>

<body class='post-template tag-ai tag-sre tag-python is-head-left-logo'>
<div class="site">

    <header id="gh-head" class="gh-head gh-outer">
        <div class="gh-head-inner gh-inner">
            <div class="gh-head-brand">
                <div class="gh-head-brand-wrapper">
                    <a class="gh-head-logo" href="https://www.codereliant.io">
                            <img src="https://www.codereliant.io/content/images/2023/06/Black---White-Minimalist-Business-Logo--1--1.png" alt="CodeReliant">
                    </a>
                </div>
                <button class="gh-search gh-icon-btn" aria-label="Search this site" data-ghost-search><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></button>
                <button class="gh-burger"></button>
            </div>

            <nav class="gh-head-menu">
                <ul class="nav">
    <li class="nav-home"><a href="https://www.codereliant.io/">Home</a></li>
    <li class="nav-about"><a href="https://www.codereliant.io/about/">About</a></li>
    <li class="nav-free-goodies"><a href="https://www.codereliant.io/free-goodies/">Free Goodies</a></li>
    <li class="nav-topics"><a href="https://www.codereliant.io/topics/">Topics</a></li>
</ul>

            </nav>

            <div class="gh-head-actions">
                    <button class="gh-search gh-icon-btn" aria-label="Search this site" data-ghost-search><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></button>
                    <div class="gh-head-members">
                                <a class="gh-head-link" href="#/portal/signin" data-portal="signin">Sign in</a>
                                <a class="gh-head-btn gh-btn gh-primary-btn" href="#/portal/signup" data-portal="signup">Subscribe</a>
                    </div>
            </div>
        </div>
    </header>


    <div class="site-content">
        
<main class="site-main">

        <article class="single post tag-ai tag-sre tag-python featured">

        <header class="single-header gh-canvas">
            <div class="single-meta">
                <span class="single-meta-item single-meta-date">
                    <time datetime="2024-03-26">
                        Mar 26, 2024
                    </time>
                </span>
                    <span class="single-meta-item single-meta-length">
                        6 min read
                    </span>
                    <span class="single-meta-item single-meta-tag">
                        <a class="post-tag post-tag-ai" href="/tag/ai/">
                            AI
                        </a>
                    </span>
            </div>

            <h1 class="single-title">Building a Kubernetes Pod Doctor with Gradio and GPT-4</h1>


                <figure class="single-media kg-width-wide">
                    <div class="u-placeholder horizontal">
                        <img
                            class="u-object-fit"
                            srcset="https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDN8fGRvY3RvcnxlbnwwfHx8fDE3MTEzNzk0NDR8MA&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;400 400w,
https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDN8fGRvY3RvcnxlbnwwfHx8fDE3MTEzNzk0NDR8MA&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;750 750w,
https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDN8fGRvY3RvcnxlbnwwfHx8fDE3MTEzNzk0NDR8MA&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;960 960w,
https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDN8fGRvY3RvcnxlbnwwfHx8fDE3MTEzNzk0NDR8MA&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;1140 1140w"
                            sizes="(min-width: 1200px) 920px, 92vw"
                            src="https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;fit&#x3D;max&amp;fm&#x3D;jpg&amp;ixid&#x3D;M3wxMTc3M3wwfDF8c2VhcmNofDN8fGRvY3RvcnxlbnwwfHx8fDE3MTEzNzk0NDR8MA&amp;ixlib&#x3D;rb-4.0.3&amp;q&#x3D;80&amp;w&#x3D;960"
                            alt="Building a Kubernetes Pod Doctor with Gradio and GPT-4"
                        >
                    </div>

                        <figcaption><span style="white-space: pre-wrap;">Photo by </span><a href="https://unsplash.com/@nci?utm_source=ghost&amp;utm_medium=referral&amp;utm_campaign=api-credit"><span style="white-space: pre-wrap;">National Cancer Institute</span></a><span style="white-space: pre-wrap;"> / </span><a href="https://unsplash.com/?utm_source=ghost&amp;utm_medium=referral&amp;utm_campaign=api-credit"><span style="white-space: pre-wrap;">Unsplash</span></a></figcaption>
                </figure>
        </header>

    <div class="single-content gh-content gh-canvas">
        <p>Hey devs, <br>As many of you, I’ve been exploring how AI can help me be more productive with my day to day tasks. So <strong>“Pod Doctor”</strong> was born. This is a little tool (just <strong>180</strong> lines!) which helps me with Kubernetes Pod troubleshooting faster than if I were to do it myself. You can find the full code on&nbsp;<a href="https://github.com/codereliant/pod-doctor?ref=codereliant.io" rel="noreferrer">github</a> and in this beginner tutorial we’ll go through the steps required to be able build similar tools for yourself.<br><br>We’ll learn how to create&nbsp;<a href="https://www.gradio.app/?ref=codereliant.io">Gradio's</a> chatbot UI, integrate the&nbsp;<a href="https://github.com/kubernetes-client/python?ref=codereliant.io">Kubernetes Python client</a>, and leverage GPT-4's language for understanding and reasoning.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://www.codereliant.io/content/images/2024/03/Pod-Doctor-1.png" class="kg-image" alt="" loading="lazy" width="2000" height="1156" srcset="https://www.codereliant.io/content/images/size/w600/2024/03/Pod-Doctor-1.png 600w, https://www.codereliant.io/content/images/size/w1000/2024/03/Pod-Doctor-1.png 1000w, https://www.codereliant.io/content/images/size/w1600/2024/03/Pod-Doctor-1.png 1600w, https://www.codereliant.io/content/images/2024/03/Pod-Doctor-1.png 2000w" sizes="(min-width: 720px) 720px"><figcaption><span style="white-space: pre-wrap;">Pod Doctor</span></figcaption></figure><h2 id="user-interface">User Interface:</h2><p>The user interface of the Pod Doctor application is built using <a href="https://www.gradio.app/?ref=codereliant.io" rel="noreferrer">Gradio</a>, which is a Python library for creating customizable UI components and deploying machine learning models. The interface consists of the following elements:</p><ol><li><strong>Title</strong>: A label displaying the name of the application, "Pod Doctor."</li><li><strong>Chatbot</strong>: A chatbot-style interface for displaying the conversation between the user and the language model.</li><li><strong>Namespace Dropdown</strong>: A dropdown menu that allows users to select the Kubernetes namespace they want to interact with.</li><li><strong>Pod Dropdown</strong>: A dropdown menu that populates with the list of pods available in the selected namespace.</li><li><strong>Include Events Checkbox</strong>: A checkbox that allows users to include pod events in the information provided to the language model.</li><li><strong>Include Logs Checkbox</strong>: A checkbox that allows users to include pod logs in the information provided to the language model.</li><li><strong>Message Input</strong>: A text input field where users can type their messages or queries.</li></ol><pre><code class="language-python">with gr.Blocks(theme=gr.themes.Soft()) as demo:
    with gr.Row():
        title = gr.Label("Pod Doctor")
    with gr.Row():
        with gr.Column(scale=4):
            chatbot = gr.Chatbot(height="600px")
        with gr.Column(scale=1):
            namespace = gr.Dropdown(
                list_namespaces(),
                label="Namespace",
                info="Select the namespace you want to check the pod in.",
                interactive=True,
            )
            pod = gr.Dropdown(
                [],
                label="Pod",
                info="Select the pod you want to interact with.",
                interactive=True,
            )
            include_events = gr.Checkbox(
                label="Include Events",
                info="Include the pod events.",
                interactive=True,
            )
            include_logs = gr.Checkbox(
                label="Include Logs",
                info="Include the pod logs.",
                interactive=True,
            )
            namespace.change(namespace_change, inputs=namespace, outputs=pod)
    with gr.Row():
        msg = gr.Textbox()

    def respond(message, chat_history, namespace, pod, include_events, include_logs):
        if not namespace or not pod or not message:
            chat_history.append((message or "Error", "Please select a namespace and pod."))
            return "", chat_history
        bot_message = call_llm(message, namespace, pod, include_events, include_logs)
        new_message = f"Namespace {namespace}, Pod: {pod}, Include Events: {include_events}, Include Logs: {include_logs} \n {message}"
        chat_history.append((new_message, bot_message))
        return "", chat_history
    msg.submit(respond, [msg, chatbot, namespace, pod, include_events, include_logs], [msg, chatbot])</code></pre><p>As we progress through the tutorial, you may encounter function calls that are not yet defined. However, these functions will be explained and implemented as we move forward.</p><p>Let's define a function that is responsible for updating the dropdown of pods once a namespace is selected:</p><pre><code class="language-python">def namespace_change(value):
    """
    Returns a Dropdown widget populated with a list of pods based on the given value.

    Args:
        value (str): The namespace to filter the pods.

    Returns:
        gr.Dropdown: A Dropdown widget with choices populated from the list of pods.
    """
    pods = list_pods(value)
    return gr.Dropdown(choices=pods)</code></pre><h2 id="kubernetes-integration">Kubernetes Integration</h2><p>The Pod Doctor application integrates with a Kubernetes cluster using the <code>kubernetes</code> Python <a href="https://github.com/kubernetes-client/python?ref=codereliant.io">library</a>. The following functions handle the interaction with the Kubernetes API:</p><p>first we need to import the k8s library and load the config :</p><pre><code class="language-python">from kubernetes import client, config

config.load_kube_config()</code></pre><p><code>list_namespaces()</code>: Retrieves a list of namespaces from the Kubernetes cluster.</p><pre><code class="language-python">def list_namespaces():
    """
    Retrieves a list of namespaces from the Kubernetes cluster.

    Returns:
        A list of namespace names.
    """
    v1 = client.CoreV1Api()
    namespaces = v1.list_namespace()
    return [namespace.metadata.name for namespace in namespaces.items]</code></pre><p><code>list_pods(namespace)</code>: Lists all pods in the specified namespace.</p><pre><code>def list_pods(namespace):
    """
    List all pods in the specified namespace.

    Args:
        namespace (str): The namespace to list pods from.

    Returns:
        list: A list of pod names.
    """
    v1 = client.CoreV1Api()
    pods = v1.list_namespaced_pod(namespace)
    return [pod.metadata.name for pod in pods.items]</code></pre><p><code>get_pod_info(namespace, pod, include_events, include_logs)</code>: Retrieves detailed information about a specific pod, including events and logs if requested.</p><pre><code class="language-python">def get_pod_info(namespace, pod, include_events, include_logs):
    """
    Retrieves information about a specific pod in a given namespace.

    Args:
        namespace (str): The namespace of the pod.
        pod (str): The name of the pod.
        include_events (bool): Flag indicating whether to include events associated with the pod.
        include_logs (bool): Flag indicating whether to include logs of the pod.

    Returns:
        dict: A dictionary containing the pod information, events (if include_events is True), and logs (if include_logs is True).
    """
    v1 = client.CoreV1Api()
    pod_info = v1.read_namespaced_pod(pod, namespace)
    pod_info_map = pod_info.to_dict()
    pod_info_map["metadata"]["managed_fields"] = None
    
    info = {
        "PodInfo": pod_info_map,
    }
    if include_events:
        events = v1.list_namespaced_event(namespace)
        info["Events"] = [
            {
                "Name": event.metadata.name,
                "Message": event.message,
                "Reason": event.reason,
            }
            for event in events.items
            if event.involved_object.name == pod
        ]
    if include_logs:
        logs = v1.read_namespaced_pod_log(pod, namespace)
        info["Logs"] = logs
    
    return info</code></pre><h2 id="llm-gpt-4">LLM &amp; GPT-4</h2><p>The heart of the Pod Doctor application is the integration with the GPT-4 language model from OpenAI. The <code>call_llm</code> function is responsible for generating a response based on the user's message, the selected namespace, pod, and the options for including events and logs.</p><p>Here's how the <code>call_llm</code> function works:</p><ol><li>The&nbsp;<code>get_pod_info</code>&nbsp;function is called to retrieve the pod information, including events and logs if requested.</li><li>The&nbsp;<code>create_prompt</code>&nbsp;function generates a prompt message by combining the user's message with the pod information.</li><li>The OpenAI API is called using the&nbsp;<code>openAiClient.chat.completions.create</code>&nbsp;method, passing the prompt message and the GPT-4 model.</li><li>The response from the language model is returned and displayed in the chatbot interface.</li></ol><pre><code class="language-python">from openai import OpenAI
import yaml

openAiClient = OpenAI()

def create_prompt(msg, info):
    """
    Creates a prompt message with the given message and pod information.

    Args:
        msg (str): The main message for the prompt.
        info (dict): A dictionary containing pod information.

    Returns:
        str: The generated prompt message.
    """
    prompt = f"{msg}\n"
    prompt += f"Pod Info: \n {yaml.dump(info['PodInfo'])} \n"
    if info.get("Events"):
        prompt += f"Here are the last few events for the pod: \n"
        for event in info["Events"]:
            prompt += f"Event: {event['Name']}, Reason: {event['Reason']}, Message: {event['Message']}\n"
    if info.get("Logs"):
        prompt += f"Here are the last few logs for the pod: \n"
        prompt += info["Logs"]
    return prompt


def call_llm(msg, namespace, pod, include_events, include_logs):
    """
    Calls the Language Model to generate a response based on the given message, namespace, pod, and options.

    Args:
        msg (str): The user's message.
        namespace (str): The namespace of the pod.
        pod (str): The name of the pod.
        include_events (bool): Whether to include events in the pod information.
        include_logs (bool): Whether to include logs in the pod information.

    Returns:
        str: The generated response from the Language Model.
    """
    info = get_pod_info(namespace, pod, include_events, include_logs)
    prompt = create_prompt(msg, info)
    
    completion = openAiClient.chat.completions.create(
        model="gpt-3.5-turbo",
        messages=[
            {"role": "system", "content": "You are a kubernetes expert, and will help the user with request below based on the context and info provided"},
            {"role": "user", "content": prompt}
        ]
    )
    return completion.choices[0].message.content</code></pre><h2 id="usage">Usage</h2><p>We need one piece of code to wrap everything together:</p><pre><code class="language-python">if __name__ == "__main__":
    demo.launch()</code></pre><pre><code class="language-bash">export OPENAI_API_KEY='sk-xxxxxxxxxx'
python app.py</code></pre><p>To use the Pod Doctor application, follow these steps:</p><ol><li>Make sure your local kubernetes config is setup try <code>kubectl cluster-info</code></li><li>Select the desired Kubernetes namespace from the "Namespace" dropdown.</li><li>Select the pod you want to interact with from the "Pod" dropdown.</li><li>Optional: Check the "Include Events" and "Include Logs" checkboxes if you want to include pod events and logs in the information provided to the language model.</li><li>Type your message or query in the text input field and press Enter.</li><li>The application will display the response from the GPT-4 language model in the chatbot interface.</li></ol><p>Let's try a deploying a pod with the wrong port in the probes configuration and ask Pod Doctor to troubleshoot it for us.</p><p>Below is the bad nginx pod we will apply:</p><pre><code class="language-yaml">apiVersion: v1
kind: Pod
metadata:
  name: nginx
spec:
  containers:
    - name: nginx
      image: nginx
      ports:
        - containerPort: 80
      livenessProbe:
        httpGet:
          path: /
          port: 81
      readinessProbe:
        httpGet:
          path: /
          port: 81
</code></pre><p>After we apply this yaml we go to our app, select the namespace where we aplied it, select include events and logs, and type `troubleshoot` in the textbox, hit enter and watch the magic:</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://www.codereliant.io/content/images/2024/03/image-1.png" class="kg-image" alt="" loading="lazy" width="2000" height="1108" srcset="https://www.codereliant.io/content/images/size/w600/2024/03/image-1.png 600w, https://www.codereliant.io/content/images/size/w1000/2024/03/image-1.png 1000w, https://www.codereliant.io/content/images/size/w1600/2024/03/image-1.png 1600w, https://www.codereliant.io/content/images/2024/03/image-1.png 2000w" sizes="(min-width: 720px) 720px"><figcaption><span style="white-space: pre-wrap;">Pod Doctor Troubleshooting Pod</span></figcaption></figure><p>As we can see Pod Doctor was able to successfully troubleshoot the pod, and provide a root cause solution.</p><h2 id="conclusion">Conclusion</h2><p>By combining the power of <a href="https://www.gradio.app/?ref=codereliant.io">Gradio</a> for building user interfaces, the <a href="https://github.com/kubernetes-client/python?ref=codereliant.io">Kubernetes Python library</a> for interacting with Kubernetes pods, and the advanced language understanding capabilities of GPT-4, the <strong>Pod Doctor</strong> application provides a powerful and intuitive way to interact with and troubleshoot your Kubernetes pods.</p><p>You can find the full code in <a href="https://github.com/codereliant/pod-doctor?ref=codereliant.io">github</a>.</p><div class="kg-card kg-signup-card kg-width-regular " data-lexical-signup-form="" style="background-color: #F0F0F0; display: none;">
            
            <div class="kg-signup-card-content">
                
                <div class="kg-signup-card-text kg-align-center">
                    
                    <p class="kg-signup-card-subheading" style="color: #000000;"><span style="white-space: pre-wrap;">Join our weekly Newsletter for more tips!</span></p>
                    
        <form class="kg-signup-card-form" data-members-form="signup">
            <input data-members-label="" type="hidden" value="top_post_grey_cta">
            <div class="kg-signup-card-fields">
                <input class="kg-signup-card-input" id="email" data-members-email="" type="email" required="true" placeholder="Your email">
                <button class="kg-signup-card-button kg-style-accent" style="color: #FFFFFF;" type="submit">
                    <span class="kg-signup-card-button-default">Subscribe</span>
                    <span class="kg-signup-card-button-loading"><svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 24 24">
        <g stroke-linecap="round" stroke-width="2" fill="currentColor" stroke="none" stroke-linejoin="round" class="nc-icon-wrapper">
            <g class="nc-loop-dots-4-24-icon-o">
                <circle cx="4" cy="12" r="3"></circle>
                <circle cx="12" cy="12" r="3"></circle>
                <circle cx="20" cy="12" r="3"></circle>
            </g>
            <style data-cap="butt">
                .nc-loop-dots-4-24-icon-o{--animation-duration:0.8s}
                .nc-loop-dots-4-24-icon-o *{opacity:.4;transform:scale(.75);animation:nc-loop-dots-4-anim var(--animation-duration) infinite}
                .nc-loop-dots-4-24-icon-o :nth-child(1){transform-origin:4px 12px;animation-delay:-.3s;animation-delay:calc(var(--animation-duration)/-2.666)}
                .nc-loop-dots-4-24-icon-o :nth-child(2){transform-origin:12px 12px;animation-delay:-.15s;animation-delay:calc(var(--animation-duration)/-5.333)}
                .nc-loop-dots-4-24-icon-o :nth-child(3){transform-origin:20px 12px}
                @keyframes nc-loop-dots-4-anim{0%,100%{opacity:.4;transform:scale(.75)}50%{opacity:1;transform:scale(1)}}
            </style>
        </g>
    </svg></span>
                </button>
            </div>
            <div class="kg-signup-card-success" style="color: #000000;">
                Email sent! Check your inbox to complete your signup.
            </div>
            <div class="kg-signup-card-error" style="color: #000000;" data-members-error=""></div>
        </form>
        
                    
                </div>
            </div>
        </div>
    </div>

    <div class="gh-canvas">
    <footer class="single-footer">

        <div class="single-footer-left">
            <div class="navigation navigation-previous">
                <a class="navigation-link" href="/the-most-tragic-bug/" aria-label="Previous post">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" fill="currentColor" class="icon navigation-icon">
    <path d="M26.667 14.667v2.667h-16L18 24.667l-1.893 1.893L5.547 16l10.56-10.56L18 7.333l-7.333 7.333h16z"></path>
</svg>                </a>
            </div>
        </div>

        <div class="single-footer-middle">
        </div>

        <div class="single-footer-right">
        </div>

    </footer>
    </div>

</article>
            <section class="related-wrapper gh-canvas">
        <h3 class="related-title">You might also like...</h3>
        <div class="related-feed">
                <article class="feed members post featured">

    <div class="feed-calendar">
        <div class="feed-calendar-month">
            Mar
        </div>
        <div class="feed-calendar-day">
            14
        </div>
    </div>

    <h2 class="feed-title">SRE Interview Prep Plan (Week 6)</h2>

    <div class="feed-right">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" fill="currentColor" class="icon icon-star">
    <path d="M16 23.027L24.24 28l-2.187-9.373 7.28-6.307-9.587-.827-3.747-8.827-3.747 8.827-9.587.827 7.267 6.307L7.759 28l8.24-4.973z"></path>
</svg>        <div class="feed-length">
            5 min read
        </div>
    </div>

    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" fill="currentColor" class="icon feed-icon">
    <path d="M11.453 22.107L17.56 16l-6.107-6.12L13.333 8l8 8-8 8-1.88-1.893z"></path>
</svg>
    <a class="u-permalink" href="/sre-interview-prep-plan-week-6/" aria-label="SRE Interview Prep Plan (Week 6)"></a>

</article>                <article class="feed public post featured">

    <div class="feed-calendar">
        <div class="feed-calendar-month">
            Mar
        </div>
        <div class="feed-calendar-day">
            01
        </div>
    </div>

    <h2 class="feed-title">Chat with your Kubernetes Cluster</h2>

    <div class="feed-right">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" fill="currentColor" class="icon icon-star">
    <path d="M16 23.027L24.24 28l-2.187-9.373 7.28-6.307-9.587-.827-3.747-8.827-3.747 8.827-9.587.827 7.267 6.307L7.759 28l8.24-4.973z"></path>
</svg>        <div class="feed-length">
            5 min read
        </div>
    </div>

    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" fill="currentColor" class="icon feed-icon">
    <path d="M11.453 22.107L17.56 16l-6.107-6.12L13.333 8l8 8-8 8-1.88-1.893z"></path>
</svg>
    <a class="u-permalink" href="/chat-with-your-kubernetes-cluster/" aria-label="Chat with your Kubernetes Cluster"></a>

</article>                <article class="feed members post featured">

    <div class="feed-calendar">
        <div class="feed-calendar-month">
            Feb
        </div>
        <div class="feed-calendar-day">
            13
        </div>
    </div>

    <h2 class="feed-title">SRE Interview Prep Plan (Week 5)</h2>

    <div class="feed-right">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" fill="currentColor" class="icon icon-star">
    <path d="M16 23.027L24.24 28l-2.187-9.373 7.28-6.307-9.587-.827-3.747-8.827-3.747 8.827-9.587.827 7.267 6.307L7.759 28l8.24-4.973z"></path>
</svg>        <div class="feed-length">
            5 min read
        </div>
    </div>

    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" fill="currentColor" class="icon feed-icon">
    <path d="M11.453 22.107L17.56 16l-6.107-6.12L13.333 8l8 8-8 8-1.88-1.893z"></path>
</svg>
    <a class="u-permalink" href="/sre-interview-prep-plan-week-5/" aria-label="SRE Interview Prep Plan (Week 5)"></a>

</article>                <article class="feed members post featured">

    <div class="feed-calendar">
        <div class="feed-calendar-month">
            Jan
        </div>
        <div class="feed-calendar-day">
            29
        </div>
    </div>

    <h2 class="feed-title">Why Distributed Systems Fail? (part 2)</h2>

    <div class="feed-right">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" fill="currentColor" class="icon icon-star">
    <path d="M16 23.027L24.24 28l-2.187-9.373 7.28-6.307-9.587-.827-3.747-8.827-3.747 8.827-9.587.827 7.267 6.307L7.759 28l8.24-4.973z"></path>
</svg>        <div class="feed-length">
            5 min read
        </div>
    </div>

    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" fill="currentColor" class="icon feed-icon">
    <path d="M11.453 22.107L17.56 16l-6.107-6.12L13.333 8l8 8-8 8-1.88-1.893z"></path>
</svg>
    <a class="u-permalink" href="/why-distributed-systems-fail-2/" aria-label="Why Distributed Systems Fail? (part 2)"></a>

</article>                <article class="feed members post">

    <div class="feed-calendar">
        <div class="feed-calendar-month">
            Jan
        </div>
        <div class="feed-calendar-day">
            23
        </div>
    </div>

    <h2 class="feed-title">Why Distributed Systems Fail? (part 1)</h2>

    <div class="feed-right">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" fill="currentColor" class="icon icon-star">
    <path d="M16 23.027L24.24 28l-2.187-9.373 7.28-6.307-9.587-.827-3.747-8.827-3.747 8.827-9.587.827 7.267 6.307L7.759 28l8.24-4.973z"></path>
</svg>        <div class="feed-length">
            6 min read
        </div>
    </div>

    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" fill="currentColor" class="icon feed-icon">
    <path d="M11.453 22.107L17.56 16l-6.107-6.12L13.333 8l8 8-8 8-1.88-1.893z"></path>
</svg>
    <a class="u-permalink" href="/why-distributed-systems-fail-1/" aria-label="Why Distributed Systems Fail? (part 1)"></a>

</article>        </div>
    </section>

            <section class="gh-comments gh-canvas">
        <header class="gh-comments-header">
            <h3 class="gh-comments-title related-title">Member discussion</h3>
            <script
    data-ghost-comment-count="6601f9409bc1780001ba319e"
    data-ghost-comment-count-empty=""
    data-ghost-comment-count-singular="comment"
    data-ghost-comment-count-plural="comments"
    data-ghost-comment-count-tag="span"
    data-ghost-comment-count-class-name="gh-comments-count"
    data-ghost-comment-count-autowrap="true"
>
</script>
        </header>
        
        <script defer src="https://cdn.jsdelivr.net/ghost/comments-ui@~0.16/umd/comments-ui.min.js" data-ghost-comments="https://www.codereliant.io/" data-api="https://codereliant.ghost.io/ghost/api/content/" data-admin="https://codereliant.ghost.io/ghost/" data-key="8131b2c2ef99a59bf945b573a1" data-title="" data-count="false" data-post-id="6601f9409bc1780001ba319e" data-color-scheme="auto" data-avatar-saturation="60" data-accent-color="#ff572f" data-comments-enabled="all" data-publication="CodeReliant" crossorigin="anonymous"></script>
    
    </section>

</main>
    </div>

    <footer class="gh-foot gh-outer">
        <div class="gh-foot-inner gh-inner">
            <div class="gh-copyright">
                CodeReliant © 2024
            </div>
                <nav class="gh-foot-menu">
                    <ul class="nav">
    <li class="nav-sign-up"><a href="#/portal/">Sign up</a></li>
    <li class="nav-subscribe"><a href="#/portal/">Subscribe</a></li>
</ul>

                </nav>
            <div class="gh-powered-by">
                <a href="https://ghost.org/" target="_blank" rel="noopener">Powered by Ghost</a>
            </div>
        </div>
    </footer>

</div>

    <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="pswp__bg"></div>

    <div class="pswp__scroll-wrap">
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>
<script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous">
</script>
<script src='https://www.codereliant.io/assets/built/main.min.js?v=13585ad5c8'></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-core.min.js" integrity="sha512-9khQRAUBYEJDCDVP2yw3LRUQvjJ0Pjx0EShmaQjcHa6AXiOv6qHQu9lCAIR8O+/D8FtaCoJ2c0Tf9Xo7hYH01Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/autoloader/prism-autoloader.min.js" integrity="sha512-fTl/qcO1VgvKtOMApX2PdZzkziyr2stM65GYPLGuYMnuMm1z2JLJG6XVU7C/mR+E7xBUqCivykuhlzfqxXBXbg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdn.popupsmart.com/bundle.js" data-id="228301" async defer></script>

</body>
</html>